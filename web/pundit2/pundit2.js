angular.module("templates-main",["src/Annomatic/AnnomaticPanel.dir.tmpl.html","src/Annomatic/AnnomaticPopover.tmpl.html","src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html","src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html","src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html","src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html","src/Annotators/ImgMenu.dir.tmpl.html","src/Annotators/TextFragmentIcon.dir.tmpl.html","src/ContextualMenu/dropdown.tmpl.html","src/Core/confirm.modal.tmpl.html","src/Core/info.modal.tmpl.html","src/Core/login.modal.tmpl.html","src/Core/send.modal.tmpl.html","src/Dashboard/ClientDashboard.tmpl.html","src/Dashboard/Dashboard.dir.tmpl.html","src/Dashboard/DashboardPanel.dir.tmpl.html","src/Dashboard/pndTabs.dir.tmpl.html","src/Item/Item.dir.tmpl.html","src/Item/KorboItem.dir.tmpl.html","src/KorboEE/Korboee-callback.tmpl.html","src/KorboEE/Korboee-error-config.tmpl.html","src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tmpl.html","src/KorboEE/New/KorboEE.languagesPopover.tmpl.html","src/KorboEE/New/KorboEE.new.tmpl.html","src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html","src/KorboEE/Search/KorboEE.search.tmpl.html","src/KorboEE/Search/KorboEEverticalTabs.tmpl.html","src/KorboEE/autocompleteList.tmpl.html","src/KorboEE/korboee-entity.tmpl.html","src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html","src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html","src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html","src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html","src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html","src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html","src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html","src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html","src/Lists/itemList.tmpl.html","src/Lists/itemsContainer.tmpl.html","src/Notebook/Notebook.dir.tmpl.html","src/Preview/ClientDashboardPreview.tmpl.html","src/Preview/DashboardPreview.dir.tmpl.html","src/Preview/ItemPreview.dir.tmpl.html","src/Preview/NotebookPreview.dir.tmpl.html","src/ResourcePanel/datepicker.tmpl.html","src/ResourcePanel/popoverCalendar.tmpl.html","src/ResourcePanel/popoverLiteralText.tmpl.html","src/ResourcePanel/popoverResourcePanel.tmpl.html","src/ResourcePanel/verticalTabs.tmpl.html","src/SimplifiedClient/ItemPopover.tmpl.html","src/Toolbar/ClientToolbar.tmpl.html","src/Toolbar/Toolbar.dir.tmpl.html","src/Toolbar/myNotebooksDropdown.tmpl.html","src/Toolbar/templatesDropdown.tmpl.html","src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html","src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html","src/Tools/TripleComposer/ClientTripleComposer.tmpl.html","src/Tools/TripleComposer/Statement.dir.tmpl.html","src/Tools/TripleComposer/TripleComposer.dir.tmpl.html"]),angular.module("src/Annomatic/AnnomaticPanel.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/AnnomaticPanel.dir.tmpl.html",'<div ng-controller="AnnomaticPanelCtrl">\n    <div>\n\n        <button ng-disabled="targets.length == 0" class="btn btn-success pnd-button-suggestion" ng-click="getSuggestions()">\n            Scan Page <span class="pnd-icon pnd-icon-file-text"></span>\n        </button>\n\n        <button class="btn btn-success pnd-button-select-area" ng-click="selectAreaMode()">\n            Select area <span class="pnd-icon pnd-icon-edit"></span>\n        </button>\n\n        <div ng-show="Annomatic.annotationNumber > 0">\n            <button class="btn btn-danger pnd-button-start-review" ng-click="startReview()">\n                Review ({{Annomatic.currAnn}}/{{Annomatic.annotationNumber}})\n            </button>\n\n            <button\n                class="btn btn-default pnd-button-filter-suggestion"\n                ng-model="filteredTypes"\n                placeholder="Filter by suggestion type"\n                data-html="1"\n                data-multiple="1"\n                data-animation="am-flip-x"\n                ng-options="type.value as type.label for type in Annomatic.ann.typesOptions"\n                bs-select>\n            </button>\n        </div>\n    </div>\n    <div>\n'+"        Accepted: {{Annomatic.ann.byState['accepted'].join(', ')}}\n    </div>\n    <div>\n        Removed: {{Annomatic.ann.byState['removed'].join(', ')}}\n    </div>\n    <div>\n        filteredTypes: {{Annomatic.filteredTypes}}\n    </div>\n</div>")}]),angular.module("src/Annomatic/AnnomaticPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/AnnomaticPopover.tmpl.html",'<div class="pnd-annomatic-popover popover" ng-controller="AnnomaticPopoverCtrl">\n    <div class="arrow"></div>\n\n    <h4 class="popover-title" ng-click="showDetails = !showDetails">\n\n        <!--\n        TODO: decide if we want the caret or not\n        <span ng-show="!showDetails" class="pnd-icon pnd-icon-caret-right"></span>\n        <span ng-show="showDetails" class="pnd-icon pnd-icon-caret-down"></span>\n        -->\n\n        <span\n            style="opacity: {{ann.byNum[num].confidence}}"\n            title="Confidence {{ann.byNum[num].confidence}}"\n            class="pnd-icon pnd-icon-th-large pnd-confidence"></span>\n\n        {{ann.byNum[num].title}}\n\n        <span class="pull-right pnd-icon pnd-icon-times" ng-click="hide()"></span>\n    </h4>\n\n    <div class="popover-content">\n\n        <div ng-show="showDetails" class="pnd-preview clearfix">\n            <item-preview uri="{{ann.byNum[num].uri}}" sticking="false"></item-preview>\n        </div>\n\n        <div class="btn-group">\n\n            <button class="btn btn-warning pnd-button-go-prev" ng-click="goPrev()">\n                <span class="pnd-icon pnd-icon-arrow-left"></span>\n            </button>\n\n            <button class="btn btn-success pnd-button-set-ok" ng-click="setOk()">\n                <span class="pnd-icon pnd-icon-check"></span>\n            </button>\n\n            <button class="btn btn-danger pnd-button-set-ko" ng-click="setKo()">\n                <span class="pnd-icon pnd-icon-trash-o"></span>\n            </button>\n\n            <button\n                ng-show="instances > 1"\n                class="btn btn-info"\n                ng-click="acceptAll()"\n                ng-mouseover="toggleSimilar()"\n                ng-mouseout="toggleSimilar(content)">accept all {{instances}}</button>\n\n            <button class="btn btn-warning" ng-click="goNext()">\n                <span class="pnd-icon pnd-icon-arrow-right"></span>\n            </button>\n\n        </div>\n\n    </div>\n</div>')}]),angular.module("src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",'<span\n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()"\n    ng-click="clickHandler($event)"\n    class="{{textFragmentIconClass}} {{iconClass}}">\n</span>')}]),angular.module("src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",'<div \n    class="pnd-annotation-details-wrap pnd-ignore"\n    ng-mouseover="mouseoverAllHandler()"\n    ng-mouseout="mouseoutAllHandler()">\n    <div class="pnd-annotation-details-header pnd-annotation-details-top" \n        ng-click="toggleAnnotation()"\n        ng-class="{\'pnd-annotation-details-broken\': annotation.broken, \'pnd-annotation-details-ghosted\': annotation.ghosted}"\n        ng-mouseover="mouseoverHandler()"\n        ng-mouseout="mouseoutHandler()">\n        <div class="{{annotation.mainItem.class}}">\n		        <div class="pnd-annotation-item-header-text">\n                        <span ng-show="annotation.broken" class="pnd-icon pnd-icon-exclamation-circle"></span>\n		                <span class="pnd-annotation-icon-color" style="background-color: {{annotation.color}};"><span class="{{annotation.mainItem.icon}}"></span></span>\n		                <span class="pnd-item-title">{{annotation.mainItem.label}}</span>\n		        </div>    \n                <button type="button" class="btn pull-right">\n                    <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[annotation.expanded]"></span>\n                </button>\n        </div>\n    </div>\n    <div class="pnd-annotation-details-container" ng-if="annotation.expanded">\n\n        <div class="pnd-annotation-details-menu">\n            <div class="{{annotation.mainItem.class}}">\n	            <button type="button" class="btn btn-primary" ng-click="metaInfo = !metaInfo"><!--<span class="pnd-icon-exclamation-circle"></span>-->Meta</button>\n	            <button type="button" class="btn btn-primary" disabled><!--<span class="pnd-icon-mail-forward"></span>-->Reply</button>\n	            <button type="button" class="btn btn-primary" disabled><!--<span class="pnd-icon-share-square-o"></span>-->Share</button>\n            </div>\n        </div>\n\n        <div class="pnd-annotation-details-info" ng-show="metaInfo">\n            <div class="pnd-annotation-details-info-author">\n                <strong>Author:</strong> {{annotation.creatorName}}\n            </div>\n            <div class="pnd-annotation-details-info-date">\n                <strong>Date:</strong> {{annotation.created | date : \'MMM d, y H:mm a\'}}\n            </div>       \n            <div class="pnd-annotation-details-info-notebook">\n                <strong>Notebook:</strong> <a href="{{askLink}}{{annotation.notebookId}}" target="_blank">\n                    {{notebookName}}\n                </a>\n            </div>       \n        </div>\n        \n        <div class="pnd-annotation-details-content">\n            <div class="pnd-annotation-detains-item" ng-repeat="item in annotation.itemsArray">\n            <!-- subject -->\n                <div \n                    class="pnd-annotation-details-subject" \n                    ng-init="subInfo = false"\n                    ng-mouseover="mouseoverItemHandler(item.subject.uri)"\n                    ng-mouseout="mouseoutItemHandler(item.subject.uri)">\n                        <div \n                            class="pnd-annotation-details-item-header" \n                            ng-click="subInfo = !subInfo"\n                            ng-class="{\'pnd-annotation-details-sub-open\': subInfo}">\n                            <!-- <span class="{{item.subject.icon}}"></span> -->\n                            <div class="pnd-annotation-item-header-text">\n	                            <span class="pnd-icon pnd-icon-circle"></span>\n	                            <span ng-bind-html="item.subject.label">{{item.subject.label}}</span>\n                            </div>\n                            <button type="button" class="btn btn-link pull-right">\n                                <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[subInfo]"></span>\n                            </button>\n                        </div>\n\n                        <div ng-show="subInfo" class="pnd-sub-info">\n                            <span ng-if="subInfo">\n                                <item-preview uri="{{item.subject.uri}}" sticking="false"></item-preview>\n                            </span>\n                        </div>\n                </div>\n             <!-- // end subject -->\n             <!-- predicate -->\n                <div \n                    class="pnd-annotation-details-predicate" \n                    ng-init="preInfo = false">\n                        <div \n                            class="pnd-annotation-details-item-header" \n                            ng-click="preInfo = !preInfo"\n                            ng-class="{\'pnd-annotation-details-sub-open\': preInfo}">\n                        	<div class="pnd-annotation-item-header-text">\n    	                    	<span class="pnd-icon pnd-icon-circle"></span>\n    	                    	<span ng-bind-html="item.predicate.label">{{item.predicate.label}}</span>\n                        	</div>\n                            <button type="button" class="btn  btn-link pull-right">\n                                <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[preInfo]"></span>\n                            </button>\n                        </div>\n\n                        <div ng-show="preInfo" class="pnd-sub-info">\n                            <span ng-if="preInfo">\n                                <item-preview uri="{{item.predicate.uri}}" sticking="false"></item-preview>\n                            </span>\n                        </div>\n                </div>\n             <!-- // end predicate -->\n             <!-- // object -->\n                <div ng-repeat="object in item.objects">\n                    <div \n                        class="pnd-annotation-details-object"                         \n                        ng-init="objInfo = false"\n                        ng-mouseover="mouseoverItemHandler(object.uri)"\n                        ng-mouseout="mouseoutItemHandler(object.uri)">\n                            <div \n                                class="pnd-annotation-details-item-header" \n                                ng-click="objInfo = !objInfo"\n                                ng-class="{\'pnd-annotation-details-sub-open\': objInfo}">\n                                <!-- <span class="{{object.icon}}"></span> -->\n                                <div class="pnd-annotation-item-header-text">\n	                                <span class="pnd-icon pnd-icon-circle"></span>\n	                                <span ng-bind-html="object.label">{{object.label}}</span>\n                                </div>\n                                <button type="button" class="btn  btn-link pull-right">\n                                        <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[objInfo]"></span>\n                                </button>\n                            </div>\n                            <div ng-show="objInfo" class="pnd-sub-info">\n                                <span ng-if="objInfo">\n                                    <span ng-if="object.typeClass==\'uri\'">\n                                        <item-preview class="pnd-preview clearfix" uri="{{object.uri}}" sticking="false"></item-preview>\n                                    </span>\n                                    <span ng-if="object.typeClass!=\'uri\'">\n                                        <span ng-bind-html="object.label">{{object.label}}</span>\n                                    </span>\n                                </span>\n                            </div>\n                    </div>\n                </div>\n             <!-- // end object -->\n            </div>    \n        </div>\n        <!-- footer -->\n        <div class="pnd-annotation-details-footer" ng-show="isUserToolShowed()">\n            <button type="button" ng-if="showEdit()" class="btn btn-xs btn-success" ng-click="editAnnotation()">Edit</button>\n            <button type="button" class="btn btn-xs btn-danger" ng-click="deleteAnnotation()">Delete</button>\n        </div>\n        <!-- // end footer -->\n    </div>\n</div>')}]),angular.module("src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",'<div class="pnd-annotation-sidebar-container pnd-ignore">\n    <!-- <div class="pnd-annotation-sidebar-content" ng-show="isAnnotationSidebarExpanded"> -->\n    <div class="pnd-annotation-sidebar-content">\n\n        <div class="pnd-annotation-sidebar-content-exp" ng-show="isAnnotationSidebarExpanded">\n            <div class="pnd-annotation-sidebar-modes-buttons">\n                <button type="button"\n                        ng-click="activateSuggestionsPanel()"\n                        ng-class="{\'pnd-active\': isSuggestionsPanelActive()}"\n                        class="btn pnd-btn-sidebar"\n                        disabled>\n                    Suggestions\n                </button><button type="button"\n                        ng-click="activateAnnotationsPanel()"\n                        ng-class="{\'pnd-active\': isAnnotationsPanelActive()}"\n                        class="btn pnd-btn-sidebar">\n                    Annotations ({{annotations.length}}/{{allAnnotations.length}})\n                </button>\n            </div>\n\n            <div class="pnd-annotation-sidebar-filter-content" ng-show="isAnnotationsPanelActive()">\n\n                <div ng-class="{\'pnd-btn-sidebar-full\': !annotationSidebar.needToFilter()}">\n                    <button\n                        ng-click="annotationSidebar.toggleFiltersContent()"\n                        ng-show="!isFiltersShowed"\n                        class="btn btn-link pnd-annotation-sidebar-btn-show-filter">\n                            <span class="pnd-icon pnd-icon-filter"></span> Show Filters\n                    </button>\n                    <button ng-show="annotationSidebar.needToFilter() && !isFiltersShowed"\n                        class="btn btn-link pnd-annotation-sidebar-btn-remove-filters" ng-click="annotationSidebar.resetFilters()">\n                           <span class="pnd-icon pnd-icon-times"></span> Remove all filters\n                    </button>\n                </div>\n\n                <div class="pnd-annotation-sidebar-filters-list" ng-show="isFiltersShowed">\n                <!-- buttons -->\n                <!-- // end buttons -->\n                    \n\n                    <!-- Free text -->\n                    <div class="pnd-annotation-sidebar-filter-input-contains">\n                        <span \n                            class="pnd-icon" \n                            ng-class="setSearchIcon(annotationSidebar.filters.freeText.expression)" \n                            ng-click="freeText = \'\'"></span>\n                        <input class="form-control" ng-model="freeText" placeholder="Contains">\n                    </div>\n\n                    <!-- Authors -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Annotation author\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        	<span \n                                class="pnd-icon" \n                                ng-class="setFilterIcon(searchAuthors.label)" \n                                ng-click="searchAuthors.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchAuthors.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n    	                    <div \n    	                        ng-repeat="elem in filters.authors | orderObjectBy:\'partial\':\'dsc\' | filter:searchAuthors" \n    	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n    	                        class="pnd-annotation-sidebar-filter-element">\n    	                            <div \n    	                                class="pnd-annotation-sidebar-filter-element-label"\n    	                                ng-click="toggleFilter(\'authors\', elem.uri)">\n    	                                    <span class="pnd-icon pnd-icon-check"\n    	                                        ng-show="elem.active"></span>\n    	                                    {{elem.label}} ({{elem.partial}})\n    	                            </div>\n    	                    </div>\n                        </div>\n                    </div>\n\n                    <!-- Notebooks -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Notebooks\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                            <span \n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchNotebooks.label)" \n                                ng-click="searchNotebooks.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchNotebooks.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n                            <div \n                                ng-repeat="elem in filters.notebooks | orderObjectBy:\'partial\':\'dsc\' | filter:searchNotebooks" \n                                ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n                                class="pnd-annotation-sidebar-filter-element">\n                                    <div \n                                        class="pnd-annotation-sidebar-filter-element-label"\n                                        ng-click="toggleFilter(\'notebooks\', elem.uri)">\n                                            <span class="pnd-icon pnd-icon-check"\n                                                ng-show="elem.active"></span>\n                                            {{elem.label}} ({{elem.partial}})\n                                    </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Types -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Types\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                            <span\n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchTypes.label)" \n                                ng-click="searchTypes.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchTypes.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n    	                    <div ng-repeat="elem in filters.types | orderObjectBy:\'partial\':\'dsc\' | filter:searchTypes" \n    	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n    	                        class="pnd-annotation-sidebar-filter-element">\n    	                            <div \n    	                                class="pnd-annotation-sidebar-filter-element-label"\n    	                                ng-click="toggleFilter(\'types\', elem.uri)">\n    	                                    <span class="pnd-icon pnd-icon-check"\n    	                                          ng-show="elem.active"></span>\n    	                                {{elem.label}} ({{elem.partial}})\n    	                            </div>\n    	                    </div>\n                        </div>\n                    </div>\n\n                    <!-- Used predicate -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" \n                            ng-click = "toggleFilterList($event)">\n                            Used predicate\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        	<span\n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchPredicates.label)" \n                                ng-click="searchPredicates.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchPredicates.label" placeholder="Filter">\n                        </div>\n                        <div \n                            ng-repeat="elem in filters.predicates | orderObjectBy:\'partial\':\'dsc\' | filter:searchPredicates" \n                            ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n                            class="pnd-annotation-sidebar-filter-element">\n                                <div \n                                    class="pnd-annotation-sidebar-filter-element-label"\n                                    ng-click="toggleFilter(\'predicates\', elem.uri)">\n                                        <span class="pnd-icon pnd-icon-check"\n                                              ng-show="elem.active"></span>\n                                    {{elem.label}} ({{elem.partial}})\n                                </div>\n                        </div>\n                    </div>\n\n                    <!-- Page items -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Page Items\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        	<span\n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchEntities.label)" \n                                ng-click="searchEntities.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchEntities.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n    	                    <div \n    	                        ng-repeat="elem in filters.entities | orderObjectBy:\'partial\':\'dsc\' | filter:searchEntities" \n    	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n    	                        class="pnd-annotation-sidebar-filter-element">\n    	                            <div \n    	                                class="pnd-annotation-sidebar-filter-element-label"\n    	                                ng-click="toggleFilter(\'entities\', elem.uri)">\n    	                                    <span class="pnd-icon pnd-icon-check"\n    	                                          ng-show="elem.active"></span>\n    	                                {{elem.label}} ({{elem.partial}})\n    	                            </div>\n    	                    </div>\n                        </div>\n                    </div>\n\n                    <!-- Date -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">Date</div>\n                        <span \n                            ng-show="isFilterLabelShowed(annotationSidebar.filters.fromDate.expression)"\n                            class="pnd-annotation-sidebar-filter-label">\n                                From: {{annotationSidebar.filters.fromDate.expression}}\n                        </span>\n                        <span \n                            ng-show="isFilterLabelShowed(annotationSidebar.filters.toDate.expression)"\n                            class="pnd-annotation-sidebar-filter-label">\n                                To: {{annotationSidebar.filters.toDate.expression}}\n                        </span>\n\n                        <div class="pnd-annotation-sidebar-filter-input">\n                            <!-- From Date -->\n                            <input \n                                type="text" \n                                class="form-control" \n                                ng-model="annotationSidebar.filters.fromDate.expression" \n                                data-min-date="{{fromMinDate}}" \n                                data-max-date="{{fromMaxDate}}" \n                                placeholder="From" \n                                data-autoclose="1" \n                                data-date-type="string" \n                                data-date-format="yyyy-MM-dd" \n                                bs-datepicker\n                            >\n\n                            <!-- To Date -->\n                            <input \n                                type="text" \n                                class="form-control" \n                                ng-model="annotationSidebar.filters.toDate.expression" \n                                data-min-date="{{toMinDate}}" \n                                data-max-date="{{toMaxDate}}" \n                                placeholder="To" \n                                data-autoclose="1" \n                                data-date-type="string" \n                                data-date-format="yyyy-MM-dd" \n                                bs-datepicker\n                            >\n                            </div>\n                    </div>\n                    \n                    <!-- Broken -->\n					<div \n                        class="pnd-annotation-sidebar-filter-broken"\n                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': annotationSidebar.filters.broken.expression.length>0}" \n                        ng-click="toggleBrokenAnnotations()">\n    					<span \n                            ng-show="annotationSidebar.filters.broken.expression.length>0">\n                                Show broken annotations\n                        </span>\n    					<span \n                            ng-show="annotationSidebar.filters.broken.expression.length == 0">\n                                Hide broken annotations\n                        </span>\n					</div>\n\n                    <!-- buttons -->\n                    <div class="pnd-annotation-footer-sidebar-filter">\n    	                <button type="button" class="btn btn-xs btn-success pnd-annotation-sidebar-btn-close-filters" ng-click="annotationSidebar.toggleFiltersContent()">Hide filters</button>\n    	                <button type="button" class="btn btn-xs btn-success pnd-annotation-sidebar-btn-remove-filters" ng-click="annotationSidebar.resetFilters()">Remove all filters</button>\n                    </div>\n                    <!-- // end buttons -->\n                </div>\n            </div>\n\n            <div class="pnd-annotation-details-opacity" ng-show="isFiltersShowed" ng-click="annotationSidebar.toggleFiltersContent()">\n            </div>\n\n            <!-- Suggestions panel -->\n            <div class="pnd-annotation-sidebar-annotations" ng-show="isSuggestionsPanelActive()">\n                TODO! :)\n            </div>\n        </div>\n\n        <!-- List of annotations -->\n        <div \n            ng-show="isAnnotationsPanelActive()"\n            class="pnd-annotation-sidebar-annotations">\n\n            <!-- Loading -->\n            <div ng-show="isLoading" class="pnd-saving-content" ng-show="isAnnotationSidebarExpanded">\n            	<span class="pnd-icon pnd-icon-refresh pnd-icon-spin pnd-icon-2x"></span>\n                <span class="pnd-message">Loading</span>\n            </div>\n\n            <div ng-repeat="ann in filtered = (annotations)">\n                <!-- <annotation-details id="{{ann.id}}"></annotation-details> -->\n                <annotation-details id="{{ann.id}}" broken="ann.broken" style="position: absolute; top: {{annotationSidebar.annotationPositionReal[ann.id].top}}px"></annotation-details>\n            </div>\n            \n            <!-- \n                TODO: need to delegate the management of \n                annotations in the service of the sidebar\n                to avoid forcing the instance of details\n            -->\n            <div ng-if="allAnnotations.length == 0">\n                <annotation-details ng-show="false"></annotation-details>\n            </div>\n        </div>\n    </div>\n</div>')
}]),angular.module("src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html","<annotation-sidebar></annotation-sidebar>")}]),angular.module("src/Annotators/ImgMenu.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annotators/ImgMenu.dir.tmpl.html",'<div\n    ng-click="clickHandler($event)" \n    ng-mouseover="onMouseOver($event)" \n    ng-mouseleave="onMouseLeave($event)"\n    >\n        <span\n            ng-show="visible"\n            class="pnd-image-icon {{icon}}">\n        </span>\n</div>')}]),angular.module("src/Annotators/TextFragmentIcon.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annotators/TextFragmentIcon.dir.tmpl.html",'<span\n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()"\n    ng-click="clickHandler($event)"\n    class="{{textFragmentIconClass}} {{iconClass}}">\n</span>')}]),angular.module("src/ContextualMenu/dropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ContextualMenu/dropdown.tmpl.html",'<ul class="pnd-dropdown-contextual-menu dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-notebook\': item.currentNotebook, divider: item.divider, \'disabled\': item.disable, \'dropdown-submenu\': item.submenu, \'active\': item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text"></span>\n        <a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && !item.header && item.href" ng-bind="item.text"></a>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && !item.header && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="item.submenu" ng-mouseover="$eval(item.hover);" ng-mouseleave="$eval(item.leave);" ng-bind="item.text"></a>\n    </li>\n</ul>')}]),angular.module("src/Core/confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/confirm.modal.tmpl.html",'<div class="modal pnd-confirm-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-confirm-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-confirm-modal-footer">\n                <button type="button" class="btn btn-default pnd-confirm-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-confirm-modal-confirm" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Core/info.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/info.modal.tmpl.html",'<div class="modal pnd-info-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-info-modal-body">\n                <table class="table table-condensed pnd-table">\n                    <tr ng-repeat="field in info">\n                        <td class="modal-field-label">{{field.label}}</td>\n                        <td class="modal-field-value">{{field.value}}</td>\n                    </tr>\n                    <tr ng-repeat="link in links">\n                        <td class="modal-field-label">{{link.label}}</td>\n                        <td class="modal-field-value"><a target="_blank" href="{{link.ref}}">{{link.linkLabel}}</a></td>\n                    </tr>\n                </table>                \n            </div>\n\n            <div class="modal-footer pnd-info-modal-footer">\n                <button type="button" class="btn btn-default pnd-info-modal-close" ng-click="close()">Close</button>\n                <!-- <button type="button" class="btn btn-default pnd-info-modal-tell" ng-click="send()">Found a bug? tell us!</button> -->\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Core/login.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/login.modal.tmpl.html",'<div class="modal pnd-login-modal-container pnd-ignore" tabindex="-1" role="dialog" ng-controller="LoginModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title"> Login </h4>\n            </div>\n            <div class="modal-body pnd-login-modal-body">\n                {{notifyMessage}}\n            </div>\n            <div class="modal-footer pnd-login-modal-footer">\n                <button type="button" class="btn btn-default pnd-login-modal-close" ng-show="isUserLogged()" ng-click="closeModal()">Close</button>\n                <button type="button" class="btn btn-default pnd-login-modal-cancel" ng-show="!isUserLogged()" ng-click="cancelModal()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-login-modal-openPopUp" ng-show="!isUserLogged()" ng-click="loginPopUp()">Open the login window</button>\n            </div> <!-- end modal-footer -->\n        </div> <!-- end modal content-->\n    </div> <!-- end modal dialog-->\n</div> <!-- end modal -->\n\n\n')}]),angular.module("src/Core/send.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/send.modal.tmpl.html",'<div class="modal pnd-send-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-send-modal-body">\n            	<div class="form-group">\n	            	<label for="exampleInputEmail1">Subject <span class="pnd-mandatory-field"> * </span>:</label>\n	            	<input placeholder="Subject" ng-model="text.subject" class="form-control" >\n	            </div>\n	            <div class="form-group">\n	            	<label for="exampleInputPassword1">Description:</label>\n	            	<textarea ng-model="text.msg" class="form-control"  rows="5"></textarea>\n	            </div>\n            </div>\n\n            <div class="modal-footer pnd-send-modal-footer">\n            	<button type="button" class="btn btn-default pnd-send-modal-close" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-success disabled pnd-send-modal-send" ng-click="send()">Send</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Dashboard/ClientDashboard.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/ClientDashboard.tmpl.html","<dashboard></dashboard>")}]),angular.module("src/Dashboard/Dashboard.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/Dashboard.dir.tmpl.html",'<div class="pnd-ignore">\n\n    <div class="pnd-dashboard-container" ng-show="isDashboardVisible">\n\n        <!--footer-->\n        <div class="pnd-dashboard-footer"></div>\n\n    </div>\n\n</div>')}]),angular.module("src/Dashboard/DashboardPanel.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/DashboardPanel.dir.tmpl.html",'<div class="pnd-dashboard-panel" ng-class="{\'pnd-dashboard-panel-last\': isLast}"\n     style="width: {{width}}px; left: {{left}}px; bottom: {{bottom}}px;">\n\n    <div class="pnd-dashboard-panel-expanded" ng-hide="isCollapsed">\n        <!--<div class="pnd-dashboard-panel-nav"></div>-->\n        <div class="pnd-dashboard-panel-content" pnd-tabs="tabs">\n            <!-- the content comes from outside-->\n        </div>\n        <div class="pnd-dashboard-footer-handler" ng-mousedown="footerMouseDownHandler($event)"></div>\n        <button type="button" class="btn btn-xs btn-default pnd-btn-dashboard" ng-click="toggleCollapse()"><span class="pnd-icon pnd-icon-times"></span></button>\n    </div>\n\n    <div class="pnd-dashboard-panel-collapsed" ng-show="isCollapsed" style="width: {{collapsedWidth}}px;">\n        <div class="pnd-dashboard-panel-collapsed-content"></div>\n        <button type="button" class="btn btn-xs btn-default  pnd-btn-dashboard" ng-click="toggleCollapse()"><span class="pnd-icon pnd-icon-expand"></span></button>\n    </div>\n\n    <div class="pnd-dashboard-panel-separator"\n         ng-mousedown="mouseDownHandler($event)"\n         ng-show="!isLast"></div>\n\n</div>')}]),angular.module("src/Dashboard/pndTabs.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/pndTabs.dir.tmpl.html",'<ul class="nav nav-tabs pnd-tab-header" ng-class="{\'pnd-hidden-tabs\': hiddenTabsToShow()}">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}" ng-show="pane.isVisible">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n    </li>\n    <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n        <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n    </li>\n</ul>\n<div class="tab-content pnd-tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template" ng-show="$index == active"></div>\n</div>')}]),angular.module("src/Item/Item.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Item/Item.dir.tmpl.html",'<div class="pnd-item" ng-class="{\'pnd-sticky-item\': isSticky()}" ng-mouseover="onItemMouseOver()" ng-mouseleave="onItemMouseLeave()">\n    <div class="pnd-item-buttons">\n        <button ng-hide="hideOptions" type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link" title="Options"><span class="pnd-icon pnd-icon-bars"></span></button>\n        <button ng-hide="hideStickyButton" type="button" ng-click="onClickSticky($event)" class="btn btn-xs btn-link" title="Sticky"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n        <span ng-if="isSelected" class="pnd-icon pnd-icon-check"></span>\n    </div>\n\n    <div class="pnd-item-text">\n        <span ng-show="item.type.length > 0" class="pnd-item-typeLabel">{{itemTypeLabel}}</span>\n        <span class="pnd-item-label">{{item.label}}</span>\n    </div>\n\n</div>')}]),angular.module("src/Item/KorboItem.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Item/KorboItem.dir.tmpl.html",'<div class="pnd-item" ng-class="{\'pnd-sticky-item\': isSticky()}" ng-show="useInKorbo">\n\n    <div class="pnd-item-buttons">\n        <button ng-hide="hideOptions" type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link" title="Options"><span class="pnd-icon pnd-icon-bars"></span></button>\n        <button ng-hide="hideStickyButton" type="button" ng-click="onClickSticky($event)" class="btn btn-xs btn-link" title="Sticky"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n        <span ng-if="isSelected" class="pnd-icon pnd-icon-check"></span>\n    </div>\n\n    <div class="pnd-item-text">\n        <span ng-show="item.type.length > 0" class="pnd-item-typeLabel">{{itemTypeLabel}}</span>\n        <span class="pnd-item-label">{{item.label}}</span>\n        \n    </div>\n\n</div>')}]),angular.module("src/KorboEE/Korboee-callback.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-callback.tmpl.html","<!--\nUse only callback mode.\nYou can use API registered on Global Object defined in your configuration\n-->\n\n")}]),angular.module("src/KorboEE/Korboee-error-config.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-error-config.tmpl.html",'<div class="container error-ee-config">\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-globalobject" \n        ng-show="errorType == \'globalObject\'">\n            Configuration Error. Object {{conf.globalObjectName}} existing. Please check your configuration!\n    </div>\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-autocomplete" \n        ng-show="errorType == \'autoComplete\'">\n            CONFIGURATION ERROR. <br> \n            You can choise only one mode: useAutocompleteWithNew or useAutocompleteWithSearch. <br> \n            Please check your configuration!\n    </div>\n</div>')}]),angular.module("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",'<div class="modal kee-wrp pnd-confirm-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-confirm-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-confirm-modal-footer">\n                <button type="button" class="btn btn-default pnd-confirm-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-confirm-modal-confirm" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",'<ul class="nav nav-tabs" ng-hide="editMode">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}">{{pane.title}}<span class="badge pull-right" ng-show="pane.isStarted">{{pane.totalResults}}</span>\n        </a>\n    </li>\n</ul>\n<div class="tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template || \'$pane\'"></div>\n</div>\n')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tmpl.html",'<div class="kee-wrp kee-modal-container modal pnd-ignore" tabindex="-1" role="dialog" ng-controller="KeeModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content kee-modal-content">\n            <div class="modal-body kee-modal-body">\n                <div ng-model="korboModalTabs.activeTab" data-template="src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html" bs-tabs="korboModalTabs"> </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n')}]),angular.module("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",'<div class="pnd-korbo-languages-popover popover">\n    <div ng-repeat="lang in disactiveLanguages" class="kee-popover-item">\n        <div ng-click="addLanguage(lang); $hide()" >\n            <span class="pnd-icon pnd-icon-plus"></span> {{lang.name}} ({{lang.title}})\n        </div>\n    </div>\n</div>')}]),angular.module("src/KorboEE/New/KorboEE.new.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.new.tmpl.html",'<div ng-controller="KeeNewCtrl">\n    <!-- Top area -->\n    <div class="kee-top-area">\n        <div class="kee-top-area-menu pull-right">\n            <button type="button" class="btn btn-xs btn-link" ng-click="showDropdown($event)">\n                <span class="pnd-icon pnd-icon-gear"></span>\n            </button>\n        </div>\n        <div class="kee-top-area-message" ng-class="{\'kee-error\' : topArea.status == \'error\'}">\n            {{topArea.message}}\n        </div>\n    </div> \n    <!-- End top area -->\n\n    <!-- New content -->\n    <div class="kee-new-content" ng-hide="isSaving">\n    \n        <!-- Content on the right -->\n        <div class="kee-right-content" ng-hide="loadingStatus">\n\n            <!-- Original url-->\n            <div class="kee-new-original-url">\n	            <div class="form-group">\n	                <label>Original URL</label>\n	                <div class="left-inner-icon">\n                        <span class="pnd-icon pnd-icon-external-link" ng-click="openWindow(originalUrl);$event.stopPropagation();$event.preventDefault();"></span>\n                        <input \n                            type="text" \n                            class="form-control" \n                            ng-model="originalUrl" \n                            ng-disabled="originalUrlCheck">\n	                </div>\n	            </div>\n            </div>\n            <!-- End original url -->\n\n            <!-- Image url -->\n            <div class="kee-new-image-url">\n\n                <!-- Form group -->\n	            <div class="form-group">\n\n	            	<!-- Preview -->\n	                <div class="kee-preview-image">\n                    	<img ng-show="showImg" ng-src="{{previewImage}}"/>\n                    </div>\n	                <!-- End preview -->\n\n	                <span \n                        ng-show="errorImage" \n                        class="kee-message-error-image">\n                            Impossible to load image\n                    </span>\n                    <span \n                        ng-show="loadingImage" \n                        class="kee-message-loading-image">\n                            Loading image...\n                    </span>\n	                <label>\n                        Image URL\n	                    <span \n                            ng-show="!imageUrlHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="imageUrlHasError" \n                            class="kee-error pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n	                <input \n                        ng-hide="showImg" \n                        type="text" \n                        ng-model="imageUrl" \n                        ng-change="checkUrl()" \n                        class="form-control">\n	                <a \n                        ng-show="showImg" \n                        ng-click="removeImage()" \n                        class="kee-message-remove-image">\n                            Remove image\n                    </a>\n	                <label ng-class="{\'kee-error\' : imageUrlHasError}" />\n	            </div>\n                <!-- End form group -->\n            </div>\n            <!-- End image url -->\n\n            <!-- Types -->\n            <div \n                class="kee-new-types" \n                ng-mouseleave="typesMouseLeave()" \n                ng-mouseenter="typesMouseEnter()">\n            \n                <!-- Form group -->\n	            <div class="form-group">\n    	            <button \n                        type="button" \n                        class="btn btn-xs btn-link pull-right" \n                        ng-show="!activeFilter" \n                        ng-click="activeFilter = !activeFilter">\n                            <span class="pnd-icon pnd-icon-filter"></span>\n                    </button>\n	                <label ng-class="{\'kee-error\' : typesHasError}">                    \n	                    Types\n                        <span class="kee-error"> * </span>\n	                    <span \n                            ng-show="!typesHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{typesTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="typesHasError" \n                            class="pnd-icon pnd-icon-info-circle kee-error" \n                            data-title="{{typesErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n\n                    <div \n                        class="left-inner-icon pull-right" \n                        ng-show="activeFilter">\n                        <span \n                            ng-show="typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-filter" \n                            ng-click="activeFilter = !activeFilter">\n                        </span>\n                        <span \n                            ng-show="!typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-times" \n                            ng-click="typeFilter.label=\'\'">\n                        </span>\n                        <input \n                            ng-show="activeFilter" \n                            type="text" \n                            placeholder="filter types..." \n                            ng-model="typeFilter.label"  \n                            class="form-control">\n                    </div>\n	            </div>\n                <!-- End form group -->\n\n                <!-- Types list -->\n                <div class="kee-list-types">\n                    <ul class="list-group">\n                        <li \n                            ng-repeat="item in types | filter:typeFilter" \n                            class="list-group-item">\n                            	<div \n                                    class="pnd-item" \n                                    ng-class="{\'pnd-sticky-item\': item.checked}" \n                                    ng-click="item.checked = !item.checked; updateTypes()">\n                                        <div class="pnd-item-buttons">\n                                            <span \n                                                class="pnd-icon pnd-icon-check ng-scope"\n                                                ng-show="item.checked">\n                                            </span>\n                                        </div>\n\n                                        <div class="pnd-item-text">\n                                            <span class="pnd-item-label">\n                                                {{item.label}}\n                                            </span>\n                                        </div>\n\n                                        <span \n                                            class="pnd-icon pnd-icon-external-link pull-right" \n                                            ng-click="openWindow(item.URI);$event.stopPropagation();$event.preventDefault();">\n                                        </span>\n                                </div>\n                        </li>\n                    </ul>\n                </div>\n                <button \n                    type="button" \n                    class="btn btn-xs" \n                    ng-click="activeAllTypes()">\n                        Select all types\n                </button>\n                <button \n                    type="button" \n                    class="btn btn-xs" \n                    ng-click="disableAllTypes()">\n                        Deselect all types\n                </button>\n                <!-- End types list -->  \n            </div>\n            <!-- End Types -->\n        </div> \n        <!-- End content on the right -->\n\n        <div class="kee-new-languages">\n            <div kee-languages="tabs"></div>\n            <button \n                class="btn btn-xs btn-link pull-left" \n                ng-class="{true:\'pnd-korboee-btn-not-active\'}[disactiveLanguages.length < 1]"\n                template="{{disactiveLanguagesPopoverTemplate}}" \n                data-animation="am-flip-x" \n                bs-popover \n                ng-disabled="disactiveLanguages.length < 1">\n                    <span class="pnd-icon pnd-icon-plus"></span>\n            </button>\n        </div>\n    </div> \n    <!-- End new content -->\n\n    <div class="kee-new-saving" ng-show="isSaving">\n        Saving...\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="clearForm()">\n                Clear\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="save()">\n                <span ng-if="!editMode">Save and add</span>\n                <span ng-if="editMode">Save</span>\n        </button>\n    </div> \n    <!-- End Footer -->\n</div>')}]),angular.module("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in panes" ng-class="{active: $index == active, \'kee-error\' : panes[$index].hasError}" ng-show="pane.isVisible">\n            <a ng-show="!panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n            <a ng-show="panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="kee-error" bs-tooltip data-title="{{tabs[$index].tooltipMessageErrorTab}}" >{{pane.title}}</span>\n            </a>\n        </li>\n        <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n            <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n        </li>\n    </ul>\n    <!-- tab content-->\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n            <div ng-repeat="pane in tabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n                <!-- entity title -->\n                <div class="kee-title">\n	                <div class="form-group">\n	                <label ng-class="{\'kee-error\' : tabs[$index].hasError}">Title\n	                    <span class="kee-error" ng-class="{\'kee-error\' : tabs[$index].hasError}"> * </span>\n	                    <span ng-show="!tabs[$index].hasError" class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageTitle}}" bs-tooltip></span>\n	                    <span ng-show="tabs[$index].hasError" class="kee-error pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageError}}" bs-tooltip></span>\n	                </label>\n	                <input type="text" ng-model="tabs[$index].label" ng-change = updateTitleField($index) class="form-control">\n	                </div>\n                </div>\n                <!-- end entity title -->\n\n                <!-- entity description -->\n                <div class="form-group">\n	                <div class="kee-description">\n    	                <label>Description <span class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageDescription}}" bs-tooltip></span></label>\n    	                <textarea class="form-control" rows="3" ng-model="tabs[$index].description" class="form-control"></textarea>\n	                </div>\n                </div>\n                <!-- end entity description -->\n            </div>\n\n        </div>\n    </div>\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/Search/KorboEE.search.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEE.search.tmpl.html",'<div class="kee-wrp" ng-controller="KeeSearchCtrl">\n    <!-- Search -->\n    <div class="kee-search">\n            <label>\n                Search entity to use:\n            </label>\n            <div class="left-inner-icon">\n    	        <span \n                    class="pnd-icon pnd-icon-search" \n                    ng-click="search.term = \'\'">\n                </span>\n    	        <input \n                    class="form-control" \n                    type="text" \n                    ng-model="elemToSearch" \n                    placeholder="Type at least {{conf.labelMinLength}} characters...">\n            </div>\n    </div>\n    <!-- // End search -->\n\n    <div>\n        <preview \n            use-in-korbo="true" \n            is-loading="{{previewIsLoading}}" \n            error-loading="{{previewError}}">\n        </preview>\n    </div>\n\n    <div \n        ng-model="contentTabs.activeTab" \n        bs-tabs="contentTabs" \n        data-template = "src/ResourcePanel/verticalTabs.tmpl.html">\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showMoreInfo.visibility" \n            ng-class="{\'disabled\': showMoreInfo.disabled}" \n            ng-click="moreInfo()">\n                More Info\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showCopyInEditor.visibility" \n            ng-class="{\'disabled\': showCopyInEditor.disabled}" \n            ng-click="copyInEditor()">\n                Copy in editor\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUse.visibility" \n            ng-class="{\'disabled\': showUse.disabled}" \n            ng-click="use()">\n                Use\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUseAndCopy.visibility" \n            ng-class="{\'disabled\': showUseAndCopy.disabled}" \n            ng-click="copyAndUse()">\n                Copy and Use\n        </button>\n\n        <button \n            ng-show="editMode" \n            type="button" class="btn btn-xs btn-success" \n            ng-click="korboModalTabs.activeTab = 1">\n                Back\n        </button>\n        <button \n            ng-show="editMode" \n            type="button" \n            class="btn btn-xs btn-success"\n            ng-disabled="!itemSelected"\n            ng-click="copyInEditor(); elemToSearch = \'\'">\n                Select URL\n        </button>\n    </div>\n    <!-- // End footer -->\n</div>')
}]),angular.module("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in contentTabs" ng-class="{active: $index == active}">\n            <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="badge pull-right" ng-show="!pane.isLoading && pane.items.length>0 && elemToSearch!==\'\'">{{pane.items.length}}</span>\n                <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" ng-show="pane.isLoading"></span>\n                {{pane.title}}\n            </a>\n        </li>\n    </ul>\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n        	<div ng-repeat="pane in contentTabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n		        <div class="kee-server-messages" ng-if="!contentTabs[$index].serverError">\n		        	<!-- messages 1 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch !== \'\'">No results found</div>\n		        	<!-- / end messages 1 -->\n		        	<!-- messages 2 -->\n		        	<div class="kee-server-searching" ng-show="contentTabs[$index].isLoading && elemToSearch !== \'\'"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n		        	<!-- / end messages 2 -->\n		        	<!-- messages 3 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch === \'\'">Type a label to search...</div>\n		        	<!-- / end messages 3 -->\n		        </div>\n		        <!-- messages 4 -->\n		        <div class="kee-server-messages" ng-if="contentTabs[$index].serverError">\n		            <div ng-show="contentTabs[$index].serverError">Server error</div>\n		        </div>\n		        <!-- / end messages 4 -->\n                <ul class="list-group pnd-inner-scrollable">\n                    <li class="list-group-item" ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" >\n                        <item uri="{{mi.uri}}" hide-options="true" hide-sticky-button="true" ng-click="select(mi)" is-selected="{{isSelected(mi)}}" ng-mouseover="getItem(mi)"></item>\n                    </li>\n                </ul>\n           </div>\n        </div>\n    </div>\n\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/autocompleteList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/autocompleteList.tmpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu kee-autocomplete-list list-group" ng-show="$isVisible() && !serverNotRunning" role="select">\n  <li role="presentation" ng-repeat="match in $matches"  class="list-group-item">\n    <item uri="{{match.value.uri}}" ng-click="$select($index, $event);selectEntity(match)" ng-if="match.label !== \'no found\'"></item>\n    <span class="kee-not-found" role="menuitem" tabindex="-1" disabled ng-bind="noFound" ng-show="match.value.noResult === true"></span>\n  </li>\n    <li ng-show="showNewButton() || showSearchButton()"></li>\n    <li>\n    <!-- footer -->\n    <div class="kee-footer-autocomplete">\n        <span class="kee-elem-to-search" ng-show="showNewButton() || showSearchButton()">"{{elemToSearch}}"</span>\n        <!-- <div class="kee-footer-btn"> -->\n        <button class="kee-btn-new btn btn-success btn-xs" ng-show="showNewButton()" ng-click="openKeeModal();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-plus"></i>\n            Create new\n        </button>\n        <button class="kee-btn-search btn btn-success btn-xs" ng-show="showSearchButton()" ng-click="searchOnLOD();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-search"></i>\n            Search in LOD\n        </button>\n        <!-- </div> -->\n    </div>\n    <!-- End footer -->\n    </li>\n</ul>\n')}]),angular.module("src/KorboEE/korboee-entity.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/korboee-entity.tmpl.html",'<div \n      class="container kee-wrp" \n      id="korbo-ee-container" \n      ng-show="renderElement()">\n      \n      <div class="left-inner-icon">\n            <span \n                  class="pnd-icon pnd-icon-refresh pnd-icon-spin" \n                  ng-show="isLoading() && !serverNotRunning">\n            </span>\n            \n            <input \n                  class="kee-input-elem-to-search kee-input-ok form-control"\n                  name="{{conf.tafonyName}}"\n                  id="{{conf.tafonyId}}"\n                  placeholder="Type at least {{conf.labelMinLength}} characters..."\n                  ng-keypress="keyPressHandle($event)"\n                  type="text"\n                  autocomplete="off"\n                  ng-model="elemToSearch"\n                  template="{{autocompleteListTemplate}}"\n                  ng-options="e.label for e in results"\n                  bs-typeahead\n                  ng-disabled="serverNotRunning"\n                  ng-show = "!serverNotRunning"\n                    />\n            <input \n                  ng-disabled="true" \n                  class="kee-input-elem-to-search kee-input-error-server form-control" placeholder="Sorry! The service is not working" \n                  ng-show = "serverNotRunning"/>\n\n      </div> \n      <!-- // End div ee-input-container -->\n\n\n      <!-- input hidden -->\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenUri}}" \n            value="{{location}}" \n            class="ee-uri-hidden" />\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenLabel}}" \n            value="{{label}}" \n            class="ee-label-hidden" />\n      <!-- // End input hidden -->\n\n</div> \n<!-- // End div container -->\n')}]),angular.module("src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html","<my-items-container></my-items-container>")}]),angular.module("src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link my-items-btn-delete" ng-click="onClickDeleteAllMyItems()" title="Delete all my items"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n        <button type="button" class="btn btn-xs btn-link my-items-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering"  title="Order my items"><span class="pnd-icon pnd-icon-sort-amount-asc"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html","<my-notebooks-container></my-notebooks-container>")}]),angular.module("src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <!-- HEADER -->\n\n    <div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-border">\n        <div class="left-inner-icon">\n            <span class="pnd-icon {{search.icon}}" ng-click="search.term = \'\'"></span>\n            <input type="text" ng-model="search.term" placeholder="search notebooks" class="form-control">\n        </div>\n    </div> <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n\n    <div class="pnd-panel-tab-content-content pnd-inner-scrollable pnd-inner-no-tabs">\n	        <ul class="list-group" ng-if="!message.flag">\n	            <li class="list-group-item" ng-repeat="notebook in displayedNotebook | orderBy:getOrderProperty:reverse">\n	                <notebook nid="{{notebook.id}}" menu-type="{{notebookMenuType}}"></notebook>\n	            </li>\n	        </ul>\n	<div class="pnd-dashboard-welcome" ng-if="message.flag">{{message.text}}</div>\n    </div> <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link my-notebooks-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering" title="Order my notebooks"><span class="pnd-icon pnd-icon-sort-amount-asc"></span></button>\n        <button \n            type="button" \n            class="btn btn-xs btn-link my-notebooks-btn-new"\n            placement="top-left" \n            title="Create new notebook"\n            ng-click="createNewNotebook()">\n                <span class="pnd-icon pnd-icon-file-o"></span>\n        </button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html","<page-items-container></page-items-container>")}]),angular.module("src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link page-items-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering" title="Order page items"><span class="pnd-icon pnd-icon-sort-amount-asc"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html","<vocabularies-container></vocabularies-container>")}]),angular.module("src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link vocab-items-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering" title="Order vocabularies"><span class="pnd-icon pnd-icon-sort-amount-asc"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/itemList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/itemList.tmpl.html",'<ul class="list-group" ng-if="!message.flag">\n    <li class="list-group-item" ng-repeat="pndItem in displayedItems | orderBy:getOrderProperty:reverse">\n        <item uri="{{pndItem.uri}}" menu-type="{{itemMenuType}}"></item>\n    </li>\n</ul>\n<div class="pnd-dashboard-welcome" ng-if="message.flag">{{message.text}}</div>')}]),angular.module("src/Lists/itemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/itemsContainer.tmpl.html",'<!-- HEADER -->\n\n<div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-no-border">\n    <div class="left-inner-icon">\n        <span class="pnd-icon {{search.icon}}" ng-click="search.term = \'\'"></span>\n        <input type="text" ng-model="search.term" placeholder="search items" class="form-control">\n    </div>\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n\n<div class="pnd-panel-tab-content-content pnd-inner">\n    <div ng-model="tabs.activeTab" pnd-tabs="tabs"></div>\n</div> <!-- end pnd-panel-tab-content-content -->')}]),angular.module("src/Notebook/Notebook.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Notebook/Notebook.dir.tmpl.html",'<div class="pnd-item" ng-class="{\'pnd-sticky-item\': isSticky()}" ng-mouseover="onItemMouseOver()" ng-mouseleave="onItemMouseLeave()">\n\n    <div class="pnd-item-buttons">\n        <button type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link" title="Options"><span class="pnd-icon pnd-icon-bars"></span></button>\n        <button type="button" ng-click="onClickSticky($event)" class="btn btn-xs btn-link" title="Sticky"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n    </div>\n\n    <div class="pnd-item-text">\n        <!-- <span class="pnd-item-typeLabel">{{notebook.visibility}}</span> -->\n        <span ng-if="!notebook.isPublic()" class="pnd-icon pnd-icon-lock"  title="Private"></span>\n        <span ng-if="notebook.isPublic()" class="pnd-icon pnd-icon-group" title="Public"></span> \n        <span ng-if="notebook.isCurrent()" class="pnd-icon pnd-icon-pencil-square" title="Current"></span>   \n        <span class="pnd-item-label">{{notebook.label}}</span>\n    </div>\n\n</div>')}]),angular.module("src/Preview/ClientDashboardPreview.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/ClientDashboardPreview.tmpl.html","<preview></preview>")}]),angular.module("src/Preview/DashboardPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/DashboardPreview.dir.tmpl.html",'<div class="pnd-panel-tab-content pnd-preview {{getItemClass()}}">\n\n    <!-- HEADER -->\n\n    <div class="pnd-panel-tab-content-header" ng-if="!useInKorbo || (useInKorbo && !isItemEmpty())">\n        <span ng-if="!isItemEmpty()" class="{{getItemIcon()}}"></span>\n        <span class="pnd-dashboard-preview-panel-heading" ng-if="isItemEmpty() && !useInKorbo">{{getWelcomeHeaderMessage()}}</span>\n        <span class="pnd-dashboard-preview-panel-label" ng-if="!isItemEmpty()">{{itemDashboardPreview.label}}</span>\n    </div> <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n\n    <!-- show welcome content when preview is empty -->\n    <div class="pnd-panel-tab-content-content pnd-inner-scrollable">\n        <div>\n            <span class="pnd-dashboard-welcome" ng-if="isItemEmpty() && !useInKorbo">{{getWelcomeBodyMessage()}}</span>\n            <item-preview ng-if="!isItemEmpty() && !isNotebook()" uri="{{itemDashboardPreview.uri}}" sticking="true"></item-preview>\n            <notebook-preview ng-if="!isItemEmpty() && isNotebook()" id="{{itemDashboardPreview.id}}"></notebook-preview>\n        </div>\n\n        <!-- loading preview in korboEE -->\n        <div class="kee-server-searching" ng-show="isLoading"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n        <!-- / end loading preview in korboEE -->\n        <!-- error loading preview in korboEE -->\n        <div class="kee-server-error" ng-show="errorLoading">Impossible loading preview...</div>\n        <!-- / end error loading preview in korboEE -->\n\n    </div> <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer" ng-hide="useInKorbo">\n\n        <!-- More info -->\n        <button class="btn btn-success btn-xs pnd-btn-full pnd-dashboard-preview-more-info-button" ng-if="!itemIsAnImage && !isNotebook()" ng-click="openUrl(itemDashboardPreview.uri)" ng-class="{disabled: !isStickyItem()}">More info</button>\n        <button class="btn btn-success btn-xs pnd-btn-full pnd-dashboard-preview-more-info-button" ng-if="!itemIsAnImage && isNotebook()" ng-click="openNotebookUrl(itemDashboardPreview.id)" ng-class="{disabled: !isStickyItem()}">More info</button>\n        <!-- Clear Sticky Icon -->\n        <button class="btn btn-success btn-xs pnd-btn-full pnd-dashboard-preview-clear-sticky-button" ng-click="clearSticky()" ng-class="{disabled: !isStickyItem()}">Clear Sticky</button>\n        <!-- Open image -->\n        <button class="btn btn-link btn-xs pnd-btn-full pnd-dashboard-preview-external-modal-button" ng-class="{disabled: !isStickyItem()}" ng-if="itemIsAnImage"><span class="pnd-icon pnd-icon-external-link"></span></button>\n\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Preview/ItemPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/ItemPreview.dir.tmpl.html",'<div class="pnd-annotation-preview-item-container pnd-ignore">\n\n    <div class="pnd-preview-item-types">\n        <ul class="pnd-preview-item-types-ul">\n            <li class="pnd-preview-single-type" ng-class="{\'pnd-is-sticky\': isSticky}" ng-repeat="type in item.type">{{getTypeLabel(type)}}</li>\n        </ul>\n        <div ng-show="typeHiddenPresent" ng-class="{\'pnd-icon-caret-down\': typeHidden, \'pnd-icon-caret-up\': !typeHidden}" class="pnd-icon" ng-click="showAlltypes()"></div>\n    </div>\n\n    <div ng-if="item.isImage()" class="pnd-preview-item-image">\n        <img ng-src="{{item.image}}" />\n    </div>\n\n    <div ng-show="item.isImageFragment()" class="pnd-preview-item-image">\n        <img ng-src="{{item.image}}" />\n    </div>\n\n    <div class="pnd-preview-item-description">\n        <p>{{item.description}}</p>\n    </div>\n\n    <div ng-if="item.isProperty()" class="pnd-preview-item-predicate">\n        <ul>\n            <li ng-if="item.uri"><strong>Uri:</strong> {{item.uri}}</li>\n            <li ng-if="item.vocabulary"><strong>Vocabulary:</strong> {{item.vocabulary}}</li>\n            <li ng-if="item.domain"><strong>Domain:</strong> \n                <span ng-repeat="domain in item.domain">{{domain}}</span>\n            </li>\n            <li ng-if="item.range"><strong>Range:</strong> \n                <span ng-repeat="range in item.range">{{range}}</span>\n            </li>\n        </ul>\n    </div>\n    \n</div>\n')}]),angular.module("src/Preview/NotebookPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/NotebookPreview.dir.tmpl.html",'<div class="pnd-dashboard-welcome">\n	<div class="pnd-preview-notebook-visibility">\n	    <span><strong>Visibility:</strong>\n            <span class="pnd-icon pnd-icon-group" ng-if="notebook.isPublic()"></span>\n            <span class="pnd-icon pnd-icon-lock" ng-if="!notebook.isPublic()"></span> {{notebook.visibility}}</span>\n	</div>\n	<div class="pnd-preview-notebook-annotations">\n	    <span><strong>Annotations:</strong>  </span> <span>{{notebook.includes.length}}</span>\n	</div>\n	<div class="pnd-preview-notebook-creator">\n	    <span><strong>Creator:</strong>  </span> <span>{{notebook.creatorName}}</span>\n	</div>\n	\n	<div class="pnd-preview-notebook-date">\n	    <span><strong>Creation date:</strong>  </span> <span>{{notebook.created}}</span>\n	</div>\n	<div class="pnd-preview-notebook-current" ng-show="isCurrent">\n	    <strong>current notebook</strong> <span class="pnd-icon pnd-icon-pencil-square"></span>\n	</div>\n</div>')}]),angular.module("src/ResourcePanel/datepicker.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/datepicker.tmpl.html",'<div class="dropdown-menu datepicker pnd-date-picker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px; position: static;">\n<table style="table-layout: fixed; height: 100%; width: 100%;">\n  <thead>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)">\n          <i class="glyphicon glyphicon-chevron-left"></i>\n        </button>\n      </th>\n      <th colspan="{{ rows[0].length - 2 }}">\n        <button tabindex="-1" type="button" class="btn btn-default btn-block text-strong"  ng-click="$toggleMode()">\n          <strong style="text-transform: capitalize;" ng-bind="title"></strong>\n        </button>\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)">\n          <i class="glyphicon glyphicon-chevron-right"></i>\n        </button>\n      </th>\n    </tr>\n    <tr ng-show="showLabels" ng-bind-html="labels"></tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%">\n      <td class="text-center" ng-repeat="(j, el) in row">\n        <button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected}" ng-click="$select(el.date)" ng-disabled="el.disabled">\n          <span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span>\n        </button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n<button class="btn btn-sm btn-success"  ng-click="save()">Save</button>\n<button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button>\n</div>\n')}]),angular.module("src/ResourcePanel/popoverCalendar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverCalendar.tmpl.html",'<div class="popover popover-datepicker pnd-popover-calendar">\n    <div class="arrow"></div>\n    <h3 class="popover-title">Calendar</h3>\n\n    <div class="popover-content">\n        <div class="form-group">\n            <label class="control-label"><i class="fa fa-calendar"></i> Date </label>\n            <input type="text" ng-model="selectedDate"\n                   class="form-control pnd-input-calendar"\n                   trigger="click" data-date-format="dd/MM/yyyy" template="src/ResourcePanel/datepicker.tmpl.html" bs-datepicker>\n        </div>\n        <!--<button class="btn btn-sm btn-success"  ng-click="save()">Save</button>\n        <button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button>-->\n    </div>\n</div>')}]),angular.module("src/ResourcePanel/popoverLiteralText.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverLiteralText.tmpl.html",'<div class="popover pnd-popover-literal">\n    <div class="arrow"></div>\n    <h3 class="popover-title">Choose your...</h3>\n    <div class="popover-content">\n	    <div class="form-group">\n		    <textarea class="form-control pnd-popover-literal-textarea" rows="6" ng-model="literalText"></textarea>\n		</div>\n		    <button class="btn btn-sm btn-success" ng-class="{disabled: literalText == \'\'}" ng-click="save()">Save</button>\n		    <button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button>\n    </div>\n</div>')}]),angular.module("src/ResourcePanel/popoverResourcePanel.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverResourcePanel.tmpl.html",'<div class="popover pnd-resource-panel-popover pnd-ignore" ng-controller="ResourcePanelCtrl">\n    <div class="arrow"></div>\n    <div ng-model="contentTabs.activeTab" bs-tabs="contentTabs" data-template = "src/ResourcePanel/verticalTabs.tmpl.html">\n    </div>\n\n\n</div>')}]),angular.module("src/ResourcePanel/verticalTabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/verticalTabs.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n    	<!-- header -->\n        <div class="pnd-vertical-tab-header-content" ng-if="moduleName == \'Pundit2\'">\n            <strong ng-if="type === \'sub\'">Choose your subject...</strong>\n            <strong ng-if="type === \'obj\'">Choose your object...</strong>\n            <strong ng-if="type === \'pr\'">Choose your predicate...</strong>\n            <button type="button" class="btn btn-xs btn-link pnd-btn-dashboard pull-right" ng-click="cancel()"><span class="pnd-icon pnd-icon-times"></span></button>\n        </div>\n        <!-- // end header -->\n\n<ul class="nav nav-tabs pnd-vertical-tabs" ng-if = "moduleName == \'Pundit2\'">\n    <li ng-repeat="pane in contentTabs" ng-class="{active: $index == active}" ng-if="pane.title != \'My Items\' || (pane.title == \'My Items\' && userLoggedIn)">\n    <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n        <span class="badge pull-right" ng-show="moduleName == \'Pundit2\' && !pane.isLoading && pane.isStarted">{{pane.items.length}}</span>\n        <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" ng-show="pane.isLoading"></span>\n        {{pane.title}}\n    </a>\n  </li>\n</ul>\n\n<ul class="nav nav-tabs pnd-vertical-tabs" ng-if = "moduleName == \'KorboEE\'">\n    <li ng-repeat="pane in contentTabs" ng-class="{active: $index == active}">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n            <span class="badge pull-right" ng-show="moduleName == \'KorboEE\' && !pane.isLoading && pane.isStarted">{{pane.items.length}}</span>\n            <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" ng-show="pane.isLoading"></span>\n            {{pane.title}}\n        </a>\n    </li>\n</ul>\n\n<div>\n    <div class="pnd-vertical-tab-content tab-content">\n        <div ng-repeat="pane in contentTabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n            <div class="kee-server-messages" ng-if="pane.module == \'KorboEE\' && !contentTabs[$index].serverError">\n                <!-- messages 1 -->\n                <div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch !== \'\'">No results found</div>\n                <!-- / end messages 1 -->\n                <!-- messages 2 -->\n                <div class="kee-server-searching" ng-show="contentTabs[$index].isLoading && elemToSearch !== \'\'"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n                <!-- / end messages 2 -->\n                <!-- messages 3 -->\n                <div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch === \'\'">Type a label to search...</div>\n                <!-- / end messages 3 -->\n            </div>\n            <!-- messages 4 -->\n            <div class="kee-server-messages" ng-if="pane.module == \'KorboEE\' && contentTabs[$index].serverError">\n                <div ng-show="contentTabs[$index].serverError">Server error</div>\n            </div>\n\n        <ul class="list-group">\n            <li ng-if="pane.module == \'Pundit2\' && contentTabs[$index].items.length === 0 && label !== \'\'">No results found</li>\n            <li ng-if="pane.module == \'Pundit2\' && contentTabs[$index].items.length === 0 && label === \'\'">Type a label to search...</li>\n            <li class="list-group-item" ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" ng-if="moduleName == \'Pundit2\'">\n                <item uri="{{mi.uri}}" is-selected="{{isSelected(mi)}}" ng-click="select(mi)" hide-options="true" ng-if="moduleName == \'Pundit2\'"></item>\n            </li>\n            <li class="list-group-item" ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" ng-if="moduleName == \'KorboEE\'" ng-mouseenter="getItem(mi);$event.stopPropagation()" ng-mouseleave="onMouseLeave()">\n                <item uri="{{mi.uri}}" hide-options="true" hide-sticky-button="true" ng-click="select(mi)" is-selected="{{isSelected(mi)}}" use-in-korbo="true" ng-if="moduleName == \'KorboEE\'"></item>\n            </li>\n        </ul>\n        </div>\n        <div class="pnd-vertical-tab-footer-content" ng-if=" moduleName == \'Pundit2\'">\n            <button class="pnd-resource-panel-use-button btn btn-xs btn-success" ng-class="{\'disabled\': !isUseActive}" ng-click="save(itemSelected)">Use</button>\n            <button class="pnd-resource-panel-copy-button btn btn-xs btn-success" ng-class="{\'disabled\': !isUseActive}" ng-show="showUseAndCopyButton()" ng-click="useAndCopy(itemSelected)">Copy and Use</button>\n            <button class="pnd-resource-panel-new-button btn btn-xs btn-success" ng-class="{\'disabled\': !isUseActive}" ng-show="showCopyInEditorButton()" ng-click="copyInEditor()">Copy in editor</button>\n            <button class="pnd-resource-panel-new-button btn btn-xs btn-success" ng-show="showNewButton()" ng-click="createNew()">Create New</button>\n        </div>\n    </div>\n</div>\n\n</div> <!-- / tabs left -->\n\n\n')}]),angular.module("src/SimplifiedClient/ItemPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/SimplifiedClient/ItemPopover.tmpl.html",'<div class="popover pnd-item-popover" ng-controller="ItemPopoverCtrl" style="min-width: 330px;">\n\n    <div class="arrow"></div>\n\n        <h3 class="popover-title">\n            {{title}}\n            <span class="pull-right pnd-icon pnd-icon-times" ng-click="hide()"></span>\n        </h3>\n\n    <div class="popover-content" ng-click="onContentClick()" style="max-height: 400px; overflow-y: scrool; overflow-x: hidden;">\n        <annotation-details ng-repeat="ann in annotations" id="{{ann.id}}"></annotation-details>\n    </div>\n\n</div>')}]),angular.module("src/Toolbar/ClientToolbar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/ClientToolbar.tmpl.html","<toolbar></toolbar>")}]),angular.module("src/Toolbar/Toolbar.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/Toolbar.dir.tmpl.html",'<nav class="navbar navbar-inverse navbar-fixed-top pnd-toolbar-navbar pnd-ignore" role="navigation" ng-controller="ToolbarCtrl">\n    <div class="container-fluid pnd-toolbar-navbar-container">\n    \n        <div class="pnd-toolbar-navbar-collapse">\n            <ul class="nav navbar-nav pnd-toolbar-navbar-left">\n                \n                <!-- Error button -->\n                <li ng-show="showStatusButtonError()" class="pnd-toolbar-error-button">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="errorMessageDropdown"><span class="pnd-icon pnd-icon-exclamation-circle"></span></a>\n                </li>\n                \n                <!-- OK button -->\n                <li ng-show="showStatusButtonOk()" class="pnd-toolbar-status-button-ok">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="infoDropdown"><span class="pnd-icon pnd-icon-check"></span></a>\n                </li>\n\n                <!-- Loading button -->\n                <li ng-show="showStatusButtonLoading()" class="pnd-toolbar-loading-button">\n                    <a href="javascript:void(0)">\n                        <!-- <span></span> -->\n                        <span class="pnd-icon pnd-icon-refresh pnd-icon-spin"></span>\n                    </a>\n                </li>\n\n                <!-- Login button -->\n                <li ng-show="showLogin()" class="pnd-toolbar-login-button pnd-toolbar-button-active">\n                    <!-- <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userNotLoggedDropdown"><span>Login</span></a> -->\n                    <a href="javascript:void(0)" ng-click="login()"><span>Login</span></a>\n                </li>\n                \n                <!-- User button -->\n                <li ng-show="showUserButton()" class="pnd-toolbar-user-button  pnd-toolbar-button-active">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userLoggedInDropdown"><span>{{userData.fullName}}</span></a>\n                </li>\n                \n                <!-- Ask the Pundit button-->\n                <li ng-class="{true: \'pnd-toolbar-ask-button-active\', false: \'pnd-toolbar-ask-button-not-active\'}[isAskActive()]" class="pnd-toolbar-ask-button">\n                    <a href="{{getAskLink()}}" target="_blank">Ask the Pundit</a>\n                </li>\n                \n                <!-- Dashboard button -->\n                <li class="pnd-toolbar-dashboard-button">\n                    <a href="javascript:void(0)" ng-click="dashboardClickHandler()">\n                        <span ng-class="{true: \'pnd-toolbar-active-element\', false: \'pnd-toolbar-not-active-element\'}[isDashboardActive()] ">Dashboard</span>\n                    </a>\n                </li>\n\n            </ul> <!-- pnd-navbar-left -->\n\n            <ul class="nav navbar-nav navbar-right pnd-toolbar-navbar-right">\n                \n                <!-- Template mode button -->\n                <li class="pnd-toolbar-template-mode-button" ng-show="useTemplates" ng-click="toggleTemplateMode()">\n                    <a href="javascript:void(0)">\n                        <span class="pnd-icon pnd-icon-pencil"></span>\n                    </a>\n                </li>\n                \n                <!-- Template menu -->\n                <li class="pnd-toolbar-template-menu-button" ng-click="onClickTemplateDropdown()" ng-show="useTemplates">\n                    <a href="javascript:void(0)" template="{{dropdownTemplateTemplates}}" bs-dropdown="userTemplateDropdown">\n                        <span>{{currentTemplateLabel}}</span>\n                        <span class="pnd-icon pnd-icon-circle" style="color: {{currentTemplateColor}};"></span>\n                    </a>\n                </li>\n                \n                <!-- Notebooks menu -->\n                <li class="pnd-toolbar-notebook-menu-button">\n                    <a ng-if="isNotebookMenuActive()" href="javascript:void(0)" placement="bottom-right" template="{{dropdownTemplateMyNotebook}}" bs-dropdown="userNotebooksDropdown"><span class="pnd-icon pnd-icon-book"> </span> <span class="pnd-toolbar-active-element">{{currentNotebookLabel}}</span></a>\n                    <a ng-show="!isNotebookMenuActive()" href="javascript:void(0)" placement="bottom-right" template="{{dropdownTemplate}}" bs-dropdown="userNotLoggedDropdown"><span class="pnd-toolbar-not-active-element">My Notebooks</span></a>\n                </li>\n                \n                <!-- Annotations menu -->\n                <li class="pnd-toolbar-annotations-button">\n                    <a href="javascript:void(0)" ng-click="annotationsClickHandler()">\n                        <span class="pnd-toolbar-active-element">Annotations Sidebar</span>\n                    </a>\n                </li>\n\n            </ul> <!-- pnd-toolbar-navbar-right -->\n    \n        </div><!-- pnd-toolbar-navbar-collapse -->\n    </div><!-- pnd-toolbar-navbar-container -->\n</nav>\n\n\n\n              \n')
}]),angular.module("src/Toolbar/myNotebooksDropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/myNotebooksDropdown.tmpl.html",'<ul class="dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-notebook\': item.currentNotebook, divider: item.divider, \'disabled\': item.disable, \'dropdown-submenu\': item.submenu, active: item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text">dksad</span>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()">\n        <span ng-if="item.visibility == \'private\'" class="pnd-icon pnd-icon-lock"></span>\n        <span ng-if="item.visibility == \'public\'" class="pnd-icon pnd-icon-group"></span>\n        <span ng-if="item.currentNotebook" class="pnd-icon pnd-icon-pencil-square"></span>\n        {{item.text}}</a>\n    </li>\n</ul>')}]),angular.module("src/Toolbar/templatesDropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/templatesDropdown.tmpl.html",'<ul class="dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-template\': item.currentTemplate, divider: item.divider, \'disabled\': item.disable, active: item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text">dksad</span>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()">\n        <span class="pnd-icon pnd-icon-circle pull-right" style="color: {{item.color}};"></span>\n        <span ng-if="item.currentTemplate" class="pnd-icon pnd-icon-check"></span>\n        {{item.text}}</a>\n    </li>\n</ul>')}]),angular.module("src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html","<notebook-composer></notebook-composer>")}]),angular.module("src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",'<!-- HEADER -->\n\n<div class="pnd-panel-tab-content-header">\n    {{notebookComposerHeader}}\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n\n<div class="pnd-panel-tab-content-content">\n\n    <div class="form-group pnd-notebook-composer-container" ng-hide="saving">\n    	<p>\n        <input type="text" class="form-control" placeholder="Enter notebook name" ng-model="notebook.name">\n    	</p>\n        <div class="checkbox" ng-class="{\'pnd-notebook-composer-element-active\': notebook.current}">\n        <label>\n            <input type="checkbox" ng-model="notebook.current" ng-disabled="editMode && isCurrentNotebook">\n            <span class="pnd-icon pnd-icon-pencil-square"></span> Set as current\n        </label>\n        </div>\n        <div class="radio" ng-class="{\'pnd-notebook-composer-element-active\': notebook.visibility == \'public\'}">\n            <label>\n                <input type="radio" name="visibility" value="public" ng-model="notebook.visibility">\n                <span class="pnd-icon pnd-icon-group"></span> Public\n            </label>\n        </div>\n        <div class="radio" ng-class="{\'pnd-notebook-composer-element-active\': notebook.visibility == \'private\'}">\n            <label>\n                <input type="radio" name="visibility" value="private" ng-model="notebook.visibility">\n                <span class="pnd-icon pnd-icon-lock"></span> Private\n            </label>\n        </div>\n    </div>\n\n    <!-- message-->\n    <div class="pnd-notebook-saving-content" ng-if="saving">\n        <span class="pnd-icon {{savingIcon}} pnd-icon-2x"></span>\n        <span class="{{shortMessageClass}}">{{shortMessagge}}</span>\n        {{textMessage}}\n    </div>\n    <!-- // end message-->\n\n</div> <!-- end pnd-panel-tab-content-content -->\n\n<!-- FOOTER -->\n\n<div class="pnd-panel-tab-content-footer">\n\n    <button class="pnd-notebookcomposer-add-blank btn btn-success btn-xs" ng-if="!editMode" ng-class="{disabled: notebook.name == \'\'}" ng-click="save()">Save</button>\n    <button class="pnd-notebookcomposer-add-blank btn btn-success btn-xs" ng-if="editMode" ng-class="{disabled: notebook.name == \'\'}" ng-click="edit()">Save</button>\n    <button class="pnd-notebookcomposer-save btn btn-success btn-xs" ng-class="{disabled: notebook.name == \'\'}" ng-click="clear()">Clear</button>\n\n</div> <!-- end pnd-panel-tab-content-footer -->')}]),angular.module("src/Tools/TripleComposer/ClientTripleComposer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/ClientTripleComposer.tmpl.html","<triple-composer></triple-composer>")}]),angular.module("src/Tools/TripleComposer/Statement.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/Statement.dir.tmpl.html",'<div class="pnd-statement-row clearfix">\n<div class="pnd-statement-widget">\n\n    <!-- Subject -->\n    <div class="pnd-statement-subject">\n\n        <!-- Incomplete Subject -->\n        <div ng-if="!subjectFound">\n\n            <!-- Subject Input div -->\n            <div class="left-inner-icon">\n                <span ng-show="!templateMode" class="pnd-icon {{subjectIcon}}" ng-click="clearSubjectSearch()"></span>\n                <input ng-show="!templateMode" type="text" class="input-sm form-control" placeholder="search a subject" ng-model="$parent.subjectSearch" ng-click="onClickSubject($event)" ng-keyup="onKeyUpSubject($event)">\n                <div ng-show="templateMode" class="pnd-statement-label pnd-statement-subject-text">Select some text on the page</div>\n            </div>\n\n            <!-- Subject Buttons div (empty)-->\n            <div class="pnd-row-button-subject"></div>\n\n        </div>\n\n        <!-- Complete Subject -->\n        <div ng-if="subjectFound">\n            <div class="pnd-statement-label" ng-mouseover="onSubjectMouseOver()" ng-mouseleave="onItemMouseOut()">{{subjectLabel}}</div>\n            <!-- Subject buttons -->\n            <div class="pnd-row-button-subject">\n		            <button type="button" class="btn btn-xs btn-link" ng-if="!templateMode" title="delete" ng-click="wipeSubject()"><span class="pnd-icon pnd-icon-trash-o"></span></button> {{subjectTypeLabel}}\n            </div>\n            <!-- // end Subject buttons -->\n        </div>\n\n    </div>\n\n    <!-- Predicate -->\n    <div class="pnd-statement-predicate">\n\n        <!-- Incomplete Predicate -->\n        <div ng-if="!predicateFound">\n\n            <!-- Predicate Input div -->\n            <div class="left-inner-icon">\n                <span class="pnd-icon {{predicateIcon}}" ng-click="clearPredicateSearch()"></span>\n                <input type="text" class="input-sm form-control" placeholder="search a predicate" ng-model="$parent.predicateSearch" ng-click="onClickPredicate($event)" ng-keyup="onKeyUpPredicate($event)">\n            </div>\n\n            <!-- Predicate Buttons div-->\n            <div class="pnd-row-button-predicate"></div>\n\n        </div>\n\n        <!-- Complete Predicate -->\n        <div ng-if="predicateFound">\n	        <div class="pnd-statement-label" ng-mouseover="onPredicateMouseOver()" ng-mouseleave="onItemMouseOut()">{{predicateLabel}}</div>\n	        <!-- Predicate buttons -->\n	        <div class="pnd-row-button-predicate">\n	            <button type="button" class="btn btn-xs btn-link" ng-if="!predicateFixed" title="delete"  ng-click="wipePredicate()"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n            </div>\n            <!-- // end Predicate buttons -->            \n        </div>\n\n    </div>\n\n    <!-- Object -->\n    <div class="pnd-statement-object">\n\n        <!-- Incomplete Object -->\n        <div ng-if="!objectFound">\n\n            <!-- Object Input div -->\n            <div class="left-inner-icon">\n                <span class="pnd-icon {{objectIcon}}" ng-click="clearObjectSearch()"></span>\n                <input type="text" class="input-sm form-control" placeholder="search an object" ng-model="$parent.objectSearch" ng-click="onClickObject($event)" ng-keyup="onKeyUpObject($event)" ng-class="{\'pnd-statement-mandatory-object\':isMandatory && templateMode}">\n            </div>\n\n            <!-- Object Buttons div -->\n            <div class="pnd-row-button-object">\n                <!--Calendar Icon-->\n                <button type="button" class="btn btn-xs btn-link" ng-if="canBeObjectDate" ng-click="onClickObjectCalendar($event)"  title="calendar"><span class="pnd-icon pnd-icon-table"></span></button>\n                <!--Pen Icon-->\n                <button type="button" class="btn btn-xs btn-link" ng-if="canBeObjectLiteral" ng-click="onClickObjectLiteral($event)"  title="text"><span class="pnd-icon pnd-icon-pencil"></span></button>\n            </div>\n\n        </div>\n\n        <!-- Complete Object -->\n        <div ng-if="objectFound">\n	        <div class="pnd-statement-label" ng-mouseover="onObjectMouseOver()" ng-mouseleave="onItemMouseOut()">{{objectLabel}}</div>\n	        \n	        <!-- Object buttons -->\n            <div class="pnd-row-button-object">\n		            <button type="button" class="btn btn-xs btn-link" ng-if="!objectFixed" title="delete" ng-click="wipeObject()"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n                    <!--Calendar Icon-->\n                    <button type="button" class="btn btn-xs btn-link" ng-if="objectDate && !objectFixed" ng-click="onClickObjectCalendar($event)"  title="calendar"><span class="pnd-icon pnd-icon-table"></span></button>\n                    <!--Pen Icon-->\n                    <button type="button" class="btn btn-xs btn-link" ng-if="objectLiteral && !objectFixed" ng-click="onClickObjectLiteral($event)"  title="text"><span class="pnd-icon pnd-icon-pencil"></span></button> {{objectTypeLabel}}\n            </div>\n            <!-- // end Object buttons -->\n	        \n        </div>\n\n    </div>\n</div><!-- // end widget -->\n\n    <!-- Right buttons -->\n    <div class="pnd-statement-buttons">\n        <!-- close icon -->\n        <button type="button" class="btn btn-xs btn-danger pnd-btn-statement" ng-hide="templateMode" ng-click="remove()" title="delete" ng-disabled="isDeleteDisabled"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n        <!-- copy icon -->\n        <button type="button" class="btn btn-xs btn-success pnd-btn-statement" ng-hide="templateMode" ng-click="duplicate()" title="copy"><span class="pnd-icon pnd-icon-copy"></span></button>\n    </div>\n\n</div>')}]),angular.module("src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",'<!-- HEADER -->\n\n<div class="pnd-panel-tab-content-header">\n    {{headerMessage}}\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n\n<div class="pnd-panel-tab-content-content">\n\n    <div class="pnd-triplecomposer-statements-container pnd-inner-scrollable" ng-hide="saving">\n        <statement ng-repeat="s in statements" id="{{s.id}}" duplicated="s.scope.duplicated"></statement>\n    </div>\n    <!-- message-->\n    <div class="pnd-triplecomposer-saving-content" ng-if="saving">\n        <span class="pnd-icon {{savingIcon}} pnd-icon-3x"></span>\n        <span class="{{shortMessageClass}}">{{shortMessagge}}</span>\n        {{textMessage}}\n    </div>\n    <!-- // end message-->\n</div> <!-- end pnd-panel-tab-content-content -->\n\n<!-- FOOTER -->\n\n<div class="pnd-panel-tab-content-footer">\n    \n    <button class="pnd-triplecomposer-add-blank btn btn-success btn-xs pnd-btn-full" ng-hide="templateMode" ng-click="onClickAddStatement()">Add blank Statement</button>\n    \n    <button class="pnd-triplecomposer-save btn btn-success btn-xs pnd-btn-full disabled" ng-hide="editMode" ng-click="saveAnnotation()">Save all Statements to Server</button>\n    <button class="pnd-triplecomposer-save btn btn-success btn-xs pnd-btn-full disabled" ng-show="editMode" ng-click="editAnnotation()">Update Annotation</button>\n    <button class="pnd-triplecomposer-cancel btn btn-success btn-xs pnd-btn-full" ng-if="editMode" ng-click="cancel()">Cancel</button>\n    \n</div> <!-- end pnd-panel-tab-content-footer -->')}]),angular.module("Pundit2",["ngResource","ngSanitize","ngAnimate","mgcrea.ngStrap","templates-main","Pundit2.Core","Pundit2.Annomatic","Pundit2.AnnotationSidebar","Pundit2.Dashboard","Pundit2.Toolbar","Pundit2.Communication","Pundit2.Annotators","Pundit2.ContextualMenu","Pundit2.Preview","Pundit2.Client","Pundit2.PageItemsContainer","Pundit2.Item","Pundit2.MyItemsContainer","Pundit2.ResourcePanel","Pundit2.Vocabularies","Pundit2.TripleComposer","Pundit2.NotebookComposer","Pundit2.MyNotebooksContainer","Pundit2.Notebook","KorboEE","Pundit2.SimplifiedClient"]);var PUNDITVERSION={version:"2.0.29.beta.20140829"};angular.module("Pundit2.Client",[]),angular.module("Pundit2.Client").run(["$injector","Config",function(a,b){if(b.isValid()&&b.isModuleActive("Client")){var c=a.get("Client");c.boot()}}]).constant("CLIENTDEFAULTS",{debug:!1,relationsContainer:"usableRelations",bootModules:["Toolbar","Dashboard","AnnotationSidebar","Preview","MyNotebooksContainer","SelectorsManager","PageItemsContainer","MyItemsContainer","NotebookComposer","TripleComposer"],basicRelations:[{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"has comment (free text)",description:"Any comment related to the selected fragment of text or image",domain:["http://purl.org/pundit/ont/ao#fragment-image","http://purl.org/pundit/ont/ao#fragment-text","http://xmlns.com/foaf/0.1/Image"],range:["http://www.w3.org/2000/01/rdf-schema#Literal"],vocabulary:"Basic Relation",uri:"http://schema.org/comment"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"depicts",description:"An image or part of an image depicts something",domain:["http://xmlns.com/foaf/0.1/Image","http://purl.org/pundit/ont/ao#fragment-image"],range:[],vocabulary:"Basic Relation",uri:"http://xmlns.com/foaf/0.1/depicts"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is similar to",description:"The selected fragment (text or image fragment) is similar to another fragment (of the same or of different types)",domain:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],range:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/vocab#similarTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"has creator",description:"The selected text fragment has been created by a specific Person",domain:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],range:["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person"],vocabulary:"Basic Relation",uri:"http://purl.org/dc/terms/creator"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"cites",description:"The selected text fragment cites another text fragment, or a Work or a Person",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://purl.org/pundit/ont/ao#fragment-text","http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],vocabulary:"Basic Relation",uri:"http://purl.org/spar/cito/cites"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"quotes",description:"The selected text fragment is a sentence from a Person or a Work, usually enclosed by quotations (eg: '')",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],vocabulary:"Basic Relation",uri:"http://purl.org/spar/cito/includesQuotationFrom"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"talks about",description:"The selected text fragment talks about some other text, Entity, Person or any other kind of concept",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:[],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#talksAbout"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is related to",description:"The selected text fragment is someway related to another text, Entity, Person or any other kind of concept",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:[],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isRelatedTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"identifies",description:"The selected text fragment is a Person, a Work, a Place or a well defined Entity",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/location/location","http://dbpedia.org/ontology/Place","http://schema.org/Place","http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing","http://www.freebase.com/schema/people/person","http://dbpedia.org/ontology/Person","http://xmlns.com/foaf/0.1/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#identifies"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is date",description:"The selected text fragment corresponds to the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"period of dates starts at",description:"The selected text fragment corresponds to the specified date period which starts at the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#periodStartDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"period of dates ends at",description:"The selected text fragment corresponds to the specified date period which ends at the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#periodEndDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"translates to",description:"The selected text fragment translation is given as free text",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2000/01/rdf-schema#Literal"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#translatesTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is translation of",description:"The selected text fragment is the translation of another text fragment",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://purl.org/pundit/ont/ao#fragment-text"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isTranslationOf"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is written in",description:"The selected text fragment is written in the specified language (french, german, english etc)",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/language/human_language"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isWrittenIn"}]}).service("Client",["CLIENTDEFAULTS","BaseComponent","Config","MyPundit","ImageAnnotator","TextFragmentAnnotator","AnnotationsCommunication","AnnotationsExchange","Item","ItemsExchange","MyItems","TextFragmentHandler","ImageHandler","Toolbar","Annomatic","NotebookCommunication","NotebookExchange","SelectorsManager","FreebaseSelector","MurucaSelector","KorboBasketSelector","Korbo2Selector","PredicateSelector","TemplatesSelector","TripleComposer","ImageFragmentAnnotatorHelper","$injector","$templateCache","$rootScope","$compile","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E){var F,G=new b("Client",a),H=function(){F=angular.element("[data-ng-app='Pundit2']"),F.hasClass("pnd-wrp")||F.addClass("pnd-wrp")},I=function(){for(var a=0,b=G.options.bootModules.length;b>a;a++){var d=G.options.bootModules[a];if(c.isModuleActive(d)){var e,f=A.get(d);"clientDomTemplate"in f.options?(e=B.get(f.options.clientDomTemplate),"undefined"==typeof e?G.err("Can not bootstrap module "+f.name+", template not found: "+f.options.clientDomTemplate):(F.append(e),G.log("Appending to DOM "+f.name,e))):"clientDashboardTemplate"in f.options&&"clientDashboardPanel"in f.options&&"clientDashboardTabTitle"in f.options&&c.isModuleActive("Dashboard")?(e=B.get(f.options.clientDashboardTemplate),"undefined"==typeof e?G.err("Can not bootstrap module "+f.name+", template not found: "+f.options.clientDashboardTemplate):(A.get("Dashboard").addContent(f.options.clientDashboardPanel,f.options.clientDashboardTabTitle,f.options.clientDashboardTemplate),G.log("Adding to Dashboard: "+f.name+" to panel "+f.options.clientDashboardPanel))):G.err("Did not bootstrap module "+d+": .options parameters missing.")}else G.log("Not bootstrapping "+d+": not active.")}},J=function(a){F.append(a)},K=function(){var a=0,b=G.options.basicRelations;for(var c in b){var d=new i(b[c].uri,b[c]);j.addItemToContainer(d,G.options.relationsContainer)}G.log("Loaded "+a+" basic relations")},L=function(){w.getAllVocabularies().then(function(a){for(var b in a){var c=new i(a[b].uri,a[b]);j.addItemToContainer(c,G.options.relationsContainer)}G.log("Loaded "+a.length+" configured relations")})};G.boot=function(){if(H(),c.useBasicRelations&&K(),L(),c.useTemplates&&x.getAll().then(function(){c.useOnlyTemplateMode&&y.showCurrentTemplate()}),d.checkLoggedIn().then(function(a){a===!0&&(k.getAllItems(),p.getMyNotebooks(),p.getCurrent()),g.getAnnotations(),C.$watch(function(){return d.isUserLogged()},function(a,b){a!==b&&(a===!0?(G.log("User just logged in"),M()):(G.log("User just logged out"),N()))})}),"undefined"!=typeof c.korbo&&c.korbo.active){var a="<korbo-entity-editor conf-name='"+c.korbo.confName+"'></korbo-entity-editor>";J(a)}O(),r.init(),I(),G.log("Boot is completed, emitting pundit-boot-done event"),C.$emit("pundit-boot-done")};var M=function(){q.wipe(),j.wipe(),h.wipe(),p.getMyNotebooks(),p.getCurrent(),g.getAnnotations(),k.getAllItems(),c.useBasicRelations&&K(),L()},N=function(){q.wipe(),j.wipe(),h.wipe(),g.getAnnotations(),c.useBasicRelations&&K(),L()},O=function(){if(c.korbo.active){var a=E[c.korbo.confName],b=a.languages[0];for(var d in a.languages)if(a.languages[d].state===!0){b=a.languages[d];break}var e={container:"kee-korbo2",label:"Korbo",active:!0,basketID:a.basketID,url:a.endpoint,language:b.value},f=new v(e);f.push(e),delete f}};return G.log("Component up and running"),G}]),angular.module("Pundit2.SimplifiedClient",[]),angular.module("Pundit2.SimplifiedClient").run(["$injector","Config",function(a,b){if(b.isModuleActive("SimplifiedClient")){var c=a.get("SimplifiedClient");c.boot()}}]).service("SimplifiedClient",["BaseComponent","$rootScope","MyPundit","MyItems","AnnotationsCommunication","TextFragmentAnnotator","Consolidation","ItemPopover",function(a,b,c,d,e,f,g,h){var i,j=new a("SimplifiedClient"),k=function(){i=angular.element("[data-ng-app='Pundit2']"),i.hasClass("pnd-wrp")||i.addClass("pnd-wrp"),i.append('<button class="btn btn-info" ng-click="toggleAnnotation()">Show or Hide Annotation</button>')},l=!0;return b.toggleAnnotation=function(){h.hide(),l?g.wipe():g.consolidateAll(),l=!l},j.boot=function(){k(),e.getAnnotations()},j}]),angular.module("Pundit2.SimplifiedClient").service("ItemPopover",["BaseComponent","$rootScope","$popover","AnnotationsExchange",function(a,b,c,d){var e,f,g=new a("ItemPopover"),h=null,i=null,j=null,k=!0,l="bottom",m={scope:b.$new(),title:"Annotations Preview",template:"src/SimplifiedClient/ItemPopover.tmpl.html",trigger:"manual",container:"[data-ng-app='Pundit2']"};return g.show=function(a,b,d,e){null!==h&&(h.hide(),h.destroy()),"undefined"!=typeof b&&(i=b),"undefined"!=typeof a&&(j=a),k="undefined"!=typeof e?e:!0,m.placement="string"!=typeof d?l:d,h=c(j,m),h.$promise.then(h.show)},g.hide=function(){null!==h&&h.$isShown!==!1&&(h.hide(),h.destroy(),h=null)},g.update=function(a,b){var c=angular.element("html");return b.top+a.height()>c.height()&&g.show(j,i,"top",!1),b.left<0?void g.show(j,i,"right",!1):b.left+a.width()>c.width()?void g.show(j,i,"left",!1):void 0},g.fix=function(){if("bottom"!==m.placement){var a="top"===m.placement?1:2,b=angular.element(".pnd-item-popover"),c=b.height(),d=e+(f-c)/a;b.css("top",d),f=c,e=d}},g.getAnnotation=function(){return null!==i?d.getAnnotationsByItem(i.uri):void 0},m.scope.$on("tooltip.show",function(){var a=angular.element(".pnd-item-popover"),b=a.position();e=b.top,f=a.height(),k&&g.update(a,b)}),g.log("Up and running!"),g}]),angular.module("Pundit2.SimplifiedClient").controller("ItemPopoverCtrl",["$scope","ItemPopover",function(a,b){a.annotations=b.getAnnotation(),a.hide=function(){b.hide()},a.onContentClick=function(){b.fix()}}]),angular.module("Pundit2.Core",[]),angular.module("Pundit2.Core").service("Utils",function(){var a={};return a.deepExtend=function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=angular.copy(b[c]);return a},a.getLabelFromURI=function(a){var b;return a.match("http://www.freebase.com/schema/")?b=a.substring(31).replace(/\//g,": ").replace(/_/g," "):a.match("http://dbpedia.org/ontology/")?b=a.substring(28).replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()}):(b=a.substring(a.lastIndexOf("/")+1),-1!==b.indexOf("#")&&(b=b.substring(b.lastIndexOf("#")+1)),b)},a}),angular.module("Pundit2.Core").constant("BASECOMPONENTDEFAULTS",{debug:!1}).service("BaseComponent",["$log","Utils","BASECOMPONENTDEFAULTS","$window","Config",function(a,b,c,d,e){var f=function(a,f){this.name=a,this.options=angular.copy(c),"undefined"!=typeof f&&b.deepExtend(this.options,f),"undefined"==typeof d.PUNDIT&&(d.PUNDIT={config:e},this.log("Created PUNDIT global object")),"undefined"!=typeof e.modules[this.name]&&(b.deepExtend(this.options,e.modules[this.name]),this.log("BaseComponent extending with Config.modules conf")),e.modules[this.name]=this.options};return f.prototype.err=function(){var b=function(){try{throw Error("")}catch(a){return a}},c=b(),d=c.stack.split("\n")[5],e=Array.prototype.slice.call(arguments);e.unshift("#PUNDIT "+this.name+"#"),e.push(d),a.error.apply(null,e)},f.prototype.log=function(){if(e.debugAllModules===!0||this.options.debug===!0){var b=Array.prototype.slice.call(arguments);b.unshift("#"+this.name+"#"),a.log.apply(null,b)}},f}]),angular.module("Pundit2.Core").service("NameSpace",["BaseComponent","Config","$interpolate","$window",function(a,b,c,d){var e=new a("NameSpace"),f="http://www.w3.org/1999/02/22-rdf-syntax-ns#",g="http://www.w3.org/2000/01/rdf-schema#",h="http://purl.org/dc/elements/1.1/",i="http://purl.org/dc/terms/",j="http://purl.org/pundit/ont/ao#",k="http://www.w3.org/2004/02/skos/core#";return d.PUNDIT.ns=e,e.punditOntologyBaseURL=j,e.rdf={},e.rdf.type=f+"type",e.rdf.value=f+"value",e.rdf.property=f+"Property",e.rdfs={},e.rdfs.label=g+"label",e.rdfs.comment=g+"comment",e.rdfs.resource=g+"Resource",e.rdfs.literal=g+"Literal",e.rdfs.seeAlso=g+"seeAlso",e.dateTime="http://www.w3.org/2001/XMLSchema#dateTime",e.item={label:e.rdfs.label,altLabel:k+"altLabel",description:h+"description",image:"http://xmlns.com/foaf/0.1/depiction",type:e.rdf.type,pageContext:j+"hasPageContext",isPartOf:i+"isPartOf",selector:"http://www.w3.org/ns/openannotation/core/hasSelector",parentItemXP:j+"parentItemXP"},e.notebook={label:e.rdfs.label,visibility:"http://open.vocab.org/terms/visibility",created:i+"created",creator:i+"creator",creatorName:h+"creator",id:j+"id",includes:j+"includes",type:e.rdf.type},e.annotation={creatorName:h+"creator",created:i+"created",creator:i+"creator",modified:i+"modified",pageContext:j+"hasPageContext",target:"http://www.openannotation.org/ns/hasTarget",isIncludedIn:j+"isIncludedIn",hasTemplate:j+"hasTemplate"},e.fragments={imagePart:j+"fragment-image",text:j+"fragment-text"},e.types={page:"http://schema.org/WebPage",image:"http://xmlns.com/foaf/0.1/Image",named:j+"named-content"},e.typesLabels={},e.typesLabels[e.fragments.imagePart]="Image fragment",e.typesLabels[e.fragments.text]="Text fragment",e.typesLabels[e.types.page]="Web page",e.typesLabels[e.types.image]="Image",e.typesLabels[e.types.named]="Named content",e.selectors={baseURI:"http://purl.org/pundit/selector/",polygonType:"http://purl.org/pundit/ont/ao#selector-polygon",rectangleType:"http://purl.org/pundit/ont/ao#selector-rectangle"},e.fragmentBaseUri="http://purl.org/pundit/fragment/",e.as=b.annotationServerBaseURL,e.asUsers=e.as+"api/users/",e.asUsersCurrent=e.as+"api/users/current",e.asUsersLogout=e.as+"api/users/logout",e.asNB=e.as+"api/notebooks",e.asNBEditMeta=e.as+"api/notebooks/{{id}}",e.asNBOwned=e.as+"api/notebooks/owned",e.asNBCurrent=e.as+"api/notebooks/current",e.asNBPrivate=e.as+"api/notebooks/private/{{id}}",e.asNBPublic=e.as+"api/notebooks/public/{{id}}",e.asNBMeta=e.as+"api/notebooks/{{id}}/metadata",e.asOpenNBMeta=e.as+"api/open/notebooks/{{id}}/metadata",e.asOpenNBAnnMeta=e.as+"api/open/notebooks/{{id}}/annotations/metadata",e.asAnnMetaSearch=e.as+"api/annotations/metadata/search",e.asOpenAnnMetaSearch=e.as+"api/open/metadata/search",e.asAnn=e.as+"api/annotations/{{id}}",e.asOpenAnn=e.as+"api/open/annotations/{{id}}",e.asAnnContent=e.as+"api/annotations/{{id}}/content",e.asAnnItems=e.as+"api/annotations/{{id}}/items",e.asPref=e.as+"api/services/preferences/{{key}}",e.get=function(a,b){if("string"!=typeof e[a])return void e.err("get() cant find key "+a);"undefined"==typeof b&&(b={});var d,f=e[a],g=f.match(/{{([a-zA-Z0-9]*)}}/g);if(null!==g&&g.length>0){var h=0;for(d in b)h++;if(g.length>h)return void e.err("Context variables mismatch! Expecting "+g.join(", ")+" instead got "+JSON.stringify(b))}return c(f)(b)},e.log("NameSpace up and running"),e}]),angular.module("Pundit2.Core").factory("Config",["PUNDITDEFAULTCONF","$window","Utils",function(a,b,c){var d={};return c.deepExtend(d,a),"undefined"!=typeof b.punditConfig&&angular.isObject(b.punditConfig)&&c.deepExtend(d,b.punditConfig),d.isValid=function(){return!0},d.isModuleActive=function(a){return angular.isObject(d.modules[a])&&d.modules[a].active===!0},"undefined"==typeof b.PUNDIT&&(b.PUNDIT={config:d}),d}]),angular.module("Pundit2.Core").constant("PUNDITDEFAULTCONF",{korbo:{active:!1,confName:"KORBODEFAULTCONF"},imageFragmentAnnotator:{active:!1,baseUrl:"http://dev.thepund.it/download/ia/last-beta/index.php?u="},annotationServerBaseURL:"http://demo-cloud.as.thepund.it:8080/annotationserver/",confURL:"local",debugAllModules:!1,vocabularies:[],templates:["http://conf.thepund.it/V2/templates/tagFree","http://conf.thepund.it/V2/templates/comment","http://conf.thepund.it/V2/templates/tagFixedMarx","http://conf.thepund.it/V2/templates/timeline","http://conf.thepund.it/V2/templates/peopleGraph"],useTemplates:!0,useOnlyTemplateMode:!1,useBasicRelations:!0,modules:{Client:{active:!1},SimplifiedClient:{active:!1},Dashboard:{active:!0},Toolbar:{active:!0},AnnotationSidebar:{active:!0},Preview:{active:!0},PageItemsContainer:{active:!0},MyNotebooksContainer:{active:!0},MyItemsContainer:{active:!0},SelectorsManager:{active:!0},TripleComposer:{active:!0},NotebookComposer:{active:!0}}}),angular.module("Pundit2.Core").constant("MYPUNDITDEFAULTS",{loginPollTimerMS:1e3,loginModalCloseTimer:3e5}).service("MyPundit",["BaseComponent","MYPUNDITDEFAULTS","NameSpace","$http","$q","$timeout","$modal","$window","$interval",function(a,b,c,d,e,f,g,h,i){var j,k,l=new a("MyPundit",b),m=!1,n={};
l.getLoginStatus=function(){return k},l.isUserLogged=function(){return m},l.getUserData=function(){return""!==n&&"undefined"!=typeof n?n:void 0},l.checkLoggedIn=function(){var a,b=e.defer();return a=d({headers:{Accept:"application/json"},method:"GET",url:c.get("asUsersCurrent"),withCredentials:!0}).success(function(a){0===a.loginStatus?(m=!1,j=a.loginServer,b.resolve(!1)):(m=!0,k="loggedIn",n=a,b.resolve(!0))}).error(function(){l.err("Server error"),b.reject("check logged in promise error")}),b.promise};var o;l.login=function(){return o=e.defer(),l.isUserLogged()?o.resolve(!0):(k="loggedOff",l.openLoginPopUp()),o.promise};var p;l.openLoginPopUp=function(){if(f.cancel(p),"undefined"==typeof o)return void l.err("Login promise not defined, you should call login() first");k="waitingForLogIn";var a=h.open(j,"loginpopup","left=260,top=120,width=480,height=360"),b=i(function(){"undefined"==typeof a||!a.closed&&null!==a||(i.cancel(b),f(function(){f.cancel(p)},5e3))},1e3),c=function(){var a=l.checkLoggedIn();a.then(function(a){a&&(o.resolve(!0),i.cancel(b),f.cancel(p))},function(){o.reject("login error")}),p=f(c,l.options.loginPollTimerMS)};c(),f(function(){f.cancel(p),o.resolve(!1),a.close()},l.options.loginModalCloseTimer)},l.logout=function(){var a,b=e.defer();return a=d({headers:{Accept:"application/json"},method:"GET",url:c.get("asUsersLogout"),withCredentials:!0}).success(function(){m=!1,n={},b.resolve(!0)}).error(function(){b.reject("logout promise error")}),b.promise};var q=g({container:"[data-ng-app='Pundit2']",template:"src/Core/login.modal.tmpl.html",show:!1,backdrop:"static"});return l.closeLoginModal=function(){q.hide(),f.cancel(p)},l.cancelLoginModal=function(){q.hide(),o.resolve(!1),f.cancel(p)},l}]),angular.module("Pundit2.Core").constant("ANALYTICSDEFAULTS",{trackingCode:"UA-50437894-1",globalTracker:"__gaPndtTracker",maxHits:20,bufferDelay:1e3,doTracking:!0,debug:!1}).service("Analytics",["BaseComponent","$window","$document","$interval","$timeout","ANALYTICSDEFAULTS",function(a,b,c,d,e,f){var g,h=new a("Analytics",f),i={events:[]},j=0,k=!1,l=!1,m=h.options.maxHits;!function(a,c,d,e,f,g,i){a.GoogleAnalyticsObject=f,a[f]=a[f]||function(){(a[f].q=a[f].q||[]).push(arguments)},a[f].l=1*new Date,g=c.createElement(d),i=c.getElementsByTagName(d)[0],g.async=1,g.src=e,g.onload=function(){h.log("GA async script loaded"),n=b[h.options.globalTracker]},i.parentNode.insertBefore(g,i)}(b,c[0],"script","//www.google-analytics.com/analytics.js",h.options.globalTracker);var n=b[h.options.globalTracker];n("create",h.options.trackingCode,{storage:"none",cookieDomain:"none"});var o=function(){return m>=h.options.maxHits?(l=!1,void h.log(h.options.maxHits+" hits available again")):void(g=e(function(){m=Math.min(m+2,h.options.maxHits),o(),p()},h.options.bufferDelay))},p=function(){if(0===i.events.length)return void(k=!1);if(m>0){j++;var a=i.events.shift();n("send",{hitType:"event",eventCategory:a.eventCategory,eventAction:a.eventAction,eventLabel:a.eventLabel,eventValue:a.eventValue}),m--,l||(l=!0,o()),h.log("Tracked ("+j+" sent / "+m+" available) event "+a.eventCategory+" ("+a.eventAction+": "+a.eventLabel+")"),p()}};return h.getHits=function(){return m},h.track=function(a,b,c,d){if(h.options.doTracking){if(!angular.isDefined(a)||!angular.isDefined(b))return void h.err("Category and Action are required");i.events.push({eventCategory:a,eventAction:b,eventLabel:c,eventValue:d}),k||(k=!0,p())}},h.log("Component running"),h}]),angular.module("Pundit2.Core").service("PredicateSelector",["BaseComponent","Config","$http","$q",function(a,b,c,d){var e=new a("PredicateSelector");return e.getAllVocabularies=function(){var a=b.vocabularies,c=[],f=d.defer();e.log("Loading predicates from",a);var g=[];for(var h in a){var i=e.getRelations(a[h]);i.then(function(a){c.push.apply(c,a)}),g.push(i)}return d.all(g).then(function(){e.log("Completed loading, get "+c.length+" predicates"),f.resolve(c)}),f.promise},e.getRelations=function(a){var b,f=d.defer();return b=a.indexOf("?")>-1?"&jsonp=JSON_CALLBACK":"?jsonp=JSON_CALLBACK",c.jsonp(a+b).success(function(b){if("undefined"==typeof b||"undefined"==typeof b.result)return e.log("Impossible to get predicates from: "+a),void f.resolve();if("predicates"!==b.result.vocab_type)return e.log("Response not is a predicates vocabularie "+a),void f.resolve();if("undefined"==typeof b.result.items)return e.log("Response not have items property "+a),void f.resolve();var c=b.result.items,d=[];for(var g in c){e.log("Add "+c[g].label);var h=c[g];delete h.children,delete h.is_root_node,delete h.nodetype,h.type=h.rdftype,delete h.rdftype,h.uri=h.value,delete h.value,h.vocabulary=a,d.push(h)}e.log("Loaded "+d.length+" predicates from: "+a),f.resolve(d)}),f.promise},e}]),angular.module("Pundit2.Core").service("TemplatesSelector",["BaseComponent","Config","$http","$q","Item","Template","ItemsExchange","TemplatesExchange","FreebaseSelector",function(a,b,c,d,e,f,g,h,i){var j=new a("TemplatesSelector"),k=new i({container:"freebase"}),l=["#FF00FF","#0000FF","#00FFFF","#00FF00","#FFFF00","#FF0000","#008800","#822222"];return j.getAll=function(){var a=b.templates,c=[];a.length>0&&h.setCurrent(a[0]);for(var e in a)c.push(j.get(a[e],l[e]));return j.log("Loading templates from",a),d.all(c)},j.get=function(a,h){var i,l=d.defer();return i=a.indexOf("?")>-1?"&jsonp=JSON_CALLBACK":"?jsonp=JSON_CALLBACK",c.jsonp(a+i).success(function(c){if("undefined"==typeof c||"undefined"==typeof c.triples)return j.log("Impossible to get templates from: "+a),void l.resolve(void 0);c.id=a,"undefined"!=typeof h&&(c.color=h);var i,m=c.triples;for(i in m)"undefined"!=typeof m[i].predicate&&(m[i].predicate.type=["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],m[i].predicate=new e(m[i].predicate.uri,m[i].predicate),g.addItemToContainer(m[i].predicate,b.modules.Client.relationsContainer));var n=new f(c.id,c);for(i in m)"undefined"!=typeof m[i].object&&"uri"===m[i].object.type&&m[i].object.value.indexOf("freebase")>-1&&!function(a){var b=m[i].object.value.substring(23),c={mid:b,image:"https://usercontent.googleapis.com/freebase/v1/image"+b,description:-1,uri:-1},f=d.defer();f.promise.then(function(b){n.triples[a].object.type="item",n.triples[a].object.value=b,n.triples[a].object.value.label=n.triples[a].object.label,n.triples[a].object.value=new e(n.triples[a].object.value.uri,n.triples[a].object.value)}),k.getItemDetails(c,f)}(i);j.log("Loaded template:",n),l.resolve(n)}).error(function(){l.resolve(void 0)}),l.promise},j}]),angular.module("Pundit2.Core").constant("FP3DEFAULTS",{label:"Finish",link:"",active:!1,debug:!1}).service("Fp3",["BaseComponent","FP3DEFAULTS","Config","$http","$q",function(a,b,c,d,e){var f=new a("Fp3",b),g="#html-storage";return f.getPunditContentUrl=function(){var a=angular.element(".pundit-content").attr("about");return"undefined"==typeof a?"":a},f.getNodeContent=function(){var a=angular.element(g).html();return"undefined"==typeof a?"":a},f.post=function(){var a=e.defer();return""===f.options.link?void f.log("Error: do you must configure a link to POST data"):(d({headers:{"Content-Type":"application/json"},method:"POST",url:f.options.link+"?fp=on",data:{punditContent:f.getPunditContentUrl(),punditPage:f.getNodeContent(),annotationServerBaseURL:c.annotationServerBaseURL},withCredentials:!0}).success(function(){f.log("Success: fp3 post data")}).error(function(b){f.log("Error: impossible to post data",b),a.reject()}),a.promise)},f.log("Up and Running"),f}]),angular.module("Pundit2.Core").service("ImageFragmentAnnotatorHelper",["$rootScope","$modal","$window","BaseComponent","Config","NameSpace","ContextualMenu","XpointersHelper","Item","MyItems","MyPundit",function(a,b,c,d,e,f,g,h,i,j,k){var l=new d("ImageFragmentAnnotatorHelper"),m={close:"ia-closed",addPolygon:"ia-add-polygon"},n='<iframe class="pnd-image-fragment-frame" width="620" height="500" src="'+e.imageFragmentAnnotator.baseUrl,o='" scrolling="no" frameborder="0" allowfullscreen></iframe>',p=function(){g.addAction({type:[e.modules.ImageHandler.cMenuType],name:"openImageFragmentAnnotator",label:"Annotate a part of this image",showIf:function(){return!0},priority:99,action:function(a){s(a)}})};a.$on("pundit-boot-done",function(){e.imageFragmentAnnotator.active&&p()}),c.addEventListener("message",function(b){if(b.data.type===m.close&&t(),b.data.type===m.addPolygon){var c=b.data;if(k.isUserLogged()){var d=l.createItemFromPolygon(c.poly);j.addItem(d)}else a.$on("consolidation-completed",function(){var a=l.createItemFromPolygon(c.poly);j.addItem(a)}),k.login()}});var q,r,s=function(a){var b=decodeURIComponent(a.image);b=b.replace(/'/g,"\\'"),angular.element("[data-ng-app='Pundit2']").append("http://"===b.substring(0,7)||"https://"===b.substring(0,8)?n+b+o:n+"http://"+b+o),q=angular.element("body").css("overflow"),angular.element("body").css("overflow","hidden"),r=a},t=function(){angular.element("body").css("overflow",q),angular.element(".pnd-image-fragment-frame").remove()};return l.createItemFromPolygon=function(a){var b=r.image.substring(r.image.lastIndexOf("/")+1,r.image.length),c={uri:f.fragmentBaseUri+"image/"+(new Date).getTime(),type:[f.fragments.imagePart],label:a.name,description:"This fragment represents a part of the image "+b,isPartOf:r.isPartOf,image:r.image,pageContext:h.getSafePageContext(),polygon:angular.copy(a.points),polygonUri:f.selectors.baseURI+"polygon/"+((new Date).getTime()+1),parentItemXP:r.uri};return new i(c.uri,c)},l.drawPolygonOverImage=function(a,b){if("undefined"==typeof b||!b.is("img, svg"))return!1;var c,d=b.width(),e=b.height(),f=(b.outerWidth(!0)-d)/2,g=(b.outerHeight(!0)-e)/2,h='<span class="pnd-cons-svg"></span>',i='<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" class="pnd-polygon-layer" width='+d+" height="+e+"></svg>",j=angular.element(h).insertBefore(b).css({position:"absolute","margin-left":f,"margin-top":g}),k=angular.element(i).appendTo(j),l=[];for(c=0;c<a.length;c++)l.push({x:a[c].x*d,y:a[c].y*e});var m=[];for(c=0;c<l.length;c++){var n,o;c===l.length-1?(n=l[c],o=l[0]):(n=l[c],o=l[c+1]),m.push("<line x1="+n.x+" y1="+n.y+" x2="+o.x+" y2="+o.y+" ></line>")}var p='<polygon points="';for(c=0;c<l.length;c++)p+=l[c].x+","+l[c].y+" ";p+='"></polygon>',k.append(m),k.find("line").css({stroke:"red","stroke-width":2}),k.prepend(p),k.find("polygon").css({fill:"red",opacity:.3}),angular.element(j).html(j.html())},l}]),angular.module("Pundit2.Core").factory("Template",["BaseComponent","Utils","TemplatesExchange",function(a,b,c){var d=new a("Template"),e=function(a,e){return"undefined"==typeof a?void d.err("Can't create a template without an id"):(this.id=a,angular.isObject(e)&&(d.log("Extending new Template with values "+this.id,e),b.deepExtend(this,e)),void c.addTemplate(this))};return e}]),angular.module("Pundit2.Core").constant("ITEMDEFAULTS",{iconDefault:"pnd-icon pnd-icon-eye",iconImage:"pnd-icon pnd-icon-camera",iconText:"pnd-icon pnd-icon-align-center",iconWebPage:"pnd-icon-file-text",iconEntity:"pnd-icon pnd-icon-code-fork",classDefault:"pnd-item-default",classImage:"pnd-item-image",classText:"pnd-item-text",classWebPage:"pnd-item-web-page",classEntity:"pnd-item-entity"}).factory("Item",["BaseComponent","NameSpace","Utils","ItemsExchange","ITEMDEFAULTS",function(a,b,c,d,e){var f=new a("Item",e),g=function(a,b){return"undefined"==typeof a?void f.err("Can't create an item without an URI"):(this.uri=a,this.type=[],this.label="default item label",this.isAnnomatic=!1,angular.isObject(b)&&(f.log("Extending new Item with values "+this.uri,b),c.deepExtend(this,b)),void d.addItem(this))};return g.prototype.isProperty=function(){return-1!==this.type.indexOf(b.rdf.property)},g.prototype.isTextFragment=function(){return-1!==this.type.indexOf(b.fragments.text)},g.prototype.isImage=function(){return-1!==this.type.indexOf(b.types.image)},g.prototype.isImageFragment=function(){return-1!==this.type.indexOf(b.fragments.imagePart)},g.prototype.isWebPage=function(){return-1!==this.type.indexOf(b.types.page)},g.prototype.isEntity=function(){return!(this.isImage()||this.isProperty()||this.isTextFragment()||this.isImage()||this.isImageFragment()||this.isWebPage())},g.prototype.fromAnnotationRdf=function(a){var c=b.item,d=a[this.uri];if("undefined"==typeof d)return void f.log("Error? No RDF for this item? ",this.uri);for(var e in c){var g=c[e];g in d&&(this[e]=d[g][0].value)}var h=d[b.rdf.type];if(angular.isArray(h)&&h.length>0){this.type=[];for(var i in h)this.type.push(h[i].value)}if(-1!==this.type.indexOf(b.fragments.imagePart)&&b.item.selector in d){var j=d[b.item.selector];for(var k in j){var l=j[k].value;if(l in a){var m=a[l];if(this.polygonUri=l,m[b.rdf.type][0].value===b.selectors.polygonType){var n=JSON.parse(m[b.rdf.value][0].value);this.polygon=n.points}}}}f.log("Created new item from annotation RDF: "+this.label)},g.prototype.toRdf=function(){var a={};return a[b.item.label]=[{type:"literal",value:this.label}],a[b.item.type]=[],this.type.forEach(function(c){a[b.item.type].push({type:"uri",value:c})}),"undefined"!=typeof this.altLabel&&(a[b.item.altLabel]=[{type:"literal",value:this.altLabel}]),"undefined"!=typeof this.description&&(a[b.item.description]=[{type:"literal",value:this.description}]),"undefined"!=typeof this.image&&(a[b.item.image]=[{type:"uri",value:this.image}]),"undefined"!=typeof this.pageContext&&(a[b.item.pageContext]=[{type:"uri",value:this.pageContext}]),"undefined"!=typeof this.isPartOf&&(a[b.item.isPartOf]=[{type:"uri",value:this.isPartOf}]),"undefined"!=typeof this.parentItemXP&&(a[b.item.parentItemXP]=[{type:"uri",value:this.parentItemXP}]),"undefined"!=typeof this.polygonUri&&(a[b.item.selector]=[{type:"uri",value:this.polygonUri}]),a},g.prototype.toJsonLD=function(){},g.prototype.getIcon=function(){return this.isImage()||this.isImageFragment()?f.options.iconImage:this.isTextFragment()?f.options.iconText:this.isWebPage()?f.options.iconWebPage:this.isEntity()?f.options.iconEntity:f.options.iconDefault},g.prototype.getClass=function(){return this.isImage()||this.isImageFragment()?f.options.classImage:this.isTextFragment()?f.options.classText:this.isWebPage()?f.options.classWebPage:this.isEntity()?f.options.classEntity:f.options.classDefault},f.log("Component up and running"),g}]),angular.module("Pundit2.Core").service("TypesHelper",["BaseComponent","NameSpace","Utils",function(a,b,c){var d=new a("TypesHelper"),e={};return d.addFromAnnotationRdf=function(a,d){a in e||(e[a]={},a in d?(b.item.label in d[a]&&(e[a].label=d[a][b.item.label][0].value),b.item.description in d[a]&&(e[a].description=d[a][b.item.description][0].value)):e[a].label=c.getLabelFromURI(a))},d.add=function(a,b,c){a in e||(e[a]={}),e[a].label=b,"undefined"!=typeof c&&(e[a].description=c)},d.getLabel=function(a){if("undefined"==typeof e[a]){var d;d=a.match(b.punditOntologyBaseURL)&&a in b.typesLabels?b.typesLabels[a]:c.getLabelFromURI(a),e[a]={label:d}}return e[a].label},d.log("Component up and running"),d}]),angular.module("Pundit2.Core").constant("CONSOLIDATIONDEFAULTS",{}).service("Consolidation",["$rootScope","$location","CONSOLIDATIONDEFAULTS","BaseComponent","NameSpace","Config","Item","ItemsExchange","XpointersHelper",function(a,b,c,d,e,f,g,h,i){var j=new d("Consolidation",c),k={};j.wipe=function(){k.itemListByType={},k.typeUriMap={},k.uriTypeMap={},k.itemListByURI={},k.fragmentsItemListByParentURI={};for(var a in k.annotators)k.annotators[a].wipe();j.log("Wiped up!")},j.wipe(),k.annotableTypes=[],k.annotators={},j.getItems=function(){return k.itemListByURI},j.getFragmentParentList=function(){return k.fragmentsItemListByParentURI};var l=function(a){angular.isArray(a)||(a=[a]);for(var b=a.length;b--;){var c=a[b],d=j.isConsolidable(c);d!==!1?c.uri in k.itemListByURI?j.log("Item already present: "+c.label):(d in k.itemListByType?(k.itemListByType[d][c.uri]=c,k.typeUriMap[d].push(c.uri)):(k.typeUriMap[d]=[],k.itemListByType[d]={},k.itemListByType[d][c.uri]=c),"undefined"!=typeof c.parentItemXP&&(c.parentItemXP in k.fragmentsItemListByParentURI?k.fragmentsItemListByParentURI[c.parentItemXP].push(c):k.fragmentsItemListByParentURI[c.parentItemXP]=[c]),k.itemListByURI[c.uri]=c,k.uriTypeMap[c.uri]=d,j.log("Added item: "+c.label+" ("+d+")")):j.log("Not adding, item is not consolidable: "+c.label)}};return j.consolidateAll=function(){var b=[];"undefined"!=typeof f.modules.PageItemsContainer&&(b=b.concat(h.getItemsByContainer(f.modules.PageItemsContainer.container))),"undefined"!=typeof f.modules.MyItems&&(b=b.concat(h.getItemsByContainer(f.modules.MyItems.container))),j.log("Consolidating ALL items"),j.consolidate(b),a.$emit("consolidation-completed")},j.consolidate=function(a){j.log("Will try to consolidate "+a.length+" items"),j.wipe(),l(a);for(var b in k.annotators)b in k.itemListByType?(j.log("Consolidating annotator type "+b+", "+k.typeUriMap[b].length+" items"),k.annotators[b].consolidate(k.itemListByType[b])):j.log("Skipping annotator type "+b+": no item to consolidate.")},j.addAnnotator=function(a){j.log("Adding annotable type ",a.label),k.annotableTypes.push(a.label),k.annotators[a.label]=a},j.isConsolidable=function(a){for(var b in k.annotators)if(k.annotators[b].isConsolidable(a))return b;return!1},j.isConsolidated=function(a){return a instanceof g?a.uri in k.itemListByURI:!1},j.getAvailableTargets=function(a){var c=[],d=i.options.namedContentClasses;("undefined"==typeof a||a!==!0)&&c.push(decodeURIComponent(b.absUrl()));for(var e=d.length;e--;)for(var f=d[e],g=angular.element("."+f),h=g.length;h--;){var j=angular.element(g[h]).attr("about");j&&c.push(j)}return c},j}]),angular.module("Pundit2.Annotators",[]),angular.module("Pundit2.Annotators").constant("XPOINTERSHELPERDEFAULTS",{wrapNodeName:"span",wrapNodeClass:"pnd-cons",textFragmentIconClass:"pnd-text-fragment-icon",consolidationClasses:["pnd-cons-svg"],namedContentClasses:["pundit-content"]}).config(["$locationProvider",function(a){a.html5Mode(!0)}]).service("XpointersHelper",["XPOINTERSHELPERDEFAULTS","NameSpace","BaseComponent","$document","$location","$window",function(a,b,c,d,e,f){var g=new c("XpointersHelper",a);g.getXPathsFromXPointers=function(a){for(var b=[],c={},d=a.length-1;d>=0;d--){var e=a[d],f=g.xPointerToXPath(e);g.isValidXpointer(e)?(c[e]=f,b.push(e)):g.err("Invalid xpointer passed to getXPathsFromXPointers: THIS SHOULD NOT HAPPEN!",e)}return c},g.isValidXpointerURI=function(a){return"undefined"==typeof a?(g.err("Xpointer is undefined: this should not happend!"),!1):null===a.match(/#xpointer\(start-point\(string-range\(/)||null===a.match(/range-to\(string-range\(/)?!1:!0},g.isValidXpointer=function(a){if(!g.isValidXpointerURI(a))return!1;var b=g.xPointerToXPath(a);return g.isValidRange(b.startNode,b.startOffset,b.endNode,b.endOffset)},g.xPointerToXPath=function(a){var b,c,d={};return g.isValidXpointerURI(a)?(b=a.split("#xpointer(start-point(string-range(")[1].split("))/range-to(string-range("),c=b[0].split(",'',"),d.startXpath=c[0],d.startOffset=c[1],c=b[1].substr(0,b[1].length-3).split(",'',"),d.endXpath=c[0],d.endOffset=c[1],d.startNode=g.getNodeFromXpath(d.startXpath),d.endNode=g.getNodeFromXpath(d.endXpath),d):(g.log("xPointerToXPath() Invalid xpointer! ",a),{startNode:null,startOffset:null,endNode:null,endOffset:null,valid:!1})},g.getNodeFromXpath=function(a){var b=d[0].evaluate(a,d[0],null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return b.singleNodeValue},g.isValidRange=function(a,b,c,e){try{var f=d[0].createRange();return f.setStart(a,b),f.setEnd(c,e),!0}catch(g){return!1}},g.splitAndSortXPaths=function(a){var b=g.getNodeFromXpath("//body"),c=[],e=[];for(var f in a){var h=d[0].createRange(),i=g.getNodeFromXpath(a[f].startXpath);h.setStart(b,0),h.setEnd(i,a[f].startOffset),c.push({xpointer:f,xpath:a[f].startXpath,offset:a[f].startOffset,range:h});var j=d[0].createRange();i=g.getNodeFromXpath(a[f].endXpath),j.setStart(b,0),j.setEnd(i,a[f].endOffset),c.push({xpointer:f,xpath:a[f].endXpath,offset:a[f].endOffset,range:j})}c.sort(function(a,b){return a.range.compareBoundaryPoints(Range.END_TO_END,b.range)}),e[0]=c[0];for(var k=1,l=0,m=c.length;m>k;k++)(c[k].xpath!==e[l].xpath||c[k].offset!==e[l].offset)&&(e[++l]=c[k]);return e},g.getClassesForXpaths=function(a,b,c,d){for(var e=[],f=[],j=0;j<b.length-1;j++){var k=b[j],l=g.getStartingXPs(a,c,k.xpath,k.offset),m=g.getEndingXPs(a,c,k.xpath,k.offset);e=h(e,l),e=i(e,m);for(var n=[],o=e.length-1;o>=0;o--)for(var p=e[o],q=d[p].length-1;q>=0;q--)n.push(d[p][q]);f[j+1]=n}return f};var h=function(a,b){return a.concat(b)},i=function(a,b){for(var c=[],d=a.length-1;d>=0;d--)-1===b.indexOf(a[d])&&c.push(a[d]);return c};return g.getStartingXPs=function(a,b,c,d){for(var e=[],f=a.length-1;f>=0;f--){var g=a[f];b[g].startXpath===c&&b[g].startOffset===d&&e.push(g)}return e},g.getEndingXPs=function(a,b,c,d){for(var e=[],f=a.length-1;f>=0;f--){var g=a[f];b[g].endXpath===c&&b[g].endOffset===d&&e.push(g)}return e},g.updateDOM=function(a,b,c){for(var d=a.length-1;d>0;d--){var e=a[d-1],f=a[d];c[d].length>0&&(g.log("## Updating DOM, xpath "+d+": "+c[d].join(" ")),g.wrapXPaths(e,f,g.options.wrapNodeName,b,c[d]))}g.log("Dom successfully updated!")},g.wrapXPaths=function(a,b,c,e,f){var h=c||g.options.wrapNodeName,i=e||g.options.wrapNodeClass,j=f||[],k=d[0].createRange(),l=g.getNodeFromXpath(a.xpath),m=g.getNodeFromXpath(b.xpath);a.xpath.match(/\[[0-9]+\]$/)||b.xpath.match(/\[[0-9]+\]$/)?(g.isElementNode(l)?k.setStart(l,a.offset):k.setStart(l,a.offset),g.isElementNode(m)?k.setEndAfter(m):k.setEnd(m,b.offset)):k.selectNode(l.childNodes[a.offset]),g.wrapElement(k.commonAncestorContainer,k,h,i,j)},g.wrapElement=function(a,b,c,d,e){if(a.childNodes&&a.childNodes.length>0)for(var f=a.childNodes.length-1;f>=0&&a.childNodes[f];f--)g.wrapElement(a.childNodes[f],b,c,d,e);else g.isTextNodeInsideRange(a,b)?g.wrapNode(a,b,c,d,e):g.isImageNodeInsideRange(a,b)&&g.wrapNode(a,b,c,d,e)},g.isTextNodeInsideRange=function(a,b){var c;return a.nodeType!==Node.TEXT_NODE?!1:(c=a.textContent.replace(/ /g,"").replace(/\n/,""),a.data&&""!==c&&" "!==c?g.isNodeInsideRange(a,b):!1)},g.isImageNodeInsideRange=function(a,b){return a.nodeType!==Node.ELEMENT_NODE?!1:"img"!==a.tagName.toLowerCase()?!1:g.isNodeInsideRange(a,b)},g.isNodeInsideRange=function(a,b){var c=d[0].createRange();try{c.selectNode(a)}catch(e){c.selectNodeContents(a)}return-1!==b.compareBoundaryPoints(Range.END_TO_START||3,c)||1!==b.compareBoundaryPoints(Range.START_TO_END||1,c)?!1:!0},g.wrapNode=function(a,b,c,e,f){var h=d[0].createRange();a===b.startContainer||a===b.endContainer?(h.setStart(a,a===b.startContainer?b.startOffset:0),h.setEnd(a,a===b.endContainer?b.endOffset:a.length)):h.selectNode(a),h.surroundContents(g.createWrapNode(c,e,f))},g.createWrapNode=function(a,b,c){var e=d[0].createElement(a);return angular.element(e).addClass(b),angular.element(e).attr("text-fragment-bit",""),angular.element(e).attr("fragments",c.join(",")),angular.element(e).addClass(c.join(" ")),e},g.mergeTextNodes=function(a){if(a&&"undefined"!=typeof a.childNodes&&a.childNodes.length>0)for(var b,c,d=a.childNodes.length-1;b=a.childNodes[d--];)g.isTextNode(b)&&(c=a.childNodes[d])&&g.isTextNode(c)?(c.nodeValue=c.nodeValue+b.nodeValue,a.removeChild(b)):g.isElementNode(b)&&g.mergeTextNodes(b)},g.isTextNode=function(a){return a.nodeType===Node.TEXT_NODE},g.isElementNode=function(a){return a.nodeType===Node.ELEMENT_NODE},g.isWrapNode=function(a){if(!g.isElementNode(a))return!1;if(a.nodeName.toUpperCase()!==g.options.wrapNodeName.toUpperCase())return!1;var b=angular.element(a);return b.hasClass(g.options.wrapNodeClass)?!0:!1},g.isConsolidationNode=function(a){if(!g.isElementNode(a))return!1;var b=[g.options.textFragmentIconClass,g.options.wrapNodeClass,g.options.imgWrapNodeClass];b=b.concat(g.options.consolidationClasses);for(var c=b.length;c--;)if(angular.element(a).hasClass(b[c]))return!0;return!1},g.isWrappedTextNode=function(a){return g.isWrapNode(a)&&g.isTextNode(a.firstChild)?!0:!1},g.isWrappedElementNode=function(a){return g.isWrapNode(a)&&g.isElementNode(a.firstChild)?!0:!1},g.isNamedContentNode=function(a){if(!g.isElementNode(a))return!1;for(var b=g.options.namedContentClasses,c=b.length;c--;)if(angular.element(a).hasClass(b[c]))return!0;return!1},g.isUIButton=function(a){return g.isElementNode(a)&&angular.element(a).hasClass(g.options.textFragmentIconClass)?!0:!1},g.getSafePageContext=function(){var a,b,c,d=f.location.href;if(-1!==d.indexOf("#")&&(a=d.substring(d.indexOf("#")+1,d.length),d=d.substring(0,d.indexOf("#"))),-1!==d.indexOf("?")){b=d.substring(d.indexOf("?")+1,d.length),d=d.substring(0,d.indexOf("?")),c=e.search(),delete c["pundit-show"];var g=[];for(var h in c)g.push(h+"="+c[h]);b=g.join("&")}return b&&(d+="?"+b),a&&(d+="#"+a),decodeURIComponent(d)},g.log("Component up and running"),g}]),angular.module("Pundit2.Annotators").constant("TEXTFRAGMENTANNOTATORDEFAULTS",{cMenuType:"annotatedTextFragment",annotationIconClass:"pnd-icon-tag",myItemsIconClass:"pnd-icon-bookmark",suggestionIconClass:"pnd-icon-pencil"}).service("TextFragmentAnnotator",["TEXTFRAGMENTANNOTATORDEFAULTS","NameSpace","BaseComponent","Consolidation","XpointersHelper","ItemsExchange","Config","TripleComposer","Toolbar","$compile","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k){var l=new c("TextFragmentAnnotator",a);l.label="text",l.type=b.fragments[l.label],d.addAnnotator(l),l.isConsolidable=function(a){return angular.isArray(a.type)?0===a.type.length?(l.log("Item not valid: types len 0"),!1):-1===a.type.indexOf(l.type)?(l.log("Item not valid: not a "+l.type),!1):e.isValidXpointerURI(a.uri)?e.isValidXpointer(a.uri)?(l.log("Item valid: try to consolidate "+a.label),!0):(l.log("Item not valid: not consolidable on this page: "+a.uri),!1):(l.log("Item not valid: not a valid xpointer uri: "+a.uri),!1):(l.log("Item not valid: malformed"),!1)};var m={},n={};l.consolidate=function(a){l.log("Consolidating!");var b=[],c=0;m={},n={};for(var d in a)b.push(d),m[d]=["fr-"+c],n["fr-"+c]={uri:d,bits:[],item:a[d]},c++;var f=e.getXPathsFromXPointers(b),g=e.splitAndSortXPaths(f),h=e.getClassesForXpaths(b,g,f,m);e.updateDOM(g,e.options.wrapNodeClass,h),p(),l.log(l.label+" consolidation: done!")};var o=function(){var a=0;for(var b in m){var c=m[b],d=angular.element("."+c).last(),e="text-fragment-icon";n[c].item.isAnnomatic&&(e="suggestion-fragment-icon"),l.log("Placing fragment icon "+a++,c,d.attr("fragments")),d.after("<"+e+' fragment="'+c+'"></'+e+">")}},p=function(){o();var a=angular.element(".pnd-cons");j(a)(k);var b=angular.element("text-fragment-icon, suggestion-fragment-icon");j(b)(k),k.$$phase||k.$digest()};return l.wipe=function(){m={},n={},angular.element("."+e.options.textFragmentIconClass).remove();var a=angular.element("."+e.options.wrapNodeClass);angular.forEach(a,function(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);angular.element(a).remove()}),e.mergeTextNodes(angular.element("body")[0])},l.addFragmentIcon=function(a){n[a.fragment].icon=a,a.item=n[a.fragment].item,l.log("Adding fragment icon for fragment id="+a.fragment)},l.addFragmentBit=function(a){var b=a.fragments;b=b.match(/,/)?b.split(","):[b];for(var c=b.length;c--;){var d=n[b[c]];d.bits.push(a)}l.log("Adding consolidated fragment bit",b)},l.getFragmentIdByUri=function(a){return"undefined"!=typeof m[a]?m[a]:void 0},l.getFragmentIconScopeById=function(a){return"undefined"!=typeof n[a]?n[a].icon:void 0},l.getBitsById=function(a){return"undefined"!=typeof n[a]?n[a].bits:void 0},l.highlightByUri=function(a){return"undefined"==typeof m[a]?void l.log("Not highlighting given URI: fragment id not found"):void l.highlightById(m[a][0])},l.highlightById=function(a){for(var b=n[a].bits.length;b--;)n[a].bits[b].high();l.log("Highlighting fragment id="+a+", # bits: "+n[a].bits.length)},l.clearHighlightByUri=function(a){return"undefined"==typeof m[a]?void l.log("Not clearing highlight on given URI: fragment id not found"):void l.clearHighlightById(m[a])},l.clearHighlightById=function(a){for(var b=n[a].bits.length;b--;)n[a].bits[b].clear();l.log("Clear highlight on fragment id="+a+", # bits: "+n[a].bits.length)},l.showByUri=function(a){if("undefined"==typeof m[a])return void l.log("Not showing fragment for given URI: fragment id not found");for(var b=m[a],c=n[b].bits.length;c--;)n[b].bits[c].show()},l.hideByUri=function(a){if("undefined"==typeof m[a])return void l.log("Not hiding fragment for given URI: fragment id not found");for(var b=m[a],c=n[b].bits.length;c--;)n[b].bits[c].hide()},l.hideAll=function(){for(var a in m)l.hideByUri(a)},l.showAll=function(){for(var a in m)l.showByUri(a)},l.ghostByUri=function(a){if("undefined"==typeof m[a])return void l.log("Fragment id not found");for(var b=m[a],c=n[b].bits.length;c--;)n[b].bits[c].ghost()},l.ghostRemoveByUri=function(a){if("undefined"==typeof m[a])return void l.log("Fragment id not found");for(var b=m[a],c=n[b].bits.length;c--;)n[b].bits[c].expo()},l.ghostAll=function(){for(var a in m)l.ghostByUri(a)},l.ghostRemoveAll=function(){for(var a in m)l.ghostRemoveByUri(a)},l.log("Component up and running"),l}]),angular.module("Pundit2.Annotators").service("ImageAnnotator",["NameSpace","BaseComponent","$location","$compile","$rootScope","$timeout","Consolidation","XpointersHelper","ImageFragmentAnnotatorHelper",function(a,b,c,d,e,f,g,h,i){var j=new b("ImageAnnotator");j.label="image",j.type=a.types[j.label],j.labelIF="imagePart",j.typeIF=a.fragments[j.labelIF];var k="pnd-cons-img";g.addAnnotator(j);var l=null,m=!1,n=null,o=null;angular.element("img").hover(function(a){j.clearTimeout(),null!==n&&a.target.src!==n[0].src&&p(),m||(n=angular.element(a.target).addClass("pnd-pointed-img").after('<img-menu ref="pnd-pointed-img"></img-menu>'),o=d(angular.element("img-menu"))(e),m=!0)},function(){j.removeDirective()}),j.clearTimeout=function(){null!==l&&(f.cancel(l),l=null)},j.removeDirective=function(){l=f(function(){p()},100)};var p=function(){n.removeClass("pnd-pointed-img"),o.remove(),m=!1,n=null};return j.isConsolidable=function(a){var b;return angular.isArray(a.type)?0===a.type.length?(j.log("Item not valid: types len 0"+a.uri),!1):-1===a.type.indexOf(j.type)&&-1===a.type.indexOf(j.typeIF)?(j.log("Item not valid: not have type image "+a.uri),!1):(-1!==a.type.indexOf(j.type)?b=a.uri:-1!==a.type.indexOf(j.typeIF)&&(b=a.parentItemXP),h.isValidXpointerURI(b)?h.isValidXpointer(b)?(j.log("Item valid: "+a.label),!0):(j.log("Item not valid: not consolidable on this page: "+b),!1):(j.log("Item not valid: not a valid xpointer uri: "+b),!1)):(j.log("Item not valid: malformed type"+a.uri),!1)},j.consolidate=function(a){j.log("Consolidating!");var b,c,d=[],e={};for(b in a)-1!==a[b].type.indexOf(j.type)?c=a[b].uri:-1!==a[b].type.indexOf(j.typeIF)&&(c=a[b].parentItemXP),d.push(c),"undefined"!=typeof a[b].polygon&&("undefined"!=typeof e[a[b].parentItemXP]?e[a[b].parentItemXP].push(a[b].polygon):e[a[b].parentItemXP]=[a[b].polygon]);var f=h.getXPathsFromXPointers(d);for(b in f){var g=angular.element(f[b].startNode.firstElementChild);g.addClass(k)}},j.wipe=function(){var a=angular.element("."+k);a.removeClass(k)},j.svgHighlightByItem=function(a){var b,c,d=[];-1!==a.type.indexOf(j.typeIF)&&"undefined"!=typeof a.polygon&&(b=a.parentItemXP,d=h.getXPathsFromXPointers([b]),b in d&&(c=angular.element(d[b].startNode.firstElementChild),i.drawPolygonOverImage(a.polygon,c)))},j.svgClearHighlightByItem=function(){angular.element("."+k).siblings("span.pnd-cons-svg").remove()},j.highlightById=function(){},j.clearHighlightById=function(){},j.highlightByUri=function(){},j.clearHighlightByUri=function(){},j.log("Component up and running"),j}]),angular.module("Pundit2.Annotators").directive("textFragmentBit",["TextFragmentAnnotator",function(a){return{restrict:"A",scope:{fragments:"@"},link:function(b,c){a.addFragmentBit(b),b.isHigh=!1,b.high=function(){c.addClass("pnd-textfragment-highlight")},b.clear=function(){c.removeClass("pnd-textfragment-highlight")},b.hide=function(){c.addClass("pnd-textfragment-hidden")},b.show=function(){c.removeClass("pnd-textfragment-hidden")
},b.ghost=function(){c.addClass("pnd-textfragment-ghosted")},b.expo=function(){c.removeClass("pnd-textfragment-ghosted")}}}}]),angular.module("Pundit2.Annotators").directive("textFragmentIcon",["TextFragmentAnnotator","ContextualMenu","XpointersHelper","Config","ItemsExchange","ItemPopover",function(a,b,c,d,e,f){return{restrict:"E",scope:{fragment:"@"},templateUrl:"src/Annotators/TextFragmentIcon.dir.tmpl.html",replace:!0,link:function(g,h){g.textFragmentIconClass=c.options.textFragmentIconClass,g.element=h,a.addFragmentIcon(g);var i=d.modules.PageItemsContainer.container,j=d.modules.MyItems.container;g.iconClass=e.isItemInContainer(g.item,j)&&!e.isItemInContainer(g.item,i)?a.options.myItemsIconClass:a.options.annotationIconClass,g.mouseoverHandler=function(){a.highlightById(g.fragment)},g.mouseoutHandler=function(){a.clearHighlightById(g.fragment)},g.clickHandler=function(c){d.modules.Client.active?b.show(c.pageX,c.pageY,g.item,a.options.cMenuType):d.modules.SimplifiedClient.active&&f.show(g.element,g.item)}}}}]),angular.module("Pundit2.Core").service("ItemsExchange",["BaseComponent",function(a){var b=new a("ItemsExchange"),c={},d={},e=[],f={};return b.wipe=function(){c={},d={},e=[],f={},b.log("Wiped every loaded item and every container.")},b.isItemInContainer=function(a,b){var c=d[a.uri];return"undefined"==typeof c?!1:-1===c.indexOf(b)?!1:!0},b.wipeContainer=function(a){return"undefined"==typeof c[a]?void b.log("Cannot wipe undefined container "+a):(c[a].forEach(function(b){if(d[b.uri].splice(d[b.uri].indexOf(a),1),0===d[b.uri].length){delete d[b.uri],delete f[b.uri];var c=e.indexOf(b);-1!==c&&e.splice(c,1)}}),delete c[a],void b.log("Wiped "+a+" container."))},b.getItems=function(){return e},b.getItemsHash=function(){return f},b.getItemByUri=function(a){return a in f?f[a]:void 0},b.getAll=function(){return{itemListByURI:f,itemListByContainer:c,itemContainers:d}},b.getItemsBy=function(a){if("function"==typeof a){var b=[];for(var c in f){var d=f[c];a(d)&&b.push(d)}return b}},b.getItemsFromContainerByFilter=function(a,b){if("function"==typeof b&&"undefined"!=typeof c[a]){var d=[],e=c[a];for(var f in e){var g=e[f];b(g)&&d.push(g)}return d}},b.getItemsByContainer=function(a){return"undefined"!=typeof c[a]?c[a]:[]},b.addItemToContainer=function(a,e){angular.isArray(e)||(e=[e]);for(var f=e.length;f--;){var g=e[f];if(a.uri in d&&-1!==d[a.uri].indexOf(g))return void b.log("Item "+a.label+" already belongs to container "+g);g in c?c[g].push(a):c[g]=[a],a.uri in d?d[a.uri].push(g):d[a.uri]=[g]}},b.removeItemFromContainer=function(a,g){var h=c[g];if("undefined"==typeof h)return void b.err("Cannot remove item "+a.label+" from container "+g+": container not found.");var i=h.indexOf(a);if(-1===i)return void b.err("Cannot remove item "+a.label+" from container "+g+": item not in container.");h.splice(i,1);var j=d[a.uri].indexOf(g);if(d[a.uri].splice(j,1),0===d[a.uri].length){delete d[a.uri],delete f[a.uri];var k=e.indexOf(a);-1!==k&&e.splice(k,1)}b.log("Item "+a.label+" removed from container "+g)},b.addItems=function(a){for(var c=a.length;c--;)b.addItem(a[c])},b.addItem=function(a,c){return"undefined"==typeof c&&(c="default"),"undefined"!=typeof a.uri&&angular.isArray(a.type)?a.uri in f?void b.log("Item already present: "+a.uri):(a.isProperty()&&(c="property"),f[a.uri]=a,e.push(a),b.addItemToContainer(a,c),void b.log("Added item: "+a.uri)):void b.err("Ouch, cannot add this item ... ",a)},b.log("Component up and running"),b}]),angular.module("Pundit2.Annotators").constant("TEXTFRAGMENTHANDLERDEFAULTS",{ignoreClasses:["pnd-ignore"],removeSelectionOnAbort:!0,container:"createdTextFragments",cMenuType:"textFragmentHandlerItem",labelMaxLength:40}).service("TextFragmentHandler",["$rootScope","TEXTFRAGMENTHANDLERDEFAULTS","NameSpace","BaseComponent","ContextualMenu","XpointersHelper","Item","ItemsExchange","Toolbar","TripleComposer","$document",function(a,b,c,d,e,f,g,h,i,j,k){var l=new d("TextFragmentHandler",b);k.on("mousedown",function(a){var b=a.target;return l.isToBeIgnored(b)?(l.log("ABORT: ignoring mouse DOWN event on document: ignore class spotted."),void(l.options.removeSelectionOnAbort&&k.on("mouseup",m))):(k.on("mouseup",n),void l.log("Selection started on document, waiting for mouse up."))});var m=function(){k.off("mouseup",m),null!==l.getSelectedRange()&&o()},n=function(b){k.off("mouseup",n);var c=b.target;if(l.isToBeIgnored(c))return l.log("ABORT: ignoring mouse UP event on document: ignore class spotted."),void o();var d=l.getSelectedRange();if(null!==d){for(var f=d.cloneContents().querySelectorAll("*"),g=f.length;g--;)if(l.isToBeIgnored(f[g]))return l.log("ABORT: ignoring range: ignore class spotted inside it, somewhere."),void o();var m=l.createItemFromRange(d);return h.addItemToContainer(m,l.options.container),l.log("Valid selection ended on document. Text fragment Item produced: "+m.label),i.isActiveTemplateMode()?(l.log("Item used as subject inside triple composer (template mode active)."),j.addToAllSubject(m),j.closeAfterOp(),void a.$emit("pnd-save-annotation")):void e.show(b.pageX,b.pageY,m,l.options.cMenuType)}};l.createItemFromRange=function(a){var b={};return b.uri=l.range2xpointer(a),b.type=[c.fragments.text],b.description=a.toString(),b.label=b.description,b.label.length>l.options.labelMaxLength&&(b.label=b.label.substr(0,l.options.labelMaxLength)+" .."),b.pageContext=f.getSafePageContext(),b.isPartOf=b.uri.split("#")[0],new g(b.uri,b)},l.getSelectedRange=function(){var a,b=k[0];return 0===b.getSelection().rangeCount?(l.log("getSelection().rangeCount is 0: no selected range."),null):(a=b.getSelection().getRangeAt(0),null!==a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset?(l.log("Range is not null, but start/end containers and offsets match: no selected range."),null):(l.log("GetSelectedRange returning a DIRTY range: "+a.startContainer.nodeName+"["+a.startOffset+"] > "+a.endContainer.nodeName+"["+a.endOffset+"]"),a))};var o=function(){l.options.removeSelectionOnAbort&&k[0].getSelection().removeAllRanges()};l.isToBeIgnored=function(a){for(var b=l.options.ignoreClasses,c=b.length;"body"!==a.nodeName.toLowerCase();){for(var d=c;d--;)if(angular.element(a).hasClass(b[d]))return!0;if(null===a.parentNode)return!1;a=a.parentNode}return!1},l.range2xpointer=function(a){var b=q(a),c=w(x(b.startContainer),b.cleanStartNumber),d=w(x(b.endContainer),b.cleanEndNumber),e=y(c),f=p(e,c,b.startOffset,d,b.endOffset);return l.log("range2xpointer returning an xpointer: "+f),f};var p=function(a,b,c,d,e){return a+"#xpointer(start-point(string-range("+b+",'',"+c+"))/range-to(string-range("+d+",'',"+e+")))"},q=function(a){var b={};l.log("dirty2cleanRange DIRTY: "+a.startContainer.nodeName+"["+a.startOffset+"] > "+a.endContainer.nodeName+"["+a.endOffset+"]");var c=r(a.startContainer,a.startOffset),d=r(a.endContainer,a.endOffset);return b.startContainer=c.cleanContainer,b.startOffset=c.cleanOffset,b.endContainer=d.cleanContainer,b.endOffset=d.cleanOffset,b.cleanStartNumber=u(b.startContainer),b.cleanEndNumber=u(b.endContainer),l.log("dirty2cleanRange CLEAN: "+b.startContainer.nodeName+"["+b.startOffset+"] > "+b.endContainer.nodeName+"["+b.endOffset+"]"),b},r=function(a,b){var c,d,e,g=f,h=a.parentNode;if(g.isElementNode(a)&&!g.isConsolidationNode(a))return{cleanContainer:a,cleanOffset:b};for(d=g.isTextNode(a)&&g.isWrapNode(h)?h:a,e=b;c=d.previousSibling;){if(!g.isConsolidationNode(c)&&g.isElementNode(c)&&!g.isWrapNode(c))return g.isTextNode(a)&&g.isWrapNode(h)?{cleanContainer:a,cleanOffset:e}:{cleanContainer:d,cleanOffset:e};g.isTextNode(c)?e+=c.length:g.isWrapNode(c)&&(e+=c.firstChild.length),d=c}return f.isTextNode(a)&&f.isWrapNode(h)?{cleanContainer:a,cleanOffset:e}:{cleanContainer:d,cleanOffset:e}},s=function(a){return f.isTextNode(a)||f.isWrappedTextNode(a)||f.isUIButton(a)},t=function(a){return f.isElementNode(a)&&!f.isUIButton(a)&&!f.isWrappedTextNode(a)},u=function(a){var b,c=1,d=f,e=v(a),g=a.parentNode,h=d.isWrapNode(g)?g:a;if(d.isTextNode(a))for(;b=h.previousSibling;)s(b)&&(t(h)||d.isWrappedElementNode(h))&&c++,h=b;else for(;b=h.previousSibling;)v(b)!==e||d.isConsolidationNode(b)||c++,h=b;return c},v=function(a){return f.isTextNode(a)?"text()":a.nodeName.toUpperCase()},w=function(a,b){return a.replace(/\[[0-9]+\]$/,"["+b+"]")},x=function(a,b){var c=a.parentNode;if(!a)return b;var d=f,e=v(a);if(d.isNamedContentNode(a))return"undefined"!=typeof b?"//DIV[@about='"+angular.element(a).attr("about")+"']/"+b:"//DIV[@about='"+angular.element(a).attr("about")+"']";if("BODY"===e||"HTML"===e)return"undefined"!=typeof b?"//BODY/"+b:"//BODY";if(d.isWrapNode(a))return x(a.parentNode,b);var g,h=1,i=a;if(!d.isTextNode(i))for(;g=i.previousSibling;)v(g)!==e||d.isConsolidationNode(g)||h++,i=g;return b="undefined"!=typeof b?e+"["+h+"]/"+b:e+"["+h+"]",x(c,b)},y=function(a){var b=f.getSafePageContext(),c=a.indexOf("DIV[@about='"),d="about";if(-1===c)return-1!==b.indexOf("#")?b.split("#")[0]:b;if(3>c){var e=c+7+d.length,g=a.indexOf("_text']"),h=a.indexOf(-1!==g?"_text']":"']")-e;return a.substr(e,h)}return l.log("ERROR: getContentURLFromXPath returning something weird? xpath = "+a),""};return l.log("Component up and running"),l}]),angular.module("Pundit2.Annotators").constant("IMAGEHANDLERDEFAULTS",{ignoreClasses:["pnd-ignore"],container:"createdImage",cMenuType:"imageHandlerItem",labelMaxLength:40}).service("ImageHandler",["IMAGEHANDLERDEFAULTS","NameSpace","BaseComponent","Config","TextFragmentHandler","XpointersHelper","Item",function(a,b,c,d,e,f,g){var h=new c("ImageHandler",a),i=function(a){var b=document.createRange();return b.selectNode(a),e.range2xpointer(b)};return h.createItemFromImage=function(a){var c={};return c.uri=i(a),c.type=[b.types.image],c.description=a.src,c.image=a.src,c.label=c.description,c.label.length>h.options.labelMaxLength&&(c.label=c.label.substr(0,h.options.labelMaxLength)+" .."),c.pageContext=f.getSafePageContext(),c.isPartOf=c.uri.split("#")[0],new g(c.uri,c)},h}]),angular.module("Pundit2.Annotators").directive("imgMenu",["$rootScope","NameSpace","ContextualMenu","Toolbar","ImageHandler","ImageAnnotator","ItemsExchange","TemplatesExchange","TripleComposer",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",scope:{ref:"@"},templateUrl:"src/Annotators/ImgMenu.dir.tmpl.html",link:function(j,k){j.image=angular.element("."+j.ref),j.element=k,j.visible=!1,j.item=null,j.$watch(function(){return d.isActiveTemplateMode()},function(a){j.icon=a?"pnd-icon-plus-circle":"pnd-icon-gear"});var l=function(){var a=j.image.position();j.visible=!0,j.element.css({position:"absolute",color:"#fff",background:"rgba(0, 0, 0, 0.2)",fontSize:"1.7em",height:"30px",width:"30px",left:a.left,top:a.top}),j.element.hover(function(){$(this).css({color:"#333333"})},function(){$(this).css({color:"#fff"})})};l(),j.clickHandler=function(k){if(k.preventDefault(),k.stopPropagation(),f.clearTimeout(),null===j.item&&(j.item=e.createItemFromImage(j.image[0]),g.addItemToContainer(j.item,e.options.container)),d.isActiveTemplateMode()){var l=h.getCurrent().triples;for(var m in l)if(-1===l[m].predicate.domain.indexOf(b.types.image))return;return i.addToAllSubject(g.getItemByUri(j.item.uri)),i.closeAfterOp(),void a.$emit("pnd-save-annotation")}var n=g.getItemByUri(j.item.uri);c.show(k.pageX,k.pageY,n,e.options.cMenuType)},j.onMouseOver=function(){f.clearTimeout()},j.onMouseLeave=function(){f.removeDirective()}}}}]),angular.module("Pundit2.Communication",[]),angular.module("Pundit2.Communication").constant("NOTEBOOKDEFAULTS",{iconDefault:"pnd-icon pnd-icon-book",classDefault:"pnd-item-default"}).factory("Notebook",["BaseComponent","NameSpace","MyPundit","Analytics","NotebookExchange","NOTEBOOKDEFAULTS","$http","$q",function(a,b,c,d,e,f,g,h){function i(a,b){this._q=h.defer(),"undefined"!=typeof a?(this.id=a,this.load()):this.create(),e.addNotebook(this,b)}function j(a,b){var c=new i(a,b);return c._q.promise}var k=new a("Notebook",f);i.prototype.addAnnotation=function(a){"undefined"==typeof this.includes&&(this.includes=[]),this.includes.push(a)},i.prototype.removeAnnotation=function(a){if("undefined"==typeof this.includes)return!1;var b=this.includes.indexOf(a);return b>-1?(this.includes.splice(b,1),!0):void 0},i.prototype.getIcon=function(){return k.options.iconDefault},i.prototype.getClass=function(){return k.options.classDefault},i.prototype.setPrivate=function(){this.visibility="private"},i.prototype.isPublic=function(){return"public"===this.visibility},i.prototype.setPublic=function(){this.visibility="public"},i.prototype.setLabel=function(a){this.label=a},i.prototype.isCurrent=function(){var a=e.getCurrentNotebooks();return"undefined"==typeof a?!1:this.id===a.id},i.prototype.create=function(){k.log("Creating a new Notebook on the server"),this._q.resolve("New notebook created: TODO, after LOGIN")},i.prototype.save=function(){},i.prototype.load=function(a){var e=this;"undefined"==typeof a&&(a=!0),k.log("Loading notebook "+e.id+" metadata with cache "+a);var f,h=c.isUserLogged()?"asNBMeta":"asOpenNBMeta";f=g({headers:{Accept:"application/json"},method:"GET",cache:a,url:b.get(h,{id:e.id}),withCredentials:!0}).success(function(a){l(e,a),e._q.resolve(e),d.track("api","get","notebook meta"),k.log("Retrieved notebook "+e.id+" metadata")}).error(function(a,b){e._q.reject("Error from server while retrieving notebook "+e.id+": "+b),d.track("api","error","get notebook meta",b),k.err("Error getting notebook "+e.id+" metadata. Server answered with status code "+b)})};var l=function(a,c){for(var d in c)a.uri=d;var e=b.notebook,f=c[a.uri];if("undefined"==typeof f)return k.err("Malformed notebook uri="+a.uri+", wrong metadata: ",c),!1;for(var g in e){var h=e[g];a[g]=h in f?"type"===g?[f[h][0].value]:f[h][0].value:""}var i=f[e.includes];a.includes=[];for(var j in i){var l=i[j].value.match(/[a-z0-9]*$/);null!==l&&a.includes.push(l[0])}};return k.log("Component up and running"),j}]),angular.module("Pundit2.Communication").service("NotebookExchange",["BaseComponent",function(a){var b=new a("NotebookExchange"),c=[],d={},e=[],f={},g=null;return b.wipe=function(){b.log("Wiping every loaded notebooks."),c=[],d={},e=[],f={}},b.addNotebook=function(a,g){a.id in d?b.log("Not adding notebook "+a.id+": already present."):a._q.promise.then(function(b){d[a.id]=b,c.push(b)}),"undefined"!=typeof g&&g&&(a.id in f?b.log("Not adding notebook "+a.id+" to my notebook, already present."):a._q.promise.then(function(b){f[a.id]=b,e.push(b)}))},b.removeNotebook=function(a){for(var g=-1,h=0;h<c.length;h++)if(c[h].id===a){g=h;break}if(-1===g)return void b.err("Cannot remove notebook "+a+" from notebook list: notebook is not in notebook list.");c.splice(g,1),delete d[a],g=-1;for(var i=0;i<e.length;i++)if(e[i].id===a){g=i;break}return-1===g?void b.err("Cannot remove notebook "+a+" from my notebook list: notebook is not in my notebook list."):(e.splice(g,1),void delete f[a])},b.getNotebookById=function(a){return a in d?d[a]:void 0},b.getNotebooks=function(){return c},b.getMyNotebooks=function(){return e},b.getCurrentNotebooks=function(){return null!==g?d[g]:void 0},b.setCurrentNotebooks=function(a){b.log("set new current as: ",a),g=a},b.log("Component up and running"),b}]),angular.module("Pundit2.Communication").service("NotebookCommunication",["BaseComponent","NameSpace","Notebook","MyPundit","Analytics","Config","$http","$q","NotebookExchange","Toolbar",function(a,b,c,d,e,f,g,h,i,j){var k=new a("NotebookCommunication");return k.getMyNotebooks=function(){var a=h.defer();return k.log("Getting my notebooks from the server"),d.isUserLogged()?(j.setLoading(!0),g({headers:{Accept:"application/json"},method:"GET",url:b.get("asNBOwned"),withCredentials:!0}).success(function(b){if(j.setLoading(!1),e.track("api","get","notebook owned"),"undefined"==typeof b||""===b)return a.reject("some sort of error?"),void k.log("Error retrieving list of my notebooks - Server undefined response");if("NotebookIDs"in b){for(var d=[],f=b.NotebookIDs.length;f--;)d[f]=new c(b.NotebookIDs[f],!0);h.all(d).then(function(b){a.resolve(b),k.log("Retrieved all of my notebooks")},function(){a.reject("some other error?")})}else a.reject("some sort of error?"),k.log("Error retrieving list of my notebooks -- TODO")}).error(function(b,c){j.setLoading(!1),a.reject("Error from server while retrieving list of my notebooks: "+c),k.err("Error from server while retrieving list of my notebooks: "+c),e.track("api","error","get notebook owned",c)})):(k.log("Impossible to get my notebooks: you have to be logged in"),a.reject("User not logged in")),a.promise},k.getCurrent=function(){var a=h.defer();return k.log("Getting current notebook"),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"GET",url:b.get("asNBCurrent"),withCredentials:!0}).success(function(b){j.setLoading(!1),k.log(b.NotebookID+" is the current notebook"),i.setCurrentNotebooks(b.NotebookID),a.resolve(b.NotebookID)}).error(function(b){j.setLoading(!1),k.log("Impossible to get the current notebook "),a.reject(b)})):(k.log("Impossible to get current: you have to be logged in"),a.reject("User not logged in")),a.promise},k.setCurrent=function(a){var c=h.defer();return k.log("Setting as current "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBCurrent")+"/"+a,withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is now current"),i.setCurrentNotebooks(a),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to set as current: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setPublic=function(a){var c=h.defer();return k.log("Setting as public "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBPublic",{id:a}),withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is now public"),i.getNotebookById(a).setPublic(),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to set as public: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setPrivate=function(a){var c=h.defer();return k.log("Setting as private "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBPrivate",{id:a}),withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is now private"),i.getNotebookById(a).setPrivate(),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to set as private: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.createNotebook=function(a){var f=h.defer();return k.log("Creating a new notebook"),d.login().then(function(d){return d===!1?void f.reject("Ouch!"):(j.setLoading(!0),void g({headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:b.get("asNB"),withCredentials:!0,data:{NotebookName:a}}).success(function(a){j.setLoading(!1),"NotebookID"in a?new c(a.NotebookID,!0).then(function(){f.resolve(a.NotebookID),k.log("Created a new notebook: "+a.NotebookID),e.track("api","post","notebook create")}):(f.reject("some sort of error?"),k.log("Error creating a notebook -- TODO"))}).error(function(a,b){j.setLoading(!1),f.reject("Error from server while retrieving list of my notebooks: "+b),k.err("Error from server while retrieving list of my notebooks: "+b),e.track("api","error","get notebook owned",b)}))}),f.promise},k.deleteNotebook=function(a){var c=h.defer();return k.log("Deleting "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"DELETE",url:b.get("asNB")+"/"+a,withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is removed"),i.removeNotebook(a),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to remove "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setName=function(a,c){var e=h.defer();return k.log("Edit name of notebook "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBEditMeta",{id:a}),withCredentials:!0,data:{NotebookName:c}}).success(function(){j.setLoading(!1),k.log(a+" is now edited"),i.getNotebookById(a).setLabel(c),e.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to edit name of notebook: "+a),e.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),e.reject("User not logged in")),e.promise},k}]),angular.module("Pundit2.Communication").factory("Annotation",["BaseComponent","NameSpace","Utils","Item","TypesHelper","Analytics","AnnotationsExchange","Consolidation","MyPundit","ItemsExchange","PageItemsContainer","$http","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){this._q=m.defer(),"undefined"!=typeof a?(this.id=a,this.load(b)):this.create(),g.addAnnotation(this)}function o(a,b){var c=new n(a,b);return c._q.promise}var p=new a("Annotation");n.prototype.create=function(){p.log("Creating a new Annotation on the server"),this._q.resolve("New annotation created: TODO, after LOGIN")},n.prototype.update=function(){var a=this,c=m.defer();return l({headers:{Accept:"application/json"},method:"GET",url:b.get("asAnn",{id:a.id}),withCredentials:!0}).success(function(b){q(a,b),c.resolve(),p.log("Retrieved annotation "+a.id+" metadata")}).error(function(b,d){c.reject(),p.err("Error getting annotation "+a.id+". Server answered with status code "+d)}),c.promise},n.prototype.load=function(a){var c=this,d=i.isUserLogged()?"asAnn":"asOpenAnn";"undefined"==typeof a&&(a=!0),p.log("Loading annotation "+c.id+" with cache "+a);var e;e=l({headers:{Accept:"application/json"},method:"GET",cache:a,url:b.get(d,{id:c.id}),withCredentials:!0}).success(function(a){q(c,a);c._q.resolve(c),p.log("Retrieved annotation "+c.id+" metadata"),f.track("api","get","annotation")}).error(function(a,b){c._q.reject("Error from server while retrieving annotation "+c.id+": "+b),p.err("Error getting annotation "+c.id+". Server answered with status code "+b),f.track("api","error","get annotation",b)})},n.prototype.isBroken=function(){var a,b=this.items;for(var c in b)if(a=j.getItemByUri(b[c].uri),(a.isTextFragment()||a.isImage()||a.isImageFragment())&&h.isConsolidated(a))return!1;return!0};var q=function(a,f){if("undefined"==typeof f||"undefined"==typeof f.graph||"undefined"==typeof f.metadata||"undefined"==typeof f.items)return p.err("Malformed annotation id="+a.id+": ",f),!1;a.items={},a.graph=angular.copy(f.graph);for(var g in f.metadata)a.uri=g;if("undefined"==typeof a.uri)return p.err("Malformed annotation id="+a.id+", wrong metadata: ",f),!1;var h=b.annotation,i=f.metadata[a.uri];for(var l in h){var m=h[l];a[l]=m in i?i[m][0].value:""}if(h.isIncludedIn in i){a.isIncludedInUri=i[h.isIncludedIn][0].value;var n=a.isIncludedInUri.match(/[a-z0-9]*$/);null!==n&&(a.isIncludedIn=n[0])}if(h.target in i){a.target=[];for(var o=0;o<i[h.target].length;o++)a.target.push(i[h.target][o].value)}a.entities=[],a.predicates=[];for(var q in f.graph){-1===a.entities.indexOf(q)&&(a.entities.push(q),a.items[q]={});for(var r in f.graph[q]){-1===a.entities.indexOf(r)&&(a.items[r]={type:[b.rdf.property],label:c.getLabelFromURI(r)},-1===a.predicates.indexOf(r)&&a.predicates.push(r));for(var s in f.graph[q][r]){var t=f.graph[q][r][s];"uri"===t.type&&-1===a.entities.indexOf(t.value)&&(a.entities.push(t.value),a.items[t.value]={})}}}for(var u in a.items){var v=j.getItemByUri(u);"undefined"==typeof v&&(v=angular.equals(a.items[u],{})?new d(u):new d(u,a.items[u]),v.fromAnnotationRdf(f.items)),v.isProperty()||j.addItemToContainer(v,k.options.container);for(var w in v.type)e.addFromAnnotationRdf(v.type[w],f.items);a.items[u]=v}};return p.log("Component up and running"),o}]),angular.module("Pundit2.Communication").service("AnnotationsExchange",["BaseComponent","NameSpace","MyPundit","Analytics","$http","$q",function(a,b,c,d,e,f){var g=new a("AnnotationsExchange"),h=[],i={};return g.wipe=function(){g.log("Wiping every loaded annotation."),h=[],i={}},g.searchByUri=function(a){angular.isArray(a)||(a=[a]),g.log("Searching for annotations with "+a.length+" URIs from the server");var h,i=f.defer(),j=c.isUserLogged()?"asAnnMetaSearch":"asOpenAnnMetaSearch";return h=e({headers:{Accept:"application/json"},method:"GET",url:b.get(j),cache:!1,params:{scope:"all",query:{resources:a}},withCredentials:!0}).success(function(a){if(d.track("api","get","search"),"undefined"==typeof a)return void i.reject("Any data found on the response");var b=[];for(var c in a){var e=c.match(/[a-z0-9]*$/);null!==e&&b.push(e[0])}i.resolve(b),g.log("Retrieved annotations IDs searching by URIs")}).error(function(a,b){var c="Error from server while searching for annotations by URIs: "+b;i.reject(c),g.err(c),d.track("api","error","get "+j,b)}),i.promise},g.addAnnotation=function(a){a.id in i?g.log("Not adding annotation "+a.id+": already present."):a._q.promise.then(function(b){"undefined"!=typeof b&&"undefined"!=typeof b.graph&&"undefined"!=typeof b.items&&(i[a.id]=b,h.push(b))})},g.removeAnnotation=function(a){if(a in i){var b=h.indexOf(i[a]);h.splice(b,1),delete i[a]}else g.log("Impossible to remove annotation "+a+": not exist.")},g.getAnnotations=function(){return h},g.getAnnotationById=function(a){return a in i?i[a]:void 0},g.getAnnotationsByItem=function(a){var b=[];for(var c in h)"undefined"!=typeof h[c].items[a]&&b.push(h[c]);return b},g.getAnnotationsHash=function(){return i},g.log("Component up and running"),g}]),angular.module("Pundit2.Communication").service("AnnotationsCommunication",["BaseComponent","NameSpace","Toolbar","Consolidation","MyPundit","AnnotationsExchange","Annotation","NotebookExchange","Notebook","ItemsExchange","Config","XpointersHelper","$http","$q","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=new a("AnnotationCommunication");return p.getAnnotations=function(){var a=n.defer();c.setLoading(!0);var b=d.getAvailableTargets(),e=f.searchByUri(b);return p.log("Getting annotations for available targets",b),e.then(function(b){if(p.log("Found "+b.length+" annotations on the current page."),0===b.length)return d.consolidateAll(),void c.setLoading(!1);for(var e=[],f=0,j=0;j<b.length;j++){var k=new g(b[j]);k.then(function(a){var b=a.isIncludedIn;"undefined"==typeof h.getNotebookById(b)&&new i(b)},function(a){p.log("Could not retrieve annotation: "+a)}).finally().then(function(){f++,p.log("Received annotation "+f+"/"+e.length),f===e.length&&(p.log("All promises settled, consolidating"),d.consolidateAll(),c.setLoading(!1),a.resolve(f))}),e.push(k)}},function(b){p.err("Could not search for annotations, error from the server: "+b),a.reject(b)}),a.promise},p.deleteAnnotation=function(a){var d=n.defer();return e.isUserLogged()?(c.setLoading(!0),m({method:"DELETE",url:b.get("asAnn",{id:a}),withCredentials:!0}).success(function(){c.setLoading(!1),p.log("Success annotation: "+a+" correctly deleted");var b=f.getAnnotationById(a).isIncludedIn,e=h.getNotebookById(b);"undefined"!=typeof e&&e.removeAnnotation(a),j.wipeContainer(k.modules.PageItemsContainer.container),f.wipe(),p.getAnnotations().then(function(){d.resolve(a)},function(){d.reject("Error during getAnnotations after a delete of: "+a)})}).error(function(){c.setLoading(!1),p.log("Error impossible to delete annotation: "+a+" please retry."),d.reject("Error impossible to delete annotation: "+a)})):(p.log("Error impossible to delete annotation: "+a+" you are not logged"),d.reject("Error impossible to delete annotation: "+a+" you are not logged")),d.promise},p.saveAnnotation=function(a,e,j,k){var q=n.defer();c.setLoading(!0);var r={graph:a,items:e};return"undefined"!=typeof k&&(r.metadata={template:k}),m({headers:{"Content-Type":"application/json"},method:"POST",url:b.get("asNBCurrent"),params:{context:angular.toJson({targets:j,pageContext:l.getSafePageContext()})},withCredentials:!0,data:r}).success(function(a){new g(a.AnnotationID).then(function(){var b=f.getAnnotationById(a.AnnotationID),e=h.getNotebookById(b.isIncludedIn);"undefined"==typeof e?new i(b.isIncludedIn,!0).then(function(b){h.getNotebookById(b).addAnnotation(a.AnnotationID)}):h.getNotebookById(b.isIncludedIn).addAnnotation(a.AnnotationID),d.consolidateAll(),o.$emit("update-annotation-completed",a.AnnotationID),c.setLoading(!1),q.resolve(b.id)},function(){p.log("Error: impossible to get annotation from server after save"),c.setLoading(!1),q.reject()})}).error(function(a){p.log("Error: impossible to save annotation",a),c.setLoading(!1),q.reject()}),q.promise},p.editAnnotation=function(a,e,g,h){var i=0,j=n.defer();return c.setLoading(!0),m({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asAnnContent",{id:a}),params:{context:angular.toJson({targets:h,pageContext:l.getSafePageContext()})},withCredentials:!0,data:{graph:e}}).success(function(){i>0&&f.getAnnotationById(a).update().then(function(){d.consolidateAll(),o.$emit("update-annotation-completed",a),j.resolve()}),c.setLoading(!1),i++,p.log("Graph correctly updated: "+a)}).error(function(){c.setLoading(!1),j.reject(),p.log("Error during graph editing of "+a)}),m({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asAnnItems",{id:a}),withCredentials:!0,data:g}).success(function(){i>0&&f.getAnnotationById(a).update().then(function(){d.consolidateAll(),o.$emit("update-annotation-completed",a),j.resolve()}),c.setLoading(!1),i++,p.log("Items correctly updated: "+a)}).error(function(){c.setLoading(!1),j.reject(),p.log("Error during items editing of "+a)}),j.promise},p}]),angular.module("Pundit2.Communication").service("TemplatesExchange",["BaseComponent",function(a){var b,c=new a("TemplatesExchange"),d=[],e={};return c.wipe=function(){c.log("Wiping every loaded template."),d=[],e={}},c.addTemplate=function(a){a.id in e?c.log("Not adding template "+a.id+": already present."):(e[a.id]=a,d.push(a))},c.removeTemplate=function(a){if(a in e){var b=d.indexOf(e[a]);d.splice(b,1),delete e[a]}else c.log("Impossible to remove template "+a+": not exist.")},c.getTemplates=function(){return d},c.getTemplateById=function(a){return a in e?e[a]:void 0},c.setCurrent=function(a){b=a},c.getCurrent=function(){return e[b]},c}]),angular.module("Pundit2.Annomatic",[]),angular.module("Pundit2.Annomatic").directive("annomaticPanel",function(){return{restrict:"AE",scope:{first:"=",second:"&funName"},templateUrl:"src/Annomatic/AnnomaticPanel.dir.tmpl.html",link:function(){}}}),angular.module("Pundit2.Annomatic").controller("AnnomaticPanelCtrl",["$scope","Annomatic","Consolidation","ItemsExchange","TextFragmentAnnotator","XpointersHelper","$window","$q",function(a,b,c,d,e,f,g,h){a.targets=c.getAvailableTargets(!0);var i=!1;a.getSuggestions=function(){if(!i){i=!0;for(var e=[],g=f.options.namedContentClasses,j=[],k=a.targets.length;k--;)j.push("[about='"+a.targets[k]+"']");j.join(","),angular.forEach(angular.element(j.join(",")),function(a){for(var b=g.length;b--;)if(angular.element(a).hasClass(g[b])){e.push(a);break}}),b.log("Asking for annotations on "+e.length+" nodes: ",e);for(var l=[],m=e.length;m--;)l.push(b.getDataTXTAnnotations(e[m]));h.all(l).then(function(){c.consolidate(d.getItemsByContainer(b.options.container))})}},a.startReview=function(){b.reviewNext(0)},a.Annomatic=b,a.$watch("filteredTypes",function(a,c){("undefined"!=typeof a||"undefined"!=typeof c)&&b.setTypeFilter(a)},!0);var j,k=angular.element("div.panel-body"),l=function(){var a;return 0===g.getSelection().rangeCount?null:(a=g.getSelection().getRangeAt(0),null!==a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset?null:a)};angular.element("body").on("mousedown",function(){angular.element("body").on("mousemove",function(){var a=l();a&&a.commonAncestorContainer!==j&&(j&&angular.element(j).removeClass("selecting-ancestor"),j=a.commonAncestorContainer,j.nodeType===Node.TEXT_NODE&&(j=j.parentNode),angular.element(j).addClass("selecting-ancestor"))
})}),angular.element("body").on("mouseup",function(){angular.element("body").off("mousemove"),j&&(angular.element(j).removeClass("selecting-ancestor"),k=angular.element(j),a.getAnnotations())})}]),angular.module("Pundit2.Annomatic").constant("ANNOMATICDEFAULTS",{container:"annomatic",cMenuType:"annomatic"}).service("Annomatic",["ANNOMATICDEFAULTS","BaseComponent","DataTXTResource","XpointersHelper","ItemsExchange","TextFragmentHandler","TypesHelper","DBPediaSpotlightResource","Item","$rootScope","$timeout","$document","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new b("Annomatic",a);n.ann={byUri:{},byNum:[],numToUriMap:{},uriToNumMap:{},byId:{},autoAnnScopes:[],byState:{},byType:{},typesOptions:[]},n.annotationNumber=0;var o=function(a,b){var c=a[0];n.log("##### Wrapping annotations ",b.length,b);for(var e,f,g,h,i,j,k=[c],m=0,o=0,r=b[o],t=[],u=!1;(i=k.pop())&&o<b.length;)if(n.log("Popped node ",i," current offset = "+m),h=0,d.isTextNode(i)){var v=p(i.textContent);if(0===v.length)0===m?n.log("Skipping FIRST empty text node."):u?n.log("Skipping Consecutive empty text node, without correcting again."):1===q(i.textContent).length?(n.log("Skipping intermediate empty text node, correcting offset by 1"),m+=1,u=!0):n.log("OUCH! trimDoubleSpaces fail?!!? --"+q(i.textContent)+"--");else{for(;r.end<=m+v.length+1;){j=!1;var w=s(i.textContent);w.push(0);for(var x=w.length;x--;)if(f=w[x]+r.start-m+h,g=w[x]+r.end-m+h,e=i.textContent.substring(f,g),n.log("Trying to add "+w[x]+" spaces: --"+e+"-- vs --"+r.spot+"-- ("+f+" to "+g+")"),r.spot===e){h+=w[x],j=!0,n.log("@@ Found annotation "+r.spot);var y=l[0].createRange();y.setStart(i,f),y.setEnd(i,g),y.toString()!==r.spot?n.err("Annotation and range content do not match!! :(("):t.push({range:y,annotation:r});break}if(j||n.log("Annotation NOT FOUND: ",r),o++,r=b[o],o>=b.length){n.log("Annotations are over!!! We are done!!");break}}var z=q(i.textContent);z.match(/^\s\s*/)&&(u||0===m)?(m+=z.length-1,n.log("Moving to next node (corrected by leading space) with current offset = "+m)):(m+=z.length,n.log("Moving to next node with current offset = "+m)),u=!1}}else if(i.hasChildNodes())for(var A=i.childNodes,B=A.length;B--;)k.push(A[B]),n.log("Pushing node ",A[B]);return n.log("Dance finished, found "+t.length+" annotations: ",t),t},p=function(a){return a.replace(/[\r\n]/g," ").replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},q=function(a){return a.replace(/[\r\n]/g," ").replace(/\s+/g," ")},r=function(a){var b=a.match(/(\s\s+)/g);if(null===b)return[];for(var c=b.length;c--;)b[c].match(/\n/)&&(b[c]=b[c].replace(/[\r\n]/g," "));return b},s=function(a){var b=r(a),c=b.length;if(0===c)return[];for(var d=[],e={},f=0;c>f;f++){var g=b[f].length-1;"undefined"==typeof e[g]&&(e[g]=!0,d.push(g))}return d.sort(function(a,b){return a-b})};n.stateClassMap={waiting:"ann-waiting",active:"ann-active",accepted:"ann-ok",removed:"ann-removed",hidden:"ann-hidden"},n.reset=function(){n.ann.typesOptions=[];for(var a in n.stateClassMap)n.ann.byState[a]=[]},n.reset();var t=function(a,b){var c=n.ann.byId,d=n.ann.byType;n.log("Analyzing from "+a+" to "+b);for(var e=a;b>e;e++){var f=n.ann.byNum[e],h=f.id,i=f.types||[];h in c?c[h].push(e):c[h]=[e];for(var j=i.length;j--;){var k=i[j];k in d?d[k].push(e):(n.ann.typesOptions.push({value:k}),d[k]=[e])}f.state="waiting",f.lastState="waiting",n.ann.byState[f.state].push(e)}for(e=n.ann.typesOptions.length;e--;){var l=n.ann.typesOptions[e],m=l.value;l.label=g.getLabel(m)+" ("+d[m].length+")"}n.ann.typesOptions=n.ann.typesOptions.sort(function(a,b){return d[b.value].length-d[a.value].length})},u=function(a,b,c){var d=n.ann.byState,e=d[b].indexOf(a);d[c].push(a),d[b].splice(e,1)};n.setState=function(a,b){var c=n.ann.byNum[a],d=n.ann.autoAnnScopes[a];u(a,c.state,b),c.lastState=c.state,c.state=b;var e=n.stateClassMap[b];c.hidden&&(e+=" "+n.stateClassMap.hidden),d.setStateClass(n.stateClassMap[c.lastState],e)},n.setLastState=function(a){var b=n.ann.byNum[a],c=n.ann.autoAnnScopes[a];u(a,b.state,b.lastState),b.state=b.lastState;var d=n.stateClassMap[b.state];b.hidden&&(d+=" "+n.stateClassMap.hidden),c.setStateClass(n.stateClassMap[b.lastState],d)},n.getDataTXTAnnotations=function(a){var b=m.defer(),d=angular.element(a),g=d.text();return g=p(g),n.log("Querying DataTXT for annotations on content: ",g),n.annotations=c.getAnnotations({$app_id:"cc85cdd8",$app_key:"668e4ac4f00f64c43ab4fefd5c8899fa",text:g},function(a){n.log("Received "+a.annotations.length+" annotations from DataTXT");var c,g=o(d,a.annotations),h=n.annotationNumber;n.annotationNumber+=g.length,n.currAnn=0;for(var i=g.length,j=0;i>j;j++){var k=h+j;c=f.createItemFromRange(g[j].range),c.isAnnomatic=!0,n.ann.byNum[k]=g[j].annotation,n.ann.numToUriMap[k]=c.uri,n.ann.uriToNumMap[c.uri]=k,n.ann.byUri[c.uri]=g[j].annotation,e.addItemToContainer(c,n.options.container),c=v(g[j].annotation),c.isAnnomatic=!0,e.addItemToContainer(c,n.options.container)}t(h,n.annotationNumber),b.resolve()},function(a){n.err("Error loading annotations from DataTXT"),b.reject(a)}),b.promise};var v=function(a){var b={};return b.uri=a.uri,b.isAnnomatic=!0,b.type="undefined"==typeof a.types?["http://dbpedia.org/ontology/Thing"]:angular.copy(a.types),b.description=a.abstract,b.label=a.label,b.label.length>f.options.labelMaxLength&&(b.label=b.label.substr(0,f.options.labelMaxLength)+" .."),"thumbnail"in a.image&&(b.image=a.image.thumbnail),new i(b.uri,b)};return n.hideAnn=function(a){var b=n.ann.byNum[a],c=n.ann.autoAnnScopes[a];b.hidden=!0,c.setStateClass(n.stateClassMap[b.state],n.stateClassMap.hidden)},n.showAnn=function(a){var b=n.ann.byNum[a],c=n.ann.autoAnnScopes[a];b.hidden=!1,c.setStateClass(n.stateClassMap.hidden,n.stateClassMap[b.state])},n.setTypeFilter=function(a){var b=n.ann.byType,c=n.ann.byNum,d={};if(n.log("Setting type filter to ",a),0===a.length)for(var e=c.length;e--;)n.showAnn(e);else{for(var f in a)for(var g=a[f],h=b[g].length;h--;)d[b[g][h]]=!0;for(var i=c.length;i--;)i in d?n.showAnn(i):n.hideAnn(i)}var l=j.$$phase;"$apply"===l||"$digest"===l?k(function(){j.$apply()},1):j.$apply()},n.closeAll=function(){for(var a=n.ann.byState.active.length;a--;){var b=n.ann.byState.active[a];n.ann.autoAnnScopes[b].hide()}},n.currAnn=0,n.reviewNext=function(a){if(0===n.annotationNumber)return void n.log("No annotation to review....");if(0===n.ann.byState.waiting.length)return void n.log("All reviewed!");for(n.closeAll(),a="undefined"==typeof a?n.currAnn:parseInt(a,10),n.currAnn=a>=n.annotationNumber?0:a;(n.ann.byNum[n.currAnn].hidden===!0||"waiting"!==n.ann.byNum[n.currAnn].state)&&(n.currAnn++,n.currAnn!==n.annotationNumber););n.currAnn<n.annotationNumber&&n.ann.autoAnnScopes[n.currAnn].show()},n.log("Component up and running"),n}]),angular.module("Pundit2.Annomatic").service("DataTXTResource",["$resource",function(a){var b="https://api.dandelion.eu/datatxt/nex/v1";return a(b,{},{getAnnotations:{params:{lang:"it",min_confidence:0,min_length:3,include_types:!0,include_categories:!0,include_abstract:!0,include_lod:!0,include_image:!0},method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}})}]),angular.module("Pundit2.Annomatic").service("DBPediaSpotlightResource",["$http","$q",function(a,b){var c,d=b.defer(),e="http://spotlight.dbpedia.org/rest/annotate";return c={getAnnotations:function(b){return a({data:"text="+encodeURIComponent(b),headers:{"content-type":"application/x-www-form-urlencoded",Accept:"application/json"},method:"POST",url:e}).success(function(a){d.resolve(a)}),d.promise}}}]),angular.module("Pundit2.Annomatic").controller("AnnomaticPopoverCtrl",["$scope","Annomatic",function(a,b){a.num=parseInt(a.content,10),a.ann=b.ann,a.showDetails=!0,a.instances=a.ann.byId[a.ann.byNum[a.num].id].length,a.hide=function(){a.$hide(),b.setLastState(a.num)},a.setOk=function(){a.$hide(),b.setState(a.num,"accepted"),b.reviewNext(a.num+1)},a.setKo=function(){a.$hide(),b.setState(a.num,"removed"),b.reviewNext(a.num+1)},a.goNext=function(){a.$hide(),b.setLastState(a.num),b.reviewNext(a.num+1)},a.acceptAll=function(){for(var c=a.ann.byNum[a.num].id,d=a.ann.byId[c],e=d.length;e--;)b.setState(d[e],"accepted");a.$hide(),b.reviewNext(a.num+1)},a.toggleSimilar=function(){for(var c=a.ann.byNum[a.num],d=c.id,e=a.ann.byId[d],f=e.length;f--;)if(e[f]!==a.num){var g=b.ann.byNum[e[f]];"active"!==g.state?b.setState(e[f],"active"):b.setLastState(e[f])}}}]),angular.module("Pundit2.Annomatic").directive("suggestionFragmentIcon",["TextFragmentAnnotator","XpointersHelper","Annomatic","$popover",function(a,b,c,d){return{restrict:"E",scope:{fragment:"@"},templateUrl:"src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",replace:!0,link:function(e,f){e.textFragmentIconClass=b.options.textFragmentIconClass,e.iconClass=a.options.suggestionIconClass,e.element=f,a.addFragmentIcon(e);var g=function(){e.uri=e.item.uri,e.num=c.ann.uriToNumMap[e.uri],c.ann.autoAnnScopes[e.num]=e,angular.element("."+e.fragment).addClass("ann-auto"),e.popover=d(e.element,{content:""+e.num,placement:"bottom",template:"src/Annomatic/AnnomaticPopover.tmpl.html",trigger:"manual",container:"[data-ng-app='Pundit2']"})};g(),e.mouseoverHandler=function(){a.highlightById(e.fragment)},e.mouseoutHandler=function(){a.clearHighlightById(e.fragment)},e.clickHandler=function(){c.ann.byNum[e.num].hidden||(e.popover.$isShown?e.hide():e.show())},e.show=function(){e.popover.$isShown!==!0&&(c.closeAll(),c.setState(e.num,"active"),e.popover.show())},e.hide=function(){e.popover.$isShown!==!1&&(c.setLastState(e.num),e.popover.hide())},e.setStateClass=function(a,b){angular.element("."+e.fragment).removeClass(a+" ann-active"),angular.element("."+e.fragment).addClass(b),a===c.stateClassMap.hidden?f.removeClass("ann-hidden"):b===c.stateClassMap.hidden&&f.addClass("ann-hidden")},e.setStateClass("",c.stateClassMap.waiting)}}}]),angular.module("Pundit2.AnnotationSidebar",[]),angular.module("Pundit2.AnnotationSidebar").directive("annotationSidebar",["AnnotationSidebar",function(a){return{restrict:"E",scope:{},templateUrl:"src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",controller:"AnnotationSidebarCtrl",link:function(){angular.element("body").addClass(a.options.bodyClass)}}}]),angular.module("Pundit2.AnnotationSidebar").controller("AnnotationSidebarCtrl",["$scope","$filter","$timeout","$document","$window","AnnotationSidebar","Dashboard","Toolbar",function(a,b,c,d,e,f,g,h){var i,j=f.options.bodyExpandedClass+" "+f.options.bodyCollapsedClass,k=f.options.sidebarExpandedClass+" "+f.options.sidebarCollapsedClass,l=angular.element("body"),m=angular.element(".pnd-annotation-sidebar-container"),n={toolbarHeight:30,newMarginTopSidebar:0,sidebarCurrentHeight:0,sidebarNewHeight:0},o={iconMagnifier:f.options.inputIconSearch,iconFilter:f.options.inputIconFilter,clean:f.options.inputIconClear};a.annotationSidebar=f,a.filters=f.getFilters(),l.css("position","static"),m.css("height",l.innerHeight()+"px"),f.options.isAnnotationSidebarExpanded?(l.addClass(f.options.bodyExpandedClass),m.addClass(f.options.sidebarExpandedClass)):(l.addClass(f.options.bodyCollapsedClass),m.addClass(f.options.sidebarCollapsedClass)),a.isSuggestionsPanelActive=function(){return f.isSuggestionsPanelActive()},a.activateSuggestionsPanel=function(){f.activateSuggestionsPanel()},a.isAnnotationsPanelActive=function(){return f.isAnnotationsPanelActive()},a.activateAnnotationsPanel=function(){f.activateAnnotationsPanel()},a.$watch(function(){return h.isLoading()},function(b,c){b!==c&&(a.isLoading=b)}),a.$watch(function(){return f.isAnnotationSidebarExpanded()},function(b,c){a.isAnnotationSidebarExpanded=b,b!==c&&(l.toggleClass(j),m.toggleClass(k),f.setAnnotationsPosition())}),a.$watch(function(){return f.isFiltersExpanded()},function(b){a.isFiltersShowed=b}),a.$watch(function(){return g.getContainerHeight()},function(a){n.newMarginTopSidebar=n.toolbarHeight+a,m.css("margin-top",n.newMarginTopSidebar+"px")}),a.$watch(function(){return g.isDashboardVisible()},function(a){a?(n.newMarginTopSidebar=n.toolbarHeight+g.getContainerHeight(),m.css("margin-top",n.newMarginTopSidebar+"px")):m.css("margin-top",n.toolbarHeight+"px")});var p=function(){var a=f.minHeightRequired,b=l.innerHeight(),c=Math.max(a,b);m.css("height",c+"px")};a.$watch(function(){return f.minHeightRequired},function(){p()}),a.$watch(function(){return d.innerHeight()},function(){p()}),angular.element(e).bind("resize",function(){p()}),a.fromMinDate=new Date,a.toMinDate=new Date,a.fromMaxDate=new Date,a.fromToDate=new Date;var q=function(a){var c=new Date(a&&!isNaN(Date.parse(a))?Date.parse(a):0);return c.setDate(c.getDate()-1),b("date")(c,"yyyy-MM-dd")};a.$watch(function(){return f.getAllAnnotations()},function(b){a.allAnnotations=b,a.annotations=f.needToFilter()?f.getAllAnnotationsFiltered(f.filters):b}),a.$watch(function(){return f.getMinDate()},function(c){if("undefined"!=typeof c){var d=b("date")(c,"yyyy-MM-dd");a.fromMinDate=q(d),""===f.filters.fromDate.expression&&(a.toMinDate=q(d))}}),a.$watch(function(){return f.getMaxDate()},function(c){if("undefined"!=typeof c){var d=b("date")(c,"yyyy-MM-dd");a.toMaxDate=d,""===f.filters.toDate.expression&&(a.fromMaxDate=d)}}),a.$watch("annotationSidebar.filters.fromDate.expression",function(b){a.toMinDate=q("undefined"!=typeof b?b:a.fromMinDate)}),a.$watch("annotationSidebar.filters.toDate.expression",function(b){a.fromMaxDate="undefined"!=typeof b?b:a.toMaxDate}),a.$watch("freeText",function(a){c.cancel(i),i=c(function(){f.filters.freeText.expression=a},1e3)}),a.$watch("annotationSidebar.filters",function(b){""===f.filters.freeText.expression&&(a.freeText=""),a.annotations=f.getAllAnnotationsFiltered(b)},!0),a.isFilterLabelShowed=function(a){return"string"==typeof a?a.length>0:void 0},a.toggleFilterList=function(b){var c=angular.element(".pnd-annotation-sidebar-filter-show"),d=angular.element(b.target.parentElement);a.searchAuthors="",a.searchNotebooks="",a.searchTypes="",a.searchPredicates="",a.searchEntities="",c.not(d).removeClass("pnd-annotation-sidebar-filter-show"),d.toggleClass("pnd-annotation-sidebar-filter-show")},a.toggleFilter=function(a,b){var c=f.filters[a].expression.indexOf(b);-1===c?(f.filters[a].expression.push(b),f.toggleActiveFilter(a,b)):(f.filters[a].expression.splice(c,1),f.toggleActiveFilter(a,b))},a.toggleBrokenAnnotations=function(){f.filters.broken.expression=""===f.filters.broken.expression?"hideBroken":""},a.setSearchIcon=function(a){return"undefined"==typeof a||""===a?o.iconMagnifier:o.clean},a.setFilterIcon=function(a){return"undefined"==typeof a||""===a?o.iconFilter:o.clean},f.log("Controller Run")}]),angular.module("Pundit2.AnnotationSidebar").filter("orderObjectBy",function(){return function(a,b,c){var d=[];if(!angular.isObject(a))return a;for(var e in a)d.push(a[e]);return d.sort(function(a,d){return a=parseInt(a[b],10),d=parseInt(d[b],10),"asc"===c?a-d:d-a}),d}}).filter("freeText",function(){return function(a,b){var c=[];return b.length>0?angular.forEach(a,function(a){for(var d in a.items){var e=a.items[d].label,f=b.toLowerCase().replace(/\s+/g," "),g=f.split(" "),h=new RegExp(g.join(".*"));if(null!==e.toLowerCase().match(h))return void c.push(a)}}):c=a,c}}).filter("broken",function(){return function(a,b){var c=[];if(b.length>0)for(var d in a)a[d].broken||c.push(a[d]);else c=a;return c}}).filter("authors",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){c=a.creator,-1!==b.indexOf(c)&&d.push(a)}):d=a,d}}).filter("notebooks",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){c=a.isIncludedInUri,-1!==b.indexOf(c)&&d.push(a)}):d=a,d}}).filter("predicates",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.predicates)if(c=a.predicates[e],-1!==b.indexOf(c))return void d.push(a)}):d=a,d}}).filter("entities",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.entities)if(c=a.entities[e],-1!==b.indexOf(c))return void d.push(a)}):d=a,d}}).filter("types",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.items){var f=a.items[e];for(var g in f.type)if(c=f.type[g],-1!==b.indexOf(c))return void d.push(a)}}):d=a,d}}).filter("fromDate",function(){return function(a,b){var c,d=[];return b?(c=new Date(b&&!isNaN(Date.parse(b))?Date.parse(b):0),c.setHours(0,0,0),angular.forEach(a,function(a){var b=Date.parse(a.created);b>=c&&d.push(a)})):d=a,d}}).filter("toDate",function(){return function(a,b){var c,d=[];return b?(c=new Date(b&&!isNaN(Date.parse(b))?Date.parse(b):(new Date).getTime()),c.setHours(23,59,59),angular.forEach(a,function(a){var b=Date.parse(a.created);c>=b&&d.push(a)})):d=a,d}}),angular.module("Pundit2.AnnotationSidebar").constant("ANNOTATIONSIDEBARDEFAULTS",{isAnnotationSidebarExpanded:!1,isFiltersShowed:!1,annotationsRefresh:300,bodyClass:"pnd-annotation-sidebar-active",bodyExpandedClass:"pnd-annotation-sidebar-expanded",bodyCollapsedClass:"pnd-annotation-sidebar-collapsed",sidebarExpandedClass:"pnd-annotation-sidebar-expanded",sidebarCollapsedClass:"pnd-annotation-sidebar-collapsed",inputIconSearch:"pnd-icon-search",inputIconFilter:"pnd-icon-filter",inputIconClear:"pnd-icon-times",annotationsPanelActive:!0,suggestionsPanelActive:!1,annotationHeigth:25,startTop:55,clientDomTemplate:"src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html",debug:!1}).service("AnnotationSidebar",["$rootScope","$filter","$timeout","BaseComponent","AnnotationsExchange","Consolidation","Dashboard","ItemsExchange","NotebookExchange","TypesHelper","TextFragmentAnnotator","ANNOTATIONSIDEBARDEFAULTS",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new d("AnnotationSidebar",l),n={isSidebarExpanded:m.options.isAnnotationSidebarExpanded,isFiltersExpanded:m.options.isFiltersShowed,allAnnotations:[],filteredAnnotations:[],isAnnotationsPanelActive:m.options.annotationsPanelActive,isSuggestionsPanelActive:m.options.suggestionsPanelActive},o={annotationsDate:[],authors:{},notebooks:{},entities:{},predicates:{},types:{}},p=m.options.startTop,q=30,r=[];m.minHeightRequired=p,m.filters={freeText:{filterName:"freeText",filterLabel:"Free text",expression:""},authors:{filterName:"authors",filterLabel:"Author",expression:[]},notebooks:{filterName:"notebooks",filterLabel:"Notebooks",expression:[]},fromDate:{filterName:"fromDate",filterLabel:"From date",expression:""},toDate:{filterName:"toDate",filterLabel:"To date",expression:""},predicates:{filterName:"predicates",filterLabel:"Predicates",expression:[]},entities:{filterName:"entities",filterLabel:"Entities",expression:[]},types:{filterName:"types",filterLabel:"Types",expression:[]},broken:{filterName:"broken",filterLabel:"Broken",expression:""}},m.filtersCount={},m.annotationPositionReal={},m.toggle=function(){n.isSidebarExpanded=!n.isSidebarExpanded},m.toggleFiltersContent=function(){n.isFiltersExpanded=!n.isFiltersExpanded},m.isAnnotationSidebarExpanded=function(){return n.isSidebarExpanded},m.isFiltersExpanded=function(){return n.isFiltersExpanded},m.isAnnotationsPanelActive=function(){return n.isAnnotationsPanelActive},m.activateAnnotationsPanel=function(){n.isAnnotationsPanelActive=!0,n.isSuggestionsPanelActive=!1},m.isSuggestionsPanelActive=function(){return n.isSuggestionsPanelActive},m.activateSuggestionsPanel=function(){n.isSuggestionsPanelActive=!0,n.isAnnotationsPanelActive=!1};var s=function(a){return"undefined"==typeof m.filtersCount[a]?m.filtersCount[a]=1:m.filtersCount[a]++,m.filtersCount[a]},t=function(a){m.filtersCount={},angular.forEach(o,function(a){for(var b in a)"undefined"!=typeof a[b]&&(a[b].count=0,a[b].partial=0)}),angular.forEach(a,function(a){var b,c={};b=s(a.creator),o.authors[a.creator].count=b,o.authors[a.creator].partial=b,b=s(a.isIncludedIn),o.notebooks[a.isIncludedInUri].count=b,o.notebooks[a.isIncludedInUri].partial=b,angular.forEach(a.predicates,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},b=s(a),o.predicates[a].count=b,o.predicates[a].partial=b)}),angular.forEach(a.entities,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},b=s(a),o.entities[a].count=b,o.entities[a].partial=b)}),angular.forEach(a.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},b=s(a),o.types[a].count=b,o.types[a].partial=b)})})})},u=function(a,b,c){if(m.filtersCount={},c)for(var d in o[b])"undefined"!=typeof o[b][d]&&(o[b][d].partial=0);else for(var e in o)if(e!==b)for(var d in o[e])"undefined"!=typeof o[e][d]&&(o[e][d].partial=0);angular.forEach(a,function(a){var d={};("authors"!==b&&!c||"authors"===b&&c)&&(o.authors[a.creator].partial=s(a.creator)),("notebooks"!==b&&!c||"notebooks"===b&&c)&&(o.notebooks[a.isIncludedInUri].partial=s(a.isIncludedIn)),("predicates"!==b&&!c||"predicates"===b&&c)&&angular.forEach(a.predicates,function(a){"undefined"==typeof d[a]&&(d[a]={uri:a},o.predicates[a].partial=s(a))}),("entities"!==b&&!c||"entities"===b&&c)&&angular.forEach(a.entities,function(a){"undefined"==typeof d[a]&&(d[a]={uri:a},o.entities[a].partial=s(a))}),("types"!==b&&!c||"types"===b&&c)&&angular.forEach(a.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof d[a]&&(d[a]={uri:a},o.types[a].partial=s(a))})})})},v=function(a,b){var c,d,e;p=m.options.startTop,m.annotationPositionReal={},"undefined"!=typeof a&&"number"==typeof b?(e=r.map(function(a){return a.id}).indexOf(a),-1!==e&&(r[e].height=b)):r.sort(function(a,b){return a.top-b.top}),c=r;for(var f in c)m.annotationPositionReal[c[f].id]={id:c[f].id,top:c[f].top,height:c[f].height,broken:c[f].broken},d=c[f].top,d>p?(m.annotationPositionReal[c[f].id].top=d,p=d+c[f].height):(m.annotationPositionReal[c[f].id].top=p,p+=c[f].height);m.minHeightRequired=p+m.options.annotationHeigth},w=function(a){var b,c,d,e,g=a.graph;for(var i in g){if(c=h.getItemByUri(i),(c.isTextFragment()||c.isImageFragment()||c.isImage())&&f.isConsolidated(c))return i;for(var j in g[i]){b=g[i][j];for(var k in b)if(d=b[k].value,e=b[k].type,"uri"===e&&(c=h.getItemByUri(d),(c.isTextFragment()||c.isImageFragment()||c.isImage())&&f.isConsolidated(c)))return d}}},x=function(a,b){var c,d=m.needToFilter()?n.filteredAnnotations:n.allAnnotations,e=!1,f=0;c=g.isDashboardVisible()?g.getContainerHeight():0,d.length>0&&(p=m.options.startTop,r=[],"undefined"!=typeof a&&"number"==typeof b&&(e=!0),angular.forEach(d,function(d){var g,i,j;if(g=w(d),"undefined"==typeof g)f=m.options.annotationHeigth,e&&a===d.id&&(f=b),r.push({id:d.id,top:-2,height:f,broken:!0});else{var l=-1;if(i=h.getItemByUri(g),i.isTextFragment())j=k.getFragmentIdByUri(g),"undefined"!=typeof j?l=angular.element("."+j).offset().top-q-c:m.log("Something wrong with the fragments of this annotation: ",d);else if(i.isImage()||i.isImageFragment()){var n=angular.element('img[src="'+i.image+'"]');"undefined"!=typeof n.offset()&&(l=n.offset().top-q-c)}f=m.options.annotationHeigth,e&&a===d.id&&(f=b),r.push({id:d.id,top:l,height:f,broken:!1})}}),v())},y=function(){for(var a in n.allAnnotations)n.allAnnotations[a].broken=n.allAnnotations[a].isBroken()},z=function(a){var b;k.hideAll(),angular.forEach(a,function(a){for(var c in a.items)-1===a.predicates.indexOf(c)&&(b=h.getItemByUri(c),f.isConsolidated(b)&&k.showByUri(b.uri))})},A=function(b){m.filtersCount={},angular.forEach(b,function(b){var c={};"undefined"==typeof o.authors[b.creator]&&(o.authors[b.creator]={uri:b.creator,label:b.creatorName,active:!1,count:0}),-1===o.annotationsDate.indexOf(b.created)&&o.annotationsDate.push(b.created);var d=b.isIncludedIn,e=b.isIncludedInUri;if("undefined"==typeof o.notebooks[e]){var f="Downloading in progress",g=a.$watch(function(){return i.getNotebookById(d)},function(a){"undefined"!=typeof a&&(f=a.label,o.notebooks[e].label=f,g())});o.notebooks[e]={uri:e,label:f,notebookId:d,active:!1,count:0}}angular.forEach(b.predicates,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof o.predicates[a]&&(o.predicates[a]={uri:a,label:b.items[a].label,active:!1,count:0}))}),angular.forEach(b.entities,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof o.entities[a]&&(o.entities[a]={uri:a,label:b.items[a].label,active:!1,count:0}))}),angular.forEach(b.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof o.types[a]&&(o.types[a]={uri:a,label:j.getLabel(a),active:!1,count:0}))})})}),t(b)};return m.getAllAnnotations=function(){return n.allAnnotations},m.getAllAnnotationsFiltered=function(a){var c,d,e={};n.filteredAnnotations=angular.copy(n.allAnnotations),angular.forEach(a,function(a){d=a.filterName,c=a.expression,("string"==typeof c&&""!==c||angular.isArray(c)&&c.length>0)&&(n.filteredAnnotations=b(d)(n.filteredAnnotations,c),e[d]=b(d)(n.allAnnotations,c))});var f=function(a,b){var c=[];for(var d in a)for(var e in b)angular.equals(a[d],b[e])&&c.push(a[d]);return c},g=function(a,b,c){var d=c;for(var e in a)e!==b&&(d=f(d,a[e]));return d};u(n.filteredAnnotations,"none",!1);var h={};for(var i in e)h[i]=g(e,i,angular.copy(n.allAnnotations)),u(h[i],i,!0);return z(n.filteredAnnotations),x(),n.filteredAnnotations},m.getFilters=function(){return o},m.getMinDate=function(){return o.annotationsDate.length>0?o.annotationsDate.reduce(function(a,b){return b>a?a:b}):void 0},m.getMaxDate=function(){return o.annotationsDate.length>0?o.annotationsDate.reduce(function(a,b){return a>b?a:b}):void 0},m.setAllPosition=function(a,b){v(a,b)},m.setAnnotationPosition=function(a,b){var c;"undefined"!=typeof a&&"number"==typeof b&&(c=r.map(function(a){return a.id}).indexOf(a),-1!==c&&(r[c].height=b))},m.setAnnotationsPosition=function(){x()},m.needToFilter=function(){for(var a in m.filters){var b=m.filters[a].expression;if("string"==typeof b&&""!==b)return!0;if(angular.isArray(b)&&b.length>0)return!0}return!1},m.toggleActiveFilter=function(a,b){o[a][b].active=!o[a][b].active},m.setFilter=function(a,b){var c,d,e=m.filters[a].expression;"string"==typeof e?m.filters[a].expression=b:"object"==typeof e&&(c=m.filters[a].expression.indexOf(b),d=o[a][b],-1===c&&"undefined"!=typeof d&&(d.active=!0,m.filters[a].expression.push(b)))},m.removeFilter=function(a,b){var c,d=m.filters[a].expression;"string"==typeof d?m.filters[a].expression="":"object"==typeof d&&(c=m.filters[a].expression.indexOf(b),-1!==c&&(o[a][b].active=!1,m.filters[a].expression.splice(c,1)))},m.resetFilters=function(){angular.forEach(m.filters,function(a){if("string"==typeof a.expression)a.expression="";else if("object"==typeof a.expression){for(var b in o[a.filterName])o[a.filterName][b].active=!1;a.expression=[]}})},a.$on("consolidation-completed",function(){m.log("Update annotations in sidebar");var a=e.getAnnotations();n.allAnnotations=angular.copy(a),y(),A(n.allAnnotations),x()}),m.log("Component running"),m}]),angular.module("Pundit2.AnnotationSidebar").directive("annotationDetails",function(){return{restrict:"E",scope:{id:"@",broken:"=broken"},templateUrl:"src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",controller:"AnnotationDetailsCtrl"}}),angular.module("Pundit2.AnnotationSidebar").controller("AnnotationDetailsCtrl",["$scope","$rootScope","$element","$modal","$timeout","AnnotationSidebar","AnnotationDetails","AnnotationsExchange","AnnotationsCommunication","NotebookExchange","ItemsExchange","TripleComposer","Dashboard","ImageAnnotator","TextFragmentAnnotator","Toolbar","TypesHelper","MyPundit","Consolidation",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=a.id,u=angular.element(c).find(".pnd-annotation-details-wrap"),v=f.options.annotationHeigth;if(g.addAnnotationReference(a),a.annotation=g.getAnnotationDetails(t),"undefined"!=typeof a.annotation){a.askLink=g.isUserToolShowed(a.annotation.creator)?p.options.askLinkDefault+"#/myNotebooks/":p.options.askLinkDefault+"#/notebooks/";var w=a.annotation.notebookId}a.notebookName="Downloading notebook in progress";var x=a.$watch(function(){return j.getNotebookById(w)},function(b){"undefined"!=typeof b&&(a.notebookName=b.label,x())});a.toggleAnnotation=function(){f.isAnnotationSidebarExpanded()||f.toggle(),a.metaInfo=!1,g.toggleAnnotationView(t),a.annotation.expanded||f.setAllPosition(t,v)};var y=b.$new();y.titleMessage="Delete Annotation",y.confirm=function(){r.isUserLogged()&&(u.addClass("pnd-annotation-details-delete-in-progress"),i.deleteAnnotation(a.annotation.id).then(function(){y.notifyMessage="Your annotation has been deleted successfully"},function(){u.removeClass("pnd-annotation-details-delete-in-progress"),y.notifyMessage="Impossible to delete the annotation. Please reatry later."})),e(function(){z.hide()},1e3)},y.cancel=function(){z.hide()};var z=d({container:'[data-ng-app="Pundit2"]',template:"src/Core/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:y}),A=function(){y.notifyMessage="Are you sure you want to delete this annotation? After you can no longer recover.",z.$promise.then(z.show)};a.deleteAnnotation=function(){A()},a.showEdit=function(){return"undefined"==typeof a.annotation.hasTemplate},a.editAnnotation=function(){l.editAnnotation(a.annotation.id),m.isDashboardVisible()||(l.closeAfterOp(),m.toggle()),b.$emit("pnd-dashboard-show-tab",l.options.clientDashboardTabTitle)},a.$watch(function(){return u.height()},function(b,c){b!==c&&a.annotation.expanded&&f.setAllPosition(t,b)}),a.$watch(function(){return f.isAnnotationSidebarExpanded()},function(a,b){a!==b&&(f.isAnnotationSidebarExpanded()||g.closeViewAndReset())}),a.isUserToolShowed=function(){return g.isUserToolShowed(a.annotation.creator)},a.mouseoverAllHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=k.getItemByUri(c[d]),"undefined"!=typeof b&&b.isImageFragment()&&s.isConsolidated(b)&&n.svgHighlightByItem(b)}},a.mouseoutAllHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=k.getItemByUri(c[d]),"undefined"!=typeof b&&b.isImageFragment()&&s.isConsolidated(b)&&n.svgClearHighlightByItem(b)}},a.mouseoverHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=k.getItemByUri(c[d]),"undefined"!=typeof b&&(b.isTextFragment()?o.highlightByUri(c[d]):b.isImageFragment()||b.isImage()&&n.highlightByUri(c[d]))}},a.mouseoutHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=k.getItemByUri(c[d]),"undefined"!=typeof b&&(b.isTextFragment()?o.clearHighlightByUri(c[d]):b.isImageFragment()||b.isImage()&&n.clearHighlightByUri(c[d]))}},a.mouseoverItemHandler=function(b){if(!a.annotation.broken){var c=k.getItemByUri(b);"undefined"!=typeof c&&(c.isTextFragment()?o.highlightByUri(b):c.isImageFragment()&&s.isConsolidated(c)?(n.svgClearHighlightByItem(c),n.svgHighlightByItem(c)):c.isImage()&&n.highlightByUri(b))}},a.mouseoutItemHandler=function(b){if(!a.annotation.broken){var c=k.getItemByUri(b);"undefined"!=typeof c&&(c.isTextFragment()?o.clearHighlightByUri(b):c.isImageFragment()||c.isImage()&&n.clearHighlightByUri(b))}},g.log("Controller Details Run")}]),angular.module("Pundit2.AnnotationSidebar").constant("ANNOTATIONDETAILSDEFAULTS",{defaultExpanded:!1,debug:!1}).service("AnnotationDetails",["$rootScope","$filter","$timeout","$document","BaseComponent","Annotation","AnnotationSidebar","AnnotationsExchange","TemplatesExchange","Consolidation","ContextualMenu","Dashboard","ImageHandler","ItemsExchange","MyPundit","TextFragmentAnnotator","TypesHelper","ANNOTATIONDETAILSDEFAULTS",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=new e("AnnotationDetails",r),t={annotations:[],defaultExpanded:s.options.defaultExpanded,isUserLogged:!1,isGhostedActive:!1,userData:{}};k.addAction({type:[p.options.cMenuType,m.options.cMenuType],name:"showAllAnnotations",label:"Show all annotations of this item",showIf:function(a){return"undefined"!=typeof a?j.isConsolidated(a)||a.uri in j.getFragmentParentList():void 0},priority:10,action:function(a){g.isAnnotationSidebarExpanded()||g.toggle(),s.closeViewAndReset();
var b,c=j.getFragmentParentList();a.uri in c&&(b=c[a.uri]);for(var d in t.annotations){-1===t.annotations[d].itemsUriArray.indexOf(a.uri)&&(t.annotations[d].ghosted=!0);for(var e in b)-1===t.annotations[d].itemsUriArray.indexOf(b[e].uri)||(t.annotations[d].ghosted=!1)}t.isGhostedActive=!0,p.ghostAll(),p.ghostRemoveByUri(a.uri)}});var u=function(a){for(var b="pnd-annotation-details-wrap",c="pnd-annotation-sidebar-filter-content",d="pnd-annotation-details-ghosted";"body"!==a.nodeName.toLowerCase();){if(angular.element(a).hasClass(b)&&0===angular.element(a).find("."+d).length)return!1;if(angular.element(a).hasClass(c))return!1;if(null===a.parentNode)return!0;a=a.parentNode}return!0};d.on("mousedown",function(b){var c=b.target;t.isGhostedActive&&u(c)&&s.closeViewAndReset(),a.$$phase||a.$digest()});var v=function(a){var b,c=n.getItemByUri(a);return"undefined"!=typeof c&&(b={uri:a,label:c.label,description:c.description,image:"undefined"!=typeof c.image?c.image:null,"class":c.getClass(),icon:c.getIcon(),typeLabel:"undefined"!=typeof c.type[0]?q.getLabel(c.type[0]):null,typeClass:"uri"}),b},w=function(a){var b,c=a,d={};for(b in c.graph)break;return d=v(b)},x=function(a){var b,c,d=[];for(var e in a)b=a[e].value,c=a[e].type,d.push("uri"===c?v(b):{uri:null,label:b,description:b,image:null,"class":null,icon:null,typeLabel:c,typeClass:c});return d},y=function(a){var b=a,c=b.graph,d=[];for(var e in c)for(var f in c[e])d.push({subject:v(e),predicate:v(f),objects:x(c[e][f],b)});return d},z=function(a){var b=a,c=b.items,d=[];for(var e in c)-1===d.indexOf(e)&&d.push(e);return d};return s.getAnnotationDetails=function(a){return a in t.annotations?t.annotations[a]:void 0},s.getAnnotationViewStatus=function(a){return t.annotations[a].expanded},s.setGhosted=function(a){"undefined"!=typeof t.annotations[a]&&(t.annotations[a].ghosted=!0),t.isGhostedActive=!0},s.resetGhosted=function(){for(var a in t.annotations)t.annotations[a].ghosted=!1;t.isGhostedActive=!1},s.closeViewAndReset=function(){for(var a in t.annotations)t.annotations[a].ghosted=!1,t.annotations[a].expanded=!1,g.setAllPosition(a,g.options.annotationHeigth);t.isGhostedActive=!1,p.ghostRemoveAll()},s.closeAllAnnotationView=function(a){for(var b in t.annotations)b!==a&&(t.annotations[b].expanded=!1,g.setAnnotationPosition(b,g.options.annotationHeigth))},s.openAnnotationView=function(a){"undefined"!=typeof t.annotations[a]?(g.isAnnotationSidebarExpanded()||g.toggle(),s.closeAllAnnotationView(a),t.annotations[a].expanded=!0):s.log("Cannot find this annotation: id -> "+a)},s.toggleAnnotationView=function(a){s.closeAllAnnotationView(a),t.annotations[a].expanded=!t.annotations[a].expanded},s.isAnnotationGhosted=function(a){return t.annotations[a].ghosted},s.isAnnotationUser=function(a){return a===t.userData.uri},s.isUserToolShowed=function(a){return t.isUserLogged===!0&&a===t.userData.uri},s.addAnnotationReference=function(a,b){var c,d,e,f,g=a.id,j=a.broken;"undefined"!=typeof g&&(c=h.getAnnotationById(g),d=b?!0:t.defaultExpanded,e=i.getTemplateById(c.hasTemplate),"undefined"!=typeof e&&(f=e.color),("undefined"==typeof t.annotations[g]||"undefined"!=typeof b)&&(t.annotations[g]={id:g,creator:c.creator,creatorName:c.creatorName,created:c.created,notebookId:c.isIncludedIn,scopeReference:a,mainItem:w(c),itemsArray:y(c),itemsUriArray:z(c),broken:j,expanded:d,ghosted:!1,color:f,hasTemplate:e}))},a.$on("update-annotation-completed",function(a,b){s.log("Update annotation");var d,e;"undefined"!=typeof b&&(e=h.getAnnotationById(b),d={id:b,broken:e.isBroken()},g.isAnnotationSidebarExpanded()||g.toggle(),s.closeAllAnnotationView(b),s.addAnnotationReference(d,!0),c(function(){var a=angular.element("#"+b);a.length>0&&angular.element("body").animate({scrollTop:a.offset().top-l.getContainerHeight()-30},"slow")},100))}),a.$watch(function(){return o.isUserLogged()},function(a){t.isUserLogged=a,t.userData=o.getUserData()}),s.log("Component running"),s}]),angular.module("Pundit2.Dashboard",[]),angular.module("Pundit2.Dashboard").directive("dashboard",function(){return{restrict:"E",scope:{},templateUrl:"src/Dashboard/Dashboard.dir.tmpl.html",controller:"DashboardCtrl"}}),angular.module("Pundit2.Dashboard").controller("DashboardCtrl",["$document","$window","$rootScope","$scope","$compile","Dashboard",function(a,b,c,d,e,f){var g={container:angular.element(".pnd-dashboard-container"),footer:angular.element(".pnd-dashboard-footer"),body:angular.element("body")};g.footer.css({height:f.options.footerHeight}),d.isDashboardVisible=f.isDashboardVisible();var h=function(){var a=angular.element("body"),b=parseInt(a.innerWidth(),10),e=parseInt(a.css("margin-left"),10),g=parseInt(a.css("margin-right"),10),h=b+g+e;h!==f.getContainerWidth()&&(f.setContainerWidth(h),c.$$phase||d.$digest())};d.$watch(function(){return g.body.innerWidth()},h),angular.element(b).resize(h),d.$watch(function(){return f.getConfiguredPanels()},function(a){for(var b in a)f.log("Adding configured panel to Dashboard: "+b),g.container.append('<dashboard-panel paneltitle="'+b+'"></dashboard-panel>');var c=angular.element("dashboard-panel");e(c)(d)}),d.$watch(function(){return f.getContainerHeight()},function(a){g.container.css({height:a});var b=parseInt(g.container.css("top"),10);g.body.css({marginTop:b+a})}),d.$watch(function(){return f.getContainerWidth()},function(a){g.container.css({width:a})}),d.$watch(function(){return f.isDashboardVisible()},function(a,b){if(d.isDashboardVisible=a,"undefined"!=typeof a&&"undefined"!=typeof b){var c=parseInt(g.container.css("top"),10),e=a?c+f.getContainerHeight():c;g.body.css({marginTop:e})}}),f.log("Controller Run")}]),angular.module("Pundit2.Dashboard").constant("DASHBOARDDEFAULTS",{clientDomTemplate:"src/Dashboard/ClientDashboard.tmpl.html",debug:!1,isDashboardVisible:!1,containerMinHeight:200,containerMaxHeight:800,containerHeight:300,footerHeight:20,separatorWidth:8,panels:{lists:{minWidth:243},tools:{minWidth:478},details:{minWidth:239}},panelCollapsedWidth:28,panelTabsHeight:27,panelContentHeaderHeight:43,panelInnerTabsHeight:31,panelFooterHeight:40}).service("Dashboard",["BaseComponent","DASHBOARDDEFAULTS","$window","$rootScope",function(a,b,c,d){var e=new a("Dashboard",b),f=0;for(var g in e.options.panels)f+=e.options.panels[g].minWidth;var h={isDashboardVisible:e.options.isDashboardVisible,containerWidth:Math.max(angular.element("body").innerWidth(),f),containerHeight:e.options.containerHeight,panelsContent:{}};e.getConfiguredPanels=function(){return e.options.panels},e.canCollapsePanel=function(){var a=i.filter(function(a){return a.isCollapsed}).length;return a<i.length-1},e.toggle=function(){if(h.isDashboardVisible=!h.isDashboardVisible,h.isDashboardVisible)for(var a in i)i[a].setTabContentHeight()},e.isDashboardVisible=function(){return h.isDashboardVisible},e.getContainerHeight=function(){return h.containerHeight},e.increaseContainerHeight=function(a){if(h.containerHeight===e.options.containerMaxHeight&&a>0)return!1;if(h.containerHeight===e.options.containerMinHeight&&0>a)return!1;var b=h.containerHeight+a;return h.containerHeight=b<e.options.containerMinHeight?e.options.containerMinHeight:b>e.options.containerMaxHeight?e.options.containerMaxHeight:b,d.$$phase||d.$digest(),!0},e.getContainerWidth=function(){return h.containerWidth},e.setContainerWidth=function(a){return f>=a?(h.containerWidth=f,e.resizeAll(),void e.log("Dashboard is at min-width")):(h.containerWidth=a,void e.resizeAll())};var i=[];return e.addPanel=function(a){e.log("Adding panel",a.paneltitle);var b=i.length;if(b>0&&(i[b-1].isLast=!1,i[b-1].collapsedWidth=e.options.panelCollapsedWidth),a.isLast=!0,a.collapsedWidth=e.options.panelCollapsedWidth-e.options.separatorWidth,a.minWidth=e.options.panels[a.paneltitle].minWidth,a.index=b,i.push(a),a.paneltitle in h.panelsContent)for(var c=h.panelsContent[a.paneltitle],d=c.length;d--;)e.log("Adding tab "+c[d].tabName+" to existing panel "+a.paneltitle),a.addContent(c[d].tabName,c[d].tabTemplate);var f,g=0;for(f in e.options.panels)g++;i.length===g&&e.resizeAll()},e.resizeAll=function(a){var b,c,f=e.getContainerWidth(),g=0;angular.isObject(a)||(a={});for(c in a)g++,f-=a[c];var h=i.filter(function(a){return a.isCollapsed}),j=i.filter(function(a){return!a.isCollapsed});f-=h.reduce(function(a,b){return a+b.collapsedWidth},0);var k=j.reduce(function(b,c){return c.width<c.minWidth&&(c.width=c.minWidth),c.index in a?b:b+c.width},0);for(b=j.length;b--;)j[b].ratio=j[b].width/k;var l=0,m=[],n=0;for(b=i.length,c=0;b>c;c++){if(c in a)i[c].width=a[c];else if(i[c].isCollapsed)i[c].width=i[c].collapsedWidth;else{var o=i[c].ratio*f;o<i[c].minWidth?(n+=o-i[c].minWidth,i[c].width=i[c].minWidth):(i[c].width=o,m.push(i[c]))}i[c].left=l,l+=i[c].width}for(var p,q;0>n;){for(p=0,q=0,l=0,c=0;c<m.length;c++)q+=m[c].width;for(m=m.filter(function(a){a.ratio=a.width/q;var b=a.width+a.ratio*n;return b<a.minWidth?(p+=b-a.minWidth,a.width=a.minWidth,!1):(a.width=b,!0)}),c=0;c<i.length;c++)i[c].left=l,l+=i[c].width;n=p}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest()},e.tryToResizeCouples=function(a,b){var c,e,f,g=i[a];if(g.isCollapsed){if(!(a+1<i.length)||i[a+1].isCollapsed)return!1;for(c=a-1;c>=0;c--)if(!i[c].isCollapsed){g=i[c],a=c;break}if(0>c)return!1}var h=!0;if(a<i.length-1){for(c=a+1;c<i.length;c++)if(!i[c].isCollapsed){h=!1;break}if(h)return!1}if(0>b){if(e=g.width-Math.max(g.minWidth,g.width+b),g.width=Math.max(g.minWidth,g.width+b),e>0){for(f=g.left,c=a+1;c<i.length;c++){if(!i[c].isCollapsed){i[c].width=i[c].width+e,i[c].left=i[c-1].left+i[c-1].width;break}i[c].left=f+i[c-1].width}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!0}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!1}if(i.length>a+1){var j;for(c=a+1;c<i.length;c++)if(!i[c].isCollapsed){j=c;break}var k=i[j];if(e=k.width-Math.max(k.minWidth,k.width-b),k.width=Math.max(k.minWidth,k.width-b),e>0){for(g.width=g.width+e,f=g.left+g.width,c=a+1;j>c;c++)i[c].left=f,f+=i[c].width;if(k.left=f,!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!0}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!1}},e.addContent=function(a,b,c){for(var d in i)if(i[d].paneltitle===a)return e.log("Adding tab "+b+" to existing panel "+a),void i[d].addContent(b,c);var f={tabName:b,tabTemplate:c};a in h.panelsContent?h.panelsContent[a].push(f):h.panelsContent[a]=[f],e.log("Added tab "+b+" to non-existing panel "+a+": for later use.")},e.log("Service run"),e}]),angular.module("Pundit2.Dashboard").directive("dashboardPanel",function(){return{restrict:"E",transclude:!0,scope:{paneltitle:"@"},templateUrl:"src/Dashboard/DashboardPanel.dir.tmpl.html",controller:"DashboardPanelCtrl"}}),angular.module("Pundit2.Dashboard").controller("DashboardPanelCtrl",["$document","$window","$scope","$rootScope","$element","$timeout","Dashboard",function(a,b,c,d,e,f,g){c.collapsedWidth=g.options.panelCollapseWidth,c.bottom=g.options.footerHeight,c.minWidth=100,c.ratio=1,c.isCollapsed=!1,c.left=0,c.width=200,c.tabs=[],c.$watch(function(){return c.tabs.activeTab},function(){f(function(){c.setTabContentHeight()},30)}),c.toggleCollapse=function(){if(c.isCollapsed){c.isCollapsed=!c.isCollapsed;var a={};a[c.index]=c.minWidth,g.resizeAll(a)}else g.canCollapsePanel()&&(c.isCollapsed=!c.isCollapsed,g.resizeAll())},c.addContent=function(a,b){c.tabs.push({title:a,template:b}),g.log("Added content "+a+" to panel "+c.title)};var h,i=function(a){var b,d=a.pageX-h;0!==d&&(b=g.tryToResizeCouples(c.index,d),b&&(h=a.pageX))},j=function(){a.off("mousemove",i),a.off("mouseup",j)};c.mouseDownHandler=function(b){b.preventDefault(),h=b.pageX,a.on("mousemove",i),a.on("mouseup",j)},c.$watch(function(){return g.getContainerHeight()},function(){c.setTabContentHeight()}),c.setTabContentHeight=function(){var a=g.getContainerHeight(),b=angular.element(e).find(".pnd-inner .pnd-tab-content"),c=angular.element(e).find(".pnd-inner-scrollable"),d=angular.element(e).find(".pnd-inner-scrollable.pnd-inner-no-tabs");a-=g.options.panelTabsHeight,a-=g.options.panelContentHeaderHeight,a-=g.options.panelFooterHeight,a-=g.options.footerHeight,b.length>0&&(a-=g.options.panelInnerTabsHeight,b.height(a-1)),c.length>0&&c.height(a-7),d.length>0&&(a+=g.options.panelContentHeaderHeight,d.height(a-9))};var k,l=function(){a.off("mousemove",m),a.off("mouseup",l)},m=function(a){var b=a.pageY-k;g.increaseContainerHeight(b)&&(k=a.pageY)};c.footerMouseDownHandler=function(b){1===b.which&&(b.preventDefault(),a.on("mouseup",l),a.on("mousemove",m),k=b.pageY)},g.addPanel(c),d.$$phase||c.$digest(),g.log("Panel "+c.title+" Controller Run")}]),angular.module("Pundit2.Dashboard").directive("pndTabs",function(){return{restrict:"EAC",scope:!0,templateUrl:"src/Dashboard/pndTabs.dir.tmpl.html",controller:"pndTabsCtrl"}}),angular.module("Pundit2.Dashboard").controller("pndTabsCtrl",["$document","$window","$rootScope","$scope","$element","Dashboard","ResourcePanel",function(a,b,c,d,e,f,g){var h={animation:"am-fade",offsetButton:40};d.hiddenTabsDropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",h.animation&&e.addClass(h.animation),d.panes=null,d.hiddenTabs=[],d.$watch("tabs",function(a){if(!angular.equals(a,d.panes)){d.panes=angular.copy(a);for(var b in d.panes)d.panes[b].isVisible=!0}},!0);var i=0,j=!1;d.$watch(function(){return angular.element(e).children("ul.pnd-tab-header").children("li:not(.pull-right)").length},function(a){a>0&&(i=a,j=!0,m())});var k=0,l=angular.element(e).children("ul.pnd-tab-header");d.$watch(function(){return l.width()},function(a){k=parseInt(a,10),m(),d.hiddenTabIsActive=-1===p()?!1:!0});var m=function(){i>0&&k>0&&(j&&(j=!1,n()),o(k))},n=function(){for(var a=angular.element(e).children("ul.pnd-tab-header").children("li:not(.pull-right)"),b=0;b<a.length;b++){var c=parseInt(angular.element(a[b]).css("width"),10);d.panes[b].width=c}},o=function(a){d.hiddenTabs=[];for(var b,c,e,f=a-h.offsetButton,g=0,i=0;i<d.panes.length;i++){if(b=d.panes[i],e=g+b.width,e>f){c=i;break}g=e}for(i=0;i<d.panes.length;i++)if(b=d.panes[i],c>i||"undefined"==typeof c)b.isVisible=!0;else{b.isVisible=!1;var j={text:b.title,click:"setActive("+i+", $event)"};j.isActive=i===d.tabs.activeTab?!0:!1,d.hiddenTabs.push(j)}},p=function(a){var b;if("undefined"==typeof d.hiddenTabs)return-1;if(0===d.hiddenTabs.length)return-1;if("undefined"==typeof d.tabs.activeTab)return-1;if(""===a||"undefined"==typeof a){var c=d.tabs.activeTab;b=d.panes[c]}else b=a;for(var e=0;e<d.hiddenTabs.length;e++)if(d.hiddenTabs[e].text===b.title)return e;return-1};e.addClass("tabs"),d.active=d.activePane=0,c.$on("pnd-dashboard-show-tab",function(a,b){for(var c=0;c<d.panes.length;c++)if(d.panes[c].title===b)return d.active!==c&&d.setActive(c),void(d.$parent.isCollapsed&&d.$parent.toggleCollapse())}),d.setActive=function(a){if(g.hide(),0!==d.hiddenTabs.length)for(var b=0;b<d.hiddenTabs.length;b++)d.hiddenTabs[b].isActive=!1;if(d.active=a,d.tabs.activeTab=a,d.panes[a].isVisible)d.hiddenTabIsActive=!1;else{d.hiddenTabIsActive=!0;var c=p(d.panes[a]);d.hiddenTabs[c].isActive=!0}};var q=!1;d.$watch(function(){return d.hiddenTabs},function(){q=d.hiddenTabs.length>0}),d.hiddenTabsToShow=function(){return q}}]),angular.module("Pundit2.ContextualMenu",[]),angular.module("Pundit2.ContextualMenu").constant("CONTEXTUALMENUDEFAULTS",{position:"bottom-left",debug:!1}).service("ContextualMenu",["$rootScope","BaseComponent","CONTEXTUALMENUDEFAULTS","$dropdown","$window",function(a,b,c,d,e){var f=new b("ContextualMenu",c),g={menu:null,menuElements:[],menuResource:null,menuType:null,lastX:0,lastY:0,anchor:null,content:null,mockMenu:null};angular.element("[data-ng-app='Pundit2']").prepend("<div class='pnd-dropdown-contextual-menu-anchor' style='position: absolute; left: -500px; top: -500px;'><div>"),g.anchor=angular.element(".pnd-dropdown-contextual-menu-anchor");var h={scope:a.$new()},i={scope:a.$new()},j=function(a,b){return a.scope.content=g.content,a.placement="undefined"!=typeof b?b:f.options.position,a.template="src/ContextualMenu/dropdown.tmpl.html",d(g.anchor,a)};return f.getState=function(){return g},f.buildContent=function(){var a=[],b=g.menuElements.filter(function(a){return a.type.indexOf(g.menuType)>-1});b.sort(function(a,b){return b.priority-a.priority});for(var c in b)b[c].showIf(g.menuResource)&&a.push(b[c].submenu?{text:b[c].label,submenu:!0,hover:b[c].hover,leave:b[c].leave}:b[c].divider?{divider:!0}:{text:b[c].label,header:b[c].header?!0:!1,click:function(a){return function(){b[a].action(g.menuResource)}}(c)});var d=0;a.some(function(a,b){return"undefined"==typeof a.divider?(d=b,!0):void 0}),a.splice(0,d);for(var e=a.length-1;e>=0&&"undefined"!=typeof a[e].divider;e--)a.pop();return f.log("buildContent built "+a.length+" elements for type="+g.menuType),a},f.position=function(a,b,c){var d,f=a.outerWidth(),g=a.outerHeight();return d=c+g>angular.element(e).innerHeight()?"top":"bottom",d+=b+f>angular.element(e).innerWidth()?"-right":"-left"},f.show=function(a,b,c,d){return null!==g.menu&&(g.menu.hide(),g.menu.destroy(),g.menu=null),0===g.menuElements.length?void f.err("Cannot show a contextual menu without any element!!"):"undefined"==typeof c?void f.err("Try to show menu without resource for type "+d):(g.menuResource=c,g.menuType=d,g.content=f.buildContent(),0===g.content.length?void f.err("Tried to show menu for type "+d+" without any content (buildContent fail)"):(f.log("Showing menu for type="+d+" at "+a+","+b),g.lastX=a,g.lastY=b,g.mockMenu=j(i),void g.mockMenu.$promise.then(g.mockMenu.show)))},i.scope.$on("tooltip.show",function(){var a=f.position(angular.element(g.mockMenu.$element),g.lastX,g.lastY);g.anchor.css({left:g.lastX,top:g.lastY}),angular.element(g.mockMenu.$element).remove(),g.menu=j(h,a),g.menu.$promise.then(g.menu.show)}),f.hide=function(){null!==g.menu&&(g.menu.hide(),g.menu.destroy(),g.menu=null)},f.addAction=function(a){var b=g.menuElements.some(function(b){return a.name===b.name});return b?(f.err("Not adding duplicated action "+a.name),!1):(g.menuElements.push(angular.copy(a)),f.log("Added action "+a.name+" for types "+a.type),!0)},f.removeActionByName=function(a){var b,c;return g.menuElements.some(function(d,e){a===d.name&&(b=d,c=e)}),"undefined"!=typeof b?(g.menuElements.splice(c,1),f.log("Remove action "+b.name+" for types "+b.type),!0):(f.err("Action "+a+" not found"),!1)},f.wipeActionsByType=function(a){g.menuElements=g.menuElements.filter(function(b,c){return a===g.menuElements[c].type?!1:!0})},f.modifyHeaderActionByName=function(a,b){var c,d;return g.menuElements.some(function(b,e){a===b.name&&(c=b,d=e)}),"undefined"!=typeof c?(g.menuElements[d].header=b,f.log("Disactive "+c.name),!0):(f.err("Action "+a+" not found"),!1)},f.addSubMenu=function(a){var b=g.menuElements.some(function(b){return angular.equals(a.name,b.name)});if(b)return f.err("Try to add duplicated submenu element"),!1;var c=angular.copy(a);return c.submenu=!0,g.menuElements.push(c),!0},f.addDivider=function(a){var b=angular.copy(a);b.divider=!0,b.showIf=function(){return!0},g.menuElements.push(b)},f.getSubMenuPlacement=function(){var a=h.placement.indexOf("-"),b=h.placement.substring(a+1);return"right"===b?"left":"right"},f.log("service run"),f}]),angular.module("Pundit2.PageItemsContainer",[]),angular.module("Pundit2.PageItemsContainer").directive("pageItemsContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",controller:"PageItemsContainerCtrl"}}),angular.module("Pundit2.PageItemsContainer").controller("PageItemsContainerCtrl",["$scope","$element","PageItemsContainer","ItemsExchange","Preview","TypesHelper",function(a,b,c,d,e,f){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.itemMenuType=c.options.cMenuType;var g=angular.element(b).find(".page-items-btn-order");a.message={flag:!0,text:"No page items found."};var h=c.options.order;a.reverse=c.options.reverse,a.tabs=[{title:"All Items",template:"src/Lists/itemList.tmpl.html",filterFunction:function(){return!0}},{title:"Text",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isTextFragment()}},{title:"Images",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isImage()||a.isImageFragment()}},{title:"Entities",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isEntity()}},{title:"Pages",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isWebPage()}}],a.tabs.activeTab=c.options.initialActiveTab;var i=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label Asc",click:function(){h="label",a.reverse=!1,i(0)},isActive:"label"===h&&a.reverse===!1},{text:"Label Desc",click:function(){h="label",a.reverse=!0,i(1)},isActive:"label"===h&&a.reverse===!0},{text:"Type Asc",click:function(){a.dropdownOrdering[2].disable||(h="type",a.reverse=!1,i(2))},isActive:"type"===h&&a.reverse===!1},{text:"Type Desc",click:function(){a.dropdownOrdering[3].disable||(h="type",a.reverse=!0,i(3))},isActive:"type"===h&&a.reverse===!0}];var j=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===h?j(a.label):"type"===h?j(f.getLabel(a.type[0])):void 0};var k=function(b){b=b.toLowerCase().replace(/\s+/g," ");var d=b.split(" "),e=new RegExp(d.join(".*"));a.displayedItems=c.getItemsArrays()[a.tabs.activeTab].filter(function(a){return null!==a.label.toLowerCase().match(e)}),a.message.text=""===b?"No page items found.":"No item found to: "+b};a.$watch(function(){return a.tabs.activeTab},function(b){a.displayedItems=c.getItemsArrays()[b],a.tabs[b].title!==a.tabs[0].title&&a.tabs[b].title!==a.tabs[3].title?(a.dropdownOrdering[2].disable=!0,a.dropdownOrdering[3].disable=!0):(a.dropdownOrdering[2].disable=!1,a.dropdownOrdering[3].disable=!1),"undefined"!=typeof a.displayedItems&&"undefined"!=typeof a.search.term&&k(a.search.term)}),a.search={icon:c.options.inputIconSearch,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=c.options.inputIconSearch):a.search.icon=c.options.inputIconClear,k(b))}),a.$watch(function(){return d.getItemsByContainer(c.options.container)},function(b){a.displayedItems=c.buildItemsArray(a.tabs.activeTab,a.tabs,b)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,g.addClass("disabled")):(a.message.flag=!1,g.removeClass("disabled"))})}]),angular.module("Pundit2.PageItemsContainer").constant("PAGEITEMSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Page Items",initialActiveTab:0,cMenuType:"pageItems",order:"label",reverse:!1,container:"pageItems",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("PageItemsContainer",["PAGEITEMSCONTAINERDEFAULTS","BaseComponent",function(a,b){var c=new b("PageItemsContainer",a),d=[];return c.buildItemsArray=function(a,b,c){for(var e=0;e<b.length;e++)angular.isObject(b[e])&&"undefined"!=typeof b[e].filterFunction&&(d[e]=c.filter(function(a){return b[e].filterFunction(a)}));return d[a]},c.getItemsArrays=function(){return d},c}]),angular.module("Pundit2.MyNotebooksContainer",[]),angular.module("Pundit2.MyNotebooksContainer").directive("myNotebooksContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",controller:"MyNotebooksContainerCtrl"}}),angular.module("Pundit2.MyNotebooksContainer").controller("MyNotebooksContainerCtrl",["$scope","$rootScope","$element","MyNotebooksContainer","NotebookExchange","NotebookComposer",function(a,b,c,d,e,f){var g="pnd-icon-search",h="pnd-icon-times",i=[];a.displayedNotebook=i,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var j=angular.element(c).find(".my-notebooks-btn-order");a.notebookMenuType=d.options.cMenuType,a.message={flag:!0,text:"No notebooks found."};var k="label";a.reverse=!1;var l=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label Asc",click:function(){k="label",a.reverse=!1,l(0)},isActive:"label"===k&&a.reverse===!1},{text:"Label Desc",click:function(){k="label",a.reverse=!0,l(1)},isActive:"label"===k&&a.reverse===!0}];var m=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return m(a.label)},a.createNewNotebook=function(){b.$emit("pnd-dashboard-show-tab",f.options.clientDashboardTabTitle),f.setNotebookToEdit(null)};var n=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedNotebook=i.filter(function(a){return null!==a.label.toLowerCase().match(d)}),a.message.text=""===b?"No notebook found.":"No notebook found to: "+b};a.search={icon:g,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedNotebook&&("undefined"==typeof b||""===b?(b="",a.search.icon=g):a.search.icon=h,n(b))}),a.$watch(function(){return e.getMyNotebooks()},function(b){i=b,n(a.search.term)},!0),a.$watch(function(){return a.displayedNotebook.length},function(b){0===b?(a.message.flag=!0,j.addClass("disabled")):(a.message.flag=!1,j.removeClass("disabled"))})}]),angular.module("Pundit2.MyNotebooksContainer").constant("MYNOTEBOOKSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"My Notebooks",cMenuType:"myNotebooks",container:"myNotebooks",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("MyNotebooksContainer",["$rootScope","MYNOTEBOOKSCONTAINERDEFAULTS","BaseComponent","NotebookExchange","ItemsExchange","PageItemsContainer","AnnotationsExchange","NotebookCommunication","Consolidation","ContextualMenu","Dashboard","NotebookComposer","AnnotationsCommunication","$modal","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=new c("MyNotebooksContainer",b),q=function(){var b=[p.options.cMenuType];j.addAction({name:"setAsPrivate",type:b,label:"Set Notebook as Private",priority:100,showIf:function(a){return"public"===a.visibility},action:function(a){h.setPrivate(a.id)}}),j.addAction({name:"setAsPublic",type:b,label:"Set Notebook as Public",priority:100,showIf:function(a){return"private"===a.visibility},action:function(a){h.setPublic(a.id)}}),j.addAction({name:"setAsCurrent",type:b,label:"Set Notebook as Current",priority:100,showIf:function(a){return!a.isCurrent()},action:function(a){h.setCurrent(a.id)}}),j.addAction({name:"deleteNotebook",type:b,label:"Delete Notebook",priority:100,showIf:function(a){return!a.isCurrent()},action:function(a){t(a)}}),j.addAction({name:"editNotebook",type:b,label:"Edit Notebook",priority:101,showIf:function(){return!0},action:function(b){k.isDashboardVisible()||k.toggle(),a.$emit("pnd-dashboard-show-tab",l.options.clientDashboardTabTitle),l.setNotebookToEdit(b)}})};a.$on("pundit-boot-done",function(){q()});var r=a.$new();r.titleMessage="Delete Notebook",r.confirm=function(){h.deleteNotebook(r.notebook.id).then(function(){r.notifyMessage="Notebook "+r.notebook.label+" correctly deleted.",g.wipe(),e.wipeContainer(f.options.container),m.getAnnotations(),o(function(){s.hide()},1e3)},function(){r.notifyMessage="Error impossible to delete this notebook, please retry.",o(function(){s.hide()},1e3)})},r.cancel=function(){s.hide()};var s=n({container:"[data-ng-app='Pundit2']",template:"src/Core/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:r}),t=function(a){r.notifyMessage="Are you sure you want to delete this notebook? will also remove all the annotation contained in it.",r.notebook=a,s.$promise.then(s.show)};return p}]),angular.module("Pundit2.Item",[]),angular.module("Pundit2.Item").directive("item",function(){return{restrict:"E",scope:{uri:"@",menuType:"@",isSelected:"@",hideOptions:"@",hideStickyButton:"@",useInKorbo:"@"},templateUrl:function(a,b){return b.useInKorbo?"src/Item/KorboItem.dir.tmpl.html":"src/Item/Item.dir.tmpl.html"},controller:"ItemCtrl"}}),angular.module("Pundit2.Item").controller("ItemCtrl",["$scope","ItemsExchange","TypesHelper","Preview","ContextualMenu",function(a,b,c,d,e){a.item=b.getItemByUri(a.uri),a.item.type.length>0&&(a.itemTypeLabel=c.getLabel(a.item.type[0])),a.onItemMouseOver=function(){d.showDashboardPreview(a.item)},a.onItemMouseLeave=function(){d.hideDashboardPreview()},a.isSticky=function(){return d.isStickyItem(a.item)},a.onClickSticky=function(b){return d.isStickyItem(a.item)?d.clearItemDashboardSticky():d.setItemDashboardSticky(a.item),b.preventDefault(),b.stopPropagation(),!1},a.onClickMenu=function(b){return e.show(b.pageX,b.pageY,a.item,a.menuType),b.preventDefault(),b.stopPropagation(),!1},a.isItemSelected=function(){return a.isSelected===!1||"undefined"==typeof a.isSelected?!1:!0}}]),angular.module("Pundit2.Notebook",[]),angular.module("Pundit2.Notebook").directive("notebook",function(){return{restrict:"E",scope:{nid:"@",menuType:"@"},templateUrl:"src/Notebook/Notebook.dir.tmpl.html",controller:"NotebookCtrl"}}),angular.module("Pundit2.Notebook").controller("NotebookCtrl",["$scope","NotebookExchange","Preview","ContextualMenu",function(a,b,c,d){a.notebook=b.getNotebookById(a.nid),a.onItemMouseOver=function(){c.showDashboardPreview(a.notebook)},a.onItemMouseLeave=function(){c.hideDashboardPreview()},a.isSticky=function(){return c.isStickyItem(a.notebook)},a.onClickSticky=function(b){return c.isStickyItem(a.notebook)?c.clearItemDashboardSticky():c.setItemDashboardSticky(a.notebook),b.preventDefault(),b.stopPropagation(),!1},a.onClickMenu=function(b){return d.show(b.pageX,b.pageY,a.notebook,a.menuType),b.preventDefault(),b.stopPropagation(),!1}}]),angular.module("Pundit2.MyItemsContainer",[]),angular.module("Pundit2.MyItemsContainer").directive("myItemsContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",controller:"MyItemsContainerCtrl"}}),angular.module("Pundit2.MyItemsContainer").controller("MyItemsContainerCtrl",["$scope","$rootScope","$modal","$timeout","$element","MyItemsContainer","ItemsExchange","MyItems","MyPundit","Preview","TypesHelper",function(a,b,c,d,e,f,g,h,i,j,k){a.itemMenuType=f.options.cMenuType,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var l=angular.element(e).find(".my-items-btn-delete"),m=angular.element(e).find(".my-items-btn-order");a.message={flag:!0,text:"No my items found."},a.$watch(function(){return i.isUserLogged()},function(b){a.message.text=b?"No my items found.":"Please login to see your items."});var n=f.options.order;a.reverse=f.options.reverse,a.tabs=[{title:"All Items",template:"src/Lists/itemList.tmpl.html",filterFunction:function(){return!0}},{title:"Text",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isTextFragment()}},{title:"Images",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isImage()||a.isImageFragment()}},{title:"Entities",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isEntity()}},{title:"Pages",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isWebPage()}}],a.tabs.activeTab=f.options.initialActiveTab;var o=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label Asc",click:function(){n="label",a.reverse=!1,o(0)},isActive:"label"===n&&a.reverse===!1},{text:"Label Desc",click:function(){n="label",a.reverse=!0,o(1)},isActive:"label"===n&&a.reverse===!0},{text:"Type Asc",click:function(){a.dropdownOrdering[2].disable||(n="type",a.reverse=!1,o(2))},isActive:"type"===n&&a.reverse===!1},{text:"Type Desc",click:function(){a.dropdownOrdering[3].disable||(n="type",a.reverse=!0,o(3))},isActive:"type"===n&&a.reverse===!0}];var p=function(a){return a.replace(/ /g,"")
};a.getOrderProperty=function(a){return"label"===n?p(a.label):"type"===n?p(k.getLabel(a.type[0])):void 0},a.onClickDeleteAllMyItems=function(){t()},a.$watch(function(){return a.tabs.activeTab},function(b){a.displayedItems=f.getItemsArrays()[b],a.tabs[b].title!==a.tabs[0].title&&a.tabs[b].title!==a.tabs[3].title?(a.dropdownOrdering[2].disable=!0,a.dropdownOrdering[3].disable=!0):(a.dropdownOrdering[2].disable=!1,a.dropdownOrdering[3].disable=!1),"undefined"!=typeof a.displayedItems&&"undefined"!=typeof a.search.term&&q(a.search.term)});var q=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedItems=f.getItemsArrays()[a.tabs.activeTab].filter(function(a){return null!==a.label.toLowerCase().match(d)}),a.message.text=""===b?i.isUserLogged()?"No my items found.":"Please login to see your items.":"No item found to: "+b};a.search={icon:f.options.inputIconSearch,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=f.options.inputIconSearch):a.search.icon=f.options.inputIconClear,q(b))}),a.$watch(function(){return g.getItemsByContainer(h.options.container)},function(b){a.displayedItems=f.buildItemsArray(a.tabs.activeTab,a.tabs,b)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,l.addClass("disabled"),m.addClass("disabled")):(a.message.flag=!1,l.removeClass("disabled"),m.removeClass("disabled"))});var r=b.$new();r.titleMessage="Delete All My Items",r.confirm=function(){i.isUserLogged()&&h.deleteAllItems().then(function(){r.notifyMessage="Success, my items correctly deleted."},function(){r.notifyMessage="Error impossible to delete my items, please retry."}),d(function(){s.hide()},1e3)},r.cancel=function(){s.hide()};var s=c({container:"[data-ng-app='Pundit2']",template:"src/Core/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:r}),t=function(){r.notifyMessage="Are you sure you want to delete all my items? After you can no longer recover.",s.$promise.then(s.show)}}]),angular.module("Pundit2.MyItemsContainer").constant("MYITEMSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"My Items",initialActiveTab:0,cMenuType:"myItems",order:"label",reverse:!1,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("MyItemsContainer",["MYITEMSCONTAINERDEFAULTS","BaseComponent",function(a,b){var c=new b("MyItemsContainer",a),d=[];return c.buildItemsArray=function(a,b,c){for(var e=0;e<b.length;e++)angular.isObject(b[e])&&"undefined"!=typeof b[e].filterFunction&&(d[e]=c.filter(function(a){return b[e].filterFunction(a)}));return d[a]},c.getItemsArrays=function(){return d},c}]),angular.module("Pundit2.MyItemsContainer").constant("MYITEMSDEFAULTS",{apiPreferencesKey:"favorites",container:"myItems",debug:!1}).service("MyItems",["MYITEMSDEFAULTS","BaseComponent","NameSpace","Item","ItemsExchange","ContextualMenu","MyPundit","Config","Consolidation","Toolbar","$http","$rootScope","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new b("MyItems",a),o=function(){var a=[h.modules.TextFragmentHandler.cMenuType,h.modules.PageItemsContainer.cMenuType,h.modules.MyItemsContainer.cMenuType,h.modules.TextFragmentAnnotator.cMenuType,h.modules.ImageHandler.cMenuType,h.modules.SelectorsManager.cMenuType];f.addDivider({priority:99,type:a}),f.addAction({name:"addToMyItems",type:a,label:"Add to My Items",priority:100,showIf:function(a){return g.isUserLogged()&&!e.isItemInContainer(a,n.options.container)},action:function(a){return n.addItem(a).then(function(){i.consolidateAll()}),!0}}),f.addAction({name:"removeFromMyItems",type:a,label:"Remove from My Items",priority:100,showIf:function(a){return g.isUserLogged()&&e.isItemInContainer(a,n.options.container)},action:function(a){return n.deleteItem(a).then(function(){i.consolidateAll()}),!0}})};return l.$on("pundit-boot-done",function(){o()}),n.getAllItems=function(){var a;k({headers:{Accept:"application/json"},method:"GET",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0}).success(function(b){var c=0;if("undefined"==typeof b)return void n.log("Undefined Server response");if("undefined"!=typeof b.redirectTo)return void n.log("Get all my items on server produce a redirect response to: ",b);for(var f in b.value)c++,b.value[f].rdftype&&(delete b.value[f].type,delete b.value[f].rdfData,delete b.value[f].favorite,b.value[f].type=b.value[f].rdftype,delete b.value[f].rdftype,b.value[f].uri=b.value[f].value,delete b.value[f].value),a=new d(b.value[f].uri,b.value[f]),e.addItemToContainer(a,n.options.container);n.log("Retrieved my items from the server: "+c+" items")}).error(function(a){n.log("Http error while retrieving my items from the server: ",a)})},n.deleteAllItems=function(){var a=new Date,b=m.defer();return j.setLoading(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:[],created:a.getTime()})}).success(function(a){return j.setLoading(!1),"undefined"!=typeof a.redirectTo?void n.log("Deleted all my items on server produce a redirect response to: ",a):(e.wipeContainer(n.options.container),b.resolve(),i.consolidateAll(),void n.log("Deleted all my items on server",a))}).error(function(a){j.setLoading(!1),n.err("Cant delete my items on server: ",a),b.reject()}),b.promise},n.deleteItem=function(a){var b=new Date,d=e.getItemsByContainer(n.options.container),f=d.indexOf(a),g=angular.copy(d),h=m.defer();return f>-1&&g.splice(f,1),j.setLoading(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:g,created:b.getTime()})}).success(function(b){return"undefined"!=typeof b.redirectTo?void n.log("Deleted single my item on server produce a redirect response to: ",b):(e.removeItemFromContainer(a,n.options.container),h.resolve(),j.setLoading(!1),void n.log("Deleted from my item: "+a.label))}).error(function(a){h.reject(),j.setLoading(!1),n.err("Cant delete a my item on the server: ",a)}),h.promise},n.addItem=function(a){var b=new Date,d=angular.copy(e.getItemsByContainer(n.options.container)),f=m.defer();return d.push(a),j.setLoading(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:d,created:b.getTime()})}).success(function(b){return"undefined"!=typeof b.redirectTo?void n.log("Add single item to my items on server produce a redirect response to: ",b):(e.addItemToContainer(a,n.options.container),f.resolve(),j.setLoading(!1),void n.log("Added item to my items: "+a.label))}).error(function(a){f.reject(),j.setLoading(!1),n.err("Cant add item to my items on the server: ",a)}),f.promise},n}]),angular.module("Pundit2.Vocabularies",[]),angular.module("Pundit2.Vocabularies").constant("FREEBASESELECTORDEFAULTS",{freebaseSearchURL:"https://www.googleapis.com/freebase/v1/search",freebaseSchemaBaseURL:"http://www.freebase.com/schema",freebaseImagesBaseURL:"https://usercontent.googleapis.com/freebase/v1/image",freebaseTopicURL:"https://www.googleapis.com/freebase/v1/topic",freebaseMQLReadURL:"https://www.googleapis.com/freebase/v1/mqlread",freebaseItemsBaseURL:"http://www.freebase.com",freebaseAPIKey:"AIzaSyCJjAj7Nd2wKsZ8d7XQ9ZvUwN5SF0tZBsE",active:!0,limit:15,instances:[{container:"freebase",label:"Freebase",active:!0}],debug:!1}).factory("FreebaseSelector",["BaseComponent","FREEBASESELECTORDEFAULTS","TypesHelper","SelectorsManager","Item","ItemsExchange","$http","$q",function(a,b,c,d,e,f,g,h){var i=new a("FreebaseSelector",b);i.name="FreebaseSelector",i.options.active&&d.addSelector(i);var j=function(a){this.config=a};return j.prototype.getItems=function(a){var b=this,c=h.defer(),d=b.config.container+a.split(" ").join("$");return g({method:"GET",url:i.options.freebaseSearchURL,params:{key:i.options.freebaseAPIKey,query:a,limit:i.options.limit}}).success(function(a){if(i.log("Http success, get items from freebase",a),0===a.result.length)return i.log("Http success, but get empty result"),f.wipeContainer(d),void c.resolve();var g=[],j=[],k=[];for(var l in a.result){var m={label:a.result[l].name,mid:a.result[l].mid,image:i.options.freebaseImagesBaseURL+a.result[l].mid,description:-1,uri:-1};k.push(m);var n=h.defer();g.push(n.promise),j.push(n)}for(h.all(g).then(function(){for(i.log("Completed all items http request (topic and mql)"),f.wipeContainer(d),l=0;l<k.length;l++)f.addItemToContainer(new e(k[l].uri,k[l]),d);c.resolve()}),l=0;l<k.length;l++)b.getItemDetails(k[l],j[l])}).error(function(a){i.err("Cant get items from freebase: ",a),c.resolve()}),c.promise},j.prototype.getItemDetails=function(a,b){var d=0;g({method:"GET",url:i.options.freebaseMQLReadURL,params:{key:i.options.freebaseAPIKey,query:{id:null,mid:a.mid,type:[{}]}}}).success(function(d){a.uri=i.options.freebaseItemsBaseURL+d.result.mid,a.type=[],i.log("Http success, get MQL from freebase"+a.uri);for(var e=d.result.type.length;e--;){var f=d.result.type[e],g=i.options.freebaseSchemaBaseURL+f.id;a.type.push(g),c.add(g,f.name)}-1!==a.description&&(i.log("MQL was last, complete for item "+a.uri),delete a.mid,b.resolve(a))}).error(function(c){i.err("Cant get MQL from freebase: ",c),(-1!==a.description||d>0)&&b.resolve(a),d++}),g({method:"GET",url:i.options.freebaseTopicURL+a.mid,params:{key:i.options.freebaseAPIKey,filter:"/common/topic/description"}}).success(function(c){i.log("Http success, get TOPIC from freebase"+a.uri),a.description="undefined"!=typeof c.property&&c.property["/common/topic/description"].values.length>0?c.property["/common/topic/description"].values[0].value:a.label,-1!==a.uri&&(i.log("TOPIC was last, complete http for item "+a.uri),delete a.mid,b.resolve(a))}).error(function(c){i.err("Cant get TOPIC from freebase: ",c),(-1!==a.uri||d>0)&&b.resolve(a),d++})},i.log("Factory init"),j}]),angular.module("Pundit2.Vocabularies").constant("MURUCASELECTORDEFAULTS",{murucaReconURL:"http://demo2.galassiaariosto.netseven.it/backend.php/reconcile",queryProperties:{},active:!0,limit:5,instances:[{queryType:"http://purl.org/galassiariosto/types/Azione",container:"muruca",label:"Muruca",active:!0}],debug:!1}).factory("MurucaSelector",["BaseComponent","MURUCASELECTORDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("MurucaSelector",b);h.name="MurucaSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){var b=this,c=g.defer(),e=b.config.container+a.split(" ").join("$"),i={params:{query:{query:a,type:b.config.queryType,properties:h.options.queryProperties,limit:h.options.limit}}};return f.jsonp(h.options.murucaReconURL+"?jsonp=JSON_CALLBACK",i).success(function(a){h.log("Http success, get items from muruca "+b.config.label,a),d.wipeContainer(e),0===a.result.length?(h.log("Empty Response"),c.resolve()):b.getItemsDetails(a.result,c,e)}).error(function(){d.wipeContainer(e),c.resolve()}),c.promise},i.prototype.getItemsDetails=function(a,b,e){for(var f=0;f<a.length;f++){var g=a[f],i={label:g.name,uri:g.resource_url,type:[]};if(h.log("Loading metadata for item "+i.uri),"description"in g&&(i.description=g.description),"type"in g&&"length"in g.type)for(var j=g.type.length;j--;)"string"==typeof g.type[j]?i.type.push(g.type[j]):h.log("ERROR: Weird type is weird? "+typeof g.type[j]+": "+g.type[j]);var k=new c(i.uri,i);d.addItemToContainer(k,e)}b.resolve(),h.log("Complete items parsing")},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("KORBOBASKETSELECTORDEFAULTS",{korboBasketReconURL:"http://manager.korbo.org/api.php/basket/reconcile/",korboBasketMetadataURL:"http://manager.korbo.org/",korboItemsBaseURL:"http://purl.org/net7/korbo",korboSchemaBaseURL:"http://purl.org/net7/korbo/type/",baskets:[16],active:!0,limit:15,instances:[{container:"korboBasket",label:"KorboBasket",active:!0}],debug:!1}).factory("KorboBasketSelector",["BaseComponent","KORBOBASKETSELECTORDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("KorboBasketSelector",b);h.name="KorboBasketSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={params:{query:{query:a,limit:h.options.limit}},withCredentials:!0};return f.jsonp(h.options.korboBasketReconURL+h.options.baskets[0]+"?jsonp=JSON_CALLBACK",j).success(function(a){if(h.log("Http success, get items "+b.config.label,a),0===a.result.length)return h.log("Http success, but empty response"),d.wipeContainer(i),void e.resolve();for(var f=[],j=[],k=[],l=0;l<a.result.length;l++){var m=a.result[l],n={label:m.name,uri:m.resource_url,type:[]};k.push(n);var o=g.defer();f.push(o.promise),j.push(o)}for(g.all(f).then(function(){for(h.log("Completed all items http request"),d.wipeContainer(i),l=0;l<k.length;l++)d.addItemToContainer(new c(k[l].uri,k[l]),i);e.resolve()}),l=0;l<a.result.length;l++)b.getItemDetails(k[l],j[l])}).error(function(){e.resolve()}),e.promise},i.prototype.getItemDetails=function(a,b){h.log("Loading metadata for item "+a.uri);var c={params:{url:a.uri},withCredentials:!0};f.jsonp(h.options.korboBasketMetadataURL+h.options.baskets[0]+"?jsonp=JSON_CALLBACK",c).success(function(c){h.log("Http item details success, get item",c);var d=c.result;if("image"in d&&(a.image=d.image),"description"in d&&(a.description=d.description),"rdftype"in d&&"length"in d.rdftype)for(var e=d.rdftype.length;e--;)"string"==typeof d.rdftype[e]?a.type.push(d.rdftype[e]):h.log("ERROR: Weird type is weird? "+typeof d.rdftype[e]+": "+d.rdftype[e]);b.resolve()}).error(function(){b.resolve()})},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("KORBO2DEFAULTS",{active:!0,limit:15,instances:[{container:"korbo2",label:"Korbo2",active:!0,basketID:null,url:"http://dev.korbo2.org/v1",language:"en"}],debug:!1}).factory("Korbo2Selector",["BaseComponent","KORBO2DEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("Korbo2Selector",b);h.name="Korbo2Selector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={q:a,p:"korbo",limit:h.options.limit,offset:0,lang:b.config.language};return null!==b.config.basketID&&(j.basketId=b.config.basketID),f({method:"GET",url:b.config.url+"/search/items",cache:!1,params:j}).success(function(a){if(h.log("Http success, get items "+b.config.label,a.data),0===a.data.length)return h.log("Empty response"),d.wipeContainer(i),void e.resolve();d.wipeContainer(i);for(var f=0;f<a.data.length;f++){var g=a.data[f],j={label:g.label,uri:g.uri,type:g.type};""!==g.depiction&&(j.image=g.depiction),""!==g.abstract&&(j.description=g.abstract),d.addItemToContainer(new c(j.uri,j),i)}e.resolve()}).error(function(){h.log("Http Error"),e.resolve()}),e.promise},i.prototype.push=function(a){h.options.instances.push(a)},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("SELECTORMANAGERDEFAULTS",{clientDashboardTemplate:"src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Vocab",cMenuType:"vocabItems",debug:!1,order:"label",reverse:!1,initialActiveTab:0,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("SelectorsManager",["BaseComponent","SELECTORMANAGERDEFAULTS","ItemsExchange","$injector","$q",function(a,b,c,d,e){var f=new a("SelectorsManager",b),g={},h=[],i={},j=function(a){f.log("Wipe all containers that match "+a);for(var b in h){var d=h[b].config.container+a;c.wipeContainer(d)}};return f.getItems=function(a,b){var c=e.defer(),d=h.length,f=a.split(" ").join("$");"undefined"==typeof i[f]?i[f]=[b]:i[f].push(b),b.then(function(){var a=b,c=i[f].indexOf(a);c>-1&&(i[f].splice(c,1),0===i[f].length&&(j(f),delete i[f]))});for(var g in h)h[g].getItems(a).then(function(){d--,0>=d&&null!==c&&(c.resolve(),c=null)});return c.promise},f.init=function(){h=[];for(var a in g){var b=d.get(g[a].name);for(var c in g[a].options.instances){var e=new b(g[a].options.instances[c]);h.push(e)}}f.log("Init, add selectors instances",h)},f.addSelector=function(a){g[a.name]=a,f.log("Add selector ",a.name)},f.getActiveSelectors=function(){return h},f}]),angular.module("Pundit2.Vocabularies").directive("vocabulariesContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",controller:"VocabulariesContainerCtrl"}}),angular.module("Pundit2.Vocabularies").controller("VocabulariesContainerCtrl",["$scope","$timeout","$injector","$element","$q","BaseComponent","SelectorsManager","ItemsExchange","TypesHelper",function(a,b,c,d,e,f,g,h,i){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var j=angular.element(d).find(".vocab-items-btn-order");a.message={flag:!0,text:"Enter text to search in the vocabularies."},a.itemMenuType=g.options.cMenuType;var k=g.options.order;a.reverse=g.options.reverse,a.tabs=[];var l=g.getActiveSelectors();for(var m in l)a.tabs.push({title:l[m].config.label,template:"src/Lists/itemList.tmpl.html",itemsContainer:l[m].config.container});a.tabs.activeTab=g.options.initialActiveTab;var n=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label Asc",click:function(){k="label",a.reverse=!1,n(0)},isActive:"label"===k&&a.reverse===!1},{text:"Label Desc",click:function(){k="label",a.reverse=!0,n(1)},isActive:"label"===k&&a.reverse===!0},{text:"Type Asc",click:function(){k="type",a.reverse=!1,n(2)},isActive:"type"===k&&a.reverse===!1},{text:"Type Desc",click:function(){k="type",a.reverse=!0,n(3)},isActive:"type"===k&&a.reverse===!0}];var o=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===k?o(a.label):"type"===k?o(i.getLabel(a.type[0])):void 0},a.search={icon:g.options.inputIconSearch,term:""};var p;a.$watch(function(){return a.search.term},function(c){return"undefined"==typeof c||""===c?(c="",a.search.icon=g.options.inputIconSearch,void b.cancel(p)):(a.search.icon=g.options.inputIconClear,b.cancel(p),void(p=b(function(){t()},500)))}),a.displayedItems=[];var q,r=function(){0===a.displayedItems.length&&""!==a.search.term&&"undefined"!=typeof a.search.term&&(a.message.text="No item found to: "+a.search.term)},s=null,t=function(){null!==s&&s.resolve(),s=e.defer(),g.getItems(a.search.term,s.promise).then(function(){r()},function(){r()}),q=a.tabs[a.tabs.activeTab].itemsContainer+a.search.term.split(" ").join("$")};a.$watch(function(){return h.getItemsByContainer(q)},function(b){a.displayedItems=b,0===a.displayedItems.length?(a.message.flag=!0,j.addClass("disabled")):(a.message.flag=!1,j.removeClass("disabled"))},!0),a.$watch(function(){return a.tabs.activeTab},function(b,c){b!==c&&(q=a.tabs[a.tabs.activeTab].itemsContainer+a.search.term.split(" ").join("$"),r())})}]),angular.module("Pundit2.TripleComposer",[]),angular.module("Pundit2.TripleComposer").directive("tripleComposer",function(){return{restrict:"E",scope:{},templateUrl:"src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",controller:"TripleComposerCtrl"}}),angular.module("Pundit2.TripleComposer").controller("TripleComposerCtrl",["$rootScope","$scope","$http","$q","$timeout","NameSpace","MyPundit","Toolbar","TripleComposer","AnnotationsCommunication","AnnotationsExchange","TemplatesExchange",function(a,b,c,d,e,f,g,h,i,j,k,l){b.statements=i.getStatements(),b.saving=!1,b.textMessage=i.options.savingMsg,b.headerMessage="Create New Annotation",b.editMode=!1,b.$watch(function(){return i.isEditMode()},function(a){b.headerMessage=a?"Edit and update your Annotation":"Create New Annotation",b.editMode=a}),b.templateMode;var m;b.$watch(function(){return h.isActiveTemplateMode()},function(a,c){b.templateMode=a,a?(m=b.headerMessage,b.headerMessage="Complete your Annotation and Save!"):a!==c&&(b.headerMessage=m)});var n="Loading",o="Saved",p="Warning!",q="pnd-icon-refresh pnd-icon-spin",r="pnd-icon-check-circle",s="pnd-icon-exclamation-circle",t="pnd-message",u="pnd-message-success",v="pnd-message-warning";b.shortMessagge=n,b.savingIcon=q,b.shortMessageClass=t,this.removeStatement=function(a){a=parseInt(a,10),i.removeStatement(a),i.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled")},this.addStatementScope=function(a,b){a=parseInt(a,10),i.addStatementScope(a,b)},this.duplicateStatement=function(a){a=parseInt(a,10),i.duplicateStatement(a)},this.isAnnotationComplete=function(){i.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled")},this.isTripleErasable=function(){i.isTripleErasable()},b.onClickAddStatement=function(){angular.element(".pnd-triplecomposer-save").addClass("disabled"),i.addStatement()},b.cancel=function(){b.editMode&&(i.reset(),i.setEditMode(!1))},b.editAnnotation=function(){var a=i.getEditAnnID();if("undefined"!=typeof a){var b=y();angular.element(".pnd-triplecomposer-cancel").addClass("disabled"),j.editAnnotation(a,i.buildGraph(),i.buildItems(),i.buildTargets()).then(function(){z(b,i.options.notificationSuccessMsg,i.options.notificationMsgTime,!1)},function(){z(b,i.options.notificationErrorMsg,i.options.notificationMsgTime,!0)})}};var w,x=function(a,c,d){b.textMessage=a,d?(b.shortMessagge=p,b.savingIcon=s,b.shortMessageClass=v):(b.shortMessagge=o,b.savingIcon=r,b.shortMessageClass=u),e(function(){i.setEditMode(!1),angular.element(".pnd-triplecomposer-cancel").removeClass("disabled"),b.saving=!1,i.updateVisibility()},c)},y=function(){return angular.element(".pnd-triplecomposer-save").addClass("disabled"),b.textMessage=i.options.savingMsg,b.shortMessagge=n,b.savingIcon=q,b.shortMessageClass=t,w=!1,b.saving=!0,e(function(){w=!0},i.options.savingMsgTime)},z=function(a,c,d,e){return w?x(c,d,e):a.then(function(){x(c,d,e)}),b.templateMode?void i.wipeNotFixedItems():void i.reset()};b.saveAnnotation=function(){var a=d.defer();return g.login().then(function(c){if(c){var d=b.statements.some(function(a){var b=a.scope.get();return!a.scope.isMandatory||null!==b.subject&&null!==b.predicate&&null!==b.object?void 0:!0});if(d)return void a.reject();var e,f=y();e=b.templateMode?j.saveAnnotation(i.buildGraph(),i.buildItems(),i.buildTargets(),l.getCurrent().id):j.saveAnnotation(i.buildGraph(),i.buildItems(),i.buildTargets()),e.then(function(){z(f,i.options.notificationSuccessMsg,i.options.notificationMsgTime,!1),a.resolve()},function(){z(f,i.options.notificationErrorMsg,i.options.notificationMsgTime,!0),a.resolve()})}}),a.promise},a.$on("pnd-save-annotation",function(){var a=b.statements.some(function(a){var b=a.scope.get();return null===b.subject||null===b.predicate||null===b.object?!0:void 0});a?i.openTripleComposer():b.saveAnnotation().catch(function(){i.openTripleComposer()})})}]),angular.module("Pundit2.TripleComposer").constant("TRIPLECOMPOSERDEFAULTS",{clientDashboardTemplate:"src/Tools/TripleComposer/ClientTripleComposer.tmpl.html",clientDashboardPanel:"tools",clientDashboardTabTitle:"Statements Composer",savingMsg:"We are saving your annotation",savingMsgTime:1250,notificationSuccessMsg:"Your annotation has been saved successfully",notificationErrorMsg:"We were unable to save your annotation",notificationMsgTime:1500,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("TripleComposer",["$rootScope","BaseComponent","TRIPLECOMPOSERDEFAULTS","TypesHelper","NameSpace","Config","AnnotationsExchange","ItemsExchange","Dashboard","ContextualMenu","TemplatesExchange",function(a,b,c,d,e,f,g,h,i,j,k){var l,m=new b("TripleComposer",c),n=1,o=[{id:n}],p=!1,q=!1,r=function(){j.addAction({type:[f.modules.PageItemsContainer.cMenuType,f.modules.MyItemsContainer.cMenuType,f.modules.SelectorsManager.cMenuType,f.modules.TextFragmentHandler.cMenuType,f.modules.TextFragmentAnnotator.cMenuType,f.modules.ImageHandler.cMenuType],name:"useAsSubject",label:"Use as Subject",showIf:function(a){return m.canAddItemAsSubject(a)},priority:101,action:function(a){m.addToSubject(a)}}),j.addAction({type:[f.modules.PageItemsContainer.cMenuType,f.modules.MyItemsContainer.cMenuType,f.modules.SelectorsManager.cMenuType,f.modules.TextFragmentHandler.cMenuType,f.modules.TextFragmentAnnotator.cMenuType,f.modules.ImageHandler.cMenuType],name:"useAsObject",label:"Use as Object",showIf:function(a){return m.canAddItemAsObject(a)},priority:100,action:function(a){m.addToObject(a)}})};return a.$on("pundit-boot-done",function(){r()}),m.getStatements=function(){return o},m.isEditMode=function(){return p},m.closeAfterOp=function(){q=!0},m.updateVisibility=function(){q&&i.isDashboardVisible()&&i.toggle(),q=!1},m.getEditAnnID=function(){return l},m.setEditMode=function(a){p=a;for(var b in o)"undefined"!=typeof o[b].scope&&(o[b].scope.editMode=a)},m.addStatement=function(){n+=1;var a=o.push({id:n});return o[a-1]},m.removeStatement=function(a){if(1===o.length)return void o[0].scope.wipe();var b=-1;o.some(function(c,d){return c.id===a?(b=d,!0):void 0}),b>-1&&o.splice(b,1),1===o.length&&o[0].scope.isStatementEmpty()&&(o[0].scope.isDeleteDisabled=!0),m.log("Try to remove statement at index",b)},m.reset=function(){n=1,o.splice(0,o.length),o.push({id:n}),m.log("statements reset",o)},m.wipeNotFixedItems=function(){for(var a in o)o[a].scope.subjectFixed||o[a].scope.wipeSubject(),o[a].scope.predicateFixed||o[a].scope.wipePredicate(),o[a].scope.objectFixed||o[a].scope.wipeObject();m.log("Wiped not fixed items.")},m.addStatementScope=function(a,b){var c=-1;o.some(function(b,d){return b.id===a?(c=d,!0):void 0}),c>-1&&(b.editMode=p,o[c].scope=b),o.length>1&&(o[0].scope.isDeleteDisabled=!1),m.log("statement extended with scope",o[c])},m.duplicateStatement=function(a){var b=-1;o.some(function(c,d){return c.id===a?(b=d,!0):void 0}),b>-1&&(n+=1,o.push({id:n,scope:{duplicated:o[b].scope.copy()}})),o.length>1&&(o[0].scope.isDeleteDisabled=!1)},m.canAddItemAsSubject=function(a){var b=-1;if(o.some(function(a,c){return a.scope.subjectFound?void 0:(b=c,!0)}),-1===b)return!1;var c=!1,d=o[b].scope.get().predicate;return null===d||0===d.domain.length?!0:(a.type.some(function(a){return d.domain.indexOf(a)>-1?c=!0:void 0}),m.log(c?"Predicate domain match.":"Impossible to add item as Subject: predicate domain not match"),c)},m.canAddItemAsObject=function(a){var b=-1;if(o.some(function(a,c){return a.scope.objectFound?void 0:(b=c,!0)}),-1===b)return!1;var c=!1,d=o[b].scope.get().predicate;return null===d||0===d.range.length?!0:(a.type.some(function(a){return d.range.indexOf(a)>-1?c=!0:void 0}),m.log(c?"Predicate range match.":"Impossible to add item as Object: predicate range not match"),c)},m.openTripleComposer=function(){i.isDashboardVisible()||i.toggle(),a.$$phase||a.$digest(),a.$emit("pnd-dashboard-show-tab",m.options.clientDashboardTabTitle)},m.addToObject=function(b){m.closeAfterOp(),m.openTripleComposer();for(var c in o)if(!o[c].scope.objectFound)return o[c].scope.setObject(b),a.$$phase||a.$digest(),void m.log("Add item as object: "+b.label);m.log("Error: impossible to add object (all full)")},m.addToSubject=function(b){m.closeAfterOp(),m.openTripleComposer();for(var c in o)if(!o[c].scope.subjectFound)return o[c].scope.setSubject(b),a.$$phase||a.$digest(),void m.log("Add item as subject: "+b.label);m.log("Error: impossible to add subject (all full)")},m.addToAllSubject=function(b){for(var c in o)o[c].scope.setSubject(b);a.$$phase||a.$digest(),m.log("Add item: "+b.uri+"as subject of all triples")},m.isAnnotationComplete=function(){var a=!0;return o.some(function(b){return b.scope.isMandatory&&!b.scope.isStatementComplete()?(a=!1,!0):void 0}),a},m.isTripleErasable=function(){1===o.length&&(o[0].scope.isDeleteDisabled=o[0].scope.isStatementEmpty()?!0:!1)},m.showCurrentTemplate=function(){m.reset();var b,c=k.getCurrent();if("undefined"!=typeof c){for(b=1;b<c.triples.length;b++)m.addStatement();var d=a.$watch(function(){return o[c.triples.length-1].scope},function(a){if("undefined"!=typeof a){for(m.log("Now the last statement is populated with relative scope"),b=0;b<o.length;b++){var e=c.triples[b];"undefined"!=typeof e.predicate&&o[b].scope.setPredicate(e.predicate,!0),"undefined"!=typeof e.subject&&o[b].scope.setSubject(e.subject.value,!0),"undefined"!=typeof e.object&&o[b].scope.setObject(e.object.value,!0),"undefined"!=typeof e.mandatory&&(o[b].scope.isMandatory=e.mandatory),m.log("New statement populated with",e)}d()}});m.log("Showed template: "+c.label)}},m.editAnnotation=function(b){m.reset(),l=b;var c,d=g.getAnnotationById(b),e=[];for(var f in d.graph)for(var i in d.graph[f])for(var j in d.graph[f][i])e.push({subject:f,predicate:i,object:d.graph[f][i][j]});var k=e.length;for(c=0;k-1>c;c++)m.addStatement();var n=a.$watch(function(){return o[k-1].scope},function(a){if("undefined"!=typeof a){for(m.log("Now the last statement is populated with relative scope"),c=0;c<o.length;c++)o[c].scope.setSubject(h.getItemByUri(e[c].subject)),o[c].scope.setPredicate(h.getItemByUri(e[c].predicate)),"uri"===e[c].object.type?o[c].scope.setObject(h.getItemByUri(e[c].object.value)):"literal"===e[c].object.type?o[c].scope.setObject(e[c].object.value):m.log("Try to add incompatible type of object",e[c].object),m.setEditMode(!0),m.log("New statement populated with",e[c]);n()}})},m.buildItems=function(){var a,b={};return o.forEach(function(c){var f=c.scope.get();null!==f.subject&&null!==f.predicate&&null!==f.object&&("undefined"!=typeof f.subject.polygon&&"undefined"!=typeof f.subject.polygonUri&&(b[f.subject.polygonUri]={},b[f.subject.polygonUri][e.item.type]=[{type:"uri",value:e.selectors.polygonType}],a={type:"polygon",points:f.subject.polygon},b[f.subject.polygonUri][e.rdf.value]=[{type:"literal",value:angular.toJson(a)}]),"undefined"!=typeof f.object.polygon&&"undefined"!=typeof f.object.polygonUri&&(b[f.object.polygonUri]={},b[f.object.polygonUri][e.item.type]=[{type:"uri",value:e.selectors.polygonType}],a={type:"polygon",points:f.object.polygon},b[f.object.polygonUri][e.rdf.value]=[{type:"literal",value:angular.toJson(a)}]),b[f.subject.uri]=f.subject.toRdf(),b[f.predicate.uri]=f.predicate.toRdf(),"undefined"!=typeof f.object.uri&&(b[f.object.uri]=f.object.toRdf(),f.object.type.forEach(function(a,c){var g=f.object.type[c];b[g]={},b[g][e.rdfs.label]=[{type:"literal",value:d.getLabel(a)}]})),f.subject.type.forEach(function(a,c){var g=f.subject.type[c];b[g]={},b[g][e.rdfs.label]=[{type:"literal",value:d.getLabel(a)}]}),f.predicate.type.forEach(function(a,c){var g=f.predicate.type[c];b[g]={},b[g][e.rdfs.label]=[{type:"literal",value:d.getLabel(a)}]}))}),b},m.buildObject=function(a){return"string"==typeof a?{type:"literal",value:a}:{type:"uri",value:a.uri}},m.buildTargets=function(){var a=[];return o.forEach(function(b){var c=b.scope.get();null!==c.subject&&null!==c.predicate&&null!==c.object&&((c.subject.isTextFragment()||c.subject.isImage()||c.subject.isImageFragment())&&-1===a.indexOf(c.subject.uri)&&a.push(c.subject.uri),(c.predicate.isTextFragment()||c.predicate.isImage()||c.predicate.isImageFragment())&&-1===a.indexOf(c.predicate.uri)&&a.push(c.predicate.uri),"string"!=typeof c.object&&(c.object.isTextFragment()||c.object.isImage()||c.object.isImageFragment())&&-1===a.indexOf(c.object.uri)&&a.push(c.object.uri))}),a},m.buildGraph=function(){var a={};return o.forEach(function(b){var c=b.scope.get();if(null!==c.subject&&null!==c.predicate&&null!==c.object)if("undefined"==typeof a[c.subject.uri])a[c.subject.uri]={},a[c.subject.uri][c.predicate.uri]=[m.buildObject(c.object)];
else if("undefined"==typeof a[c.subject.uri][c.predicate.uri])a[c.subject.uri][c.predicate.uri]=[m.buildObject(c.object)];else{var d=c.object.uri,e=a[c.subject.uri][c.predicate.uri],f=e.some(function(a){return angular.equals(a.value,d)});f||e.push(m.buildObject(c.object))}}),a},m}]),angular.module("Pundit2.TripleComposer").directive("statement",function(){return{restrict:"E",scope:{id:"@",duplicated:"="},templateUrl:"src/Tools/TripleComposer/Statement.dir.tmpl.html",controller:"StatementCtrl",require:"^tripleComposer",link:function(a,b,c,d){a.tripleComposerCtrl=d,a.$watch("duplicated",function(b){"undefined"!=typeof b&&a.init()}),d.addStatementScope(a.id,a)}}}),angular.module("Pundit2.TripleComposer").controller("StatementCtrl",["$scope","$element","TypesHelper","ResourcePanel","NameSpace","TripleComposer","Toolbar","Preview",function(a,b,c,d,e,f,g,h){a.subjectLabel="",a.subjectTypeLabel="",a.subjectFound=!1,a.subjectSearch="",a.subjectIcon=f.options.inputIconSearch,a.subjectFixed=!1,a.predicateLabel="",a.predicateFound=!1,a.predicateSearch="",a.predicateIcon=f.options.inputIconSearch,a.predicateFixed=!1,a.objectLabel="",a.objectTypeLabel="",a.objectFound=!1,a.objectSearch="",a.objectIcon=f.options.inputIconSearch,a.objectLiteral=!1,a.objectFixed=!1,a.canBeObjectDate=!0,a.canBeObjectLiteral=!0,a.isDeleteDisabled=f.getStatements().length<2?!0:!1,a.isMandatory=!0,a.templateMode,a.$watch(function(){return g.isActiveTemplateMode()},function(b){a.templateMode=b});var i={subject:null,predicate:null,object:null},j=function(){var a=[];return a.push(null!==i.subject?i.subject.uri:""),a.push(null!==i.predicate?i.predicate.uri:""),a.push(null!==i.object?i.object.uri:""),a};a.isStatementComplete=function(){return null!==i.subject&&null!==i.predicate&&null!==i.object?!0:!1},a.isStatementEmpty=function(){return null!==i.subject||null!==i.predicate||null!==i.object?!1:!0},a.remove=function(){d.hide(),a.tripleComposerCtrl.removeStatement(a.id)},a.duplicate=function(){d.hide(),a.tripleComposerCtrl.duplicateStatement(a.id)},a.copy=function(){var b=angular.copy(i);return a.objectDate&&(b.isDate=!0),a.objectLiteral&&(b.isLiteral=!0),b},a.get=function(){return i},a.init=function(){i=a.duplicated,delete a.duplicated,null!==i.subject&&(a.subjectLabel=i.subject.label,a.subjectTypeLabel=c.getLabel(i.subject.type[0]),a.subjectFound=!0),null!==i.predicate&&(a.predicateLabel=i.predicate.label,a.predicateFound=!0),null!==i.object&&("string"==typeof i.object?(a.objectLabel=i.object,i.isDate&&(a.objectTypeLabel=c.getLabel(e.dateTime)),i.isLiteral&&(a.objectTypeLabel=c.getLabel(e.rdfs.literal))):(a.objectLabel=i.object.label,a.objectTypeLabel=c.getLabel(i.object.type[0])),a.objectFound=!0)},a.wipe=function(){a.wipeSubject(),a.wipePredicate(),a.wipeObject()},a.wipeSubject=function(){a.subjectLabel="",a.subjectTypeLabel="",a.subjectFound=!1,a.subjectSearch="",a.subjectIcon=f.options.inputIconSearch,a.subjectFixed=!1,i.subject=null,d.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.tripleComposerCtrl.isTripleErasable()},a.clearSubjectSearch=function(){""!==a.subjectSearch&&"undefined"!=typeof a.subjectSearch&&(a.subjectSearch="",d.showItemsForSubject(j(),void 0,a.subjectSearch).then(a.setSubject))},a.wipePredicate=function(){a.predicateLabel="",a.predicateFound=!1,a.predicateSearch="",a.predicateIcon=f.options.inputIconSearch,a.canBeObjectDate=!0,a.canBeObjectLiteral=!0,a.predicatetFixed=!1,i.predicate=null,d.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.tripleComposerCtrl.isTripleErasable()},a.clearPredicateSearch=function(){""!==a.predicateSearch&&"undefined"!=typeof a.predicateSearch&&(a.predicateSearch="",d.showProperties(j(),void 0,a.predicateSearch).then(a.setPredicate))},a.wipeObject=function(){a.objectLabel="",a.objectTypeLabel="",a.objectFound=!1,a.objectSearch="",a.objectIcon=f.options.inputIconSearch,a.objectLiteral=!1,a.objectDate=!1,a.objectFixed=!1,i.object=null,d.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.tripleComposerCtrl.isTripleErasable()},a.clearObjectSearch=function(){""!==a.objectSearch&&"undefined"!=typeof a.objectSearch&&(a.objectSearch="",d.showItemsForObject(j(),void 0,a.objectSearch).then(a.setObject))},a.onSubjectMouseOver=function(){h.showDashboardPreview(i.subject)},a.onPredicateMouseOver=function(){h.showDashboardPreview(i.predicate)},a.onObjectMouseOver=function(){a.objectDate||a.objectLiteral||h.showDashboardPreview(i.object)},a.onItemMouseOut=function(){h.hideDashboardPreview()},a.$watch(function(){return a.subjectSearch},function(b){a.subjectIcon="undefined"==typeof b||""===b?f.options.inputIconSearch:f.options.inputIconClear}),a.$watch(function(){return a.predicateSearch},function(b){a.predicateIcon="undefined"==typeof b||""===b?f.options.inputIconSearch:f.options.inputIconClear}),a.$watch(function(){return a.objectSearch},function(b){a.objectIcon="undefined"==typeof b||""===b?f.options.inputIconSearch:f.options.inputIconClear}),a.setSubject=function(b,d){a.subjectLabel=b.label,a.subjectTypeLabel=c.getLabel(b.type[0]),a.subjectFound=!0,i.subject=b,"undefined"!=typeof d&&(a.subjectFixed=d),a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable()},a.onClickSubject=function(b){a.templateMode||d.showItemsForSubject(j(),b.target,a.subjectSearch).then(a.setSubject)},a.onKeyUpSubject=function(b){d.showItemsForSubject(j(),b.target,a.subjectSearch).then(a.setSubject)},a.setPredicate=function(b,c){a.predicateLabel=b.label,a.predicateFound=!0,i.predicate=b,"undefined"!=typeof c&&(a.predicateFixed=c),-1===b.range.indexOf(e.rdfs.literal)&&(a.canBeObjectLiteral=!1),-1===b.range.indexOf(e.dateTime)&&(a.canBeObjectDate=!1),a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable()},a.onClickPredicate=function(b){d.showProperties(j(),b.target,a.predicateSearch).then(a.setPredicate)},a.onKeyUpPredicate=function(b){d.showProperties(j(),b.target,a.predicateSearch).then(a.setPredicate)};var k;a.setObject=function(b,d){a.objectFound=!0,"undefined"!=typeof d&&(a.objectFixed=d),i.object=b,"string"==typeof b?(a.objectLabel=b,a.objectTypeLabel=c.getLabel(e.rdfs.literal),a.objectLiteral=!0):b instanceof Date?(k=b,i.object=l(b),a.objectLabel=i.object,a.objectTypeLabel=c.getLabel(e.dateTime),a.objectDate=!0):(a.objectLabel=b.label,a.objectTypeLabel=c.getLabel(b.type[0])),a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable()},a.onClickObject=function(b){d.showItemsForObject(j(),b.target,a.objectSearch).then(a.setObject)},a.onKeyUpObject=function(b){d.showItemsForObject(j(),b.target,a.objectSearch).then(a.setObject)},a.onClickObjectCalendar=function(b){var f;f=a.objectDate?k:new Date,d.showPopoverCalendar(f,b.target).then(function(b){i.object=l(b),k=b,a.objectLabel=i.object,a.objectTypeLabel=c.getLabel(e.dateTime),a.objectDate=!0,a.objectFound=!0,a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable()})},a.onClickObjectLiteral=function(b){var f="";"string"==typeof i.object&&(f=i.object),d.showPopoverLiteral(f,b.target).then(function(b){a.objectFound=!0,a.objectLabel=b,a.objectTypeLabel=c.getLabel(e.rdfs.literal),a.objectLiteral=!0,i.object=b,a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable()})};var l=function(a){var b=a.getMonth()+1,c=a.getDate();return 10>b&&(b="0"+b),10>c&&(c="0"+c),a.getFullYear()+"-"+b+"-"+c}}]),angular.module("Pundit2.Toolbar",[]),angular.module("Pundit2.Toolbar").config(["$dropdownProvider",function(a){angular.extend(a.defaults,{trigger:"click",html:!0})}]).directive("toolbar",["Toolbar",function(a){return{restrict:"E",scope:{},templateUrl:"src/Toolbar/Toolbar.dir.tmpl.html",link:function(){angular.element("body").addClass(a.options.bodyClass),a.log("Adding "+a.options.bodyClass+" to body element")}}}]),angular.module("Pundit2.Toolbar").controller("ToolbarCtrl",["$scope","$rootScope","$modal","$http","NameSpace","Config","Toolbar","SelectorsManager","Fp3","MyPundit","Dashboard","TripleComposer","AnnotationSidebar","ResourcePanel","NotebookExchange","NotebookCommunication","TemplatesExchange",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.dropdownTemplateMyNotebook="src/Toolbar/myNotebooksDropdown.tmpl.html",a.dropdownTemplateTemplates="src/Toolbar/templatesDropdown.tmpl.html",f.useOnlyTemplateMode&&angular.element(".pnd-toolbar-template-mode-button").addClass("pnd-not-clickable"),a.login=function(){n.hide(),j.login()};var r=function(){n.hide(),j.logout()},s=b.$new(),t=b.$new(),u=c({container:"[data-ng-app='Pundit2']",template:"src/Core/info.modal.tmpl.html",show:!1,backdrop:"static",scope:s}),v=c({container:"[data-ng-app='Pundit2']",template:"src/Core/send.modal.tmpl.html",show:!1,backdrop:"static",scope:t});s.titleMessage="About Pundit",s.info=[{label:"Pundit Version: ",value:PUNDITVERSION.version},{label:"Annotation server URL: ",value:e.as},{label:"Korbo basket: ",value:"-"},{label:"Contact the Pundit team:",value:"punditdev@netseven.it"},{label:"License: ",value:"http://url3.com"},{label:"Credits: ",value:"-"}],s.links=[{label:"Developed by:",linkLabel:"Net7 srl",ref:"http://www.netseven.it"}],"local"!==f.confURL&&s.links.push({label:"Configuration file",linkLabel:f.confURL,ref:f.confURL}),f.vocabularies.length>0?s.info.push({label:"Predicates vocabularies: ",value:f.vocabularies.toString()}):f.useBasicRelations&&s.info.push({label:"Predicates vocabularies: ",value:"Pundit default basic relations"});var w="",x=h.getActiveSelectors();for(var y in x)w+=" "+x[y].config.label;s.info.push({label:"Providers:",value:w}),t.titleMessage="Found a bug? tell us!",t.text={msg:"",subject:""};var z=function(a,b){var c=j.getUserData(),d="mailto:punditbug@netseven.it?cc=&subject="+escape(a)+"&body="+escape(b)+"%0A%0APundit Version: "+PUNDITVERSION.version+"%0A%0AConfiguration file: "+f.confURL+"%0AWeb Page: "+document.URL+"%0ABroswer info: "+window.navigator.userAgent+"%0A%0AUser openid: "+c.openid+"%0AUser uri: "+c.uri+"%0AUser name: "+c.fullName+"%0AUser mail: "+c.email;window.location.href=d};t.send=function(){z(t.text.subject,t.text.msg),v.hide()},t.cancel=function(){v.hide()},s.send=function(){v.$promise.then(function(){t.text.msg="",t.text.subject="",v.show();var b=angular.element(".pnd-send-modal-send");a.$watch(function(){return t.text.subject},function(a){a.length>2?b.removeClass("disabled"):b.addClass("disabled")},!0)})},s.close=function(){u.hide()};var A=function(){u.$promise.then(u.show)},B=function(){s.send()};a.errorMessageDropdown=g.getErrorMessageDropdown(),a.userNotLoggedDropdown=[{text:"Please sign in to use Pundit",header:!0},{text:"Sign in",click:a.login}],a.infoDropdown=[{text:"About Pundit",click:A},{text:"Report a bug",click:B}],i.options.active&&a.infoDropdown.push({text:i.options.label,click:i.post}),a.userLoggedInDropdown=[{text:"Log out",click:r}];var C;a.$watch(function(){return o.getMyNotebooks()},function(a){C=a,D()},!0),a.currentNotebookLabel="Loading...",a.$watch(function(){return o.getCurrentNotebooks()},function(b){"undefined"!=typeof b&&(D(),a.currentNotebookLabel=b.label)}),a.userNotebooksDropdown=[{text:"Please select notebook you want to use",header:!0}];var D=function(){for(var b=C,c=1,d=0;d<b.length;d++)a.userNotebooksDropdown[c]={text:b[d].label,currentNotebook:function(){var a=o.getCurrentNotebooks();return"undefined"!=typeof a&&b[d].id===a.id?!0:!1}(),visibility:b[d].visibility,click:function(a){return function(){p.setCurrent(b[a].id)}}(d)},c++};if(a.useTemplates=f.useTemplates,0===f.templates.length&&(a.useTemplates=!1),a.useTemplates){a.userTemplateDropdown=[{text:"Select the template you wish to use",header:!0}],a.currentTemplateLabel="Loading...",a.$watch(function(){return q.getTemplates().length},function(){G()}),a.$watch(function(){return q.getCurrent()},function(b){"undefined"!=typeof b&&(G(),a.currentTemplateLabel=b.label,a.currentTemplateColor=b.color)});var E=angular.element(".pnd-toolbar-template-mode-button span"),F=angular.element(".pnd-toolbar-template-menu-button span");a.$watch(function(){return g.isActiveTemplateMode()},function(a){a?(E.removeClass("pnd-toolbar-not-active-element"),F.removeClass("pnd-toolbar-not-active-element")):(E.addClass("pnd-toolbar-not-active-element"),F.addClass("pnd-toolbar-not-active-element"))});var G=function(){for(var b=q.getTemplates(),c=1,d=0;d<b.length;d++)a.userTemplateDropdown[c]={text:b[d].label,color:b[d].color,currentTemplate:function(){var a=q.getCurrent();return"undefined"!=typeof a&&b[d].id===a.id?!0:!1}(),click:function(a){return function(){q.setCurrent(b[a].id),g.isActiveTemplateMode()&&(l.showCurrentTemplate(),angular.element(".pnd-triplecomposer-save").addClass("disabled"))}}(d)},c++}}a.userData={},a.$watch(function(){return j.isUserLogged()},function(b){a.isUserLogged=b,a.userData=j.getUserData()}),a.showStatusButtonOk=function(){return!g.getErrorShown()&&!g.isLoading()},a.showStatusButtonError=function(){return g.getErrorShown()},a.showStatusButtonLoading=function(){return g.isLoading()&&!g.getErrorShown()},a.showLogin=function(){return a.isUserLogged===!1},a.showUserButton=function(){return a.isUserLogged===!0},a.isDashboardActive=function(){return a.isUserLogged===!0},a.isAskActive=function(){return a.isUserLogged===!0},a.toggleTemplateMode=function(){n.hide(),g.toggleTemplateMode()},a.onClickTemplateDropdown=function(){n.hide()},a.isTemplateMenuActive=function(){return a.isUserLogged===!0},a.isNotebookMenuActive=function(){return a.isUserLogged===!0},a.getAskLink=function(){return g.getAskLink()},a.dashboardClickHandler=function(){n.hide(),k.toggle()},a.annotationsClickHandler=function(){n.hide(),m.toggle()}}]),angular.module("Pundit2.Toolbar").constant("TOOLBARDEFAULTS",{askLinkDefault:"http://demo-cloud.ask.thepund.it/",askLinkUser:"http://demo-cloud.ask.thepund.it/#/myAsk/",bodyClass:"pnd-toolbar-active",clientDomTemplate:"src/Toolbar/ClientToolbar.tmpl.html",debug:!1}).service("Toolbar",["BaseComponent","TOOLBARDEFAULTS","Config","MyPundit","TripleComposer",function(a,b,c,d,e){var f=new a("Toolbar",b),g=0,h=0,i=!1,j=!1,k=[],l=c.useOnlyTemplateMode;return f.getErrorShown=function(){return j},f.isLoading=function(){return i},f.setLoading=function(a){f.log("Setting loading to "+a),a?(h++,i=!0):(h--,0>=h&&(i=!1,h=0))},f.addError=function(a,b){var c=g,d=function(){f.removeError(c),"function"==typeof b&&""!==b&&b()},e={text:a,click:d,id:c};if(g++,k.push(e),j=!0,0===angular.element(".pnd-toolbar-error-button ul").length){var h=angular.element(".pnd-toolbar-error-button a");h.trigger("click")}return c},f.removeError=function(a){for(var b=0;b<k.length;b++)if(k[b].id===a){k.splice(b,1);break}0===k.length&&(j=!1)},f.getErrorMessageDropdown=function(){return k},f.getAskLink=function(){return d.isUserLogged()?f.options.askLinkUser:f.options.askLinkDefault},f.isActiveTemplateMode=function(){return l},f.toggleTemplateMode=function(){c.useOnlyTemplateMode||(e.reset(),l=!l,l?e.showCurrentTemplate():angular.element(".pnd-triplecomposer-save").addClass("disabled"))},f}]),angular.module("Pundit2.Core").controller("LoginModalCtrl",["$scope","MyPundit",function(a,b){var c={};c.loggedOff="To continue with this operation you must log in.",c.waitingForLogIn="Please complete the process in the login window.",c.loggedIn="You are logged in as: ",a.$watch(function(){return b.getLoginStatus()},function(d){if(a.notifyMessage=c[d],b.isUserLogged()){var e=b.getUserData();a.notifyMessage=c[d]+" "+e.fullName}}),a.loginPopUp=function(){b.openLoginPopUp()},a.logout=function(){b.logout()},a.closeModal=function(){b.closeLoginModal()},a.cancelModal=function(){b.cancelLoginModal()},a.isUserLogged=function(){return b.isUserLogged()}}]),angular.module("Pundit2.Preview",[]),angular.module("Pundit2.Preview").directive("preview",function(){return{restrict:"E",scope:{useInKorbo:"@",isLoading:"@",errorLoading:"@"},templateUrl:"src/Preview/DashboardPreview.dir.tmpl.html",controller:"PreviewCtrl"}}),angular.module("Pundit2.Preview").controller("PreviewCtrl",["$scope","Preview","TypesHelper","$window","Toolbar",function(a,b,c,d,e){a.itemDashboardPreview=null,a.$watch(function(){return b.getItemDashboardPreview()},function(b){a.itemDashboardPreview=b,null===b?(a.hasImage=!1,a.itemIsAnImage=!1):"Notebook"===c.getLabel(b.type[0])?(a.hasImage=!1,a.itemIsAnImage=!1):(a.hasImage="undefined"!=typeof b.image,a.itemIsAnImage=a.itemDashboardPreview.isImage()||a.itemDashboardPreview.isImageFragment())}),a.getWelcomeHeaderMessage=function(){return b.getWelcomeHeaderMessage()},a.getWelcomeBodyMessage=function(){return b.getWelcomeBodyMessage()},a.isItemEmpty=function(){return null===a.itemDashboardPreview},a.isNotebook=function(){return null!==a.itemDashboardPreview&&"http://purl.org/pundit/ont/ao#Notebook"===a.itemDashboardPreview.type[0]?!0:!1},a.isStickyItemEmpty=function(){return null===b.getItemDashboardSticky()},a.isStickyItem=function(){return b.isStickyItem()},a.clearSticky=function(){b.clearItemDashboardSticky()},a.getLabelType=function(a){return c.getLabel(a)},a.openUrl=function(a){d.open(a)},a.openNotebookUrl=function(a){var b=e.options.askLinkDefault+"#/myNotebooks/"+a;d.open(b)},a.getItemIcon=function(){return a.isItemEmpty()?void 0:a.itemDashboardPreview.getIcon()},a.getItemClass=function(){return a.isItemEmpty()?void 0:a.itemDashboardPreview.getClass()}}]),angular.module("Pundit2.Preview").constant("PREVIEWDEFAULTS",{welcomeHeaderMessage:"Welcome in Pundit 2",welcomeBodyMessage:"Enjoy it",clientDashboardTemplate:"src/Preview/ClientDashboardPreview.tmpl.html",clientDashboardPanel:"details",clientDashboardTabTitle:"Preview"}).service("Preview",["BaseComponent","PREVIEWDEFAULTS",function(a,b){var c,d=new a("Preview",b);return c={itemDashboardPreview:null,itemDashboardSticky:null,heigthTypesDiv:null,typesHidden:null},d.getWelcomeHeaderMessage=function(){return d.options.welcomeHeaderMessage},d.getWelcomeBodyMessage=function(){return d.options.welcomeBodyMessage},d.showDashboardPreview=function(a){c.itemDashboardPreview=a},d.getItemDashboardPreview=function(){return c.itemDashboardPreview},d.setItemDashboardSticky=function(a){c.itemDashboardSticky=a},d.getItemDashboardSticky=function(){return c.itemDashboardSticky},d.clearItemDashboardSticky=function(){c.itemDashboardSticky=null,c.itemDashboardPreview=null},d.hideDashboardPreview=function(){c.itemDashboardPreview=null===c.itemDashboardSticky?null:c.itemDashboardSticky},d.isStickyItem=function(a){var b;return b="undefined"!=typeof a?a:c.itemDashboardPreview,null!==c.itemDashboardSticky&&null!==b?c.itemDashboardSticky.uri===b.uri:!1},d}]),angular.module("Pundit2.Preview").directive("itemPreview",function(){return{restrict:"E",scope:{uri:"@",sticking:"=sticking"},templateUrl:"src/Preview/ItemPreview.dir.tmpl.html",controller:"ItemPreviewCtrl"}}),angular.module("Pundit2.Preview").controller("ItemPreviewCtrl",["$scope","$timeout","TypesHelper","ItemsExchange","$element","Preview","ImageFragmentAnnotatorHelper",function(a,b,c,d,e,f,g){var h,i,j=angular.element(e).find(".pnd-annotation-preview-item-container");a.typeHidden=!0,a.isSticky=!1,h="undefined"!=typeof a.sticking?a.sticking:!1,a.getTypeLabel=function(a){return c.getLabel(a)},a.$watch("uri",function(){a.item=d.getItemByUri(a.uri),a.typeHidden=!0,"undefined"!=typeof a.item&&a.item.isImageFragment()&&"undefined"!=typeof a.item.polygon&&b(function(){angular.element(e).find(".pnd-preview-item-image span > svg.pnd-polygon-layer").remove(),g.drawPolygonOverImage(a.item.polygon,i),i=angular.element(e).find(".pnd-preview-item-image > img")},50),h&&(a.isSticky=null!==f.getItemDashboardSticky()&&f.getItemDashboardSticky().uri===a.uri?!0:!1)}),a.$watch(function(){return"undefined"!=typeof i?i.width():void 0},function(b){"undefined"!=typeof b&&(angular.element(e).find(".pnd-preview-item-image span > svg.pnd-polygon-layer").remove(),g.drawPolygonOverImage(a.item.polygon,i))}),a.$watch(function(){return j.find("li.pnd-preview-single-type").css("width")},function(){var b;if(a.isSticky&&h)a.typeHiddenPresent=a.prev;else{b=j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").children("li:not(.pnd-is-sticky)");var c=parseInt(j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").css("width"),10),d=j.find(b[0]).outerHeight(!0),e=j.find("div.pnd-preview-item-types"),f=0;j.find(".pnd-preview-item-image").length>0?f=parseInt(j.find(".pnd-preview-item-image").css("padding-top"),10):j.find(".pnd-preview-item-description").length>0&&(f=parseInt(j.find(".pnd-preview-item-description").css("padding-top"),10));var g=d+f;e.css({height:g}),a.heigthTypesDiv=g,l(b,c)}});var k=j.find("div.pnd-preview");a.$watch(function(){return k.width()},function(){var a=j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").children("li"),b=j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").width();l(a,b)});var l=function(b,c){a.prev=a.typeHiddenPresent;for(var d,e=0,f=30,g=c-f,h=0;h<b.length;h++){if(d=parseInt(j.find(b[h]).css("width"),10)+e,d>g)return a.typeHiddenPresent=!0,!0;e=d}return a.typeHiddenPresent=!1,!1};a.showAlltypes=function(){var b=j.find("div.pnd-preview-item-types"),c=j.find("div.pnd-preview-item-types").height();c===a.heigthTypesDiv?(a.typeHidden=!1,b.css({height:"auto"})):(a.typeHidden=!0,b.css({height:a.heigthTypesDiv}))}}]),angular.module("Pundit2.Preview").directive("notebookPreview",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/Preview/NotebookPreview.dir.tmpl.html",controller:"NotebookPreviewCtrl"}}),angular.module("Pundit2.Preview").controller("NotebookPreviewCtrl",["$scope","NotebookExchange",function(a,b){a.$watch("id",function(){a.notebook=b.getNotebookById(a.id),a.isCurrent=b.getCurrentNotebooks().id===a.notebook.id?!0:!1})}]),angular.module("Pundit2.ResourcePanel",[]),angular.module("Pundit2.ResourcePanel").constant("RESOURCEPANELDEFAULTS",{vocabSearchTimer:1e3,initialCalendarDate:""}).service("ResourcePanel",["BaseComponent","RESOURCEPANELDEFAULTS","ItemsExchange","MyItems","PageItemsContainer","Client","NameSpace","SelectorsManager","$filter","$rootScope","$popover","$q","$timeout","Preview","$window","Config","Item",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=new a("ResourcePanel",b),s={};s.popover=null,s.defaultPlacement="bottom",s.resourcePromise=null,r.hide=function(){null!==s.popover&&(s.popoverOptions.scope.vocabObjRes=[],s.popoverOptions.scope.vocabSubRes=[],s.popoverOptions.scope.label="",s.popover.hide(),s.popover.destroy(),s.popover=null)},s.popoverOptions={scope:j.$new()},s.popoverOptions.trigger="manual";var t=function(a,b,c,d,e){if("calendar"===d)s.popoverOptions.template="src/ResourcePanel/popoverCalendar.tmpl.html",s.popoverOptions.scope.selectedDate="undefined"==typeof a.date||""===a.date?"undefined"==typeof r.options.initialCalendarDate||""===r.options.initialCalendarDate?(new Date).toString():r.options.initialCalendarDate:a.date,s.popoverOptions.scope.save=function(){s.resourcePromise.resolve(new Date(this.selectedDate)),n.hideDashboardPreview(),r.hide()},s.popoverOptions.scope.cancel=function(){n.hideDashboardPreview(),r.hide()};else if("literal"===d)s.popoverOptions.template="src/ResourcePanel/popoverLiteralText.tmpl.html",s.popoverOptions.scope.literalText="undefined"==typeof a.literalText?"":a.literalText,s.popoverOptions.scope.save=function(){s.resourcePromise.resolve(this.literalText),n.hideDashboardPreview(),r.hide()},s.popoverOptions.scope.cancel=function(){n.hideDashboardPreview(),r.hide()};else if("resourcePanel"===d){if("undefined"!=typeof p.korbo&&p.korbo.active){var f=o[p.korbo.confName].globalObjectName;o[f].onSave(function(a){var b={label:a.label,type:a.type};"undefined"!=typeof a.description&&""!==a.description&&(b.description=a.description),"undefined"!=typeof a.image&&""!==a.image&&(b.image=a.image);var c=new q(a.value,b);s.resourcePromise.resolve(c),n.hideDashboardPreview(),r.hide()})}s.popoverOptions.template="src/ResourcePanel/popoverResourcePanel.tmpl.html",s.popoverOptions.scope.originalContent=angular.copy(a),s.popoverOptions.scope.type=a.type,s.popoverOptions.scope.pageItems=a.pageItems,s.popoverOptions.scope.myItems=a.myItems,s.popoverOptions.scope.properties=a.properties,s.popoverOptions.scope.contentTabs=e,""!==a.label&&"undefined"!=typeof a.label?u(a.label):s.popoverOptions.scope.label=a.label,s.popoverOptions.scope.save=function(a){r.hide(),n.hideDashboardPreview(),s.resourcePromise.resolve(a)},s.popoverOptions.scope.cancel=function(){n.hideDashboardPreview(),r.hide()}}s.popoverOptions.placement="undefined"==typeof c||""===c?s.defaultPlacement:c,s.popoverOptions.container="[data-ng-app='Pundit2']";var g=b.getBoundingClientRect().left,h=b.getBoundingClientRect().top,i=angular.element(b).outerHeight(),j=angular.element(b).outerWidth();return angular.element("[data-ng-app='Pundit2']").prepend("<div class='pnd-popover-anchor' style='position: absolute; left: -500px; top: -500px;'><div>"),s.anchor=angular.element(".pnd-popover-anchor"),s.anchor.css({left:g+j/2,top:h+i}),s.popover=k(s.anchor,s.popoverOptions),"calendar"===d&&m(function(){angular.element(s.popover.$element).find(".pnd-input-calendar").triggerHandler("click")},1),s.popover.clickTarget=b,s.popover},u=function(a){s.popoverOptions.scope.label=a,("obj"===s.popoverOptions.scope.type||"sub"===s.popoverOptions.scope.type)&&(s.popoverOptions.scope.myItems=i("filterByLabel")(s.popoverOptions.scope.originalContent.myItems,a),s.popoverOptions.scope.pageItems=i("filterByLabel")(s.popoverOptions.scope.originalContent.pageItems,a)),"pr"===s.popoverOptions.scope.type&&(s.popoverOptions.scope.properties=i("filterByLabel")(s.popoverOptions.scope.originalContent.properties,a))};r.showPopoverLiteral=function(a,b){var c={};return c.literalText=a,null!==s.popover&&s.popover.clickTarget!==b?(r.hide(),s.popover=t(c,b,"","literal"),s.popover.$promise.then(function(){s.popover.show(),angular.element("textarea.pnd-popover-literal-textarea")[0].focus()})):null===s.popover&&(s.popover=t(c,b,"","literal"),s.popover.$promise.then(function(){s.popover.show(),angular.element("textarea.pnd-popover-literal-textarea")[0].focus()})),s.resourcePromise=l.defer(),s.resourcePromise.promise},r.showPopoverCalendar=function(a,b){var c={};return c.date=a,null===s.popover?(s.popover=t(c,b,"","calendar"),s.popover.$promise.then(function(){s.popover.show(),angular.element("input.pnd-input-calendar")[0].focus()})):null!==s.popover&&s.popover.clickTarget!==b&&(r.hide(),s.popover=t("",b,"","calendar"),s.popover.$promise.then(function(){s.popover.show(),angular.element("input.pnd-input-calendar")[0].focus()})),s.resourcePromise=l.defer(),s.resourcePromise.promise};var v,w=function(a,b,c,d,e,f){var g={};g.type=f;var h=[];if("sub"===f||"obj"===f){var i={title:"Page Items",items:b,isStarted:!0};h.push(i),g.pageItems=b;var j={title:"My Items",items:c,isStarted:!0};h.push(j),g.myItems=c,g.properties=null}if("pr"===f){var k={title:"Properties",items:d,isStarted:!0};h.push(k),g.properties=d,g.pageItems=null,g.myItems=null}g.label=e,null===s.popover?(s.popover=t(g,a,"","resourcePanel",h),s.popover.$promise.then(s.popover.show)):null!==s.popover&&s.popover.clickTarget!==a&&(r.hide(),s.popover=t(g,a,"","resourcePanel",h),s.popover.$promise.then(s.popover.show))};r.showItemsForSubject=function(a,b,f){"undefined"==typeof b&&(b=s.popover.clickTarget);var g=h.getActiveSelectors();if(s.popoverOptions.scope.selectors=[],angular.forEach(g,function(a){s.popoverOptions.scope.selectors.push(a.config.container)}),null!==s.popover&&s.popover.clickTarget===b)s.popoverOptions.scope.vocabSubStatus="loading",m.cancel(v),u(f),v=m(function(){x(f,g)},r.options.vocabSearchTimer);else{"undefined"!=typeof f&&""!==f&&(s.popoverOptions.scope.vocabSubStatus="loading",m.cancel(v),v=m(function(){x(f,g)},r.options.vocabSearchTimer));var i,j,k=d.options.container,n=e.options.container;if("undefined"!=typeof a){var o=a[1];if("undefined"==typeof o||""===o)i=c.getItemsByContainer(k),j=c.getItemsByContainer(n);else{var p=c.getItemByUri(o);if("undefined"==typeof p||"undefined"==typeof p.domain||0===p.domain.length||""===p.domain[0])i=c.getItemsByContainer(k),j=c.getItemsByContainer(n);else{var q=p.domain,t=function(a){for(var b=0;b<q.length;b++)for(var c=0;c<a.type.length;c++)if(q[b]===a.type[c])return!0;return!1};i=c.getItemsFromContainerByFilter(k,t),j=c.getItemsFromContainerByFilter(n,t)}}}w(b,j,i,"",f,"sub")}return s.resourcePromise=l.defer(),s.resourcePromise.promise};var x=function(a,b){if(""===a)for(var d=0;d<b.length;d++)!function(a){for(var c=0;c<s.popoverOptions.scope.contentTabs.length;c++)s.popoverOptions.scope.contentTabs[c].title===b[a].config.label&&(s.popoverOptions.scope.contentTabs[c].items=[],s.popoverOptions.scope.contentTabs[c].isLoading=!1,s.popoverOptions.scope.contentTabs[c].isStarted=!1)}(d);else for(var e=0;e<b.length;e++)!function(d){for(var e=0;e<s.popoverOptions.scope.contentTabs.length;e++)s.popoverOptions.scope.contentTabs[e].title===b[d].config.label&&(s.popoverOptions.scope.contentTabs[e].isLoading=!0,s.popoverOptions.scope.contentTabs[e].isStarted=!0);b[d].getItems(a).then(function(){for(var e=0;e<s.popoverOptions.scope.contentTabs.length;e++)if(s.popoverOptions.scope.contentTabs[e].title===b[d].config.label){var f=s.popoverOptions.scope.contentTabs[e].itemsContainer+a.split(" ").join("$");s.popoverOptions.scope.contentTabs[e].items=c.getItemsByContainer(f),s.popoverOptions.scope.contentTabs[e].isLoading=!1}})}(e)};r.showItemsForObject=function(a,b,f){"undefined"==typeof b&&(b=s.popover.clickTarget);var i=h.getActiveSelectors();if(s.popoverOptions.scope.selectors=[],angular.forEach(i,function(a){s.popoverOptions.scope.selectors.push(a.config.container)}),null!==s.popover&&s.popover.clickTarget===b)m.cancel(v),u(f),v=m(function(){x(f,i)},r.options.vocabSearchTimer);else{m.cancel(v),"undefined"!=typeof f&&""!==f&&(m.cancel(v),v=m(function(){x(f,i)},r.options.vocabSearchTimer));var j,k,n=d.options.container,o=e.options.container;if("undefined"!=typeof a){var p=a[1];if("undefined"==typeof p||""===p)j=c.getItemsByContainer(n),k=c.getItemsByContainer(o),w(b,k,j,"",f,"obj");else{var q=c.getItemByUri(p);if("undefined"==typeof q||"undefined"==typeof q.range||0===q.range.length||""===q.range[0])j=c.getItemsByContainer(n),k=c.getItemsByContainer(o),w(b,k,j,"",f,"obj");else if(1===q.range.length&&q.range[0]===g.rdfs.literal)r.showPopoverLiteral("",b);else if(1===q.range.length&&q.range[0]===g.dateTime)r.showPopoverCalendar("",b);else{var t=q.range,y=function(a){for(var b=0;b<t.length;b++)for(var c=0;c<a.type.length;c++)if(t[b]===a.type[c])return!0;return!1};j=c.getItemsFromContainerByFilter(n,y),k=c.getItemsFromContainerByFilter(o,y),w(b,k,j,"",f,"obj")}}}}return s.resourcePromise=l.defer(),s.resourcePromise.promise};var y,z;r.showProperties=function(a,b,d){if("undefined"==typeof b&&(b=s.popover.clickTarget),m.cancel(v),s.popoverOptions.scope.vocabStatus="",s.popoverOptions.scope.vocab=[],null!==s.popover&&s.popover.clickTarget===b)u(d);else{r.hide();var e,g,h,i=f.options.relationsContainer;if("undefined"!=typeof a){var j=a[0],k=a[2];"undefined"!=typeof j&&""!==j||"undefined"!=typeof k&&""!==k?"undefined"==typeof j||""===j||"undefined"!=typeof k&&""!==k?"undefined"==typeof k||""===k||"undefined"!=typeof j&&""!==j?"undefined"!=typeof k&&""!==k&&"undefined"!=typeof j&&""!==j&&(h=c.getItemByUri(k),g=c.getItemByUri(j),"undefined"!=typeof g.type&&0!==g.type.length&&""!==g.type[0]||"undefined"!=typeof h.type&&0!==h.type.length&&""!==h.type[0]?"undefined"!=typeof g.type&&0!==g.type.length&&""!==g.type[0]||"undefined"==typeof h.type||""===h.type[0]?"undefined"==typeof g.type||""===g.type[0]||"undefined"!=typeof h.type&&0!==h.type.length&&""!==h.type[0]?"undefined"!=typeof g.type&&""!==g.type[0]&&"undefined"!=typeof h.type&&""!==h.type[0]&&(z=g.type,y=h.type,e=c.getItemsFromContainerByFilter(i,C),w(b,"","",e,d,"pr")):(z=g.type,e=c.getItemsFromContainerByFilter(i,A),w(b,"","",e,d,"pr")):(y=h.type,e=c.getItemsFromContainerByFilter(i,B),w(b,"","",e,d,"pr")):(e=c.getItemsByContainer(i),w(b,"","",e,d,"pr"))):(h=c.getItemByUri(k),"undefined"==typeof h||"undefined"==typeof h.type||0===h.type.length||""===h.type[0]?(e=c.getItemsByContainer(i),w(b,"","",e,d,"pr")):(y=h.type,e=c.getItemsFromContainerByFilter(i,B),w(b,"","",e,d,"pr"))):(g=c.getItemByUri(j),"undefined"==typeof g||"undefined"==typeof g.type||0===g.type.length||""===g.type[0]?(e=c.getItemsByContainer(i),w(b,"","",e,d,"pr")):(z=g.type,e=c.getItemsFromContainerByFilter(i,A),w(b,"","",e,d,"pr"))):(e=c.getItemsByContainer(i),w(b,"","",e,d,"pr"))
}}return s.resourcePromise=l.defer(),s.resourcePromise.promise};var A=function(a){if("undefined"!=typeof a.domain){for(var b=0;b<z.length;b++)for(var c=0;c<a.domain.length;c++)if(z[b]===a.domain[c])return!0;return!1}return!1},B=function(a){if("undefined"!=typeof a.range){for(var b=0;b<y.length;b++)for(var c=0;c<a.range.length;c++)if(y[b]===a.range[c])return!0;return!1}return!1},C=function(a){var b=B(a)&&A(a);return b};return r}]).filter("filterByLabel",function(){return function(a,b){var c=[];return"undefined"!=typeof b&&""!==b?angular.forEach(a,function(a){var d=a.label,e=b.toLowerCase().replace(/\s+/g," "),f=e.split(" "),g=new RegExp(f.join(".*"));return null!==d.toLowerCase().match(g)?void c.push(a):void 0}):c=a,c}}),angular.module("Pundit2.ResourcePanel").controller("ResourcePanelCtrl",["$rootScope","$scope","MyItems","PageItemsContainer","ItemsExchange","MyPundit","$filter","Client","SelectorsManager","ResourcePanel","Config","$window","KorboCommunicationService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.moduleName="Pundit2";var n;b.contentTabs.activeTab=0;var o=i.getActiveSelectors();if("pr"!==b.type)for(var p=0;p<o.length;p++)b.contentTabs.push({title:o[p].config.label,template:"src/Lists/itemList.tmpl.html",itemsContainer:o[p].config.container,items:[],module:"Pundit2",isStarted:!1});b.$watch(function(){return b.contentTabs.activeTab},function(a,c){a!==c&&(n=b.contentTabs[b.contentTabs.activeTab].itemsContainer+b.label.split(" ").join("$"),b.showUseAndCopyButton())}),a.$watch(function(){return f.isUserLogged()},function(a){b.userLoggedIn=a});var q=function(a){return a.replace(/ /g,"")};b.getOrderProperty=function(a){return q(a.label)};var r=[],s=function(){for(var a=0;a<b.contentTabs.length;a++){var c=b.contentTabs[a].title;r.push("My Items"===c||"Page Items"===c||"Properties"===c?angular.copy(b.contentTabs[a].items):[])}};s(),b.$watch("label",function(a){for(var c=0;c<b.contentTabs.length;c++)"My Items"===b.contentTabs[c].title&&(b.contentTabs[c].items=g("filterByLabel")(r[c],a)),"Page Items"===b.contentTabs[c].title&&(b.contentTabs[c].items=g("filterByLabel")(r[c],a)),"Properties"===b.contentTabs[c].title&&(b.contentTabs[c].items=g("filterByLabel")(r[c],a))}),b.itemSelected=null,b.isUseActive=!1,b.isSelected=function(a){return null!==b.itemSelected&&b.itemSelected.uri===a.uri?!0:!1},b.select=function(a){b.isUseActive=!0,b.itemSelected=a},b.showUseAndCopyButton=function(){var a=b.contentTabs[b.contentTabs.activeTab].title;return k.korbo.active&&"Freebase"===a?!0:!1},b.showNewButton=function(){return"undefined"!=typeof k.korbo&&k.korbo.active&&"pr"!==b.type?!0:!1},b.createNew=function(){var a=l[k.korbo.confName].globalObjectName;l[a].callOpenNew()},b.useAndCopy=function(a){var b=l[k.korbo.confName].globalObjectName;l[b].callCopyAndUse(a)},b.showCopyInEditorButton=function(){var a=b.contentTabs[b.contentTabs.activeTab].title;return k.korbo.active&&"Freebase"===a?!0:!1},b.copyInEditor=function(){var a={};a.uri="__m__"+b.itemSelected.uri.substring(b.itemSelected.uri.lastIndexOf("/")+1),a.providerFrom="freebase",m.setEntityToCopy(a);var c=l[k.korbo.confName].globalObjectName;l[c].callOpenNew()}}]),angular.module("Pundit2.NotebookComposer",[]),angular.module("Pundit2.NotebookComposer").directive("notebookComposer",function(){return{restrict:"E",scope:{},templateUrl:"src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",controller:"NotebookComposerCtrl"}}),angular.module("Pundit2.NotebookComposer").controller("NotebookComposerCtrl",["$scope","NotebookComposer","Toolbar","$timeout","NotebookExchange","NotebookCommunication","$q",function(a,b,c,d,e,f,g){a.notebook={},a.notebook.visibility="public",a.notebook.name="",a.notebook.current=!1,a.editMode=!1,a.notebookComposerHeader="Create your notebook",a.$watch(function(){return b.getNotebookToEdit()},function(b){null!==b?(a.notebookToEdit=b,a.notebook.name=b.label,a.notebook.visibility=b.visibility,a.editMode=!0,e.getCurrentNotebooks().id===b.id?(a.isCurrentNotebook=!0,a.notebook.current=!0):(a.isCurrentNotebook=!1,a.notebook.current=!1),a.notebookComposerHeader="Edit your notebook"):a.clear()}),a.saving=!1,a.textMessage=b.options.savingMsg;var h="Editing",i="Loading",j="Saved",k="Warning!",l="pnd-icon-refresh pnd-icon-spin",m="pnd-icon-check-circle",n="pnd-icon-exclamation-circle",o="pnd-message",p="pnd-message-success",q="pnd-message-warning";a.shortMessagge=i,a.savingIcon=l,a.shortMessageClass=o;var r,s,t=function(e,f,g){a.textMessage=e,g?(a.shortMessagge=k,a.savingIcon=n,a.shortMessageClass=q):(a.shortMessagge=j,a.savingIcon=m,a.shortMessageClass=p),d(function(){a.saving=!1,c.setLoading(!1),a.notebookComposerHeader="Create your notebook",b.setNotebookToEdit(null)},f)};a.save=function(){c.setLoading(!0),a.textMessage=b.options.savingMsg,a.shortMessagge=i,a.savingIcon=l,a.shortMessageClass=o,s=!1,r=d(function(){s=!0},b.options.savingMsgTime),a.saving=!0,b.createNotebook(a.notebook).then(function(){s?(t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()):r.then(function(){t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()})},function(){s?t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0):r.then(function(){t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0)})})},a.edit=function(){var e=[];if(c.setLoading(!0),a.textMessage=b.options.editingMsg,a.shortMessagge=h,a.savingIcon=l,a.shortMessageClass=o,s=!1,r=d(function(){s=!0},b.options.savingMsgTime),a.saving=!0,a.notebookToEdit.label!==a.notebook.name){var i=b.editNotebook(a.notebookToEdit.id,a.notebook.name);e.push(i)}if(a.notebook.current===!0){var j=f.setCurrent(a.notebookToEdit.id);e.push(j)}if(a.notebookToEdit.visibility!==a.notebook.visibility)if("public"===a.notebook.visibility){var k=f.setPublic(a.notebookToEdit.id);e.push(k)}else if("private"===a.notebook.visibility){var m=f.setPrivate(a.notebookToEdit.id);e.push(m)}g.all(e).then(function(){s?(t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()):r.then(function(){t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()})},function(){s?(t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0),a.clear()):r.then(function(){t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0),a.clear()})})},a.clear=function(){a.notebook.name="",a.notebook.visibility="public",a.notebook.current="",a.editMode=!1,a.notebookComposerHeader="Create your notebook",b.setNotebookToEdit(null)}}]),angular.module("Pundit2.NotebookComposer").constant("NOTEBOOKCOMPOSERDEFAULTS",{clientDashboardTemplate:"src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html",clientDashboardPanel:"tools",clientDashboardTabTitle:"Notebooks Composer",savingMsg:"We are saving your notebook",editingMsg:"We are editing your notebook",savingMsgTime:1250,notificationMsgTime:1500,notificationSuccessMsg:"Your notebook has been saved successfully",notificationErrorMsg:"We were unable to save your notebook"}).service("NotebookComposer",["BaseComponent","NotebookExchange","NOTEBOOKCOMPOSERDEFAULTS","$q","NotebookCommunication",function(a,b,c,d,e){var f=new a("NotebookComposer",c);f.createNotebook=function(a){var b=d.defer(),c=[];return e.createNotebook(a.name).then(function(f){if("private"===a.visibility){var g=e.setPrivate(f);c.push(g)}if(a.current===!0){var h=e.setCurrent(f);c.push(h)}d.all(c).then(function(){b.resolve()})},function(){b.reject("created failed")}),b.promise};var g=null;return f.editNotebook=function(a,b){var c=d.defer();return e.setName(a,b).then(function(){c.resolve()},function(){c.reject("edited failed")}),c.promise},f.getNotebookToEdit=function(){return g},f.setNotebookToEdit=function(a){g=a},f}]),angular.module("korboee-templates",["src/KorboEE/Korboee-callback.tmpl.html","src/KorboEE/Korboee-error-config.tmpl.html","src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tmpl.html","src/KorboEE/New/KorboEE.languagesPopover.tmpl.html","src/KorboEE/New/KorboEE.new.tmpl.html","src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html","src/KorboEE/Search/KorboEE.search.tmpl.html","src/KorboEE/Search/KorboEEverticalTabs.tmpl.html","src/KorboEE/autocompleteList.tmpl.html","src/KorboEE/korboee-entity.tmpl.html"]),angular.module("src/KorboEE/Korboee-callback.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-callback.tmpl.html","<!--\nUse only callback mode.\nYou can use API registered on Global Object defined in your configuration\n-->\n\n")}]),angular.module("src/KorboEE/Korboee-error-config.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-error-config.tmpl.html",'<div class="container error-ee-config">\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-globalobject" \n        ng-show="errorType == \'globalObject\'">\n            Configuration Error. Object {{conf.globalObjectName}} existing. Please check your configuration!\n    </div>\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-autocomplete" \n        ng-show="errorType == \'autoComplete\'">\n            CONFIGURATION ERROR. <br> \n            You can choise only one mode: useAutocompleteWithNew or useAutocompleteWithSearch. <br> \n            Please check your configuration!\n    </div>\n</div>')}]),angular.module("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",'<div class="modal kee-wrp pnd-confirm-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-confirm-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-confirm-modal-footer">\n                <button type="button" class="btn btn-default pnd-confirm-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-confirm-modal-confirm" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",'<ul class="nav nav-tabs" ng-hide="editMode">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}">{{pane.title}}<span class="badge pull-right" ng-show="pane.isStarted">{{pane.totalResults}}</span>\n        </a>\n    </li>\n</ul>\n<div class="tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template || \'$pane\'"></div>\n</div>\n')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tmpl.html",'<div class="kee-wrp kee-modal-container modal pnd-ignore" tabindex="-1" role="dialog" ng-controller="KeeModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content kee-modal-content">\n            <div class="modal-body kee-modal-body">\n                <div ng-model="korboModalTabs.activeTab" data-template="src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html" bs-tabs="korboModalTabs"> </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n')}]),angular.module("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",'<div class="pnd-korbo-languages-popover popover">\n    <div ng-repeat="lang in disactiveLanguages" class="kee-popover-item">\n        <div ng-click="addLanguage(lang); $hide()" >\n            <span class="pnd-icon pnd-icon-plus"></span> {{lang.name}} ({{lang.title}})\n        </div>\n    </div>\n</div>')}]),angular.module("src/KorboEE/New/KorboEE.new.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.new.tmpl.html",'<div ng-controller="KeeNewCtrl">\n    <!-- Top area -->\n    <div class="kee-top-area">\n        <div class="kee-top-area-menu pull-right">\n            <button type="button" class="btn btn-xs btn-link" ng-click="showDropdown($event)">\n                <span class="pnd-icon pnd-icon-gear"></span>\n            </button>\n        </div>\n        <div class="kee-top-area-message" ng-class="{\'kee-error\' : topArea.status == \'error\'}">\n            {{topArea.message}}\n        </div>\n    </div> \n    <!-- End top area -->\n\n    <!-- New content -->\n    <div class="kee-new-content" ng-hide="isSaving">\n    \n        <!-- Content on the right -->\n        <div class="kee-right-content" ng-hide="loadingStatus">\n\n            <!-- Original url-->\n            <div class="kee-new-original-url">\n	            <div class="form-group">\n	                <label>Original URL</label>\n	                <div class="left-inner-icon">\n                        <span class="pnd-icon pnd-icon-external-link" ng-click="openWindow(originalUrl);$event.stopPropagation();$event.preventDefault();"></span>\n                        <input \n                            type="text" \n                            class="form-control" \n                            ng-model="originalUrl" \n                            ng-disabled="originalUrlCheck">\n	                </div>\n	            </div>\n            </div>\n            <!-- End original url -->\n\n            <!-- Image url -->\n            <div class="kee-new-image-url">\n\n                <!-- Form group -->\n	            <div class="form-group">\n\n	            	<!-- Preview -->\n	                <div class="kee-preview-image">\n                    	<img ng-show="showImg" ng-src="{{previewImage}}"/>\n                    </div>\n	                <!-- End preview -->\n\n	                <span \n                        ng-show="errorImage" \n                        class="kee-message-error-image">\n                            Impossible to load image\n                    </span>\n                    <span \n                        ng-show="loadingImage" \n                        class="kee-message-loading-image">\n                            Loading image...\n                    </span>\n	                <label>\n                        Image URL\n	                    <span \n                            ng-show="!imageUrlHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="imageUrlHasError" \n                            class="kee-error pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n	                <input \n                        ng-hide="showImg" \n                        type="text" \n                        ng-model="imageUrl" \n                        ng-change="checkUrl()" \n                        class="form-control">\n	                <a \n                        ng-show="showImg" \n                        ng-click="removeImage()" \n                        class="kee-message-remove-image">\n                            Remove image\n                    </a>\n	                <label ng-class="{\'kee-error\' : imageUrlHasError}" />\n	            </div>\n                <!-- End form group -->\n            </div>\n            <!-- End image url -->\n\n            <!-- Types -->\n            <div \n                class="kee-new-types" \n                ng-mouseleave="typesMouseLeave()" \n                ng-mouseenter="typesMouseEnter()">\n            \n                <!-- Form group -->\n	            <div class="form-group">\n    	            <button \n                        type="button" \n                        class="btn btn-xs btn-link pull-right" \n                        ng-show="!activeFilter" \n                        ng-click="activeFilter = !activeFilter">\n                            <span class="pnd-icon pnd-icon-filter"></span>\n                    </button>\n	                <label ng-class="{\'kee-error\' : typesHasError}">                    \n	                    Types\n                        <span class="kee-error"> * </span>\n	                    <span \n                            ng-show="!typesHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{typesTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="typesHasError" \n                            class="pnd-icon pnd-icon-info-circle kee-error" \n                            data-title="{{typesErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n\n                    <div \n                        class="left-inner-icon pull-right" \n                        ng-show="activeFilter">\n                        <span \n                            ng-show="typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-filter" \n                            ng-click="activeFilter = !activeFilter">\n                        </span>\n                        <span \n                            ng-show="!typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-times" \n                            ng-click="typeFilter.label=\'\'">\n                        </span>\n                        <input \n                            ng-show="activeFilter" \n                            type="text" \n                            placeholder="filter types..." \n                            ng-model="typeFilter.label"  \n                            class="form-control">\n                    </div>\n	            </div>\n                <!-- End form group -->\n\n                <!-- Types list -->\n                <div class="kee-list-types">\n                    <ul class="list-group">\n                        <li \n                            ng-repeat="item in types | filter:typeFilter" \n                            class="list-group-item">\n                            	<div \n                                    class="pnd-item" \n                                    ng-class="{\'pnd-sticky-item\': item.checked}" \n                                    ng-click="item.checked = !item.checked; updateTypes()">\n                                        <div class="pnd-item-buttons">\n                                            <span \n                                                class="pnd-icon pnd-icon-check ng-scope"\n                                                ng-show="item.checked">\n                                            </span>\n                                        </div>\n\n                                        <div class="pnd-item-text">\n                                            <span class="pnd-item-label">\n                                                {{item.label}}\n                                            </span>\n                                        </div>\n\n                                        <span \n                                            class="pnd-icon pnd-icon-external-link pull-right" \n                                            ng-click="openWindow(item.URI);$event.stopPropagation();$event.preventDefault();">\n                                        </span>\n                                </div>\n                        </li>\n                    </ul>\n                </div>\n                <button \n                    type="button" \n                    class="btn btn-xs" \n                    ng-click="activeAllTypes()">\n                        Select all types\n                </button>\n                <button \n                    type="button" \n                    class="btn btn-xs" \n                    ng-click="disableAllTypes()">\n                        Deselect all types\n                </button>\n                <!-- End types list -->  \n            </div>\n            <!-- End Types -->\n        </div> \n        <!-- End content on the right -->\n\n        <div class="kee-new-languages">\n            <div kee-languages="tabs"></div>\n            <button \n                class="btn btn-xs btn-link pull-left" \n                ng-class="{true:\'pnd-korboee-btn-not-active\'}[disactiveLanguages.length < 1]"\n                template="{{disactiveLanguagesPopoverTemplate}}" \n                data-animation="am-flip-x" \n                bs-popover \n                ng-disabled="disactiveLanguages.length < 1">\n                    <span class="pnd-icon pnd-icon-plus"></span>\n            </button>\n        </div>\n    </div> \n    <!-- End new content -->\n\n    <div class="kee-new-saving" ng-show="isSaving">\n        Saving...\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="clearForm()">\n                Clear\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="save()">\n                <span ng-if="!editMode">Save and add</span>\n                <span ng-if="editMode">Save</span>\n        </button>\n    </div> \n    <!-- End Footer -->\n</div>')}]),angular.module("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in panes" ng-class="{active: $index == active, \'kee-error\' : panes[$index].hasError}" ng-show="pane.isVisible">\n            <a ng-show="!panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n            <a ng-show="panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="kee-error" bs-tooltip data-title="{{tabs[$index].tooltipMessageErrorTab}}" >{{pane.title}}</span>\n            </a>\n        </li>\n        <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n            <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n        </li>\n    </ul>\n    <!-- tab content-->\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n            <div ng-repeat="pane in tabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n                <!-- entity title -->\n                <div class="kee-title">\n	                <div class="form-group">\n	                <label ng-class="{\'kee-error\' : tabs[$index].hasError}">Title\n	                    <span class="kee-error" ng-class="{\'kee-error\' : tabs[$index].hasError}"> * </span>\n	                    <span ng-show="!tabs[$index].hasError" class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageTitle}}" bs-tooltip></span>\n	                    <span ng-show="tabs[$index].hasError" class="kee-error pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageError}}" bs-tooltip></span>\n	                </label>\n	                <input type="text" ng-model="tabs[$index].label" ng-change = updateTitleField($index) class="form-control">\n	                </div>\n                </div>\n                <!-- end entity title -->\n\n                <!-- entity description -->\n                <div class="form-group">\n	                <div class="kee-description">\n    	                <label>Description <span class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageDescription}}" bs-tooltip></span></label>\n    	                <textarea class="form-control" rows="3" ng-model="tabs[$index].description" class="form-control"></textarea>\n	                </div>\n                </div>\n                <!-- end entity description -->\n            </div>\n\n        </div>\n    </div>\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/Search/KorboEE.search.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEE.search.tmpl.html",'<div class="kee-wrp" ng-controller="KeeSearchCtrl">\n    <!-- Search -->\n    <div class="kee-search">\n            <label>\n                Search entity to use:\n            </label>\n            <div class="left-inner-icon">\n    	        <span \n                    class="pnd-icon pnd-icon-search" \n                    ng-click="search.term = \'\'">\n                </span>\n    	        <input \n                    class="form-control" \n                    type="text" \n                    ng-model="elemToSearch" \n                    placeholder="Type at least {{conf.labelMinLength}} characters...">\n            </div>\n    </div>\n    <!-- // End search -->\n\n    <div>\n        <preview \n            use-in-korbo="true" \n            is-loading="{{previewIsLoading}}" \n            error-loading="{{previewError}}">\n        </preview>\n    </div>\n\n    <div \n        ng-model="contentTabs.activeTab" \n        bs-tabs="contentTabs" \n        data-template = "src/ResourcePanel/verticalTabs.tmpl.html">\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showMoreInfo.visibility" \n            ng-class="{\'disabled\': showMoreInfo.disabled}" \n            ng-click="moreInfo()">\n                More Info\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showCopyInEditor.visibility" \n            ng-class="{\'disabled\': showCopyInEditor.disabled}" \n            ng-click="copyInEditor()">\n                Copy in editor\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUse.visibility" \n            ng-class="{\'disabled\': showUse.disabled}" \n            ng-click="use()">\n                Use\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUseAndCopy.visibility" \n            ng-class="{\'disabled\': showUseAndCopy.disabled}" \n            ng-click="copyAndUse()">\n                Copy and Use\n        </button>\n\n        <button \n            ng-show="editMode" \n            type="button" class="btn btn-xs btn-success" \n            ng-click="korboModalTabs.activeTab = 1">\n                Back\n        </button>\n        <button \n            ng-show="editMode" \n            type="button" \n            class="btn btn-xs btn-success"\n            ng-disabled="!itemSelected"\n            ng-click="copyInEditor(); elemToSearch = \'\'">\n                Select URL\n        </button>\n    </div>\n    <!-- // End footer -->\n</div>')}]),angular.module("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in contentTabs" ng-class="{active: $index == active}">\n            <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="badge pull-right" ng-show="!pane.isLoading && pane.items.length>0 && elemToSearch!==\'\'">{{pane.items.length}}</span>\n                <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" ng-show="pane.isLoading"></span>\n                {{pane.title}}\n            </a>\n        </li>\n    </ul>\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n        	<div ng-repeat="pane in contentTabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n		        <div class="kee-server-messages" ng-if="!contentTabs[$index].serverError">\n		        	<!-- messages 1 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch !== \'\'">No results found</div>\n		        	<!-- / end messages 1 -->\n		        	<!-- messages 2 -->\n		        	<div class="kee-server-searching" ng-show="contentTabs[$index].isLoading && elemToSearch !== \'\'"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n		        	<!-- / end messages 2 -->\n		        	<!-- messages 3 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch === \'\'">Type a label to search...</div>\n		        	<!-- / end messages 3 -->\n		        </div>\n		        <!-- messages 4 -->\n		        <div class="kee-server-messages" ng-if="contentTabs[$index].serverError">\n		            <div ng-show="contentTabs[$index].serverError">Server error</div>\n		        </div>\n		        <!-- / end messages 4 -->\n                <ul class="list-group pnd-inner-scrollable">\n                    <li class="list-group-item" ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" >\n                        <item uri="{{mi.uri}}" hide-options="true" hide-sticky-button="true" ng-click="select(mi)" is-selected="{{isSelected(mi)}}" ng-mouseover="getItem(mi)"></item>\n                    </li>\n                </ul>\n           </div>\n        </div>\n    </div>\n\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/autocompleteList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/autocompleteList.tmpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu kee-autocomplete-list list-group" ng-show="$isVisible() && !serverNotRunning" role="select">\n  <li role="presentation" ng-repeat="match in $matches"  class="list-group-item">\n    <item uri="{{match.value.uri}}" ng-click="$select($index, $event);selectEntity(match)" ng-if="match.label !== \'no found\'"></item>\n    <span class="kee-not-found" role="menuitem" tabindex="-1" disabled ng-bind="noFound" ng-show="match.value.noResult === true"></span>\n  </li>\n    <li ng-show="showNewButton() || showSearchButton()"></li>\n    <li>\n    <!-- footer -->\n    <div class="kee-footer-autocomplete">\n        <span class="kee-elem-to-search" ng-show="showNewButton() || showSearchButton()">"{{elemToSearch}}"</span>\n        <!-- <div class="kee-footer-btn"> -->\n        <button class="kee-btn-new btn btn-success btn-xs" ng-show="showNewButton()" ng-click="openKeeModal();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-plus"></i>\n            Create new\n        </button>\n        <button class="kee-btn-search btn btn-success btn-xs" ng-show="showSearchButton()" ng-click="searchOnLOD();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-search"></i>\n            Search in LOD\n        </button>\n        <!-- </div> -->\n    </div>\n    <!-- End footer -->\n    </li>\n</ul>\n')
}]),angular.module("src/KorboEE/korboee-entity.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/korboee-entity.tmpl.html",'<div \n      class="container kee-wrp" \n      id="korbo-ee-container" \n      ng-show="renderElement()">\n      \n      <div class="left-inner-icon">\n            <span \n                  class="pnd-icon pnd-icon-refresh pnd-icon-spin" \n                  ng-show="isLoading() && !serverNotRunning">\n            </span>\n            \n            <input \n                  class="kee-input-elem-to-search kee-input-ok form-control"\n                  name="{{conf.tafonyName}}"\n                  id="{{conf.tafonyId}}"\n                  placeholder="Type at least {{conf.labelMinLength}} characters..."\n                  ng-keypress="keyPressHandle($event)"\n                  type="text"\n                  autocomplete="off"\n                  ng-model="elemToSearch"\n                  template="{{autocompleteListTemplate}}"\n                  ng-options="e.label for e in results"\n                  bs-typeahead\n                  ng-disabled="serverNotRunning"\n                  ng-show = "!serverNotRunning"\n                    />\n            <input \n                  ng-disabled="true" \n                  class="kee-input-elem-to-search kee-input-error-server form-control" placeholder="Sorry! The service is not working" \n                  ng-show = "serverNotRunning"/>\n\n      </div> \n      <!-- // End div ee-input-container -->\n\n\n      <!-- input hidden -->\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenUri}}" \n            value="{{location}}" \n            class="ee-uri-hidden" />\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenLabel}}" \n            value="{{label}}" \n            class="ee-label-hidden" />\n      <!-- // End input hidden -->\n\n</div> \n<!-- // End div container -->\n')}]),angular.module("KorboEE",["korboee-templates","templates-main","APIModule","mgcrea.ngStrap","Pundit2.Core"]),angular.module("KorboEE").directive("korboEntityEditor",["korboConf","APIService","$window",function(a,b,c){return{restrict:"E",templateUrl:function(d,e){var f=e.confName||"",g=a.setConfiguration(f);if("undefined"!=typeof c[g.globalObjectName])return e.error=!0,e.errorType="globalObject","src/KorboEE/Korboee-error-config.tmpl.html";e.error=!1;var h=b.init(g),i=["OpenSearch","OpenNew","Cancel","ClearForm","Edit","CopyAndUse"],j=["Open","Cancel","Save"];return h.addEvent(j),h.addFeature(i),null!==g.onLoad&&"function"==typeof g.onLoad&&g.useOnlyCallback&&g.onLoad(),g.useOnlyCallback||!g.useTafonyCompatibility&&!g.useOnlyCallback?"src/KorboEE/Korboee-callback.tmpl.html":g.useTafonyCompatibility?"src/KorboEE/korboee-entity.tmpl.html":void 0},scope:{},link:function(b,c,d){var e=d.confName||"";b.conf=a.setConfiguration(e),b.abstract="",b.location="",b.errorGlobalObjName=d.error,b.errorType=d.errorType,a.setIsOpenModal(!1)},controller:"EEDirectiveCtrl"}}]),angular.module("KorboEE").controller("EEDirectiveCtrl",["$scope","APIService","korboConf","$http","KorboCommunicationFactory","$timeout","ItemsExchange","KorboCommunicationService",function(a,b,c,d,e,f,g,h){a.autocompleteListTemplate="src/KorboEE/autocompleteList.tmpl.html";var i;a.readyToRender=!1,a.noFound="no entities found",a.elemToSearch="",a.isSearching=!1,a.serverNotRunning=!1,a.renderElement=function(){return a.readyToRender},a.$watch("conf",function(){a.errorGlobalObjName||(a.init=function(){a.readyToRender=a.conf.updateTime,a.limit=a.conf.limitSearchResult,a.minLabelLength=a.conf.labelMinLength,a.defaultLan=a.conf.languages[0];for(var b in a.conf.languages)if(a.conf.languages[b].state===!0){a.defaultLan=a.conf.languages[b];break}k(),a.$evalAsync(function(){j()})}())});var j=function(){a.inputWidth=angular.element(".kee-input-elem-to-search").outerWidth(),null!==a.conf.onReady&&"function"==typeof a.conf.onReady&&a.conf.onReady()},k=function(){i=b.get(a.conf.globalObjectName),"undefined"!=typeof i&&(i.exposeOpenSearch(function(b){h.openModalOnSearch(a.conf,b,a)}),i.exposeOpenNew(function(b){h.openModalOnNew(a.conf,b,a)}),i.exposeEdit(function(b){h.openModalOnEdit(a.conf,b,a)}),i.exposeCancel(function(){h.closeModal()}),i.exposeCopyAndUse(function(b){var c=new e;if("undefined"!=typeof b&&null!==b){var d={label:b.label,"abstract":b.description,depiction:b.image,type:b.type,resourceUrl:b.uri},f=c.save(d,a.defaultLan.value,a.conf.endpoint,a.conf.basketID);f.then(function(b){var c={};c.value=b,c.label=d.label,c.type=d.type,c.image=d.depiction,c.description=d.abstract,c.language=a.defaultLan.value,i.fireOnSave(c)})}}))};a.keyPressHandle=function(b){13===b.keyCode&&a.conf.useTafonyCompatibility&&(b.stopPropagation(),b.preventDefault())},a.autoCompleteSearch=function(b){b.length>=a.conf.labelMinLength&&(a.isSearching=!0,a.results=h.autocompleteSearch(b,a.conf.endpoint,"korbo",a.conf.limitSearchResult,0,a.defaultLan.value,a.conf.basketID),a.results.then(function(b){return"undefined"!=typeof b[0]&&b[0].errorServer?(a.serverNotRunning=!0,void(a.isSearching=!1)):(a.isSearching=!1,a.serverNotRunning=!1,a.results)}))},a.selectEntity=function(b){a.location=b.value.uri,a.label=b.value.label;var c={};c.value=a.location,c.label=b.value.label,c.type=b.value.type,c.image=b.value.depiction,c.description=b.value.abstract,c.language=a.defaultLan.value,i.fireOnSave(c)},a.$watch("elemToSearch",function(){a.autoCompleteSearch(a.elemToSearch)}),a.showSearchButton=function(){return"search"===a.conf.autoCompleteOptions||"all"===a.conf.autoCompleteOptions?!0:!1},a.showNewButton=function(){return"new"===a.conf.autoCompleteOptions||"all"===a.conf.autoCompleteOptions?!0:!1},a.isLoading=function(){return a.isSearching},a.openKeeModal=function(){var b={label:a.elemToSearch};h.openModalOnNew(a.conf,b,a)},a.searchOnLOD=function(){h.openModalOnSearch(a.conf,a.elemToSearch,a)}}]),angular.module("KorboEE").factory("korboConf",["Utils",function(a){var b=angular.copy(KORBODEFAULTCONF),c=function(c){return"undefined"==typeof c||"undefined"==typeof window[c]||""===c?angular.copy(KORBODEFAULTCONF):(b=angular.copy(KORBODEFAULTCONF),a.deepExtend(b,window[c]),b)};return b.setConfiguration=c,b.setIsOpenModal=function(a){b.modalOpen=a},b.getIsOpenModal=function(){return b.modalOpen},b}]),angular.module("APIModule",[]).service("APIService",["$window",function(a){function b(a){return this.conf=a,this.eventCallbacks={},this.featureCallbacks={},this.global={},this}var c=[],d={};return b.prototype.addEvent=function(a){var b=this,c=b.eventCallbacks,d=a;"string"==typeof a&&(d=[a]);for(var e in d){var f=d[e];c[f]=[],b.global["on"+f]=function(a){return function(b){"function"==typeof b&&c[a].push(b)}}(f),b["fireOn"+f]=function(a){return function(){var b=Array.prototype.splice.call(arguments,0);for(var d in c[a])c[a][d].apply(this,b)}}(f)}},b.prototype.addFeature=function(a){var b=this,c=b.featureCallbacks,d=a;"string"==typeof a&&(d=[a]);for(var e in d){var f=d[e];b["expose"+f]=function(a){return function(b){"function"==typeof b&&(c[a]=b)}}(f),b.global["call"+f]=function(a){return function(){if(a in c){var d=Array.prototype.splice.call(arguments,0);return c[a].apply(b,d)}}}(f)}},d.init=function(d){if("globalObjectName"in d){var e=new b(d);return a[d.globalObjectName]=e.global,c[d.globalObjectName]=e,e}},d.get=function(a){return c[a]},d}]);var KORBODEFAULTCONF;KORBODEFAULTCONF={endpoint:"http://dev.korbo2.org/v1",basketID:1,updateTime:1e3,labelMinLength:3,copyToKorboBeforeUse:!1,tafonyId:"default_tafony_id",tafonyName:"default_tafony_name",nameInputHiddenUri:"default_korbo_uri",nameInputHiddenLabel:"default_korbo_label",useTafonyCompatibility:!1,useOnlyCallback:!1,globalObjectName:"EE",onLoad:null,searchTypes:["http://person.uri","http://philosopher.uri","http://place.uri"],limitSearchResult:10,providers:{freebase:!1,dbpedia:!1},buttonLabel:"Default Search",type:[{label:"Schema.org place",state:!0,URI:"http://schema.org/Place"},{label:"FOAF person",state:!1,URI:"http://xmlns.com/foaf/0.1/Person"},{label:"W3 Spatial thing",state:!0,URI:"http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing"}],languages:[{name:"Italian",value:"it",state:!1},{name:"English",value:"en",state:!0},{name:"German",value:"de",state:!1}],visualizeCopyButton:["freebase"],onReady:null,autoCompleteMode:"simple",autoCompleteOptions:"none"},angular.module("KorboEE").service("KorboCommunicationService",["$q","$http","BaseComponent","ItemsExchange","Item","$rootScope","$modal","korboConf","KorboCommunicationFactory","APIService",function(a,b,c,d,e,f,g,h,i,j){var k=new c("KorboCommunication"),l=!1;k.setAutocompleteLoading=function(a){l=a},k.isAutocompleteLoading=function(){return l};var m=f.$new(),n=g({container:"[data-ng-app='Pundit2']",template:"src/KorboEE/Modal/KorboEE.modal.tmpl.html",show:!1,backdrop:"static",scope:m,keyboard:!1}),o=f.$new();o.titleMessage="Are you sure?",o.notifyMessage="Are you sure you want to close the editor? You will lose any unsaved changes",o.cancel=function(){p.hide()},o.confirm=function(){var a=j.get(this.globalObjectName);p.hide(),h.setIsOpenModal(!1),n.hide(),h.setIsOpenModal(!1),a.fireOnCancel(),r=null,q=null};var p=g({container:"[data-ng-app='Pundit2']",template:"src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:o});k.showConfirmModal=function(a){o.globalObjectName=a,p.$promise.then(p.show)},k.openModalOnNew=function(a,b,c){h.getIsOpenModal()===!1&&(h.setIsOpenModal(!0),m.entityToCreate="undefined"!=typeof b||""!==b?b:null,m.labelToSearch=null,m.idEntityToEdit=null,m.op="new",m.conf=a,m.directiveScope=c,n.$promise.then(n.show))},k.openModalOnSearch=function(a,b,c){h.getIsOpenModal()===!1&&(h.setIsOpenModal(!0),m.labelToSearch="undefined"!=typeof b||""!==b?b:null,m.entityToCreate=null,m.idEntityToEdit=null,m.op="search",m.conf=a,m.directiveScope=c,n.$promise.then(n.show))},k.openModalOnEdit=function(a,b,c){h.getIsOpenModal()===!1&&(h.setIsOpenModal(!0),m.idEntityToEdit="undefined"!=typeof b||""!==b?b:null,m.entityToCreate=null,m.labelToSearch=null,m.op="edit",m.conf=a,m.directiveScope=c,n.$promise.then(n.show))},k.closeModal=function(){h.getIsOpenModal()===!0&&(h.setIsOpenModal(!1),n.hide())},k.autocompleteSearch=function(a,c,f,g,h,i,j){return l=!0,b({method:"GET",url:c+"/search/items",cache:!1,params:{q:a,p:f,limit:g,offset:h,lang:i,basketId:j}}).then(function(a){if("0"===a.data.metadata.totalCount){var b=[{label:"no found",noResult:!0}];return l=!1,b}d.wipeContainer("kee-"+f);for(var c=0;c<a.data.data.length;c++){for(var g={uri:a.data.data[c].uri,label:a.data.data[c].label,description:a.data.data[c].abstract,depiction:a.data.data[c].depiction,type:[]},h=0;h<a.data.data[c].type.length;h++)g.type.push(a.data.data[c].type[h]);var i=new e(g.uri,g);d.addItemToContainer(i,"kee-"+f)}return l=!1,a.data.data},function(){l=!1;var a=[{label:"error",errorServer:!0}];return a})},k.buildLanguagesObject=function(b,c){var d=a.defer(),e=0,f={},g=new i,h="Insert title of the entity in ",j="Insert description of the entity in ";return f.languages=[],g.getItem(b,!1).then(function(a){if(f.imageUrl=a.depiction,f.originalUrl=a.resource,f.types=a.type,f.basketId=a.basket_id,a.available_languages.length>=0)for(var i=0;i<a.available_languages.length;i++)!function(i){var k;b.language=a.available_languages[i],k=g.getItem(b,!1),k.then(function(a){var b=c.map(function(a){return angular.lowercase(a.value)}).indexOf(angular.lowercase(a.reqLanguage));if(-1!==b){var d=angular.uppercase(a.reqLanguage),e=angular.lowercase(c[b].name),g={title:d,name:e,description:a.abstract,label:a.label,mandatory:!0,hasError:!1,tooltipMessageTitle:h+e,tooltipMessageDescription:j+e,tooltipMessageError:"message",tooltipMessageErrorTab:"There are some errors in the "+e+" languages fields"};f.languages.push(g)}}).finally(function(){e++,e===a.available_languages.length&&d.resolve(f)})}(i);else d.resolve(f)},function(a){console.log("server error ",a),f=null,d.reject()}),d.promise};var q=null;k.setSelectedEntity=function(a){q=a},k.getSelectedEntity=function(){return q};var r=null;return k.setEntityToCopy=function(a){r=a},k.getEntityToCopy=function(){return r},k}]),angular.module("KorboEE").factory("KorboCommunicationFactory",["$q","$http","Item","ItemsExchange",function(a,b,c,d){var e=function(){};return e.prototype.search=function(e,f){var g=a.defer();return b({method:"GET",url:e.endpoint+"/search/items",cache:!1,params:{q:e.label,p:e.provider,limit:e.limit,offset:e.offset,lang:e.language,basketId:e.basketID}}).success(function(a){d.wipeContainer(f);for(var b=0;b<a.data.length;b++){var e={uri:a.data[b].id,label:a.data[b].label,description:"",depiction:"",type:[""]},h=new c(e.uri,e);d.addItemToContainer(h,f)}g.resolve()}).error(function(){g.reject()}),g.promise},e.prototype.getItem=function(c,d){var e=a.defer(),f=angular.copy(c.language);return b({headers:{"Accept-Language":c.language},method:"GET",url:c.endpoint+"/baskets/"+c.basketID+"/items/"+c.item.uri,cache:d,params:{p:c.provider}}).success(function(a){a.reqLanguage=f,e.resolve(a)}).error(function(){e.reject()}),e.promise},e.prototype.save=function(c,d,e,f){var g=a.defer();return b({headers:{"Access-Control-Expose-Headers":"Location","Content-Language":d},method:"POST",url:e+"/baskets/"+f+"/items",data:c}).success(function(a,b,c){var d=c("Location");g.resolve(d)}).error(function(){g.reject()}),g.promise},e}]),angular.module("KorboEE").controller("KeeModalCtrl",["$scope","$modal","KorboCommunicationService","APIService","korboConf","KorboCommunicationFactory","$window",function(a,b,c,d,e,f,g){var h=d.get(a.conf.globalObjectName),i=new f;a.editMode=!1,a.defaultLan=a.conf.languages[0];for(var j in a.conf.languages)if(a.conf.languages[j].state===!0){a.defaultLan=a.conf.languages[j];break}a.currentProv={},a.korboModalTabs=[{title:"Search",template:"src/KorboEE/Search/KorboEE.search.tmpl.html",totalResults:0,isStarted:!1},{title:"New",template:"src/KorboEE/New/KorboEE.new.tmpl.html"}],a.showUse={visibility:!1,disabled:!0},a.showUseAndCopy={visibility:!1,disabled:!0},a.showCopyInEditor={visibility:!1,disabled:!0},a.showMoreInfo={visibility:!1,disabled:!0},a.showSaveAndAdd={visibility:!1,disabled:!0},a.$watch("op",function(b){"search"===b?(a.korboModalTabs.activeTab=0,a.korboModalTabs[0].labelToSearch=a.labelToSearch):"new"===b?(a.korboModalTabs.activeTab=1,a.korboModalTabs[1].entityToCreate=a.entityToCreate):"edit"===b&&(a.korboModalTabs.activeTab=1,a.korboModalTabs[1].idEntityToEdit=a.idEntityToEdit,a.editMode=!0)}),a.$watch("korboModalTabs.activeTab",function(){k()}),a.closeKeeModal=function(){c.showConfirmModal(a.conf.globalObjectName)},a.copyAndUse=function(){var b={label:a.itemSelected.label,"abstract":a.itemSelected.description,type:a.itemSelected.type,depiction:a.itemSelected.image,resourceUrl:a.itemSelected.resource},d=i.save(b,a.defaultLan.value,a.conf.endpoint,a.conf.basketID);d.then(function(d){a.conf.useTafonyCompatibility&&(a.directiveScope.label=b.label,a.directiveScope.elemToSearch=b.label,a.directiveScope.location=d);var f={};f.value=d,f.label=b.label,f.type=b.type,f.image=b.depiction,f.description=b.abstract,f.language=a.defaultLan.value,h.fireOnSave(f),h.fireOnCancel(),c.closeModal(),e.setIsOpenModal(!1)},function(){console.log("error to copy entity in korbo")})},a.moreInfo=function(){g.open(a.itemSelected.resource)},a.copyInEditor=function(){c.setEntityToCopy(a.itemSelected),a.korboModalTabs.activeTab=1},a.use=function(){a.conf.useTafonyCompatibility&&("korbo"===a.itemSelected.providerFrom?(a.directiveScope.location=a.itemSelected.location,a.directiveScope.elemToSearch=a.itemSelected.label,a.directiveScope.label=a.itemSelected.label):(a.directiveScope.location=a.itemSelected.resource,a.directiveScope.elemToSearch=a.itemSelected.label,a.directiveScope.label=a.itemSelected.label));var b={};b.value=a.directiveScope.location,b.label=a.itemSelected.label,b.type=a.itemSelected.type,b.image=a.itemSelected.image,b.description=a.itemSelected.description,b.language=a.defaultLan.value,h.fireOnSave(b),h.fireOnCancel(),c.closeModal(),e.setIsOpenModal(!1)},a.itemSelected=null,a.$watch(function(){return c.getSelectedEntity()},function(b){null!==b&&(a.itemSelected=b)});var k=function(){null===a.itemSelected&&(a.showUseButton(),a.showUseAndCopyButton(),a.showCopyInEditorButton(),a.showMoreInfoButton(),a.showSaveAndAddButton())};a.showUseButton=function(){0===a.korboModalTabs.activeTab?"korbo"!==a.currentProv.p&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!1,a.showUseAndCopy.visibility=!0):"korbo"===a.currentProv.p&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1):"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse||(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1):a.showUse.visibility=!1},a.showUseAndCopyButton=function(){1===a.korboModalTabs.activeTab&&(a.showUseAndCopy.visibility=!1)},a.showCopyInEditorButton=function(){a.showCopyInEditor.visibility=0===a.korboModalTabs.activeTab},a.showMoreInfoButton=function(){a.showMoreInfo.visibility=0===a.korboModalTabs.activeTab},a.showSaveAndAddButton=function(){a.showSaveAndAdd.visibility=1===a.korboModalTabs.activeTab}}]),angular.module("KorboEE").controller("KeeNewCtrl",["$scope","$rootScope","$dropdown","$modal","KorboCommunicationService","$q","KorboCommunicationFactory","korboConf","$timeout","$http","TypesHelper","ItemsExchange","ContextualMenu","$window","Config","APIService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=!1,t=new g,u=p.get(a.conf.globalObjectName);a.tabs=[],a.disactiveLanguages=[],a.disactiveLanguagesPopoverTemplate="src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",a.imageUrl="",a.saveClicked=!1,a.activeFilter=!1,a.isSaving=!1,a.originalUrlCheck=!0,a.loadingStatus=!1,a.topArea={message:"You are creating a new entity",status:"info"},a.typeFilter={label:""},n[a.conf.globalObjectName].onCancel(function(){m.wipeActionsByType("advancedMenu")});var v=function(){a.types=[]},w=function(b){m.addAction({name:"rml"+b.name,type:"advancedMenu",label:"Remove "+b.name,priority:1,showIf:function(){return!0},action:function(b){return function(){a.tabs.length>1&&a.removeLanguage(b)}}(b)})},x=function(b){1===a.tabs.length?(w(b),m.modifyHeaderActionByName("rml"+a.tabs[0].name,!0)):2===a.tabs.length?(w(b),m.modifyHeaderActionByName("rml"+a.tabs[0].name,!1)):a.tabs.length>2&&w(b)},y=function(){m.addAction({name:"editURL",type:"advancedMenu",label:"Edit original URL",priority:3,showIf:function(){return!0},action:function(){a.originalUrlCheck=!1,m.modifyHeaderActionByName("editURL",!0)}}),m.addAction({name:"searchOriginalURL",type:"advancedMenu",label:"Search original URL",priority:3,showIf:function(){return a.editMode},action:function(){a.korboModalTabs.activeTab=0,s=!1}}),m.addAction({name:"searchAndCopy",type:"advancedMenu",label:"Search and copy from LOD",priority:3,showIf:function(){return a.editMode},action:function(){a.korboModalTabs.activeTab=0,s=!0}}),m.addDivider({priority:3,type:"advancedMenu"})};y();var z=function(){var b=angular.copy(a.conf.type);for(var c in b){var d=a.types.map(function(a){return a.URI}).indexOf(b[c].URI);if(-1===d){var e={};e.URI=b[c].URI,e.label=b[c].label,e.checked=b[c].state||!1,a.types.push(e)}else a.types[d].checked=!0}},A=function(b){for(var c=0;c<b.length;c++){var d=a.types.map(function(a){return a.URI}).indexOf(b[c]);if(-1===d){var e={};e.URI=b[c],e.label=k.getLabel(b[c]),e.checked=!0,a.types.push(e)}else a.types[d].checked=!0}},B=function(){for(var b=0;b<a.conf.languages.length;b++){var c=angular.uppercase(a.conf.languages[b].value),d=angular.lowercase(a.conf.languages[b].name),e=a.tabs.map(function(a){return angular.lowercase(a.title)}).indexOf(angular.lowercase(c));if(-1!==e)return;var f={title:c,name:a.conf.languages[b].name,description:"",label:"",mandatory:!0,hasError:!1,tooltipMessageTitle:G+d,tooltipMessageDescription:H+d,tooltipMessageError:"message",tooltipMessageErrorTab:"There are some errors in the "+d+" languages fields"};"undefined"!=typeof a.entityToCreate&&null!==a.entityToCreate&&(f.label=a.entityToCreate.label),a.conf.languages[b].state?(a.tabs.push(f),x(f)):a.disactiveLanguages.push(f)}};a.prevBasketID;var C=function(b,c){a.topArea={message:"Loading entity...",status:"info"},a.loadingStatus=!0;var d="korbo"===c?null:a.conf.basketID,f={item:{uri:b},provider:c,endpoint:a.conf.endpoint,basketID:d,language:a.defaultLan.value},g=a.conf.languages;e.buildLanguagesObject(f,g).then(function(b){"undefined"!=typeof b.basketId&&null!==b.basketId?(a.prevBasketID=b.basketId,r=b.basketId):r=a.prevBasketID,a.imageUrl=b.imageUrl,a.originalUrl=b.originalUrl,v(),A(b.types),z();for(var c in b.languages)a.tabs.push(b.languages[c]),x(b.languages[c]);B(),a.topArea={message:"You are editing the entity...",status:"info"},a.loadingStatus=!1},function(){a.topArea={message:"Error getting entity info!",status:"error"}})},D=function(){for(var b=!0,c=0;c<a.tabs.length;c++)!function(c){"undefined"==typeof a.tabs[c].label||""===a.tabs[c].label?(a.tabs[c].hasError=!0,b=!1,a.tabs[c].tooltipMessageError=I):a.tabs[c].label.length<a.conf.labelMinLength?(a.tabs[c].hasError=!0,b=!1,a.tabs[c].tooltipMessageError=J):a.tabs[c].hasError=!1}(c);return b};a.defaultLan=a.conf.languages[0];for(var E in a.conf.languages)if(a.conf.languages[E].state===!0){a.defaultLan=a.conf.languages[E];break}"undefined"!=typeof a.idEntityToEdit&&null!==a.idEntityToEdit&&C(a.idEntityToEdit,"korbo"),a.imageUrlErrorMessage="Invalid URL",a.imageUrlTooltipeMessage="Depiction URL",a.imageUrlHasError=!1;var F=new RegExp("(http|ftp|https)://[a-z0-9-_]+(.[a-z0-9-_]+)+([a-z0-9-.,@?^=%&;:/~+#]*[a-z0-9-@?^=%&;/~+#])?","i"),G="Insert title of the entity in ",H="Insert description of the entity in ",I="The Title field is mandatory and must be filled",J=" The Title must be contain at least "+a.conf.labelMinLength+" characters";a.typesHasError=!1,a.typesErrorMessage="You must select at least one type",a.typesTooltipeMessage="Select at least one type",a.editMode||(v(),B(),z()),a.updateTypes=function(){var b=0;for(var c in a.types)a.types[c].checked&&b++;return a.saveClicked&&(a.typesHasError=0===b?!0:!1),b},a.checkUrl=function(){return""===a.imageUrl||F.test(a.imageUrl)?(a.saveClicked&&(a.imageUrlHasError=!1),!0):(a.saveClicked&&(a.imageUrlHasError=!0),!1)},a.updateTitleField=function(b){""===a.tabs[b].label?a.tabs[b].tooltipMessageError=I:""!==a.tabs[b].label&&a.tabs[b].label.length<a.conf.labelMinLength?a.tabs[b].tooltipMessageError=J:""!==a.tabs[b].label&&a.tabs[b].label.length>=a.conf.labelMinLength&&(a.tabs[b].hasError=!1)},a.save=function(){a.saveClicked=!0;var b=D();if(a.updateTypes(),a.checkUrl(),a.imageUrlHasError||a.typesHasError||!b)a.topArea.message="Some errors occurred! Check the fields and try to save again...!",a.topArea.status="error";else{a.isSaving=!0,a.topArea.message="Saving entity...",a.topArea.status="info";for(var c=[],d=0;d<a.types.length;d++)a.types[d].checked&&c.push(a.types[d].URI);var g=angular.lowercase(a.tabs[0].title),j={resourceUrl:a.originalUrl},k={};k.label=a.tabs[0].label,k.type=c,k.image=a.imageUrl,k.description=a.tabs[0].label,k.language=a.defaultLan.value;var l;a.editMode?(j.id=String(a.idEntityToEdit),l=r,console.log("dovrebbe stampare ",r)):l=a.conf.basketID;var n=t.save(j,g,a.conf.endpoint,l);n.then(function(b){var d;d=a.editMode?String(a.idEntityToEdit):b.substring(b.lastIndexOf("/")+1);var j=b,n=[],o={id:d,depiction:a.imageUrl},p={id:d,type:c},q=t.save(o,g,a.conf.endpoint,l),r=t.save(p,g,a.conf.endpoint,l);n.push(q),n.push(r);for(var s=0;s<a.tabs.length;s++)!function(b){var c=angular.lowercase(a.tabs[b].title),e={id:d,label:a.tabs[b].label},f={id:d,"abstract":a.tabs[b].description},g=t.save(e,c,a.conf.endpoint,l),h=t.save(f,c,a.conf.endpoint,l);n.push(g),n.push(h)}(s);f.all(n).then(function(){a.isSaving=!1,a.conf.useTafonyCompatibility&&(a.directiveScope.location=j,a.directiveScope.elemToSearch=a.tabs[0].label,a.directiveScope.label=a.tabs[0].label),a.topAreaMessage="Entity saved!",a.topArea.message="Entity saved!",a.topArea.status="info",k.value=j,u.fireOnSave(k),i(function(){m.wipeActionsByType("advancedMenu"),e.closeModal(),u.fireOnCancel(),h.setIsOpenModal(!1)},1e3)},function(){a.topArea.message="Entity saving error!",a.topArea.status="error"})},function(){a.topArea.message="Entity saving error!",a.topArea.status="error"})}},a.clearForm=function(){a.saveClicked=!1;for(var b=0;b<a.tabs.length;b++)!function(b){a.tabs[b].label="",a.tabs[b].description="",a.tabs[b].hasError=!1}(b);v(),z(),a.imageUrl="",a.originalUrl="",e.setEntityToCopy(null),a.topArea.message="You are creating a new entity",a.topArea.status="info"},a.previewImage="",a.errorImage=!1,a.loadingImage=!1;var K;a.$watch("imageUrl",function(b){""!==b&&F.test(b)?(i.cancel(K),K=i(function(){a.loadingImage=!0,j({headers:{Accept:"image/webp,*/*;q=0.8"},method:"HEAD",url:b,cache:!1}).success(function(){a.showImg=!0,a.previewImage=b,a.errorImage=!1,a.loadingImage=!1}).error(function(){a.showImg=!1,a.errorImage=!0,a.loadingImage=!1})},1e3)):(a.showImg=!1,a.errorImage=!1,a.loadingImage=!1)}),a.addLanguage=function(b){var c=a.disactiveLanguages.indexOf(b);a.disactiveLanguages.splice(c,1),a.tabs.push(b),w(b),2===a.tabs.length&&m.modifyHeaderActionByName("rml"+a.tabs[0].name,!1)},a.removeLanguage=function(b){var c=a.tabs.indexOf(b);a.tabs.splice(c,1),a.disactiveLanguages.push(b),m.removeActionByName("rml"+b.name),a.tabs.length<2&&m.modifyHeaderActionByName("rml"+a.tabs[0].name,!0)},a.showDropdown=function(a){var b={name:"resourceName"};m.show(a.pageX,a.pageY,b,"advancedMenu"),a.stopPropagation()},a.typesMouseLeave=function(){i.cancel(q),q=i(function(){a.activeFilter=!1,a.typeFilter.label=""},1e3)},a.typesMouseEnter=function(){i.cancel(q)},a.removeImage=function(){a.imageUrl=""},a.activeAllTypes=function(){for(var b in a.types)a.types[b].checked=!0},a.disableAllTypes=function(){for(var b in a.types)a.types[b].checked=!1},a.$watch(function(){return e.getEntityToCopy()},function(b){null!==b&&(!a.editMode||s?(m.wipeActionsByType("advancedMenu"),y(),a.tabs=[],a.disactiveLanguages=[],C(b.uri,b.providerFrom),s=!1):a.originalUrl=b.resource)}),a.openWindow=function(a){"undefined"!=typeof a&&null!==a&&n.open(a)}}]),angular.module("KorboEE").directive("keeLanguages",function(){return{restrict:"EAC",scope:!0,templateUrl:"src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",controller:"keeLanguagesCtrl"}}),angular.module("KorboEE").controller("keeLanguagesCtrl",["$document","$window","$rootScope","$scope","Dashboard","$element",function(a,b,c,d,e,f){var g={animation:"am-fade",offsetButton:40};d.tabs.activeTab=0,d.hiddenTabsDropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",g.animation&&f.addClass(g.animation),d.panes=null,d.hiddenTabs=[],d.$watch("tabs",function(a,b){if(a.length<b.length&&d.setActive(0),!angular.equals(a,d.panes)){d.panes=angular.copy(a);for(var c in d.panes)d.panes[c].isVisible=!0}},!0);var h=0,i=!1;d.$watch(function(){return angular.element(f).children("ul.pnd-tab-header").children("li:not(.pull-right)").length},function(a){a>0&&(h=a,i=!0,l())});var j=0,k=angular.element(f).children("ul.pnd-tab-header");d.$watch(function(){return k.width()},function(a){j=parseInt(a,10),l(),d.hiddenTabIsActive=-1===o()?!1:!0});var l=function(){h>0&&j>0&&(i&&(i=!1,m()),n(j))},m=function(){for(var a=angular.element(f).children("ul.pnd-tab-header").children("li:not(.pull-right)"),b=0;b<a.length;b++){var c=parseInt(angular.element(a[b]).css("width"),10);d.panes[b].width=c}},n=function(a){d.hiddenTabs=[];for(var b,c,e,f=a-g.offsetButton,h=0,i=0;i<d.panes.length;i++){if(b=d.panes[i],e=h+b.width,e>f){c=i;break}h=e}for(i=0;i<d.panes.length;i++)if(b=d.panes[i],c>i||"undefined"==typeof c)b.isVisible=!0;else{b.isVisible=!1;var j={text:b.title,click:"setActive("+i+", $event)"};j.isActive=i===d.tabs.activeTab?!0:!1,d.hiddenTabs.push(j)}},o=function(a){var b;if("undefined"==typeof d.hiddenTabs)return-1;if(0===d.hiddenTabs.length)return-1;if("undefined"==typeof d.tabs.activeTab)return-1;if(""===a||"undefined"==typeof a){var c=d.tabs.activeTab;b=d.panes[c]}else b=a;for(var e=0;e<d.hiddenTabs.length;e++)if(d.hiddenTabs[e].text===b.title)return e;return-1};f.addClass("tabs"),d.active=d.activePane=0,c.$on("pnd-dashboard-show-tab",function(a,b){for(var c=0;c<d.panes.length;c++)if(d.panes[c].title===b)return d.active!==c&&d.setActive(c),void(d.$parent.isCollapsed&&d.$parent.toggleCollapse())}),d.setActive=function(a){if(0!==d.hiddenTabs.length)for(var b=0;b<d.hiddenTabs.length;b++)d.hiddenTabs[b].isActive=!1;if(d.active=a,d.tabs.activeTab=a,d.panes[a].isVisible)d.hiddenTabIsActive=!1;else{d.hiddenTabIsActive=!0;var c=o(d.panes[a]);d.hiddenTabs[c].isActive=!0}};var p=!1;d.$watch(function(){return d.hiddenTabs},function(){p=d.hiddenTabs.length>0}),d.hiddenTabsToShow=function(){return p}}]),angular.module("KorboEE").controller("KeeSearchCtrl",["$scope","$modal","KorboCommunicationService","KorboCommunicationFactory","ItemsExchange","$timeout","Preview",function(a,b,c,d,e,f,g){var h=new d;a.moduleName="KorboEE",a.previewIsLoading=!1,a.elemToSearch="undefined"!=typeof a.pane.labelToSearch&&""!==a.pane.labelToSearch?a.pane.labelToSearch:"",a.defaultLan=a.conf.languages[0];for(var i in a.conf.languages)if(a.conf.languages[i].state===!0){a.defaultLan=a.conf.languages[i];break}a.contentTabs=[],a.editMode||a.contentTabs.push({title:"Korbo",template:"src/Lists/itemList.tmpl.html",items:[],itemsContainer:"kee-korbo",provider:"korbo",module:"KorboEE",isStarted:!1});for(var j in a.conf.providers)a.conf.providers[j]&&a.contentTabs.push({title:j,template:"src/Lists/itemList.tmpl.html",items:[],itemsContainer:"kee-"+j,provider:j,module:"KorboEE",isStarted:!1});a.active=a.contentTabs.activeTab=0;var k;a.$watch("elemToSearch",function(b){b.length>=a.conf.labelMinLength?(f.cancel(k),k=f(function(){l(b)},a.conf.updateTime)):""===b&&(m(),a.itemSelected=null,a.korboModalTabs[0].totalResults=0,g.clearItemDashboardSticky())}),a.$watch("contentTabs.activeTab",function(b){a.currentProv.p=a.contentTabs[b].provider,null===a.itemSelected&&("korbo"!==a.contentTabs[b].provider&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!1,a.showUseAndCopy.visibility=!0):"korbo"===a.contentTabs[b].provider&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1):"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse||(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1))});var l=function(b){a.korboModalTabs[0].totalResults=0,a.korboModalTabs[0].isStarted=!0;for(var c=0;c<a.contentTabs.length;c++)!function(c){var d={};d.label=b,d.endpoint=a.conf.endpoint,d.basketID=a.conf.basketID,d.offset=0,d.limit=a.conf.limitSearchResult,d.language=a.defaultLan.value,d.provider=a.contentTabs[c].provider,d.index=c,a.contentTabs[c].isLoading=!0,a.contentTabs[c].isStarted=!0,h.search(d,a.contentTabs[c].itemsContainer).then(function(){a.contentTabs[c].isLoading=!1,a.contentTabs[c].serverError=!1,a.contentTabs[c].items=e.getItemsByContainer(a.contentTabs[c].itemsContainer),a.korboModalTabs[0].totalResults+=a.contentTabs[c].items.length},function(){a.contentTabs[c].isLoading=!1,a.contentTabs[c].serverError=!0})}(c)},m=function(){a.korboModalTabs[0].isStarted=!1;for(var b=0;b<a.contentTabs.length;b++)!function(b){a.contentTabs[b].items=[],a.contentTabs[b].isStarted=!1,e.wipeContainer(a.contentTabs[b].itemsContainer)}(b)};a.previewError=!1,a.getItem=function(b){a.previewIsLoading=!0,a.previewError=!1;var c={};c.endpoint=a.conf.endpoint,c.basketID="korbo"===a.contentTabs[a.contentTabs.activeTab].provider?"null":a.conf.basketID,c.language=a.defaultLan.value,c.provider=a.contentTabs[a.contentTabs.activeTab].provider,c.item=b;var d=h.getItem(c,!0);d.then(function(d){if(""===d.label)c.language=d.available_languages[0],h.getItem(c,!0).then(function(c){var d=e.getItemByUri(b.uri);
d.description=c.abstract,d.type=angular.copy(c.type),d.image=c.depiction,d.location=c.uri,d.resource=c.resource,g.showDashboardPreview(d),a.previewIsLoading=!1,a.previewError=!1},function(){g.hideDashboardPreview(),a.previewIsLoading=!1,a.previewError=!0});else{var f=e.getItemByUri(b.uri);f.description=d.abstract,f.type=angular.copy(d.type),f.image=d.depiction,f.location=d.uri,f.resource=d.resource,g.showDashboardPreview(f),a.previewIsLoading=!1,a.previewError=!1}},function(){g.hideDashboardPreview(),a.previewIsLoading=!1,a.previewError=!0})},a.itemSelected=null,a.isUseActive=!1,a.select=function(b){g.setItemDashboardSticky(b),a.isUseActive=!0,a.itemSelected=b,a.itemSelected.providerFrom=a.contentTabs[a.contentTabs.activeTab].provider,c.setSelectedEntity(a.itemSelected),a.showMoreInfo.disabled="freebase"===a.itemSelected.providerFrom?!1:!0,"korbo"===a.itemSelected.providerFrom&&(a.showUse.disabled=!1,a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1),"korbo"!==a.itemSelected.providerFrom&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUseAndCopy.disabled=!1,a.showUse.visibility=!1,a.showUseAndCopy.visibility=!0):"korbo"===a.itemSelected.providerFrom||"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse||(a.showUse.disabled=!1,a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1),-1!==a.conf.visualizeCopyButton.indexOf(a.contentTabs[a.contentTabs.activeTab].provider)?(a.showCopyInEditor.visibility=!0,a.showCopyInEditor.disabled=!1):a.showCopyInEditor.disabled=!0},a.isSelected=function(b){return null!==a.itemSelected&&a.itemSelected.uri===b.uri?!0:!1},a.onMouseLeave=function(){g.hideDashboardPreview(),a.previewIsLoading=!1,a.previewError=!1}}]);