angular.module("templates-main",["src/Annomatic/AnnomaticPanel.dir.tmpl.html","src/Annomatic/AnnomaticPopover.tmpl.html","src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html","src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html","src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html","src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html","src/Annotators/ImgMenu.dir.tmpl.html","src/Annotators/TextFragmentIcon.dir.tmpl.html","src/ContextualMenu/dropdown.tmpl.html","src/Core/Templates/confirm.modal.tmpl.html","src/Core/Templates/info.modal.tmpl.html","src/Core/Templates/login.modal.tmpl.html","src/Core/Templates/send.modal.tmpl.html","src/Dashboard/ClientDashboard.tmpl.html","src/Dashboard/Dashboard.dir.tmpl.html","src/Dashboard/DashboardPanel.dir.tmpl.html","src/Dashboard/pndTabs.dir.tmpl.html","src/Item/Item.dir.tmpl.html","src/Item/ItemNotebook.dir.tmpl.html","src/Item/KorboItem.dir.tmpl.html","src/KorboEE/Korboee-callback.tmpl.html","src/KorboEE/Korboee-error-config.tmpl.html","src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tmpl.html","src/KorboEE/New/KorboEE.languagesPopover.tmpl.html","src/KorboEE/New/KorboEE.new.tmpl.html","src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html","src/KorboEE/Search/KorboEE.search.tmpl.html","src/KorboEE/Search/KorboEEverticalTabs.tmpl.html","src/KorboEE/autocompleteList.tmpl.html","src/KorboEE/korboee-entity.tmpl.html","src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html","src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html","src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html","src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html","src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html","src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html","src/Lists/PredicatesContainer/ClientPredicatesContainer.tmpl.html","src/Lists/PredicatesContainer/PredicatesContainer.dir.tmpl.html","src/Lists/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html","src/Lists/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html","src/Lists/itemList.tmpl.html","src/Lists/itemsContainer.tmpl.html","src/Preview/ClientDashboardPreview.tmpl.html","src/Preview/DashboardPreview.dir.tmpl.html","src/Preview/ItemPreview.dir.tmpl.html","src/Preview/NotebookPreview.dir.tmpl.html","src/ResourcePanel/datepicker.tmpl.html","src/ResourcePanel/popoverCalendar.tmpl.html","src/ResourcePanel/popoverLiteralText.tmpl.html","src/ResourcePanel/popoverResourcePanel.tmpl.html","src/ResourcePanel/verticalTabs.tmpl.html","src/SimplifiedClient/ItemPopover.tmpl.html","src/Toolbar/ClientToolbar.tmpl.html","src/Toolbar/Toolbar.dir.tmpl.html","src/Toolbar/myNotebooksDropdown.tmpl.html","src/Toolbar/templatesDropdown.tmpl.html","src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html","src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html","src/Tools/TripleComposer/ClientTripleComposer.tmpl.html","src/Tools/TripleComposer/Statement.dir.tmpl.html","src/Tools/TripleComposer/TripleComposer.dir.tmpl.html"]),angular.module("src/Annomatic/AnnomaticPanel.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/AnnomaticPanel.dir.tmpl.html",'<div ng-controller="AnnomaticPanelCtrl" class="pnd-annomatic-container pnd-ignore">\n    <div class="pnd-annomatic-content">\n        <div class="pnd-btn-annomatic">\n            <button \n                class="btn btn-link pnd-button-suggestion" \n                ng-click="getSuggestions()"\n                ng-show="!gotAnnotations || Annomatic.annotationNumber == 0"\n                ng-disabled="targets.length == 0">\n                    <span class="pnd-icon pnd-icon-file-text"></span> Scan Page\n            </button> \n\n            <!-- <button \n                class="btn btn-link pnd-button-suggestion" \n                ng-click="getSuggestionsArea()"\n                ng-show="Annomatic.area != null"\n                ng-disabled="targets.length == 0">\n                    <span class="pnd-icon pnd-icon-file-text"></span> Scan Area\n            </button> -->\n        </div>\n\n        <!-- <button class="btn btn-success pnd-button-select-area" ng-click="selectAreaMode()">\n            Select area <span class="pnd-icon pnd-icon-edit"></span>\n        </button> -->\n\n        <div ng-show="Annomatic.annotationNumber > 0" class="pnd-btn-annomatic">\n            <div class="pnd-annomatic-count">\n                Suggestion: {{Annomatic.annotationNumber}} - Saved: {{Annomatic.ann.savedByNum.length}} <!-- - Rejected: {{Annomatic.ann.byState[\'removed\'].length}} -->\n            </div>\n\n            <!-- TODO: fix filter -->\n            <!-- <button\n                class="btn btn-default pnd-button-filter-suggestion"\n                ng-model="filteredTypes"\n                placeholder="Filter by suggestion type"\n                data-html="1"\n                data-multiple="1"\n                data-animation="am-flip-x"\n                ng-options="type.value as type.label for type in Annomatic.ann.typesOptions"\n                bs-select\n                ng-show="Annomatic.ann.typesOptions.length > 0">\n            </button> -->\n\n            <!-- <button class="btn btn-success pnd-button-save-review" ng-click="saveReview()">\n                Save\n            </button> -->\n            <button \n                class="btn btn-success pnd-button-start-review" \n                ng-click="startReview()"\n                ng-hide="Annomatic.ann.savedByNum.length > 0">\n                Start review <!-- ({{Annomatic.currAnn}}/{{Annomatic.annotationNumber}}) -->\n            </button>\n        </div>\n\n        <div ng-repeat="ann in filtered = (annotations)" style="color: black">\n            <annotation-details id="{{ann}}"></annotation-details>\n        </div>\n\n        <!-- <div class="pnd-annomatic-info" ng-show="gotAnnotations && Annomatic.annotationNumber > 0">\n            <div>\n'+"                Accepted: {{Annomatic.ann.byState['accepted'].join(', ')}}\n            </div>\n            <div>\n                Removed: {{Annomatic.ann.byState['removed'].join(', ')}}\n            </div>\n            <div>\n                filteredTypes: {{Annomatic.filteredTypes}}\n            </div>\n        </div> -->\n    </div>\n</div>")}]),angular.module("src/Annomatic/AnnomaticPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/AnnomaticPopover.tmpl.html",'<div class="pnd-wrp pnd-ignore pnd-annomatic-popover popover" ng-controller="AnnomaticPopoverCtrl">\n    <div class="arrow"></div>\n\n    <h4 class="popover-title" ng-click="showDetails = !showDetails">\n        <!-- TODO: decide if we want the caret or not -->\n        <span ng-show="!showDetails" class="pnd-icon pnd-icon-caret-right"></span>\n        <span ng-show="showDetails" class="pnd-icon pnd-icon-caret-down"></span>\n        \n        <span\n            style="opacity: {{ann.byNum[num].confidence}}"\n            title="Confidence {{ann.byNum[num].confidence}}"\n            class="pnd-icon pnd-icon-th-large pnd-confidence"></span>\n\n        {{ann.byNum[num].label}}\n\n        <span class="pull-right pnd-icon pnd-icon-times" ng-click="hide($event)"></span>\n    </h4>\n\n    <div class="popover-content">\n        <div ng-show="showDetails" class="pnd-preview pnd-annomatic-popover-details clearfix">\n            <item-preview uri="{{ann.byNum[num].uri}}" sticking="false"></item-preview>\n        </div>\n\n        <div class="btn-group pnd-annomatic-btn-group">\n            <!-- <button class="btn btn-warning pnd-button-go-prev" ng-click="goPrev()">\n                <span class="pnd-icon pnd-icon-arrow-left"></span>\n            </button> -->\n\n            <button class="btn btn-success pnd-button-set-ok" ng-click="setOk($event)" ng-disabled="ann.savedByNum.indexOf(num) != -1">\n                <span class="pnd-icon pnd-icon-check"></span>\n            </button>\n\n            <!-- <button class="btn btn-danger pnd-button-set-ko" ng-click="setKo()" ng-disabled="ann.savedByNum.indexOf(num) != -1">\n                <span class="pnd-icon pnd-icon-trash-o"></span>\n            </button> -->\n\n            <!-- <button\n                ng-show="instances > 1"\n                class="btn btn-info"\n                ng-click="acceptAll()"\n                ng-mouseover="toggleSimilar()"\n                ng-mouseout="toggleSimilar(content)">accept all {{instances}}</button> -->\n\n            <button class="btn btn-warning" ng-click="goNext($event)">\n                <span class="pnd-icon pnd-icon-arrow-right"></span>\n            </button>\n        </div>\n    </div>\n</div>')}]),angular.module("src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",'<span\n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()"\n    ng-click="clickHandler($event)"\n    class="{{textFragmentIconClass}} {{iconClass}}">\n</span>')}]),angular.module("src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",'<div \n    class="pnd-annotation-details-wrap pnd-ignore"\n    ng-mouseover="mouseoverAllHandler()"\n    ng-mouseout="mouseoutAllHandler()">\n    <div class="pnd-annotation-details-header pnd-annotation-details-top" \n        ng-click="toggleAnnotation()"\n        ng-class="{\'pnd-annotation-details-broken\': annotation.broken, \'pnd-annotation-details-ghosted\': annotation.ghosted}"\n        ng-mouseover="mouseoverHandler()"\n        ng-mouseout="mouseoutHandler()">\n        <div class="{{annotation.mainItem.class}}">\n		        <div class="pnd-annotation-item-header-text">\n                        <span ng-show="annotation.broken" class="pnd-annotation-icon-color">\n                            <span class="pnd-icon pnd-icon-exclamation-circle"></span>\n                        </span>\n		                <span \n                            ng-show="!annotation.broken" \n                            class="pnd-annotation-icon-color" \n                            style="background-color: {{annotation.color}};">\n                            <span \n                                class="{{annotation.mainItem.icon}}"></span>\n                        </span>\n		                <span class="pnd-item-title">{{annotation.mainItem.label}}</span> 		        \n                </div>    \n                <button type="button" class="btn pull-right">\n                    <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[annotation.expanded]"></span>\n                </button>\n        </div>\n    </div>\n    <div class="pnd-annotation-details-container" ng-if="annotation.expanded">       \n        <div class="pnd-annotation-details-content">\n        \n            <!-- meta -->\n            <div class="pnd-annotation-details-meta" ng-init="meta = false">\n                    <div class="pnd-annotation-details-item-header" \n                        ng-click="meta = !meta"\n                        ng-class="{\'pnd-annotation-details-sub-open\': meta}">\n                        <div class="pnd-annotation-item-header-text">\n                            <span class="pnd-icon pnd-icon-info-circle"></span>\n                            <span>Annotation\'s info</span>\n                        </div>\n                        <button type="button" class="btn btn-link pull-right">\n                            <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[meta]"></span>\n                        </button>\n                    </div>\n\n                    <div ng-show="meta" class="pnd-sub-info">\n                        <span ng-if="meta">\n                            <div class="pnd-annotation-details-info-id">\n				                <strong>ID:</strong> {{annotation.id}}\n				            </div>\n				            <div class="pnd-annotation-details-info-author">\n				                <strong>Author:</strong> {{annotation.creatorName}}\n				            </div>\n				            <div class="pnd-annotation-details-info-date">\n				                <strong>Date:</strong> {{annotation.created | date : \'MMM d, y H:mm a\'}}\n				            </div>       \n				            <div class="pnd-annotation-details-info-notebook">\n				                <strong>Notebook:</strong> <a href="{{askLink}}{{annotation.notebookId}}" target="_blank">\n				                    {{notebookName}}\n				                </a>\n				            </div>\n                            <div ng-show="lodLive">\n                                <strong>Graph:</strong> <a href="{{openGraph}}" target="_blank">\n                                    open graph of the annotation\n                                </a>\n                            </div>  \n                        </span>\n                    </div>\n             </div>\n        \n            <div class="pnd-annotation-detains-item" ng-repeat="item in annotation.itemsArray">\n       \n            <!-- subject -->\n                <div \n                    class="pnd-annotation-details-subject" \n                    ng-init="subInfo = false"\n                    ng-mouseover="mouseoverItemHandler(item.subject.uri)"\n                    ng-mouseout="mouseoutItemHandler(item.subject.uri)">\n                        <div \n                            class="pnd-annotation-details-item-header" \n                            ng-click="subInfo = !subInfo"\n                            ng-class="{\'pnd-annotation-details-sub-open\': subInfo}">\n                            <!-- <span class="{{item.subject.icon}}"></span> -->\n                            <div class="pnd-annotation-item-header-text">\n	                            <span class="pnd-icon pnd-icon-circle"></span>\n	                            <span ng-bind-html="item.subject.label">{{item.subject.label}}</span>\n                            </div>\n                            <button type="button" class="btn btn-link pull-right">\n                                <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[subInfo]"></span>\n                            </button>\n                        </div>\n\n                        <div ng-show="subInfo" class="pnd-sub-info">\n                            <span ng-if="subInfo">\n                                <item-preview uri="{{item.subject.uri}}" sticking="false"></item-preview>\n                            </span>\n                        </div>\n                </div>\n             <!-- // end subject -->\n             <!-- predicate -->\n                <div \n                    class="pnd-annotation-details-predicate" \n                    ng-init="preInfo = false">\n                        <div \n                            class="pnd-annotation-details-item-header" \n                            ng-click="preInfo = !preInfo"\n                            ng-class="{\'pnd-annotation-details-sub-open\': preInfo}">\n                        	<div class="pnd-annotation-item-header-text">\n    	                    	<span class="pnd-icon pnd-icon-circle"></span>\n    	                    	<span ng-bind-html="item.predicate.label">{{item.predicate.label}}</span>\n                        	</div>\n                            <button type="button" class="btn  btn-link pull-right">\n                                <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[preInfo]"></span>\n                            </button>\n                        </div>\n\n                        <div ng-show="preInfo" class="pnd-sub-info">\n                            <span ng-if="preInfo">\n                                <item-preview uri="{{item.predicate.uri}}" sticking="false"></item-preview>\n                            </span>\n                        </div>\n                </div>\n             <!-- // end predicate -->\n             <!-- // object -->\n                <div ng-repeat="object in item.objects">\n                    <div \n                        class="pnd-annotation-details-object"                         \n                        ng-init="objInfo = false"\n                        ng-mouseover="mouseoverItemHandler(object.uri)"\n                        ng-mouseout="mouseoutItemHandler(object.uri)">\n                            <div \n                                class="pnd-annotation-details-item-header" \n                                ng-click="objInfo = !objInfo"\n                                ng-class="{\'pnd-annotation-details-sub-open\': objInfo}">\n                                <!-- <span class="{{object.icon}}"></span> -->\n                                <div class="pnd-annotation-item-header-text">\n	                                <span class="pnd-icon pnd-icon-circle"></span>\n                                    <span ng-if="object.typeClass!=\'uri\'">\n                                        {{object.label}}\n                                    </span>\n	                                <span ng-if="object.typeClass==\'uri\'" ng-bind-html="object.label">\n                                        {{object.label}}\n                                    </span>\n                                </div>\n                                <button type="button" class="btn  btn-link pull-right">\n                                        <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[objInfo]"></span>\n                                </button>\n                            </div>\n                            <div ng-show="objInfo" class="pnd-sub-info">\n                                <span ng-if="objInfo">\n                                    <span ng-if="object.typeClass==\'uri\'">\n                                        <item-preview class="pnd-preview clearfix" uri="{{object.uri}}" sticking="false"></item-preview>\n                                    </span>\n                                    <span ng-if="object.typeClass!=\'uri\'">\n                                        <span>{{object.label}}</span>\n                                    </span>\n                                </span>\n                                <p ng-if="object.class == \'pnd-item-entity\' && moreInfo" class="pnd-annotation-details-more-info">\n                                    <a href="{{object.uri}}" target="_blank">More info</a>\n                                </p>\n                                <p ng-if="lodLive && object.typeClass==\'uri\'">\n                                    <a href="{{lodLiveBaseUrl}}{{object.uri}}" target="_blank">Graph</a>\n                                </p>\n                            </div>\n                    </div>\n                </div>\n             <!-- // end object -->\n            </div>    \n        </div>\n        <!-- footer -->\n        <div class="pnd-annotation-details-footer" ng-show="isUserToolShowed()">\n            <button \n                type="button" \n                ng-if="showEdit()" \n                class="btn btn-xs btn-success" \n                ng-click="editAnnotation()"\n                ng-disable="isLoading">Edit</button>\n            <button \n                type="button" \n                class="btn btn-xs btn-danger" \n                ng-click="deleteAnnotation()"\n                ng-disable="isLoading">Delete</button>\n        </div>\n        <!-- // end footer -->\n    </div>\n</div>')}]),angular.module("src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",'<div class="pnd-annotation-sidebar-container pnd-ignore">\n    <!-- <div class="pnd-annotation-sidebar-content" ng-show="isAnnotationSidebarExpanded"> -->\n    <div class="pnd-annotation-sidebar-content">\n\n        <div class="pnd-annotation-sidebar-content-exp" ng-show="isAnnotationSidebarExpanded">\n            <div class="pnd-annotation-sidebar-modes-buttons">\n                <button type="button"\n                        class="btn pnd-btn-sidebar"\n                        ng-class="{\'pnd-active\': isSuggestionsPanelActive()}"\n                        ng-click="activateSuggestionsPanel()"\n                        ng-if="isAnnomaticActive"\n                        ng-disabled="isLoadingData || isLoading">\n                    Suggestions\n                </button><button type="button"\n                        ng-click="activateAnnotationsPanel()"\n                        ng-class="{\n                            \'pnd-active\': isAnnotationsPanelActive(),\n                            \'pnd-btn-only-one\': !isAnnomaticActive\n                        }"\n                        class="btn pnd-btn-sidebar"\n                        ng-disabled="isLoading">\n                    Annotations <span ng-show="isAnnotationsPanelActive()">({{annotations.length}}/{{allAnnotations.length}})</span>\n                </button>\n            </div>\n\n            <div class="pnd-annotation-sidebar-filter-content" ng-show="isAnnotationsPanelActive()">\n\n                <div ng-class="{\'pnd-btn-sidebar-full\': !annotationSidebar.needToFilter()}">\n                    <button\n                        ng-click="annotationSidebar.toggleFiltersContent()"\n                        ng-show="!isFiltersShowed"\n                        class="btn btn-link pnd-annotation-sidebar-btn-show-filter">\n                            <span class="pnd-icon pnd-icon-filter"></span> Show filters\n                    </button>\n                    <button ng-show="annotationSidebar.needToFilter() && !isFiltersShowed"\n                        class="btn btn-link pnd-annotation-sidebar-btn-remove-filters" ng-click="annotationSidebar.resetFilters()">\n                           <span class="pnd-icon pnd-icon-times"></span> Remove all filters\n                    </button>\n                </div>\n\n                <div class="pnd-annotation-sidebar-filters-list" ng-show="isFiltersShowed">\n                <!-- buttons -->\n                <!-- // end buttons -->\n                    \n\n                    <!-- Free text -->\n                    <div class="pnd-annotation-sidebar-filter-input-contains">\n                        <span \n                            class="pnd-icon" \n                            ng-class="setSearchIcon(annotationSidebar.filters.freeText.expression)" \n                            ng-click="freeText = \'\'; updateSearch(freeText)"></span>\n                        <input class="form-control" ng-model="freeText" ng-change="updateSearch(freeText)" placeholder="Contains">\n                    </div>\n\n                    <!-- Authors -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Annotation author\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        	<span \n                                class="pnd-icon" \n                                ng-class="setFilterIcon(searchAuthors.label)" \n                                ng-click="searchAuthors.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchAuthors.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n    	                    <div \n    	                        ng-repeat="elem in filters.authors | orderObjectBy:\'partial\':\'dsc\' | filter:searchAuthors" \n    	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n    	                        class="pnd-annotation-sidebar-filter-element">\n    	                            <div \n    	                                class="pnd-annotation-sidebar-filter-element-label"\n    	                                ng-click="toggleFilter(\'authors\', elem.uri)">\n    	                                    <span class="pnd-icon pnd-icon-check"\n    	                                        ng-show="elem.active"></span>\n    	                                    {{elem.label}} ({{elem.partial}})\n    	                            </div>\n    	                    </div>\n                        </div>\n                    </div>\n\n                    <!-- Notebooks -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Notebooks\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                            <span \n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchNotebooks.label)" \n                                ng-click="searchNotebooks.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchNotebooks.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n                            <div \n                                ng-repeat="elem in filters.notebooks | orderObjectBy:\'partial\':\'dsc\' | filter:searchNotebooks" \n                                ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n                                class="pnd-annotation-sidebar-filter-element">\n                                    <div \n                                        class="pnd-annotation-sidebar-filter-element-label"\n                                        ng-click="toggleFilter(\'notebooks\', elem.uri)">\n                                            <span class="pnd-icon pnd-icon-check"\n                                                ng-show="elem.active"></span>\n                                            {{elem.label}} ({{elem.partial}})\n                                    </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Types -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Types\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                            <span\n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchTypes.label)" \n                                ng-click="searchTypes.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchTypes.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n    	                    <div ng-repeat="elem in filters.types | orderObjectBy:\'partial\':\'dsc\' | filter:searchTypes" \n    	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n    	                        class="pnd-annotation-sidebar-filter-element">\n    	                            <div \n    	                                class="pnd-annotation-sidebar-filter-element-label"\n    	                                ng-click="toggleFilter(\'types\', elem.uri)">\n    	                                    <span class="pnd-icon pnd-icon-check"\n    	                                          ng-show="elem.active"></span>\n    	                                {{elem.label}} ({{elem.partial}})\n    	                            </div>\n    	                    </div>\n                        </div>\n                    </div>\n\n                    <!-- Used predicate -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" \n                            ng-click = "toggleFilterList($event)">\n                            Used predicate\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        	<span\n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchPredicates.label)" \n                                ng-click="searchPredicates.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchPredicates.label" placeholder="Filter">\n                        </div>\n                        <div \n                            ng-repeat="elem in filters.predicates | orderObjectBy:\'partial\':\'dsc\' | filter:searchPredicates" \n                            ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n                            class="pnd-annotation-sidebar-filter-element">\n                                <div \n                                    class="pnd-annotation-sidebar-filter-element-label"\n                                    ng-click="toggleFilter(\'predicates\', elem.uri)">\n                                        <span class="pnd-icon pnd-icon-check"\n                                              ng-show="elem.active"></span>\n                                    {{elem.label}} ({{elem.partial}})\n                                </div>\n                        </div>\n                    </div>\n\n                    <!-- Page items -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">\n                            Page items\n                        </div>\n                        <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        	<span\n                                class="pnd-icon"\n                                ng-class="setFilterIcon(searchEntities.label)" \n                                ng-click="searchEntities.label = \'\'"></span>\n                            <input class="form-control" ng-model="searchEntities.label" placeholder="Filter">\n                        </div>\n                        <div class="pnd-sidebar-filter-scroll">\n    	                    <div \n    	                        ng-repeat="elem in filters.entities | orderObjectBy:\'partial\':\'dsc\' | filter:searchEntities" \n    	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active && elem.partial !== 0, \'pnd-annotation-sidebar-current-filter-empt-red\': elem.active && elem.partial === 0}"\n    	                        class="pnd-annotation-sidebar-filter-element">\n    	                            <div \n    	                                class="pnd-annotation-sidebar-filter-element-label"\n    	                                ng-click="toggleFilter(\'entities\', elem.uri)">\n    	                                    <span class="pnd-icon pnd-icon-check"\n    	                                          ng-show="elem.active"></span>\n    	                                {{elem.label}} ({{elem.partial}})\n    	                            </div>\n    	                    </div>\n                        </div>\n                    </div>\n\n                    <!-- Date -->\n                    <div class="pnd-annotation-sidebar-filter">\n                        <div class="pnd-panel" ng-click = "toggleFilterList($event)">Date</div>\n                        <span \n                            ng-show="isFilterLabelShowed(annotationSidebar.filters.fromDate.expression)"\n                            class="pnd-annotation-sidebar-filter-label">\n                                From: {{annotationSidebar.filters.fromDate.expression}}\n                        </span>\n                        <span \n                            ng-show="isFilterLabelShowed(annotationSidebar.filters.toDate.expression)"\n                            class="pnd-annotation-sidebar-filter-label">\n                                To: {{annotationSidebar.filters.toDate.expression}}\n                        </span>\n\n                        <div class="pnd-annotation-sidebar-filter-input">\n                            <!-- From Date -->\n                            <input \n                                type="text" \n                                class="form-control" \n                                ng-model="annotationSidebar.filters.fromDate.expression" \n                                data-min-date="{{fromMinDate}}" \n                                data-max-date="{{fromMaxDate}}" \n                                placeholder="From" \n                                data-autoclose="1" \n                                data-date-type="string" \n                                data-date-format="yyyy-MM-dd" \n                                bs-datepicker\n                            >\n\n                            <!-- To Date -->\n                            <input \n                                type="text" \n                                class="form-control" \n                                ng-model="annotationSidebar.filters.toDate.expression" \n                                data-min-date="{{toMinDate}}" \n                                data-max-date="{{toMaxDate}}" \n                                placeholder="To" \n                                data-autoclose="1" \n                                data-date-type="string" \n                                data-date-format="yyyy-MM-dd" \n                                bs-datepicker\n                            >\n                            </div>\n                    </div>\n                    \n                    <!-- Broken -->\n					<div \n                        class="pnd-annotation-sidebar-filter-broken"\n                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': annotationSidebar.filters.broken.expression.length>0}" \n                        ng-click="toggleBrokenAnnotations()">\n    					<span \n                            ng-show="annotationSidebar.filters.broken.expression.length>0">\n                                Show broken annotations\n                        </span>\n    					<span \n                            ng-show="annotationSidebar.filters.broken.expression.length == 0">\n                                Hide broken annotations\n                        </span>\n					</div>\n\n                    <!-- buttons -->\n                    <div class="pnd-annotation-footer-sidebar-filter">\n    	                <button type="button" class="btn btn-xs btn-success pnd-annotation-sidebar-btn-close-filters" ng-click="annotationSidebar.toggleFiltersContent()">Hide filters</button>\n    	                <button type="button" class="btn btn-xs btn-success pnd-annotation-sidebar-btn-remove-filters" ng-click="annotationSidebar.resetFilters()">Remove all filters</button>\n                    </div>\n                    <!-- // end buttons -->\n                </div>\n            </div>\n\n            <div class="pnd-annotation-details-opacity" ng-show="isFiltersShowed" ng-click="annotationSidebar.toggleFiltersContent()">\n            </div>\n            \n        </div>\n        \n        <!-- Suggestions panel -->\n        <div ng-if="isSuggestionsPanelActive()">\n            <div class="pnd-annotation-sidebar-annomatic" ng-show="isAnnotationSidebarExpanded">\n                <annomatic-panel></annomatic-panel>\n            </div>\n        </div>\n\n        <!-- Loading -->\n        <div ng-show="isLoading" class="pnd-saving-content" ng-show="isAnnotationSidebarExpanded">\n            <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pnd-icon-2x"></span>\n            <span class="pnd-message">Loading</span>\n        </div>\n\n        <!-- List of annotations -->\n        <div \n            ng-show="isAnnotationsPanelActive()"\n            class="pnd-annotation-sidebar-annotations">         \n\n            <div ng-repeat="ann in filtered = (annotations)">\n                <!-- <annotation-details id="{{ann.id}}"></annotation-details> -->\n                <annotation-details \n                    id="{{ann.id}}" \n                    broken="ann.broken"\n                    class="pnd-annotation-details"\n                    ng-style="{\'top\': annotationSidebar.annotationPositionReal[ann.id].top}">\n                </annotation-details>\n            </div>\n            \n            <!-- \n                TODO: need to delegate the management of \n                annotations in the service of the sidebar\n                to avoid forcing the instance of details\n            -->\n            <div ng-if="allAnnotations.length == 0">\n                <annotation-details ng-show="false"></annotation-details>\n            </div>\n        </div>\n    </div>\n</div>')
}]),angular.module("src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html","<annotation-sidebar></annotation-sidebar>")}]),angular.module("src/Annotators/ImgMenu.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annotators/ImgMenu.dir.tmpl.html",'<div\n    ng-click="clickHandler($event)" \n    ng-mouseover="onMouseOver($event)" \n    ng-mouseleave="onMouseLeave($event)"\n    >\n        <span\n            ng-show="visible"\n            class="pnd-image-icon {{icon}}">\n        </span>\n</div>')}]),angular.module("src/Annotators/TextFragmentIcon.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annotators/TextFragmentIcon.dir.tmpl.html",'<span\n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()"\n    ng-click="clickHandler($event)"\n    class="{{textFragmentIconClass}} {{iconClass}}">\n</span>')}]),angular.module("src/ContextualMenu/dropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ContextualMenu/dropdown.tmpl.html",'<ul class="pnd-dropdown-contextual-menu dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-notebook\': item.currentNotebook, divider: item.divider, \'disabled\': item.disable, \'dropdown-submenu\': item.submenu, \'active\': item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text"></span>\n        <a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && !item.header && item.href" ng-bind="item.text"></a>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && !item.header && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="item.submenu" ng-mouseover="$eval(item.hover);" ng-mouseleave="$eval(item.leave);" ng-bind="item.text"></a>\n    </li>\n</ul>')}]),angular.module("src/Core/Templates/confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/Templates/confirm.modal.tmpl.html",'<div class="modal pnd-confirm-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-confirm-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-confirm-modal-footer">\n                <button type="button" class="btn btn-default pnd-confirm-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-confirm-modal-confirm" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Core/Templates/info.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/Templates/info.modal.tmpl.html",'<div class="modal pnd-info-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-info-modal-body">\n                <table class="table table-condensed pnd-table">\n                    <tr ng-repeat="field in info">\n                        <td class="modal-field-label">{{field.label}}</td>\n                        <td class="modal-field-value">{{field.value}}</td>\n                    </tr>\n                    <tr ng-repeat="link in links">\n                        <td class="modal-field-label">{{link.label}}</td>\n                        <td class="modal-field-value"><a target="_blank" href="{{link.ref}}">{{link.linkLabel}}</a></td>\n                    </tr>\n                </table>                \n            </div>\n\n            <div class="modal-footer pnd-info-modal-footer">\n                <button type="button" class="btn btn-default pnd-info-modal-close" ng-click="close()">Close</button>\n                <!-- <button type="button" class="btn btn-default pnd-info-modal-tell" ng-click="send()">Found a bug? tell us!</button> -->\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Core/Templates/login.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/Templates/login.modal.tmpl.html",'<div class="modal pnd-login-modal-container pnd-ignore" tabindex="-1" role="dialog" ng-controller="LoginModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title"> Login </h4>\n            </div>\n            <div class="modal-body pnd-login-modal-body">\n                {{notifyMessage}}\n            </div>\n            <div class="modal-footer pnd-login-modal-footer">\n                <button type="button" class="btn btn-default pnd-login-modal-close" ng-show="isUserLogged()" ng-click="closeModal()">Close</button>\n                <button type="button" class="btn btn-default pnd-login-modal-cancel" ng-show="!isUserLogged()" ng-click="cancelModal()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-login-modal-openPopUp" ng-show="!isUserLogged()" ng-click="loginPopUp()">Open the login window</button>\n            </div> <!-- end modal-footer -->\n        </div> <!-- end modal content-->\n    </div> <!-- end modal dialog-->\n</div> <!-- end modal -->\n\n\n')}]),angular.module("src/Core/Templates/send.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/Templates/send.modal.tmpl.html",'<div class="modal pnd-send-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-send-modal-body">\n            	<div class="form-group">\n	            	<label for="exampleInputEmail1">Subject <span class="pnd-mandatory-field"> * </span>:</label>\n	            	<input placeholder="Subject" ng-model="text.subject" class="form-control" >\n	            </div>\n	            <div class="form-group">\n	            	<label for="exampleInputPassword1">Description:</label>\n	            	<textarea ng-model="text.msg" class="form-control"  rows="5"></textarea>\n	            </div>\n            </div>\n\n            <div class="modal-footer pnd-send-modal-footer">\n            	<button type="button" class="btn btn-default pnd-send-modal-close" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-success disabled pnd-send-modal-send" ng-click="send()">Send</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Dashboard/ClientDashboard.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/ClientDashboard.tmpl.html","<dashboard></dashboard>")}]),angular.module("src/Dashboard/Dashboard.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/Dashboard.dir.tmpl.html",'<div class="pnd-ignore">\n\n    <div class="pnd-dashboard-container" ng-show="isDashboardVisible">\n\n        <!--footer-->\n        <div class="pnd-dashboard-footer"></div>\n\n    </div>\n\n</div>')}]),angular.module("src/Dashboard/DashboardPanel.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/DashboardPanel.dir.tmpl.html",'<div \n    class="pnd-dashboard-panel" \n    ng-class="{\'pnd-dashboard-panel-not-last\': !isLast}"\n    ng-style="{\'width\': width, \'left\': left, \'bottom\': bottom}">\n\n    <div class="pnd-dashboard-panel-expanded" ng-hide="isCollapsed">\n        <!--<div class="pnd-dashboard-panel-nav"></div>-->\n        <div class="pnd-dashboard-panel-content" pnd-tabs="tabs">\n            <!-- the content comes from outside-->\n        </div>\n        <div class="pnd-dashboard-footer-handler" ng-mousedown="footerMouseDownHandler($event)"></div>\n        <button \n            type="button" \n            class="btn btn-xs btn-default pnd-btn-dashboard" \n            ng-click="toggleCollapse()" \n            ng-disabled="!canCollapsePanel">\n            <span class="pnd-icon pnd-icon-times"></span>\n        </button>\n    </div>\n\n    <div \n        class="pnd-dashboard-panel-collapsed" \n        ng-show="isCollapsed" \n        ng-style="{\'width\': collapsedWidth}">\n        <div class="pnd-dashboard-panel-collapsed-content"></div>\n        <button \n            type="button" \n            class="btn btn-xs btn-default  pnd-btn-dashboard" \n            ng-click="toggleCollapse()">\n            <span class="pnd-icon pnd-icon-expand"></span>\n        </button>\n    </div>\n\n    <div class="pnd-dashboard-panel-separator"\n         ng-mousedown="mouseDownHandler($event)"\n         ng-show="!isLast">\n     </div>\n\n</div>')}]),angular.module("src/Dashboard/pndTabs.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/pndTabs.dir.tmpl.html",'<ul class="nav nav-tabs pnd-tab-header" ng-class="{\'pnd-hidden-tabs\': hiddenTabsToShow()}">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}" ng-show="pane.isVisible">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n    </li>\n    <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n        <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n    </li>\n</ul>\n<div class="tab-content pnd-tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template" ng-show="$index == active"></div>\n</div>')}]),angular.module("src/Item/Item.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Item/Item.dir.tmpl.html",'<div \n    class="pnd-item" \n    ng-class="{\'pnd-select-item\': isSelected, \'pnd-sticky-item\': isSticky() && forceSticky}"\n    ng-click="setStickInForceMode()"\n    ng-mouseover="onItemMouseOver()" \n    ng-mouseleave="onItemMouseLeave()">\n    \n    <div class="pnd-item-buttons">\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-bar" \n            title="Options"\n            ng-hide="hideOptions" \n            ng-click="onClickMenu($event)">\n            <span class="pnd-icon pnd-icon-bars"></span>\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-stick" \n            title="Sticky"\n            ng-hide="hideStickyButton" \n            ng-click="onClickSticky($event)">\n            <span class="pnd-icon pnd-icon-thumb-tack"></span>\n        </button>\n        \n        <!-- <span ng-if="isSelect" class="pnd-icon pnd-icon-check"></span> -->\n    </div>\n\n    <div class="pnd-item-text">\n        <span \n            class="pnd-item-typeLabel"\n            ng-show="item.type.length > 0">\n            {{itemTypeLabel}}\n        </span>\n        <span class="pnd-item-label">\n            {{item.label}}\n        </span>\n    </div>\n\n</div>')}]),angular.module("src/Item/ItemNotebook.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Item/ItemNotebook.dir.tmpl.html",'<div \n    class="pnd-item" \n    ng-class="{\'pnd-sticky-item\': isSticky() && forceSticky}"\n    ng-click="setStickInForceMode()"\n    ng-mouseover="onItemMouseOver()" \n    ng-mouseleave="onItemMouseLeave()">\n\n    <div class="pnd-item-buttons">\n        <button type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link" title="Options"><span class="pnd-icon pnd-icon-gears"></span></button>\n        <button type="button" ng-click="onClickSticky($event)" ng-hide="hideStickyButton" class="btn btn-xs btn-link" title="Sticky"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n    </div>\n\n    <div class="pnd-item-text">\n        <!-- <span class="pnd-item-typeLabel">{{notebook.visibility}}</span> -->\n        <span ng-if="!notebook.isPublic()" class="pnd-icon pnd-icon-lock"  title="Private"></span>\n        <span ng-if="notebook.isPublic()" class="pnd-icon pnd-icon-group" title="Public"></span> \n        <span ng-if="notebook.isCurrent()" class="pnd-icon pnd-icon-pencil-square" title="Current"></span>   \n        <span class="pnd-item-label">{{notebook.label}}</span>\n    </div>\n\n</div>')}]),angular.module("src/Item/KorboItem.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Item/KorboItem.dir.tmpl.html",'<div class="pnd-item" ng-class="{\'pnd-sticky-item\': isSticky()}" ng-show="useInKorbo">\n\n    <div class="pnd-item-buttons">\n        <button ng-hide="hideOptions" type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link" title="Options"><span class="pnd-icon pnd-icon-bars"></span></button>\n        <button ng-hide="hideStickyButton" type="button" ng-click="onClickSticky($event)" class="btn btn-xs btn-link" title="Sticky"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n        <span ng-if="isSelected" class="pnd-icon pnd-icon-check"></span>\n    </div>\n\n    <div class="pnd-item-text">\n        <span ng-show="item.type.length > 0" class="pnd-item-typeLabel">{{itemTypeLabel}}</span>\n        <span class="pnd-item-label">{{item.label}}</span>\n        \n    </div>\n\n</div>')}]),angular.module("src/KorboEE/Korboee-callback.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-callback.tmpl.html","<!--\nUse only callback mode.\nYou can use API registered on Global Object defined in your configuration\n-->\n\n")}]),angular.module("src/KorboEE/Korboee-error-config.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-error-config.tmpl.html",'<div class="container error-ee-config">\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-globalobject" \n        ng-show="errorType == \'globalObject\'">\n            Configuration Error. Object {{conf.globalObjectName}} existing. Please check your configuration!\n    </div>\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-autocomplete" \n        ng-show="errorType == \'autoComplete\'">\n            CONFIGURATION ERROR. <br> \n            You can choise only one mode: useAutocompleteWithNew or useAutocompleteWithSearch. <br> \n            Please check your configuration!\n    </div>\n</div>')}]),angular.module("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",'<div class="modal kee-wrp pnd-confirm-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-confirm-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-confirm-modal-footer">\n                <button type="button" class="btn btn-default pnd-confirm-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-confirm-modal-confirm" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",'<ul class="nav nav-tabs" ng-hide="editMode">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}">{{pane.title}}<span class="badge pull-right" ng-show="pane.isStarted">{{pane.totalResults}}</span>\n        </a>\n    </li>\n</ul>\n<div class="tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template || \'$pane\'"></div>\n</div>\n')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tmpl.html",'<div class="kee-wrp kee-modal-container modal pnd-ignore" tabindex="-1" role="dialog" ng-controller="KeeModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content kee-modal-content">\n            <div class="modal-body kee-modal-body">\n                <div ng-model="korboModalTabs.activeTab" data-template="src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html" bs-tabs="korboModalTabs"> </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n')}]),angular.module("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",'<div class="pnd-korbo-languages-popover popover">\n    <div ng-repeat="lang in disactiveLanguages" class="kee-popover-item">\n        <div ng-click="addLanguage(lang); $hide()" >\n            <span class="pnd-icon pnd-icon-plus"></span> {{lang.name}} ({{lang.title}})\n        </div>\n    </div>\n</div>')}]),angular.module("src/KorboEE/New/KorboEE.new.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.new.tmpl.html",'<div ng-controller="KeeNewCtrl">\n    <!-- Top area -->\n    <div class="kee-top-area">\n        <div class="kee-top-area-menu pull-right">\n            <button type="button" class="btn btn-xs btn-link" ng-click="showDropdown($event)">\n                <span class="pnd-icon pnd-icon-gear"></span>\n            </button>\n        </div>\n        <div class="kee-top-area-message" ng-class="{\'kee-error\' : topArea.status == \'error\'}">\n            {{topArea.message}}\n        </div>\n    </div> \n    <!-- End top area -->\n\n    <!-- New content -->\n    <div class="kee-new-content" ng-hide="isSaving">\n    \n        <!-- Content on the right -->\n        <div class="kee-right-content" ng-hide="loadingStatus">\n\n            <!-- Original url-->\n            <div class="kee-new-original-url">\n	            <div class="form-group">\n	                <label>Original URL</label>\n	                <div class="left-inner-icon">\n                        <span class="pnd-icon pnd-icon-external-link" ng-click="openWindow(originalUrl);$event.stopPropagation();$event.preventDefault();"></span>\n                        <input \n                            type="text" \n                            class="form-control" \n                            ng-model="originalUrl" \n                            ng-disabled="originalUrlCheck">\n	                </div>\n	            </div>\n            </div>\n            <!-- End original url -->\n\n            <!-- Image url -->\n            <div class="kee-new-image-url">\n\n                <!-- Form group -->\n	            <div class="form-group">\n\n	            	<!-- Preview -->\n	                <div class="kee-preview-image">\n                    	<img ng-show="showImg" ng-src="{{previewImage}}"/>\n                    </div>\n	                <!-- End preview -->\n\n	                <span \n                        ng-show="errorImage" \n                        class="kee-message-error-image">\n                            Impossible to load image\n                    </span>\n                    <span \n                        ng-show="loadingImage" \n                        class="kee-message-loading-image">\n                            Loading image...\n                    </span>\n	                <label>\n                        Image URL\n	                    <span \n                            ng-show="!imageUrlHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="imageUrlHasError" \n                            class="kee-error pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n	                <input \n                        ng-hide="showImg" \n                        type="text" \n                        ng-model="imageUrl" \n                        ng-change="checkUrl()" \n                        class="form-control">\n	                <a \n                        ng-show="showImg" \n                        ng-click="removeImage()" \n                        class="kee-message-remove-image">\n                            Remove image\n                    </a>\n	                <label ng-class="{\'kee-error\' : imageUrlHasError}" />\n	            </div>\n                <!-- End form group -->\n            </div>\n            <!-- End image url -->\n\n            <!-- Types -->\n            <div \n                class="kee-new-types" \n                ng-mouseleave="typesMouseLeave()" \n                ng-mouseenter="typesMouseEnter()">\n            \n                <!-- Form group -->\n	            <div class="form-group">\n    	            <button \n                        type="button" \n                        class="btn btn-xs btn-link pull-right" \n                        ng-show="!activeFilter" \n                        ng-click="activeFilter = !activeFilter">\n                            <span class="pnd-icon pnd-icon-filter"></span>\n                    </button>\n	                <label ng-class="{\'kee-error\' : typesHasError}">                    \n	                    Types\n                        <span class="kee-error"> * </span>\n	                    <span \n                            ng-show="!typesHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{typesTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="typesHasError" \n                            class="pnd-icon pnd-icon-info-circle kee-error" \n                            data-title="{{typesErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n\n                    <div \n                        class="left-inner-icon pull-right" \n                        ng-show="activeFilter">\n                        <span \n                            ng-show="typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-filter" \n                            ng-click="activeFilter = !activeFilter">\n                        </span>\n                        <span \n                            ng-show="!typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-times" \n                            ng-click="typeFilter.label=\'\'">\n                        </span>\n                        <input \n                            ng-show="activeFilter" \n                            type="text" \n                            placeholder="filter types..." \n                            ng-model="typeFilter.label"  \n                            class="form-control">\n                    </div>\n	            </div>\n                <!-- End form group -->\n\n                <!-- Types list -->\n                <div class="kee-list-types">\n                    <ul class="list-group">\n                        <li \n                            ng-repeat="item in types | filter:typeFilter" \n                            class="list-group-item">\n                            	<div \n                                    class="pnd-item" \n                                    ng-class="{\'pnd-sticky-item\': item.checked}" \n                                    ng-click="item.checked = !item.checked; updateTypes()">\n                                        <div class="pnd-item-buttons">\n                                            <span \n                                                class="pnd-icon pnd-icon-check ng-scope"\n                                                ng-show="item.checked">\n                                            </span>\n                                        </div>\n\n                                        <div class="pnd-item-text">\n                                            <span class="pnd-item-label">\n                                                {{item.label}}\n                                            </span>\n                                        </div>\n\n                                        <span \n                                            class="pnd-icon pnd-icon-external-link pull-right" \n                                            ng-click="openWindow(item.URI);$event.stopPropagation();$event.preventDefault();">\n                                        </span>\n                                </div>\n                        </li>\n                    </ul>\n                </div>\n                <button \n                    type="button" \n                    class="btn btn-default btn-xs" \n                    ng-click="activeAllTypes()">\n                        Select all types\n                </button>\n                <button \n                    type="button" \n                    class="btn btn-default btn-xs" \n                    ng-click="disableAllTypes()">\n                        Deselect all types\n                </button>\n                <!-- End types list -->  \n            </div>\n            <!-- End Types -->\n        </div> \n        <!-- End content on the right -->\n\n        <div class="kee-new-languages">\n            <div kee-languages="tabs"></div>\n            <button \n                class="btn btn-xs btn-link pull-left" \n                ng-class="{true:\'pnd-korboee-btn-not-active\'}[disactiveLanguages.length < 1]"\n                template="{{disactiveLanguagesPopoverTemplate}}" \n                data-animation="am-flip-x" \n                bs-popover \n                ng-disabled="disactiveLanguages.length < 1">\n                    <span class="pnd-icon pnd-icon-plus"></span>\n            </button>\n        </div>\n    </div> \n    <!-- End new content -->\n\n    <div class="kee-new-saving" ng-show="isSaving">\n        Saving...\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="save()">\n                <span ng-if="!editMode">Save and add</span>\n                <span ng-if="editMode">Save</span>\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-info" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-info" \n            ng-click="clearForm()">\n                Clear\n        </button>\n\n    </div> \n    <!-- End Footer -->\n</div>')}]),angular.module("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in panes" ng-class="{active: $index == active, \'kee-error\' : panes[$index].hasError}" ng-show="pane.isVisible">\n            <a ng-show="!panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n            <a ng-show="panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="kee-error" bs-tooltip data-title="{{tabs[$index].tooltipMessageErrorTab}}" >{{pane.title}}</span>\n            </a>\n        </li>\n        <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n            <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n        </li>\n    </ul>\n    <!-- tab content-->\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n            <div ng-repeat="pane in tabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n                <!-- entity title -->\n                <div class="kee-title">\n	                <div class="form-group">\n	                <label ng-class="{\'kee-error\' : tabs[$index].hasError}">Title\n	                    <span class="kee-error" ng-class="{\'kee-error\' : tabs[$index].hasError}"> * </span>\n	                    <span ng-show="!tabs[$index].hasError" class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageTitle}}" bs-tooltip></span>\n	                    <span ng-show="tabs[$index].hasError" class="kee-error pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageError}}" bs-tooltip></span>\n	                </label>\n	                <input type="text" ng-model="tabs[$index].label" ng-change = updateTitleField($index) class="form-control">\n	                </div>\n                </div>\n                <!-- end entity title -->\n\n                <!-- entity description -->\n                <div class="form-group">\n	                <div class="kee-description">\n    	                <label>Description <span class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageDescription}}" bs-tooltip></span></label>\n    	                <textarea class="form-control" rows="3" ng-model="tabs[$index].description" class="form-control"></textarea>\n	                </div>\n                </div>\n                <!-- end entity description -->\n            </div>\n\n        </div>\n    </div>\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/Search/KorboEE.search.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEE.search.tmpl.html",'<div class="kee-wrp" ng-controller="KeeSearchCtrl">\n    <!-- Search -->\n    <div class="kee-search">\n            <label>\n                Search entity to use:\n            </label>\n            <div class="left-inner-icon">\n    	        <span \n                    class="pnd-icon pnd-icon-search" \n                    ng-click="search.term = \'\'">\n                </span>\n    	        <input \n                    class="form-control" \n                    type="text" \n                    ng-model="elemToSearch" \n                    placeholder="Type at least {{conf.labelMinLength}} characters...">\n            </div>\n    </div>\n    <!-- // End search -->\n\n    <div>\n        <preview \n            use-in-korbo="true" \n            is-loading="{{previewIsLoading}}" \n            error-loading="{{previewError}}">\n        </preview>\n    </div>\n\n    <div \n        ng-model="contentTabs.activeTab" \n        bs-tabs="contentTabs" \n        data-template = "src/ResourcePanel/verticalTabs.tmpl.html">\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showMoreInfo.visibility" \n            ng-class="{\'disabled\': showMoreInfo.disabled}" \n            ng-click="moreInfo()">\n                More Info\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showCopyInEditor.visibility" \n            ng-class="{\'disabled\': showCopyInEditor.disabled}" \n            ng-click="copyInEditor()">\n                Copy in editor\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUse.visibility" \n            ng-class="{\'disabled\': showUse.disabled}" \n            ng-click="use()">\n                Use\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUseAndCopy.visibility" \n            ng-class="{\'disabled\': showUseAndCopy.disabled}" \n            ng-click="copyAndUse()">\n                Copy and Use\n        </button>\n\n        <button \n            ng-show="editMode" \n            type="button" class="btn btn-xs btn-success" \n            ng-click="korboModalTabs.activeTab = 1">\n                Back\n        </button>\n        <button \n            ng-show="editMode" \n            type="button" \n            class="btn btn-xs btn-success"\n            ng-disabled="!itemSelected"\n            ng-click="copyInEditor(); elemToSearch = \'\'">\n                Select URL\n        </button>\n    </div>\n    <!-- // End footer -->\n</div>')
}]),angular.module("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in contentTabs" ng-class="{active: $index == active}">\n            <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="badge pull-right" ng-show="!pane.isLoading && pane.items.length>0 && elemToSearch!==\'\'">{{pane.items.length}}</span>\n                <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" ng-show="pane.isLoading"></span>\n                {{pane.title}}\n            </a>\n        </li>\n    </ul>\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n        	<div ng-repeat="pane in contentTabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n		        <div class="kee-server-messages" ng-if="!contentTabs[$index].serverError">\n		        	<!-- messages 1 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch !== \'\'">No results found</div>\n		        	<!-- / end messages 1 -->\n		        	<!-- messages 2 -->\n		        	<div class="kee-server-searching" ng-show="contentTabs[$index].isLoading && elemToSearch !== \'\'"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n		        	<!-- / end messages 2 -->\n		        	<!-- messages 3 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch === \'\'">Type a label to search...</div>\n		        	<!-- / end messages 3 -->\n		        </div>\n		        <!-- messages 4 -->\n		        <div class="kee-server-messages" ng-if="contentTabs[$index].serverError">\n		            <div ng-show="contentTabs[$index].serverError">Server error</div>\n		        </div>\n		        <!-- / end messages 4 -->\n                <ul class="list-group pnd-inner-scrollable">\n                    <li class="list-group-item" ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" >\n                        <item uri="{{mi.uri}}" hide-options="true" hide-sticky-button="true" ng-click="select(mi)" is-selected="{{isSelected(mi)}}" ng-mouseover="getItem(mi)"></item>\n                    </li>\n                </ul>\n           </div>\n        </div>\n    </div>\n\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/autocompleteList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/autocompleteList.tmpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu kee-autocomplete-list list-group" ng-show="$isVisible() && !serverNotRunning" role="select">\n  <li role="presentation" ng-repeat="match in $matches"  class="list-group-item">\n    <item uri="{{match.value.uri}}" ng-click="$select($index, $event);selectEntity(match)" ng-if="match.label !== \'no found\'"></item>\n    <span class="kee-not-found" role="menuitem" tabindex="-1" disabled ng-bind="noFound" ng-show="match.value.noResult === true"></span>\n  </li>\n    <li ng-show="showNewButton() || showSearchButton()"></li>\n    <li>\n    <!-- footer -->\n    <div class="kee-footer-autocomplete">\n        <span class="kee-elem-to-search" ng-show="showNewButton() || showSearchButton()">"{{elemToSearch}}"</span>\n        <!-- <div class="kee-footer-btn"> -->\n        <button class="kee-btn-new btn btn-info btn-xs" ng-show="showNewButton()" ng-click="openKeeModal();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-plus"></i>\n            Create new\n        </button>\n        <button class="kee-btn-search btn btn-success btn-xs" ng-show="showSearchButton()" ng-click="searchOnLOD();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-search"></i>\n            Search in LOD\n        </button>\n        <!-- </div> -->\n    </div>\n    <!-- End footer -->\n    </li>\n</ul>\n')}]),angular.module("src/KorboEE/korboee-entity.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/korboee-entity.tmpl.html",'<div \n      class="container kee-wrp" \n      id="korbo-ee-container" \n      ng-show="renderElement()">\n      \n      <div class="left-inner-icon">\n            <span \n                  class="pnd-icon pnd-icon-refresh pnd-icon-spin" \n                  ng-show="isLoading() && !serverNotRunning">\n            </span>\n            \n            <input \n                  class="kee-input-elem-to-search kee-input-ok form-control"\n                  name="{{conf.tafonyName}}"\n                  id="{{conf.tafonyId}}"\n                  placeholder="Type at least {{conf.labelMinLength}} characters..."\n                  ng-keypress="keyPressHandle($event)"\n                  type="text"\n                  autocomplete="off"\n                  ng-model="elemToSearch"\n                  template="{{autocompleteListTemplate}}"\n                  ng-options="e.label for e in results"\n                  bs-typeahead\n                  ng-disabled="serverNotRunning"\n                  ng-show = "!serverNotRunning"\n                    />\n            <input \n                  ng-disabled="true" \n                  class="kee-input-elem-to-search kee-input-error-server form-control" placeholder="Sorry! The service is not working" \n                  ng-show = "serverNotRunning"/>\n\n      </div> \n      <!-- // End div ee-input-container -->\n\n\n      <!-- input hidden -->\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenUri}}" \n            value="{{location}}" \n            class="ee-uri-hidden" />\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenLabel}}" \n            value="{{label}}" \n            class="ee-label-hidden" />\n      <!-- // End input hidden -->\n\n</div> \n<!-- // End div container -->\n')}]),angular.module("src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html","<my-items-container></my-items-container>")}]),angular.module("src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n    <div class="pnd-panel-tab-content-footer">\n        <button \n            class="pnd-triplecomposer-cancel btn btn-success btn-xs pnd-btn-full" \n            title="Remove from my items"\n            ng-disabled="!isUseActive || !isUserLogged" \n            ng-click="onClickRemove()">\n            Remove\n        </button>\n        <button \n            class="pnd-triplecomposer-cancel btn btn-subject btn-xs pnd-btn-full" \n            title="Use as subject" \n            ng-disabled="!isUseActive || !canAddItemAsSubject"\n            ng-click="onClickUseSubject()">\n            Set subject\n        </button>\n        <button \n            class="pnd-triplecomposer-cancel btn btn-object btn-xs pnd-btn-full" \n            title="Use as object"\n            ng-disabled="!isUseActive || !canAddItemAsObject" \n            ng-click="onClickUseObject()">\n            Set object\n        </button>\n\n        <!-- <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full pnd-btn-full my-items-btn-delete" \n            ng-click="onClickDeleteAllMyItems()" \n            title="Delete all my items">\n            <span \n                class="pnd-icon pnd-icon-trash-o"></span>\n        </button> -->\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full pnd-btn-full my-items-btn-order pnd-btn-lists" \n            template="{{dropdownTemplate}}"\n            placement="top-left"\n            bs-dropdown="dropdownOrdering"  \n            title="Order my items">\n            <span \n                class="pnd-icon pnd-icon-sort-amount-asc"></span>\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full pnd-btn-full my-items-btn-add-page pnd-btn-lists" \n            title="Add current page to my items" \n            ng-click="onClickAddPageToMyItems()" \n            ng-disabled="!isUserLogged">\n            <span \n                class="pnd-icon pnd-icon-bookmark"></span>\n        </button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html","<my-notebooks-container></my-notebooks-container>")}]),angular.module("src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <!-- HEADER -->\n    <div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-border">\n        <div class="left-inner-icon">\n            <span \n                class="pnd-icon {{search.icon}}" \n                ng-click="search.term = \'\'"></span>\n            <input \n                type="text" \n                ng-model="search.term" \n                placeholder="search notebooks" \n                class="form-control">\n        </div>\n    </div> \n    <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n    <div class="pnd-panel-tab-content-content pnd-inner-scrollable pnd-inner-no-tabs">\n        <ul \n            class="list-group" \n            ng-if="!message.flag">\n            <li \n                class="list-group-item" \n                ng-repeat="notebook in displayedNotebook | orderBy:getOrderProperty:reverse">\n                <item-notebook \n                    nid="{{notebook.id}}" \n                    menu-type="{{notebookMenuType}}"\n                    hide-sticky-button="true"\n                    force-sticky="true"></item-notebook>\n            </li>\n        </ul>\n    	<div \n            class="pnd-dashboard-welcome" \n            ng-if="message.flag">{{message.text}}</div>\n    </div> \n    <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n    <div class="pnd-panel-tab-content-footer">\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full my-notebooks-btn-order pnd-btn-lists" \n            template="{{dropdownTemplate}}"\n            placement="top-left"\n            bs-dropdown="dropdownOrdering" \n            title="Order my notebooks">\n            <span class="pnd-icon pnd-icon-sort-amount-asc"></span>\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full my-notebooks-btn-new pnd-btn-lists"\n            placement="top-left" \n            title="Create new notebook"\n            ng-click="createNewNotebook()">\n            <span class="pnd-icon pnd-icon-file-o"></span>\n        </button>\n    </div> \n    <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html","<page-items-container></page-items-container>")}]),angular.module("src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n    <div class="pnd-panel-tab-content-footer">\n        <button \n            class="pnd-triplecomposer-cancel btn btn-success btn-xs pnd-btn-full" \n            title="Add to my items"\n            ng-disabled="!isUseActive || !isUserLogged" \n            ng-click="onClickAdd()">\n            Add\n        </button>\n        <button \n            class="pnd-triplecomposer-cancel btn btn-subject btn-xs pnd-btn-full" \n            title="Use as subject" \n            ng-disabled="!isUseActive || !canAddItemAsSubject"\n            ng-click="onClickUseSubject()">\n            Set subject\n        </button>\n        <button \n            class="pnd-triplecomposer-cancel btn btn-object btn-xs pnd-btn-full" \n            title="Use as object"\n            ng-disabled="!isUseActive || !canAddItemAsObject" \n            ng-click="onClickUseObject()">\n            Set object\n        </button>\n\n        <button \n            type="button" class="btn btn-xs btn-link pnd-btn-full page-items-btn-order pnd-btn-lists" \n            template="{{dropdownTemplate}}"\n            placement="top-left"\n            bs-dropdown="dropdownOrdering" \n            title="Order page items">\n            <span class="pnd-icon pnd-icon-sort-amount-asc"></span>\n        </button>\n    </div> \n    <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/PredicatesContainer/ClientPredicatesContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PredicatesContainer/ClientPredicatesContainer.tmpl.html","<predicates-container></predicates-container>")}]),angular.module("src/Lists/PredicatesContainer/PredicatesContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PredicatesContainer/PredicatesContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <!-- HEADER -->\n    <div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-border">\n        <div class="left-inner-icon">\n            <span \n                class="pnd-icon {{search.icon}}" \n                ng-click="search.term = \'\'"></span>\n            <input \n                type="text" \n                ng-model="search.term" \n                placeholder="search property" \n                class="form-control">\n        </div>\n    </div> \n    <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n    <div class="pnd-panel-tab-content-content pnd-inner-scrollable pnd-inner-no-tabs">\n        <ul \n            class="list-group" \n            ng-if="!message.flag">\n            <li \n                class="list-group-item" \n                ng-repeat="pndItem in displayedItems | orderBy:getOrderProperty:reverse">\n                <!-- <item \n                    uri="{{pndItem.uri}}" \n                    menu-type="{{itemMenuType}}"\n                    hide-sticky-button="true"\n                    force-sticky="true"></item> -->\n                <item \n                    uri="{{pndItem.uri}}" \n                    menu-type="{{itemMenuType}}"\n                    hide-sticky-button="true"\n                    hide-options="true"\n                    is-selected="isSelected(pndItem)" \n                    ng-click="select(pndItem)"></item>     \n            </li>\n        </ul>\n        <div \n            class="pnd-dashboard-welcome" \n            ng-if="message.flag">{{message.text}}</div>\n    </div> \n    <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n    <div class="pnd-panel-tab-content-footer">\n        <button \n            class="pnd-triplecomposer-cancel btn btn-predicate btn-xs pnd-btn-full" \n            title="Use as predicate"\n            ng-disabled="!isUseActive || !canBeUseAsPredicate" \n            ng-click="onClickUsePredicate()">\n            Set predicate\n        </button>\n\n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full predicates-items-btn-order pnd-btn-lists" \n            template="{{dropdownTemplate}}"\n            placement="top-left"\n            bs-dropdown="dropdownOrdering" \n            title="Order predicates">\n            <span class="pnd-icon pnd-icon-sort-amount-asc"></span>\n        </button>\n    </div> \n    <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html","<vocabularies-container></vocabularies-container>")}]),angular.module("src/Lists/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n    <div class="pnd-panel-tab-content-footer">\n        <button \n            class="pnd-triplecomposer-cancel btn btn-success btn-xs pnd-btn-full" \n            title="Add to my items"\n            ng-disabled="!isUseActive" \n            ng-click="onClickAdd()">\n            Add\n        </button>\n        <button \n            class="pnd-triplecomposer-cancel btn btn-subject btn-xs pnd-btn-full" \n            title="Use as subject" \n            ng-disabled="!isUseActive || !canAddItemAsSubject"\n            ng-click="onClickUseSubject()">\n            Set subject\n        </button>\n        <button \n            class="pnd-triplecomposer-cancel btn btn-object btn-xs pnd-btn-full" \n            title="Use as object"\n            ng-disabled="!isUseActive || !canAddItemAsObject" \n            ng-click="onClickUseObject()">\n            Set object\n        </button>\n    \n        <button \n            type="button" \n            class="btn btn-xs btn-link pnd-btn-full vocab-items-btn-order pnd-btn-lists" \n            template="{{dropdownTemplate}}"\n            placement="top-left"\n            bs-dropdown="dropdownOrdering" \n            title="Order vocabularies">\n            <span class="pnd-icon pnd-icon-sort-amount-asc"></span>\n        </button>\n    </div> \n    <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/itemList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/itemList.tmpl.html",'<ul \n    class="list-group" \n    ng-if="!message.flag">\n    <li \n        class="list-group-item" \n        ng-repeat="pndItem in displayedItems | orderBy:getOrderProperty:reverse">\n        <item \n            uri="{{pndItem.uri}}" \n            menu-type="{{itemMenuType}}"\n            hide-sticky-button="true"\n            hide-options="true"\n            is-selected="isSelected(pndItem)" \n            ng-click="select(pndItem)"></item> \n    </li>\n</ul>\n\n<div \n    class="pnd-dashboard-welcome" \n    ng-if="message.flag">\n    {{message.text}}\n</div>')}]),angular.module("src/Lists/itemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/itemsContainer.tmpl.html",'<!-- TODO: generalize MyItemsContainer, MyNotebookContainer, PageItemsContainer, PredicateContainer, VocabulariesContainer (!!!) -->\n\n<!-- HEADER -->\n<div \n    class="pnd-panel-tab-content-header pnd-panel-tab-content-header-no-border">\n    \n    <div class="left-inner-icon">\n        <span \n            class="pnd-icon {{search.icon}}" \n            ng-click="search.term = \'\'"></span>\n        <input \n            type="text" \n            ng-model="search.term" \n            placeholder="search items" \n            class="form-control">\n    </div>\n\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n<div class="pnd-panel-tab-content-content pnd-inner">\n    <div \n        ng-model="tabs.activeTab" \n        pnd-tabs="tabs"></div>\n</div> <!-- end pnd-panel-tab-content-content -->')}]),angular.module("src/Preview/ClientDashboardPreview.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/ClientDashboardPreview.tmpl.html","<preview></preview>")}]),angular.module("src/Preview/DashboardPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/DashboardPreview.dir.tmpl.html",'<div class="pnd-panel-tab-content pnd-preview {{getItemClass()}}">\n\n    <!-- HEADER -->\n\n    <div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-border" ng-if="!useInKorbo || (useInKorbo && !isItemEmpty())">\n        <span ng-if="!isItemEmpty()" class="{{getItemIcon()}}"></span>\n        <span class="pnd-dashboard-preview-panel-heading" ng-if="isItemEmpty() && !useInKorbo">{{getWelcomeHeaderMessage()}}</span>\n        <span class="pnd-dashboard-preview-panel-label" ng-if="!isItemEmpty()">{{itemDashboardPreview.label}}</span>\n    </div> <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n\n    <!-- show welcome content when preview is empty -->\n    <div class="pnd-panel-tab-content-content pnd-inner-scrollable">\n        <div>\n            <span class="pnd-dashboard-welcome" ng-if="isItemEmpty() && !useInKorbo">{{getWelcomeBodyMessage()}}</span>\n            <item-preview ng-if="!isItemEmpty() && !isNotebook()" uri="{{itemDashboardPreview.uri}}" sticking="true"></item-preview>\n            <notebook-preview ng-if="!isItemEmpty() && isNotebook()" id="{{itemDashboardPreview.id}}"></notebook-preview>\n        </div>\n\n        <!-- loading preview in korboEE -->\n        <div class="kee-server-searching" ng-show="isLoading"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n        <!-- / end loading preview in korboEE -->\n        <!-- error loading preview in korboEE -->\n        <div class="kee-server-error" ng-show="errorLoading">Impossible loading preview...</div>\n        <!-- / end error loading preview in korboEE -->\n\n    </div> <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer" ng-hide="useInKorbo">\n        <!-- Clear Sticky Icon -->\n        <button \n            class="btn btn-success btn-xs pnd-btn-full pnd-dashboard-preview-clear-sticky-button" \n            ng-click="clearSticky()" \n            ng-class="{disabled: !isStickyItem()}">\n            Clear\n        </button>\n\n        <!-- More info -->\n        <button \n            class="btn btn-info btn-xs pnd-btn-full pnd-dashboard-preview-more-info-button" \n            ng-if="itemDashboardPreview.isProperty() || itemDashboardPreview.isEntity()" \n            ng-click="openUrl(itemDashboardPreview.uri)" \n            ng-class="{disabled: !isStickyItem()}">\n            More info\n        </button>\n        <button \n            class="btn btn-info btn-xs pnd-btn-full pnd-dashboard-preview-more-info-button" \n            ng-if="isNotebook()" \n            ng-click="openNotebookUrl(itemDashboardPreview.id)" \n            ng-class="{disabled: !isStickyItem()}">\n            More info\n        </button>\n\n        <!-- Open image -->\n        <!-- <button \n            class="btn btn-link btn-xs pnd-btn-full pnd-dashboard-preview-external-modal-button" \n            ng-class="{disabled: !isStickyItem()}" \n            ng-if="itemIsAnImage">\n            <span class="pnd-icon pnd-icon-external-link"></span>\n        </button> -->\n\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Preview/ItemPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/ItemPreview.dir.tmpl.html",'<!-- TODO: Need some refactoring -->\n<div class="pnd-annotation-preview-item-container pnd-ignore">\n\n    <div class="pnd-preview-item-types">\n        <ul class="pnd-preview-item-types-ul">\n            <li class="pnd-preview-single-type" ng-class="{\'pnd-is-sticky\': isSticky}" ng-repeat="type in item.type">{{getTypeLabel(type)}}</li>\n        </ul>\n        <div ng-show="typeHiddenPresent" ng-class="{\'pnd-icon-caret-down\': typeHidden, \'pnd-icon-caret-up\': !typeHidden}" class="pnd-icon" ng-click="showAlltypes()"></div>\n    </div>\n\n    <div ng-if="item.isImage()" class="pnd-preview-item-image">\n        <img ng-src="{{item.image}}" />\n    </div>\n\n    <div ng-show="item.isImageFragment()" class="pnd-preview-item-image">\n        <img ng-src="{{item.image}}" />\n    </div>\n\n    <div \n        class="pnd-preview-item-image" \n        ng-if="!item.isImage() && !item.isImageFragment() && hasImage">\n            <img class="pnd-annotation-preview-item-image" ng-src="{{item.image}}" />\n    </div>\n\n    <div class="pnd-preview-item-description">\n        <p>{{item.description}}</p>\n    </div>\n\n    <div class="pnd-preview-item-allLables" ng-if="item.mergedLabel">\n        <strong>All labels:</strong>\n        <span>{{item.mergedLabel.split(\'_\').join(\', \')}}</span>\n    </div>\n\n    <div ng-if="item.isWebPage()" class="pnd-preview-item-webpage">\n        <ul>\n            <li>\n                <strong>URL:</strong> <a href="{{item.uri}}" target="_blank">{{item.uri}}</a>\n            </li>\n        </ul>\n    </div>\n\n    <div ng-if="item.isProperty()" class="pnd-preview-item-predicate">\n        <ul>\n            <li ng-if="item.uri"><strong>Uri:</strong> {{item.uri}}</li>\n            <li class="pnd-preview-item-vocab" ng-if="!item.mergedVocabulary && item.vocabulary"><strong>Vocabulary:</strong> {{item.vocabulary}}</li>\n            <li class="pnd-preview-item-vocab" ng-if="item.mergedVocabulary">\n                <strong>Vocabulary:</strong>\n                <span ng-repeat="vocab in item.mergedVocabulary">{{vocab}}</span>\n            </li>\n            <li class="pnd-preview-item-domain" ng-if="item.domain"><strong>Domain:</strong> \n                <span ng-repeat="domain in item.domain">{{domain}}</span>\n            </li>\n            <li class="pnd-preview-item-domain" ng-if="item.domain.length === 0"><strong>Domain:</strong> \n                <span>Free domain</span>\n            </li>\n            <li class="pnd-preview-item-range" ng-if="item.range"><strong>Range:</strong> \n                <span ng-repeat="range in item.range">{{range}}</span>\n            </li>\n            <li class="pnd-preview-item-range" ng-if="item.range.length === 0"><strong>Range:</strong> \n                <span>Free range</span>\n            </li>\n        </ul>\n    </div>\n    \n</div>\n')}]),angular.module("src/Preview/NotebookPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/NotebookPreview.dir.tmpl.html",'<div class="pnd-dashboard-welcome">\n	<div class="pnd-preview-notebook-visibility">\n	    <span><strong>Visibility:</strong>\n            <span class="pnd-icon pnd-icon-group" ng-if="notebook.isPublic()"></span>\n            <span class="pnd-icon pnd-icon-lock" ng-if="!notebook.isPublic()"></span> {{notebook.visibility}}</span>\n	</div>\n	<div class="pnd-preview-notebook-annotations">\n	    <span><strong>Annotations:</strong>  </span> <span>{{notebook.includes.length}}</span>\n	</div>\n	<div class="pnd-preview-notebook-creator">\n	    <span><strong>Creator:</strong>  </span> <span>{{notebook.creatorName}}</span>\n	</div>\n	\n	<div class="pnd-preview-notebook-date">\n	    <span><strong>Creation date:</strong>  </span> <span>{{notebook.created}}</span>\n	</div>\n	<div class="pnd-preview-notebook-current" ng-show="isCurrent">\n	    <strong>current notebook</strong> <span class="pnd-icon pnd-icon-pencil-square"></span>\n	</div>\n</div>')}]),angular.module("src/ResourcePanel/datepicker.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/datepicker.tmpl.html",'<div class="dropdown-menu datepicker pnd-date-picker" ng-class="\'datepicker-mode-\' + $mode">\n  <table class="pnd-date-picker-table">\n    <thead>\n      <tr class="text-center">\n        <th>\n          <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)">\n            <i class="glyphicon glyphicon-chevron-left"></i>\n          </button>\n        </th>\n        <th colspan="{{ rows[0].length - 2 }}">\n          <button tabindex="-1" type="button" class="btn btn-default btn-block text-strong"  ng-click="$toggleMode()">\n            <strong class="pnd-date-picker-str-bnt" ng-bind="title"></strong>\n          </button>\n        </th>\n        <th>\n          <button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)">\n            <i class="glyphicon glyphicon-chevron-right"></i>\n          </button>\n        </th>\n      </tr>\n      <tr ng-show="showLabels" ng-bind-html="labels"></tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%">\n        <td class="text-center" ng-repeat="(j, el) in row">\n          <button tabindex="-1" type="button" class="btn btn-default pnd-date-picker-cntr-btn" ng-class="{\'btn-primary\': el.selected}" ng-click="$select(el.date)" ng-dblclick="$parent.save()" ng-disabled="el.disabled">\n            <span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span>\n          </button>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n  <!-- <button class="btn btn-sm btn-success"  ng-click="save()">Save</button>\n  <button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button> -->\n</div>\n')}]),angular.module("src/ResourcePanel/popoverCalendar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverCalendar.tmpl.html",'<div class="popover popover-datepicker pnd-popover-calendar">\n    <div class="arrow"></div>\n    <h3 class="popover-title">\n        Calendar\n    </h3>\n    <div class="popover-content">\n        <div class="form-group">\n            <label class="control-label"><i class="fa fa-calendar"></i> Date </label>\n            <input  type="text" \n                    class="form-control"\n                    data-date-format="dd/MM/yyyy" \n                    ng-model="selectedDate"\n                    ng-keyup="escapeEvent($event)"\n                    calendar-date-format>\n            <input  type="text" \n                    ng-model="selectedDate"\n                    ng-show="false"\n                    class="form-control pnd-input-calendar"\n                    trigger="click" \n                    data-date-format="dd/MM/yyyy" \n                    template="src/ResourcePanel/datepicker.tmpl.html" \n                    bs-datepicker>\n        </div>\n    </div>\n\n    <div class="popover-footer">\n        <button class="btn btn-sm btn-success pnd-btn-full"  ng-click="save()">Save</button>\n        <button class="btn btn-sm btn-info pnd-btn-full" ng-click="cancel()">Cancel</button>\n    </div>\n</div>')}]),angular.module("src/ResourcePanel/popoverLiteralText.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverLiteralText.tmpl.html",'<div class="popover pnd-popover-literal">\n    <div class="arrow"></div>\n    \n    <h3 class="popover-title">\n        Write your comment\n    </h3>\n    \n    <div class="popover-content">\n	    <div class="form-group">\n		    <textarea \n                class="form-control pnd-popover-literal-textarea" \n                rows="6" \n                ng-model="literalText" \n                ng-keyup="escapeEvent($event)"></textarea>\n		</div>\n    </div>\n\n    <div class="popover-footer">\n	    <button \n            class="btn btn-sm btn-success pnd-btn-full"\n            ng-class="{disabled: literalText == \'\'}" \n            ng-click="save()">\n            Save\n        </button>\n	    <button \n            class="btn btn-sm btn-info pnd-btn-full"\n            ng-click="cancel()">\n            Cancel\n        </button>\n    </div>\n</div>')}]),angular.module("src/ResourcePanel/popoverResourcePanel.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverResourcePanel.tmpl.html",'<div class="popover pnd-resource-panel-popover pnd-ignore" ng-controller="ResourcePanelCtrl">\n    <div \n        class="arrow"\n        ng-style="{\'margin-left\': arrowLeft}"></div>\n    <div \n        ng-model="contentTabs.activeTab" \n        bs-tabs="contentTabs" \n        data-template="src/ResourcePanel/verticalTabs.tmpl.html">\n    </div>\n</div>')
}]),angular.module("src/ResourcePanel/verticalTabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/verticalTabs.tmpl.html",'<!-- TODO: split Korbo template to solve this code soup -->\n\n<div class="tabbable tabs-left"> <!-- tabs left -->\n   <!-- header -->\n   <div \n        class="pnd-panel-tab-content-header pnd-panel-tab-content-header-border"\n        ng-if="moduleName == \'Pundit2\'">\n\n       <!-- TODO: please remember that class "pnd-vertical-tab-header-content" was removed -->\n        \n        <!-- Search Input div -->\n        <div class="left-inner-icon">\n            <span \n                class="pnd-icon {{subjectIcon}}" \n                ng-click="clearSearch()"></span>\n            <input \n                type="text" \n                class="pnd-rsp-input input-sm form-control" \n                placeholder="Type at least 3 characters ..." \n                ng-model="$parent.$parent.label"\n                ng-change="updateSearch($parent.$parent.label)"\n                ng-minlength="3"\n                ng-keyup="escapeEvent($event)">\n        </div>\n    </div>\n    <!-- // end header -->\n\n    <!-- Pundit2 list -->\n    <ul \n        class="nav nav-tabs pnd-vertical-tabs" \n        ng-if= "moduleName == \'Pundit2\'">\n        <li \n            ng-repeat="pane in contentTabs" \n            ng-class="{active: $index == active}" \n            ng-if="pane.title != \'My items\' || (pane.title == \'My items\' && userLoggedIn)">\n            <a \n                data-toggle="tab" \n                ng-click="setActive($index, $event)" \n                data-index="{{$index}}" >\n                <span \n                    class="badge pull-right" \n                    ng-show="moduleName == \'Pundit2\' && !pane.isLoading && pane.isStarted">\n                    {{tabItemsFiltered[$index].length}}\n                </span>\n                <span \n                    class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" \n                    ng-show="pane.isLoading"></span>\n                {{pane.title}}\n            </a>\n        </li>\n    </ul>\n\n    <!-- KorboEE list -->\n    <ul \n        class="nav nav-tabs pnd-vertical-tabs" \n        ng-if = "moduleName == \'KorboEE\'">\n        <li \n            ng-repeat="pane in contentTabs" \n            ng-class="{active: $index == active}">\n            <a \n                data-toggle="tab" \n                ng-click="setActive($index, $event)" \n                data-index="{{$index}}" >\n                <span \n                    class="badge pull-right" \n                    ng-show="moduleName == \'KorboEE\' && !pane.isLoading && pane.isStarted">\n                    {{pane.items.length}}\n                </span>\n                <span \n                    class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" \n                    ng-show="pane.isLoading"></span>\n                {{pane.title}}\n            </a>\n        </li>\n    </ul>\n\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n            <div \n                ng-repeat="pane in contentTabs" \n                class="tab-pane pnd-vertical-tab-list-content" \n                ng-class="[$index == active ? \'active\' : \'\']">\n                <div \n                    class="kee-server-messages" \n                    ng-if="pane.module == \'KorboEE\' && !contentTabs[$index].serverError">\n                    <!-- messages 1 -->\n                    <div \n                        ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch !== \'\'">\n                        No results found\n                    </div>\n                    <!-- / end messages 1 -->\n                    \n                    <!-- messages 2 -->\n                    <div \n                        class="kee-server-searching" \n                        ng-show="contentTabs[$index].isLoading && elemToSearch !== \'\'">\n                        <span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span>\n                    </div>\n                    <!-- / end messages 2 -->\n\n                    <!-- messages 3 -->\n                    <div \n                        ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch === \'\'">\n                        Type a label to search...\n                    </div>\n                    <!-- / end messages 3 -->\n                </div>\n\n                <!-- messages 4 -->\n                <div \n                    class="kee-server-messages" \n                    ng-if="pane.module == \'KorboEE\' && contentTabs[$index].serverError">\n                    <div ng-show="contentTabs[$index].serverError">\n                        Server error\n                    </div>\n                </div>\n\n                <!-- TODO: find a better way to show partial counting -->\n                <ul class="list-group" ng-init="$parent.tabItemsFiltered = $parent.tabItemsFiltered || []">\n                    <li \n                        ng-if="pane.module == \'Pundit2\' && $parent.tabItemsFiltered[$index].length === 0 && label.length > 2 && !pane.isLoading">\n                        PUNDIT: No results found\n                    </li>\n                    <li \n                        ng-if="pane.module == \'Pundit2\' && label.length > 2 && pane.isLoading">\n                        Loading ... \n                    </li>\n                    <li \n                        class="list-group-item" \n                        ng-repeat="mi in $parent.tabItemsFiltered[$index] = (contentTabs[$index].items | filter:{label: label})" \n                        ng-if="moduleName == \'Pundit2\'">\n                        <item \n                            uri="{{mi.uri}}" \n                            is-selected="isSelected(mi)" \n                            ng-click="select(mi)"\n                            ng-dblclick="save(mi)"\n                            hide-options="true" \n                            hide-sticky-button="true"\n                            ng-if="moduleName == \'Pundit2\'"></item>\n                    </li>\n\n                    <!-- Korbo -->\n                    <li \n                        class="list-group-item" \n                        ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" \n                        ng-if="moduleName == \'KorboEE\'" \n                        ng-mouseenter="getItem(mi);$event.stopPropagation()" \n                        ng-mouseleave="onMouseLeave()">\n                        <item \n                            uri="{{mi.uri}}" \n                            hide-options="true" \n                            hide-sticky-button="true" \n                            ng-click="select(mi)" \n                            is-selected="isSelected(mi)" \n                            use-in-korbo="true" \n                            ng-if="moduleName == \'KorboEE\'"></item>\n                    </li>\n                </ul>\n            </div>\n\n            <div \n                class="pnd-vertical-tab-footer-content" \n                ng-if=" moduleName == \'Pundit2\'">\n                <button \n                    class="pnd-resource-panel-use-button btn btn-xs btn-success pnd-btn-full" \n                    ng-class="{\'disabled\': !isUseActive}" \n                    ng-click="save(itemSelected)">\n                    Use\n                </button>\n                <button \n                    class="pnd-resource-panel-copy-button btn btn-xs btn-info pnd-btn-full" \n                    ng-class="{\'disabled\': !isUseActive}" \n                    ng-show="showUseAndCopyButton()" \n                    ng-click="useAndCopy(itemSelected)">\n                    Copy and Use\n                </button>\n                <button \n                    class="pnd-resource-panel-new-button btn btn-xs btn-info pnd-btn-full" \n                    ng-class="{\'disabled\': !isUseActive}" \n                    ng-show="showCopyInEditorButton()" \n                    ng-click="copyInEditor()">\n                    Copy in editor\n                </button>\n                <button \n                    class="pnd-resource-panel-new-button btn btn-xs btn-info pnd-btn-full" ng-show="showNewButton()" \n                    ng-click="createNew()">\n                    Create new\n                </button>\n                <button \n                    class="pnd-resource-panel-use-button btn btn-xs btn-info pnd-btn-full" \n                    ng-click="cancel()">\n                    Cancel\n                </button>\n            </div>\n        </div>\n    </div>\n\n</div> <!-- / tabs left -->')}]),angular.module("src/SimplifiedClient/ItemPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/SimplifiedClient/ItemPopover.tmpl.html",'<div class="popover pnd-item-popover pnd-simplified-popover" ng-controller="ItemPopoverCtrl">\n    <div class="arrow"></div>\n    <h3 class="popover-title">\n        {{title}}\n        <span \n            class="pull-right pnd-icon pnd-icon-times" \n            ng-click="hide()">\n        </span>\n    </h3>\n\n    <div \n        class="popover-content pnd-simplified-popover-content" \n        ng-click="onContentClick()">\n        <annotation-details ng-repeat="ann in annotations" id="{{ann.id}}"></annotation-details>\n    </div>\n</div>')}]),angular.module("src/Toolbar/ClientToolbar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/ClientToolbar.tmpl.html","<toolbar></toolbar>")}]),angular.module("src/Toolbar/Toolbar.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/Toolbar.dir.tmpl.html",'<nav class="navbar navbar-inverse navbar-fixed-top pnd-toolbar-navbar pnd-ignore" role="navigation" ng-controller="ToolbarCtrl">\n    <div class="container-fluid pnd-toolbar-navbar-container">\n    \n        <div class="pnd-toolbar-navbar-collapse">\n            <ul class="nav navbar-nav pnd-toolbar-navbar-left">\n                \n                <!-- Error button -->\n                <li ng-show="showStatusButtonError()" class="pnd-toolbar-error-button">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="errorMessageDropdown"><span class="pnd-icon pnd-icon-exclamation-circle"></span></a>\n                </li>\n                \n                <!-- OK button -->\n                <li ng-show="showStatusButtonOk()" class="pnd-toolbar-status-button-ok">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="infoDropdown"><span class="pnd-icon pnd-icon-check"></span></a>\n                </li>\n\n                <!-- Loading button -->\n                <li ng-show="showStatusButtonLoading()" class="pnd-toolbar-loading-button">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="infoDropdown">\n                        <!-- <span></span> -->\n                        <span class="pnd-icon pnd-icon-refresh pnd-icon-spin"></span>\n                    </a>\n                </li>\n\n                <!-- Login button -->\n                <li ng-show="showLogin()" class="pnd-toolbar-login-button pnd-toolbar-button-active">\n                    <!-- <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userNotLoggedDropdown"><span>Login</span></a> -->\n                    <a href="javascript:void(0)" ng-click="login()"><span>Login</span></a>\n                </li>\n                \n                <!-- User button -->\n                <li ng-show="showUserButton()" class="pnd-toolbar-user-button  pnd-toolbar-button-active">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userLoggedInDropdown"><span>{{userData.fullName}}</span></a>\n                </li>\n                \n                <!-- Ask the Pundit button-->\n                <li class="pnd-toolbar-ask-button pnd-toolbar-ask-button-active" ng-if="askThePundit">\n                    <a href="{{getAskLink()}}" target="_blank">\n                        <span ng-if="!isUserLogged">Ask the Pundit</span>\n                        <span ng-if="isUserLogged">My Ask the Pundit</span>\n                    </a>\n                </li>\n\n                <li class="pnd-toolbar-custom-button" ng-if="menuCustom && menuCustomBtn" ng-repeat="(key, value) in menuCustomBtn">\n                    <a href="javascript:void(0)" ng-click="openUrl(value)">\n                        <span class="pnd-toolbar-active-element">{{key}}</span>\n                    </a>\n                </li>\n                \n                <!-- Dashboard button -->\n                <li \n                    ng-if="dashboard" \n                    ng-class="{\'pnd-not-clickable\':isAnnomaticRunning, \'pnd-toolbar-dashboard-button-active\': isDashboardVisible, \'pnd-toolbar-dashboard-button\': askThePundit}">\n                    <a href="javascript:void(0)" ng-click="dashboardClickHandler()">\n                        <span class="pnd-toolbar-active-element">Dashboard</span>\n                    </a>\n                </li>\n\n            </ul> <!-- pnd-navbar-left -->\n\n            <ul class="nav navbar-nav navbar-right pnd-toolbar-navbar-right">\n                \n                <!-- Template mode button -->\n                <li class="pnd-toolbar-template-mode-button" ng-class="{\'pnd-not-clickable\':isAnnomaticRunning}" ng-show="useTemplates" ng-click="toggleTemplateMode()">\n                    <a href="javascript:void(0)">\n                        <span class="pnd-icon pnd-icon-pencil"></span>\n                    </a>\n                </li>\n                \n                <!-- Template menu -->\n                <li class="pnd-toolbar-template-menu-button" ng-click="onClickTemplateDropdown()" ng-class="{\'pnd-not-clickable\':isAnnomaticRunning}" ng-show="useTemplates">\n                    <a href="javascript:void(0)" template="{{dropdownTemplateTemplates}}" bs-dropdown="userTemplateDropdown">\n                        <span>{{currentTemplateLabel}}</span>\n                        <span class="pnd-icon pnd-icon-circle" style="color: {{currentTemplateColor}};"></span>\n                    </a>\n                </li>\n                \n                <!-- Notebooks menu -->\n                <li class="pnd-toolbar-notebook-menu-button" ng-if="myNotebooks">\n                    <a ng-show="isUserLogged" href="javascript:void(0)" placement="bottom-right" template="{{dropdownTemplateMyNotebook}}" bs-dropdown="userNotebooksDropdown"><span class="pnd-icon pnd-icon-book"> </span> <span class="pnd-toolbar-active-element">{{currentNotebookLabel}}</span></a>\n                    <a ng-show="!isUserLogged" href="javascript:void(0)" placement="bottom-right" template="{{dropdownTemplate}}" bs-dropdown="userNotLoggedDropdown"><span class="pnd-toolbar-not-active-element">My notebooks</span></a>\n                </li>\n\n                <!-- Custom menu -->\n                <li class="pnd-toolbar-custom-menu-button" ng-if="menuCustom && menuCustomDropdown.length > 0">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="menuCustomDropdown">\n                        <span class="pnd-toolbar-active-element">Advanced menu</span>\n                    </a>\n                </li>\n                \n                <!-- Annotations menu -->\n                <li class="pnd-toolbar-annotations-button" ng-if="sidebar" ng-class="{\'pnd-toolbar-annotations-button-active\': isAnnotationSidebarExpanded}">\n                    <a href="javascript:void(0)" ng-click="annotationsClickHandler()">\n                        <span class="pnd-toolbar-active-element">\n                            Sidebar \n                            <span \n                                class="pnd-icon pnd-icon-filter"\n                                ng-class="{\'pnd-filter-active\': isAnnotationFiltersActive}">\n                            </span>\n                        </span>\n                    </a>\n                </li>\n\n            </ul> <!-- pnd-toolbar-navbar-right -->\n    \n        </div><!-- pnd-toolbar-navbar-collapse -->\n    </div><!-- pnd-toolbar-navbar-container -->\n</nav>\n\n\n\n              \n')}]),angular.module("src/Toolbar/myNotebooksDropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/myNotebooksDropdown.tmpl.html",'<ul class="dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-notebook\': item.currentNotebook, divider: item.divider, \'disabled\': item.disable, \'dropdown-submenu\': item.submenu, active: item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text">dksad</span>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()">\n        <span ng-if="item.visibility == \'private\'" class="pnd-icon pnd-icon-lock"></span>\n        <span ng-if="item.visibility == \'public\'" class="pnd-icon pnd-icon-group"></span>\n        <span ng-if="item.currentNotebook" class="pnd-icon pnd-icon-pencil-square"></span>\n        {{item.text}}</a>\n    </li>\n</ul>')}]),angular.module("src/Toolbar/templatesDropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/templatesDropdown.tmpl.html",'<ul class="dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-template\': item.currentTemplate, divider: item.divider, \'disabled\': item.disable, active: item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text">dksad</span>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()">\n        <span class="pnd-icon pnd-icon-circle pull-right" style="color: {{item.hasColor}};"></span>\n        <span ng-if="item.currentTemplate" class="pnd-icon pnd-icon-check"></span>\n        {{item.text}}</a>\n    </li>\n</ul>')}]),angular.module("src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html","<notebook-composer></notebook-composer>")}]),angular.module("src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",'<!-- HEADER -->\n<div class="pnd-panel-tab-content-header">\n    {{notebookComposerHeader}}\n</div> \n<!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n<div class="pnd-panel-tab-content-content">\n\n    <div \n        class="form-group pnd-notebook-composer-container" \n        ng-hide="saving">\n\n    	<p>\n            <input \n                type="text" \n                class="form-control" \n                placeholder="Enter notebook name" \n                ng-model="notebook.name">\n    	</p>\n\n        <div \n            class="checkbox" \n            ng-class="{\'pnd-notebook-composer-element-active\': notebook.current}">\n            <label>\n                <input \n                    type="checkbox" \n                    ng-model="notebook.current" \n                    ng-disabled="editMode && isCurrentNotebook">\n                <span \n                    class="pnd-icon pnd-icon-pencil-square"></span> \n                Set as current\n            </label>\n        </div>\n\n        <div \n            class="radio" \n            ng-class="{\'pnd-notebook-composer-element-active\': notebook.visibility == \'public\'}">\n            <label>\n                <input \n                    type="radio" \n                    name="visibility" \n                    value="public" \n                    ng-model="notebook.visibility">\n                <span \n                    class="pnd-icon pnd-icon-group"></span> \n                Public\n            </label>\n        </div>\n\n        <div \n            class="radio" \n            ng-class="{\'pnd-notebook-composer-element-active\': notebook.visibility == \'private\'}">\n            <label>\n                <input \n                    type="radio" \n                    name="visibility" \n                    value="private" \n                    ng-model="notebook.visibility">\n                <span \n                    class="pnd-icon pnd-icon-lock"></span> \n                Private\n            </label>\n        </div>\n    </div>\n\n    <!-- message-->\n    <div \n        class="pnd-notebook-saving-content" \n        ng-if="saving">\n        <span class="pnd-icon {{savingIcon}} pnd-icon-2x"></span>\n        <span class="{{shortMessageClass}}">\n            {{shortMessagge}}\n        </span>\n        {{textMessage}}\n    </div>\n    <!-- // end message-->\n\n</div> \n<!-- end pnd-panel-tab-content-content -->\n\n<!-- FOOTER -->\n<div class="pnd-panel-tab-content-footer">\n\n    <button \n        class="pnd-notebookcomposer-add-blank btn btn-success btn-xs pnd-btn-full" \n        ng-if="!editMode" \n        ng-class="{disabled: notebook.name == \'\'}" \n        ng-click="save()">\n        Save\n    </button>\n    <button \n        class="pnd-notebookcomposer-add-blank btn btn-success btn-xs pnd-btn-full" \n        ng-if="editMode" \n        ng-class="{disabled: notebook.name == \'\'}" \n        ng-click="edit()">\n        Save\n    </button>\n    <button \n        class="pnd-notebookcomposer-save btn btn-info btn-xs pnd-btn-full" \n        ng-class="{disabled: notebook.name == \'\'}" \n        ng-click="clear()">\n        Reset\n    </button>\n\n</div> \n<!-- end pnd-panel-tab-content-footer -->')}]),angular.module("src/Tools/TripleComposer/ClientTripleComposer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/ClientTripleComposer.tmpl.html","<triple-composer></triple-composer>")}]),angular.module("src/Tools/TripleComposer/Statement.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/Statement.dir.tmpl.html",'<div class="pnd-statement-row clearfix">\n    <div class="pnd-statement-widget">\n\n        <!-- Subject -->\n        <div class="pnd-statement-subject">\n            <div>\n                <!-- Subject buttons -->\n                <div class="pnd-row-button-subject" ng-if="!subjectFound">\n                    <span \n                        ng-if="templateMode"\n                        class="pnd-statement-label pnd-statement-subject-text pnd-statement-tmpl-mode">\n                            Select some text on the page\n                    </span>\n                    <span\n                        ng-if="!templateMode" \n                        class="pnd-statement-label" \n                        ng-click="onClickSubject($event)">\n                            Add a subject\n                    </span>\n                </div>\n\n                <div \n                    class="pnd-row-button-subject pnd-statement-found"\n                    ng-class="{\'pnd-statement-icon-one\': !templateMode}"\n                    ng-if="subjectFound">\n                    <span \n                        class="pnd-statement-label" \n                        ng-mouseover="onSubjectMouseOver()" \n                        ng-mouseleave="onItemMouseOut()"\n                        ng-click="onClickSubject($event)">\n                            {{subjectLabel}}\n                    </span>\n\n                    <div class="pnd-row-button-rightbuttons">\n                        <button\n                                type="button"\n                                class="btn btn-xs btn-link"\n                                ng-if="!templateMode"\n                                title="delete"\n                                ng-click="wipeSubject()">\n                            <span class="pnd-icon pnd-icon-trash-o"></span>\n                        </button>\n                    </div>\n                    <!-- <span>\n                        {{subjectTypeLabel}}\n                    </span> -->\n                </div>\n                <!-- // end Subject buttons -->\n            </div>\n        </div>\n\n        <!-- Predicate -->\n        <div class="pnd-statement-predicate">\n            <div>\n                <!-- Predicate Buttons div (not found)-->\n                <div\n                    class="pnd-row-button-predicate"\n                    ng-if="!predicateFound">\n                        <span \n                            class="pnd-statement-label" \n                            ng-click="onClickPredicate($event)">\n                                Add a predicate\n                        </span>\n                </div>\n\n                <!-- Predicate buttons (found) -->\n                <div class="pnd-row-button-predicate pnd-statement-found" ng-if="predicateFound">\n                    <span \n                        class="pnd-statement-label" \n                        ng-mouseover="onPredicateMouseOver()" \n                        ng-mouseleave="onItemMouseOut()"\n                        ng-click="onClickPredicate($event)">\n                            {{predicateLabel}}\n                    </span>\n\n                    <div class="pnd-row-button-rightbuttons">\n                        <button\n                                type="button"\n                                class="btn btn-xs btn-link"\n                                ng-if="!predicateFixed"\n                                title="delete"\n                                ng-click="wipePredicate()">\n                            <span class="pnd-icon pnd-icon-trash-o"></span>\n                        </button>\n                    </div>\n                </div>\n                <!-- // end Predicate buttons -->            \n            </div>\n        </div>\n\n        <!-- Object -->\n        <div class="pnd-statement-object">\n            <div>\n                <!-- Object buttons !found -->\n                <div\n                    class="pnd-row-button-object"\n                    ng-if="!objectFound"\n                    ng-class="{\n                        \'pnd-statement-mandatory-object\':isMandatory && templateMode,\n                        \'pnd-statement-icon-one\': !canBeObjectLiteral && canBeObjectDate || !canBeObjectDate && canBeObjectLiteral,\n                        \'pnd-statement-icon-two\': canBeObjectDate && canBeObjectLiteral\n                    }">\n                    <span\n                        class="pnd-statement-label"\n                        ng-click="onClickObject($event)">\n                            Add an object<span ng-show="templateMode && isMandatory">*</span>\n                    </span>\n\n                    <div \n                        class="pnd-row-button-rightbuttons">\n                        <!--Calendar Icon-->\n                        <button\n                                type="button"\n                                class="btn btn-xs btn-link"\n                                ng-if="canBeObjectDate"\n                                ng-click="onClickObjectCalendar($event)"\n                                title="calendar">\n                            <span class="pnd-icon pnd-icon-table"></span>\n                        </button>\n                        <!--Pen Icon-->\n                        <button\n                                type="button"\n                                class="btn btn-xs btn-link"\n                                ng-if="canBeObjectLiteral"\n                                ng-click="onClickObjectLiteral($event)"\n                                title="text">\n                            <span class="pnd-icon pnd-icon-pencil"></span>\n                        </button>\n                    </div>\n                </div>\n\n                <!-- Object buttons found -->\n                <div \n                    class="pnd-row-button-object pnd-statement-found"\n                    ng-class="{\'pnd-statement-icon-one\': !templateMode || !objectFixed}"\n                    ng-if="objectFound">\n                    <span \n                        class="pnd-statement-label"\n                        ng-mouseover="onObjectMouseOver()" \n                        ng-mouseleave="onItemMouseOut()"\n                        ng-click="onClickObject($event)">\n                        {{objectLabel}}\n                    </span>\n\n                    <div \n                        class="pnd-row-button-rightbuttons">\n                        <button\n                                type="button"\n                                class="btn btn-xs btn-link"\n                                ng-if="!objectFixed"\n                                title="delete"\n                                ng-click="wipeObject()">\n                            <span class="pnd-icon pnd-icon-trash-o"></span>\n                        </button>\n                    </div>\n                </div>\n                <!-- // end Object buttons -->\n            </div>\n\n        </div>\n    </div><!-- // end widget -->\n\n    <!-- Right buttons -->\n    <div class="pnd-statement-buttons">\n        <button \n            type="button" \n            class="btn btn-xs" \n            ng-click="showDropdown($event)" \n            title="Triple menu"\n            ng-disabled="templateMode">\n                <span class="pnd-icon pnd-icon-bars"></span>\n        </button>\n    </div>\n</div>')}]),angular.module("src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",'<!-- HEADER -->\n<div class="pnd-panel-tab-content-header">\n    {{headerMessage}}\n</div>\n\n<!-- CONTENT -->\n<div class="pnd-panel-tab-content-content">\n    <div \n        class="pnd-triplecomposer-statements-container pnd-inner-scrollable" \n        ng-hide="saving">\n        <statement \n            ng-repeat="s in statements" \n            id="{{s.id}}" \n            duplicated="s.scope.duplicated"></statement>\n    </div>\n\n    <div \n        class="pnd-triplecomposer-saving-content" \n        ng-if="saving">\n        <span \n            class="pnd-icon {{savingIcon}} pnd-icon-3x"></span>\n        <span \n            class="{{shortMessageClass}}">{{shortMessagge}}</span>\n        {{textMessage}}\n    </div>\n</div>\n\n<!-- FOOTER -->\n<div class="pnd-panel-tab-content-footer">\n    <!-- TODO: use ng-disabled -->\n    <button \n        class="pnd-triplecomposer-save btn btn-success btn-xs pnd-btn-full disabled" \n        ng-hide="editMode" \n        ng-click="saveAnnotation()">\n        Save annotation\n    </button>\n    <button \n        class="pnd-triplecomposer-save btn btn-success btn-xs pnd-btn-full disabled" \n        ng-show="editMode" \n        ng-click="editAnnotation()">\n        Update Annotation\n    </button>\n    <button \n        class="pnd-triplecomposer-cancel btn btn-info btn-xs pnd-btn-full" \n        ng-if="!editMode" \n        ng-disabled="!isAnnotationErasable()"\n        ng-click="resetComposer()">\n        Reset\n    </button>\n    <button \n        class="pnd-triplecomposer-cancel btn btn-info btn-xs pnd-btn-full" \n        ng-if="editMode" \n        ng-click="cancel()">\n        Cancel\n    </button>\n    <!-- <button class="pnd-triplecomposer-add-blank btn btn-info btn-xs pnd-btn-full" ng-hide="templateMode" ng-click="onClickAddStatement()">Add blank statement</button> -->\n</div>')}]),angular.module("Pundit2",["ngResource","ngSanitize","ngAnimate","mgcrea.ngStrap","templates-main","Pundit2.Core","Pundit2.Annomatic","Pundit2.AnnotationSidebar","Pundit2.Dashboard","Pundit2.Toolbar","Pundit2.Communication","Pundit2.Annotators","Pundit2.ContextualMenu","Pundit2.Preview","Pundit2.Client","Pundit2.PageItemsContainer","Pundit2.Item","Pundit2.MyItemsContainer","Pundit2.ResourcePanel","Pundit2.Vocabularies","Pundit2.TripleComposer","Pundit2.NotebookComposer","Pundit2.VocabulariesContainer","Pundit2.MyNotebooksContainer","KorboEE","Pundit2.SimplifiedClient","Pundit2.PredicatesContainer"]);
var PUNDITVERSION={version:"2.0.47.beta.20141128"};angular.module("Pundit2.Client",[]),angular.module("Pundit2.Client").run(["$injector","Config",function(a,b){if(b.isValid()&&b.isModuleActive("Client")){var c=a.get("Client");c.boot()}}]).constant("CLIENTDEFAULTS",{debug:!1,relationsContainer:"usableRelations",bootModules:["Toolbar","Dashboard","AnnotationSidebar","Preview","MyNotebooksContainer","SelectorsManager","PredicatesContainer","PageItemsContainer","MyItemsContainer","NotebookComposer","TripleComposer"],basicRelations:[{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"has comment (free text)",description:"Any comment related to the selected fragment of text or image",domain:["http://purl.org/pundit/ont/ao#fragment-image","http://purl.org/pundit/ont/ao#fragment-text","http://xmlns.com/foaf/0.1/Image"],range:["http://www.w3.org/2000/01/rdf-schema#Literal"],vocabulary:"Basic Relation",uri:"http://schema.org/comment"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"depicts",description:"An image or part of an image depicts something",domain:["http://xmlns.com/foaf/0.1/Image","http://purl.org/pundit/ont/ao#fragment-image"],range:[],vocabulary:"Basic Relation",uri:"http://xmlns.com/foaf/0.1/depicts"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is similar to",description:"The selected fragment (text or image fragment) is similar to another fragment (of the same or of different types)",domain:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],range:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/vocab#similarTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"has creator",description:"The selected text fragment has been created by a specific Person",domain:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],range:["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person"],vocabulary:"Basic Relation",uri:"http://purl.org/dc/terms/creator"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"cites",description:"The selected text fragment cites another text fragment, or a Work or a Person",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://purl.org/pundit/ont/ao#fragment-text","http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],vocabulary:"Basic Relation",uri:"http://purl.org/spar/cito/cites"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"quotes",description:"The selected text fragment is a sentence from a Person or a Work, usually enclosed by quotations (eg: '')",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],vocabulary:"Basic Relation",uri:"http://purl.org/spar/cito/includesQuotationFrom"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"talks about",description:"The selected text fragment talks about some other text, Entity, Person or any other kind of concept",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:[],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#talksAbout"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is related to",description:"The selected text fragment is someway related to another text, Entity, Person or any other kind of concept",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:[],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isRelatedTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"identifies",description:"The selected text fragment is a Person, a Work, a Place or a well defined Entity",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/location/location","http://dbpedia.org/ontology/Place","http://schema.org/Place","http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing","http://www.freebase.com/schema/people/person","http://dbpedia.org/ontology/Person","http://xmlns.com/foaf/0.1/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#identifies"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is date",description:"The selected text fragment corresponds to the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"period of dates starts at",description:"The selected text fragment corresponds to the specified date period which starts at the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#periodStartDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"period of dates ends at",description:"The selected text fragment corresponds to the specified date period which ends at the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#periodEndDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"translates to",description:"The selected text fragment translation is given as free text",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2000/01/rdf-schema#Literal"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#translatesTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is translation of",description:"The selected text fragment is the translation of another text fragment",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://purl.org/pundit/ont/ao#fragment-text"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isTranslationOf"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is written in",description:"The selected text fragment is written in the specified language (french, german, english etc)",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/language/human_language"],vocabulary:"Basic Relation",uri:"http://purl.org/pundit/ont/oa#isWrittenIn"}]}).service("Client",["CLIENTDEFAULTS","BaseComponent","Config","EventDispatcher","MyPundit","ImageAnnotator","TextFragmentAnnotator","AnnotationsCommunication","AnnotationsExchange","Item","ItemsExchange","MyItems","Status","TextFragmentHandler","ImageHandler","PageAnnotator","Toolbar","Annomatic","NotebookCommunication","NotebookExchange","SelectorsManager","FreebaseSelector","MurucaSelector","KorboBasketSelector","Korbo2Selector","EuropeanaSelector","DbpediaSelector","GeonamesSelector","PredicateSelector","TemplatesSelector","TripleComposer","ImageFragmentAnnotatorHelper","$injector","$templateCache","$rootScope","$compile","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){var L,M=new b("Client",a),N=function(){L=angular.element("[data-ng-app='Pundit2']"),L.hasClass("pnd-wrp")||L.addClass("pnd-wrp")},O=function(){for(var a=0,b=M.options.bootModules.length;b>a;a++){var d=M.options.bootModules[a];if(c.isModuleActive(d)){var e,f=G.get(d);"clientDomTemplate"in f.options?(e=H.get(f.options.clientDomTemplate),"undefined"==typeof e?M.err("Can not bootstrap module "+f.name+", template not found: "+f.options.clientDomTemplate):(L.append(e),M.log("Appending to DOM "+f.name,e))):"clientDashboardTemplate"in f.options&&"clientDashboardPanel"in f.options&&"clientDashboardTabTitle"in f.options&&c.isModuleActive("Dashboard")?(e=H.get(f.options.clientDashboardTemplate),"undefined"==typeof e?M.err("Can not bootstrap module "+f.name+", template not found: "+f.options.clientDashboardTemplate):(G.get("Dashboard").addContent(f.options.clientDashboardPanel,f.options.clientDashboardTabTitle,f.options.clientDashboardTemplate),M.log("Adding to Dashboard: "+f.name+" to panel "+f.options.clientDashboardPanel))):M.err("Did not bootstrap module "+d+": .options parameters missing.")}else M.log("Not bootstrapping "+d+": not active.")}},P=function(a){L.append(a)},Q=function(){var a=0,b=M.options.basicRelations;for(var c in b)k.addItemToContainer(new j(b[c].uri,b[c]),[M.options.relationsContainer,"basicRelations"]);M.log("Loaded "+a+" basic relations")},R=function(){C.getAllVocabularies().then(function(a){for(var b in a){k.addItemToContainer(new j(a[b].uri,a[b]),[M.options.relationsContainer,"vocabularyRelations"]);var c=k.getItemByUri(a[b].uri);"undefined"==typeof a[b].label||k.isItemInContainer(c,"templateRelations")||(c.label=a[b].label)}M.log("Loaded "+a.length+" relations from extern vocabularies")})};M.boot=function(){if(N(),c.useBasicRelations&&Q(),R(),c.useTemplates&&D.getAll().then(function(){c.useOnlyTemplateMode&&E.showCurrentTemplate()}),c.disableImageAnnotation&&o.turnOff(),e.checkLoggedIn().then(function(a){a===!0&&(l.getAllItems(),s.getMyNotebooks(),s.getCurrent()),h.getAnnotations(),I.$watch(function(){return e.isUserLogged()},function(a,b){a!==b&&(a===!0?(M.log("User just logged in"),S()):(M.log("User just logged out"),T()))})}),"undefined"!=typeof c.korbo&&c.korbo.active){var a="<korbo-entity-editor conf-name='"+c.korbo.confName+"'></korbo-entity-editor>";P(a)}U(),u.init(),O(),M.log("Boot is completed, emitting pundit-boot-done event"),d.sendEvent("Client.boot")};var S=function(){t.wipe(),k.wipe(),i.wipe(),s.getMyNotebooks(),s.getCurrent(),h.getAnnotations(),l.getAllItems(),c.useBasicRelations&&Q(),R()},T=function(){t.wipe(),k.wipe(),i.wipe(),h.getAnnotations(),c.useBasicRelations&&Q(),R()},U=function(){if(c.korbo.active){var a=K[c.korbo.confName],b=a.languages[0];for(var d in a.languages)if(a.languages[d].state===!0){b=a.languages[d];break}var e={container:"kee-korbo2",label:"Korbo",active:!0,basketID:a.basketID,url:a.endpoint,language:b.value},f=new y(e);f.push(e),delete f}};return M.log("Component up and running"),M}]),angular.module("Pundit2.SimplifiedClient",[]),angular.module("Pundit2.SimplifiedClient").run(["$injector","Config",function(a,b){if(b.isModuleActive("SimplifiedClient")){var c=a.get("SimplifiedClient");c.boot()}}]).service("SimplifiedClient",["BaseComponent","$rootScope","$window","MyPundit","MyItems","AnnotationsCommunication","TextFragmentAnnotator","Consolidation","ItemPopover",function(a,b,c,d,e,f,g,h,i){var j,k=new a("SimplifiedClient"),l=function(){j=angular.element("[data-ng-app='Pundit2']"),j.hasClass("pnd-wrp")||j.addClass("pnd-wrp")},m=!0,n=function(){i.hide(),m?h.wipe():h.consolidateAll(),m=!m};return c.PUNDIT.simplifiedClient={toggleAnnotation:n},k.boot=function(){l(),f.getAnnotations()},k}]),angular.module("Pundit2.SimplifiedClient").service("ItemPopover",["BaseComponent","$rootScope","$popover","AnnotationsExchange",function(a,b,c,d){var e,f,g=new a("ItemPopover"),h=null,i=null,j=null,k=!0,l="bottom",m={scope:b.$new(),title:"Annotations Preview",template:"src/SimplifiedClient/ItemPopover.tmpl.html",trigger:"manual",container:"[data-ng-app='Pundit2']"};return g.show=function(a,b,d,e){null!==h&&(h.hide(),h.destroy()),"undefined"!=typeof b&&(i=b),"undefined"!=typeof a&&(j=a),k="undefined"!=typeof e?e:!0,m.placement="string"!=typeof d?l:d,h=c(j,m),h.$promise.then(h.show)},g.hide=function(){null!==h&&h.$isShown!==!1&&(h.hide(),h.destroy(),h=null)},g.update=function(a,b){var c=angular.element("html");return b.top+a.height()>c.height()&&g.show(j,i,"top",!1),b.left<0?void g.show(j,i,"right",!1):b.left+a.width()>c.width()?void g.show(j,i,"left",!1):void 0},g.fix=function(){if("bottom"!==m.placement){var a="top"===m.placement?1:2,b=angular.element(".pnd-item-popover"),c=b.height(),d=e+(f-c)/a;b.css("top",d),f=c,e=d}},g.getAnnotation=function(){return null!==i?d.getAnnotationsByItem(i.uri):void 0},m.scope.$on("tooltip.show",function(){var a=angular.element(".pnd-item-popover"),b=a.position();e=b.top,f=a.height(),k&&g.update(a,b)}),g.log("Up and running!"),g}]),angular.module("Pundit2.SimplifiedClient").controller("ItemPopoverCtrl",["$scope","ItemPopover",function(a,b){a.annotations=b.getAnnotation(),a.hide=function(){b.hide()},a.onContentClick=function(){b.fix()}}]),angular.module("Pundit2.Core",[]),angular.module("Pundit2.Core").service("Utils",function(){var a={};return a.deepExtend=function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=angular.copy(b[c]);return a},a.getLabelFromURI=function(a){var b;return a.match("http://www.freebase.com/schema/")?b=a.substring(31).replace(/\//g,": ").replace(/_/g," "):a.match("http://dbpedia.org/ontology/")?b=a.substring(28).replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()}):(b=a.substring(a.lastIndexOf("/")+1),-1!==b.indexOf("#")&&(b=b.substring(b.lastIndexOf("#")+1)),b)},a.isValidDate=function(a){if("string"==typeof a){var b=a.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(null!==b){var c=+b[3],d=+b[2],e=+b[1],f=new Date(e,d-1,c);if(f.getFullYear()===e&&f.getMonth()===d-1)return!0}return!1}},a}),angular.module("Pundit2.Core").constant("BASECOMPONENTDEFAULTS",{debug:!1}).service("BaseComponent",["$log","Utils","BASECOMPONENTDEFAULTS","$window","Config",function(a,b,c,d,e){var f=function(a,f){this.name=a,this.options=angular.copy(c),"undefined"!=typeof f&&b.deepExtend(this.options,f),"undefined"==typeof d.PUNDIT&&(d.PUNDIT={config:e},this.log("Created PUNDIT global object")),"undefined"!=typeof e.modules[this.name]&&(b.deepExtend(this.options,e.modules[this.name]),this.log("BaseComponent extending with Config.modules conf")),e.modules[this.name]=this.options};return f.prototype.err=function(){var b=function(){try{throw Error("")}catch(a){return a}},c=b(),d=c.stack.split("\n")[5],e=Array.prototype.slice.call(arguments);e.unshift("#PUNDIT "+this.name+"#"),e.push(d),a.error.apply(null,e)},f.prototype.log=function(){if(e.debugAllModules===!0||this.options.debug===!0){var b=Array.prototype.slice.call(arguments);b.unshift("#"+this.name+"#"),a.log.apply(null,b)}},f}]),angular.module("Pundit2.Core").service("EventDispatcher",["$q","BaseComponent",function(a,b){var c=new b("EventDispatcher"),d={};return c.sendEvent=function(b,c){var e,f=[],g=[],h=0;return d[b]&&angular.forEach(d[b],function(d){"undefined"!=typeof d&&(e={name:b,args:c,resolve:function(a){h<g.length&&(g[h].resolve(a),h++)},reject:function(a){h<g.length&&(g[h].reject(a),h++)}},g.push(a.defer()),d.apply(null,[e]))}),f=g.map(function(a){return a.promise}),a.all(f)},c.addListener=function(a,b){return d[a]||(d[a]=[]),d[a].push(b),[a,b]},c.addListeners=function(a,b){var d=[];for(var e in a)d.push(c.addListener(a[e],b));return d},c.removeListener=function(a){var b=a[0],c=a[1];d[b]&&angular.forEach(d[b],function(a,e){return a===c&&(d[b].splice(e,1),0===d[b].length)?void delete d[b]:void 0})},c.getListeners=function(){var a=[];for(var b in d)a.push(b);return a},c}]),angular.module("Pundit2.Core").constant("STATUSDEFAULTS",{debug:!1}).service("Status",["BaseComponent","EventDispatcher","STATUSDEFAULTS",function(a,b,c){var d=new a("Status",c),e={AnnotationSidebar:{},Dashboard:{},Toolbar:{},Pundit:{clientBoot:!1,userLogged:!1,loading:!1,templateMode:!1}},f=[],g={},h=function(a){b.sendEvent("Pundit.loading",a)},i=function(a,b){var c=[];"undefined"==typeof g[a]&&(g[a]=0),b?(e.Pundit.loading=!0,h(!0),g[a]++):(g[a]--,c=Object.keys(g).filter(function(a){return g[a]>0}),0===c.length&&(e.Pundit.loading=!1,h(!1),g[a]=0))};return b.addListeners(["AnnotationsCommunication.loading","NotebookCommunication.loading","NotebookComposerCtrl.loading","Annomatic.loading","MyItems.loading"],function(a){i(a.name,a.args)}),b.addListener("Client.boot",function(){e.Pundit.clientBoot=!0}),b.addListener("MyPundit.isUserLogged",function(a){e.Pundit.userLogged=a.args}),b.addListener("AnnotationSidebar.toggle",function(a){e.AnnotationSidebar.isExpanded=a.args}),b.addListener("AnnotationSidebar.toggleFiltersContent",function(a){e.AnnotationSidebar.isFiltersContentExpanded=a.args}),b.addListener("Pundit.templateMode",function(a){e.Pundit.templateMode=a.args,b.sendEvent("Pundit.changeSelection")}),b.addListener("Pundit.error",function(a){f.push(a.args)}),d.getState=function(a){return e[a]},d.getClientBoot=function(){return e.Pundit.clientBoot},d.getLoading=function(){return e.Pundit.loading},d.getUserStatus=function(){return e.Pundit.userLogged},d.getTemplateModeStatus=function(){return e.Pundit.templateMode},d.getLog=function(){return f},d}]),angular.module("Pundit2.Core").service("NameSpace",["BaseComponent","Config","$interpolate","$window",function(a,b,c,d){var e=new a("NameSpace"),f="http://www.w3.org/1999/02/22-rdf-syntax-ns#",g="http://www.w3.org/2000/01/rdf-schema#",h="http://purl.org/dc/elements/1.1/",i="http://purl.org/dc/terms/",j="http://purl.org/pundit/ont/ao#",k="http://www.w3.org/2004/02/skos/core#";return d.PUNDIT.ns=e,e.punditOntologyBaseURL=j,e.rdf={},e.rdf.type=f+"type",e.rdf.value=f+"value",e.rdf.property=f+"Property",e.rdfs={},e.rdfs.label=g+"label",e.rdfs.comment=g+"comment",e.rdfs.resource=g+"Resource",e.rdfs.literal=g+"Literal",e.rdfs.seeAlso=g+"seeAlso",e.dateTime="http://www.w3.org/2001/XMLSchema#dateTime",e.item={label:e.rdfs.label,altLabel:k+"altLabel",description:h+"description",image:"http://xmlns.com/foaf/0.1/depiction",type:e.rdf.type,pageContext:j+"hasPageContext",isPartOf:i+"isPartOf",selector:"http://www.w3.org/ns/openannotation/core/hasSelector",parentItemXP:j+"parentItemXP"},e.notebook={label:e.rdfs.label,visibility:"http://open.vocab.org/terms/visibility",created:i+"created",creator:i+"creator",creatorName:h+"creator",id:j+"id",includes:j+"includes",type:e.rdf.type},e.annotation={creatorName:h+"creator",created:i+"created",creator:i+"creator",modified:i+"modified",pageContext:j+"hasPageContext",target:"http://www.openannotation.org/ns/hasTarget",isIncludedIn:j+"isIncludedIn",hasTemplate:j+"hasTemplate"},e.fragments={imagePart:j+"fragment-image",text:j+"fragment-text"},e.types={page:"http://schema.org/WebPage",image:"http://xmlns.com/foaf/0.1/Image",named:j+"named-content"},e.typesLabels={},e.typesLabels[e.fragments.imagePart]="Image fragment",e.typesLabels[e.fragments.text]="Text fragment",e.typesLabels[e.types.page]="Web page",e.typesLabels[e.types.image]="Image",e.typesLabels[e.types.named]="Named content",e.selectors={baseURI:"http://purl.org/pundit/selector/",polygonType:"http://purl.org/pundit/ont/ao#selector-polygon",rectangleType:"http://purl.org/pundit/ont/ao#selector-rectangle"},e.fragmentBaseUri="http://purl.org/pundit/fragment/",e.as=b.annotationServerBaseURL,e.asUsers=e.as+"api/users/",e.asUsersCurrent=e.as+"api/users/current",e.asUsersLogout=e.as+"api/users/logout",e.asNB=e.as+"api/notebooks",e.asNBEditMeta=e.as+"api/notebooks/{{id}}",e.asNBOwned=e.as+"api/notebooks/owned",e.asNBCurrent=e.as+"api/notebooks/current",e.asNBPrivate=e.as+"api/notebooks/private/{{id}}",e.asNBPublic=e.as+"api/notebooks/public/{{id}}",e.asNBMeta=e.as+"api/notebooks/{{id}}/metadata",e.asOpen=e.as+"api/open/",e.asOpenNBMeta=e.as+"api/open/notebooks/{{id}}/metadata",e.asOpenNBAnnMeta=e.as+"api/open/notebooks/{{id}}/annotations/metadata",e.asAnnMetaSearch=e.as+"api/annotations/metadata/search",e.asOpenAnnMetaSearch=e.as+"api/open/metadata/search",e.asAnn=e.as+"api/annotations/{{id}}",e.asOpenAnn=e.as+"api/open/annotations/{{id}}",e.asAnnContent=e.as+"api/annotations/{{id}}/content",e.asAnnItems=e.as+"api/annotations/{{id}}/items",e.asPref=e.as+"api/services/preferences/{{key}}",e.get=function(a,b){if("string"!=typeof e[a])return void e.err("get() cant find key "+a);"undefined"==typeof b&&(b={});var d,f=e[a],g=f.match(/{{([a-zA-Z0-9]*)}}/g);if(null!==g&&g.length>0){var h=0;for(d in b)h++;if(g.length>h)return void e.err("Context variables mismatch! Expecting "+g.join(", ")+" instead got "+JSON.stringify(b))}return c(f)(b)},e.log("NameSpace up and running"),e}]),angular.module("Pundit2.Core").factory("Config",["PUNDITDEFAULTCONF","$window","Utils",function(a,b,c){var d={};return c.deepExtend(d,a),"undefined"!=typeof b.punditConfig&&angular.isObject(b.punditConfig)&&c.deepExtend(d,b.punditConfig),d.isValid=function(){return!0},d.isModuleActive=function(a){return angular.isObject(d.modules[a])&&d.modules[a].active===!0},"undefined"==typeof b.PUNDIT&&(b.PUNDIT={config:d}),d}]),angular.module("Pundit2.Core").constant("PUNDITDEFAULTCONF",{korbo:{active:!1,confName:"KORBODEFAULTCONF"},imageFragmentAnnotator:{active:!1,baseUrl:"http://dev.thepund.it/download/ia/last-beta/index.php?u="},postSave:{active:!1,callbacks:[]},annotationServerBaseURL:"http://demo-cloud.as.thepund.it:8080/annotationserver/",askBaseURL:"http://demo-cloud.ask.thepund.it/",pndPurl:"http://purl.org/pundit/demo-cloud-server/",confURL:"local",debugAllModules:!1,vocabularies:[],templates:["http://conf.thepund.it/V2/templates/tagFree","http://conf.thepund.it/V2/templates/comment","http://conf.thepund.it/V2/templates/tagFixedMarx","http://conf.thepund.it/V2/templates/timeline","http://conf.thepund.it/V2/templates/peopleGraph"],useTemplates:!0,disableImageAnnotation:!1,forceEditAndDelete:!1,forceTemplateEdit:!1,useOnlyTemplateMode:!1,useBasicRelations:!0,modules:{Client:{active:!1},SimplifiedClient:{active:!1},Annomatic:{active:!1},Dashboard:{active:!0},Toolbar:{active:!0},AnnotationSidebar:{active:!0},Preview:{active:!0},PageItemsContainer:{active:!0},PredicatesContainer:{active:!0},MyNotebooksContainer:{active:!0},MyItemsContainer:{active:!0},SelectorsManager:{active:!0},TripleComposer:{active:!0},NotebookComposer:{active:!0}},lodLive:{active:!1,baseUrl:"http://demo-lodlive.thepund.it/?"},timeline:{active:!1,baseUrl:"http://metasound.dibet.univpm.it/timelinejs/examples/pundit.html?"}}),angular.module("Pundit2.Core").constant("MYPUNDITDEFAULTS",{loginPollTimerMS:1e3,loginModalCloseTimer:3e5}).service("MyPundit",["MYPUNDITDEFAULTS","$http","$q","$timeout","$modal","$window","$interval","BaseComponent","EventDispatcher","NameSpace",function(a,b,c,d,e,f,g,h,i,j){var k,l,m=new h("MyPundit",a),n=!1,o={};m.getLoginStatus=function(){return l},m.isUserLogged=function(){return n},m.setIsUserLogged=function(a){n=a},m.getUserData=function(){return""!==o&&"undefined"!=typeof o?o:void 0},m.checkLoggedIn=function(){var a,d=c.defer();return a=b({headers:{Accept:"application/json"},method:"GET",url:j.get("asUsersCurrent"),withCredentials:!0}).success(function(a){k=a.loginServer,0===a.loginStatus?(n=!1,i.sendEvent("MyPundit.isUserLogged",n),d.resolve(!1)):(n=!0,l="loggedIn",o=a,i.sendEvent("MyPundit.isUserLogged",n),d.resolve(!0))}).error(function(){m.err("Server error"),d.reject("check logged in promise error")}),d.promise};var p;m.login=function(){return p=c.defer(),m.isUserLogged()?p.resolve(!0):(l="loggedOff",m.openLoginPopUp()),p.promise};var q;m.openLoginPopUp=function(){if(d.cancel(q),"undefined"==typeof p)return void m.err("Login promise not defined, you should call login() first");l="waitingForLogIn";var a=f.open(k,"loginpopup","left=260,top=120,width=480,height=360"),b=g(function(){"undefined"==typeof a||!a.closed&&null!==a||(g.cancel(b),d(function(){d.cancel(q)},5e3))},1e3),c=function(){var a=m.checkLoggedIn();a.then(function(a){a&&(p.resolve(!0),g.cancel(b),d.cancel(q))},function(){p.reject("login error")}),q=d(c,m.options.loginPollTimerMS)};c(),d(function(){d.cancel(q),p.resolve(!1),a.close()},m.options.loginModalCloseTimer)},m.logout=function(){var a,d=c.defer();return a=b({headers:{Accept:"application/json"},method:"GET",url:j.get("asUsersLogout"),withCredentials:!0}).success(function(){n=!1,i.sendEvent("MyPundit.isUserLogged",n),o={},d.resolve(!0)}).error(function(){d.reject("logout promise error")}),d.promise};var r=e({container:"[data-ng-app='Pundit2']",template:"src/Core/Templates/login.modal.tmpl.html",show:!1,backdrop:"static"});return m.closeLoginModal=function(){r.hide(),d.cancel(q)},m.cancelLoginModal=function(){r.hide(),p.resolve(!1),d.cancel(q)},m}]),angular.module("Pundit2.Core").constant("ANALYTICSDEFAULTS",{trackingCode:"UA-50437894-1",globalTracker:"__gaPndtTracker",maxHits:20,bufferDelay:1e3,doTracking:!0,debug:!1}).service("Analytics",["BaseComponent","$window","$document","$interval","$timeout","ANALYTICSDEFAULTS",function(a,b,c,d,e,f){var g,h=new a("Analytics",f),i={events:[]},j=0,k=!1,l=!1,m=h.options.maxHits;!function(a,c,d,e,f,g,i){a.GoogleAnalyticsObject=f,a[f]=a[f]||function(){(a[f].q=a[f].q||[]).push(arguments)},a[f].l=1*new Date,g=c.createElement(d),i=c.getElementsByTagName(d)[0],g.async=1,g.src=e,g.onload=function(){h.log("GA async script loaded"),n=b[h.options.globalTracker]},i.parentNode.insertBefore(g,i)}(b,c[0],"script","//www.google-analytics.com/analytics.js",h.options.globalTracker);var n=b[h.options.globalTracker];n("create",h.options.trackingCode,{storage:"none",cookieDomain:"none"});var o=function(){return m>=h.options.maxHits?(l=!1,void h.log(h.options.maxHits+" hits available again")):void(g=e(function(){m=Math.min(m+2,h.options.maxHits),o(),p()},h.options.bufferDelay))},p=function(){if(0===i.events.length)return void(k=!1);if(m>0){j++;var a=i.events.shift();n("send",{hitType:"event",eventCategory:a.eventCategory,eventAction:a.eventAction,eventLabel:a.eventLabel,eventValue:a.eventValue}),m--,l||(l=!0,o()),h.log("Tracked ("+j+" sent / "+m+" available) event "+a.eventCategory+" ("+a.eventAction+": "+a.eventLabel+")"),p()}};return h.getHits=function(){return m},h.track=function(a,b,c,d){if(h.options.doTracking){if(!angular.isDefined(a)||!angular.isDefined(b))return void h.err("Category and Action are required");i.events.push({eventCategory:a,eventAction:b,eventLabel:c,eventValue:d}),k||(k=!0,p())}},h.log("Component running"),h}]),angular.module("Pundit2.Core").service("PredicateSelector",["BaseComponent","Config","$http","$q",function(a,b,c,d){var e=new a("PredicateSelector");return e.getAllVocabularies=function(){var a=b.vocabularies,c=[],f=d.defer();e.log("Loading predicates from",a);var g=[];for(var h in a){var i=e.getRelations(a[h]);i.then(function(a){c.push.apply(c,a)}),g.push(i)}return d.all(g).then(function(){e.log("Completed loading, get "+c.length+" predicates"),f.resolve(c)}),f.promise},e.getRelations=function(a){var b,f=d.defer();return b=a.indexOf("?")>-1?"&jsonp=JSON_CALLBACK":"?jsonp=JSON_CALLBACK",c.jsonp(a+b).success(function(b){if("undefined"==typeof b||"undefined"==typeof b.result)return e.log("Impossible to get predicates from: "+a),void f.resolve();if("predicates"!==b.result.vocab_type)return e.log("Response not is a predicates vocabularie "+a),void f.resolve();if("undefined"==typeof b.result.items)return e.log("Response not have items property "+a),void f.resolve();var c=b.result.items,d=[];for(var g in c){e.log("Add "+c[g].label);var h=c[g];delete h.children,delete h.is_root_node,delete h.nodetype,h.type=h.rdftype,delete h.rdftype,h.uri=h.value,delete h.value,h.vocabulary=a+" (External Vocabulary)",d.push(h)}e.log("Loaded "+d.length+" predicates from: "+a),f.resolve(d)}),f.promise},e}]),angular.module("Pundit2.Core").service("TemplatesSelector",["BaseComponent","Config","$http","$q","Item","Template","ItemsExchange","TemplatesExchange","FreebaseSelector",function(a,b,c,d,e,f,g,h,i){var j=new a("TemplatesSelector"),k="templateRelations",l=new i({container:"freebase"});return j.getAll=function(){var a=b.templates,c=[];a.length>0&&h.setCurrent(a[0]);for(var e in a)c.push(j.get(a[e]));return j.log("Loading templates from",a),d.all(c)},j.get=function(a){var h,i=d.defer();return h=a.indexOf("?")>-1?"&jsonp=JSON_CALLBACK":"?jsonp=JSON_CALLBACK",c.jsonp(a+h).success(function(c){if("undefined"==typeof c||"undefined"==typeof c.triples)return j.log("Impossible to get templates from: "+a),void i.resolve(void 0);c.id=a;var h,m=c.triples;for(h in m)"undefined"!=typeof m[h].predicate&&(m[h].predicate.type=["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],m[h].predicate.vocabulary=a+" (Template)",g.addItemToContainer(new e(m[h].predicate.uri,m[h].predicate),[b.modules.Client.relationsContainer,k]),"undefined"!=typeof m[h].predicate.uri.label&&(g.getItemByUri(m[h].predicate.uri).label=m[h].predicate.uri.label));var n=new f(c.id,c);for(h in m)"undefined"!=typeof m[h].object&&"uri"===m[h].object.type&&m[h].object.value.indexOf("freebase")>-1&&!function(a){var b=m[h].object.value.substring(23),c={mid:b,image:"https://usercontent.googleapis.com/freebase/v1/image"+b,description:-1,uri:-1},f=d.defer();f.promise.then(function(b){n.triples[a].object.type="item",n.triples[a].object.value=b,n.triples[a].object.value.label=n.triples[a].object.label,n.triples[a].object.value=new e(n.triples[a].object.value.uri,n.triples[a].object.value)}),l.getItemDetails(c,f)}(h);j.log("Loaded template:",n),i.resolve(n)}).error(function(){i.resolve(void 0)}),i.promise},j}]),angular.module("Pundit2.Core").constant("FP3DEFAULTS",{label:"Finish",link:"",active:!1,debug:!1}).service("Fp3",["BaseComponent","FP3DEFAULTS","Config","$http","$q","$window","$document","AnnotationsExchange","XpointersHelper","Consolidation",function(a,b,c,d,e,f,g,h,i,j){var k=new a("Fp3",b),l="#html-storage";return k.getPunditContentUrl=function(){var a=angular.element(".pundit-content").attr("about");return"undefined"==typeof a?"":a},k.getNodeContent=function(){var a=angular.element(l).html();return"undefined"==typeof a?"":a},k.convertToFAM=function(){var a,b,c,d,e,f,g=[];j.wipe();var l=h.getAnnotations();for(var m in l){e=l[m].entities[0],b=l[m].graph[e],a=l[m].items[e];for(var n in b)c=n,d=b[c][0];if(f=Object(),f.annotatedAt=l[m].created,f.annotatedBy=l[m].creator,f.anchorOf=a.description,f.id=l[m].id,f.pageContext=l[m].pageContext,f.subject=e,f.predicate=c,f.object=d.value,f.objectData="uri"==d.type?l[m].items[d.value]:Object,e.indexOf("xpointer")>-1){var o=k.getPunditContentUrl(),p=e.replace(o,""),q=i.xPointerToXPath(p),r=q.startOffset,s=q.endOffset,t=q.startNode.data,u=q.endNode.data;beforeStartOffset=q.startOffset-10,beforeEndOffset=q.startOffset,0>beforeStartOffset&&(beforeStartOffset=0),afterStartOffset=q.endOffset,afterEndOffset=parseInt(q.endOffset)+10,afterEndOffset>u.length&&(afterEndOffset=u.length);var v=t.substring(beforeStartOffset,beforeEndOffset),w=u.substring(afterStartOffset,afterEndOffset);f.before=v,f.after=w,f.start=r,f.end=s}g.push(f)}return j.consolidateAll(),g},k.post=function(){var a=e.defer();return""===k.options.link?void k.log("Error: you must configure a link to POST data"):(d({headers:{"Content-Type":"application/json"},method:"POST",url:k.options.link+"?fp=on",data:{annotations:k.convertToFAM(),punditContent:k.getPunditContentUrl(),punditPage:k.getNodeContent(),annotationServerBaseURL:c.annotationServerBaseURL},withCredentials:!0}).success(function(){k.log("Success: fp3 post data")}).error(function(b){k.log("Error: impossible to post data",b),a.reject()}),a.promise)},k.log("Up and Running"),k}]),angular.module("Pundit2.Core").service("ImageFragmentAnnotatorHelper",["$rootScope","$modal","$window","BaseComponent","EventDispatcher","Config","NameSpace","ContextualMenu","XpointersHelper","Item","MyItems","MyPundit",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new d("ImageFragmentAnnotatorHelper"),n={close:"ia-closed",addPolygon:"ia-add-polygon"},o='<iframe class="pnd-image-fragment-frame" width="620" height="500" src="'+f.imageFragmentAnnotator.baseUrl,p='" scrolling="no" frameborder="0" allowfullscreen></iframe>',q=function(){h.addAction({type:[f.modules.ImageHandler.cMenuType],name:"openImageFragmentAnnotator",label:"Annotate a part of this image",showIf:function(){return!0
},priority:99,action:function(a){u(a)}})};e.addListener("Client.boot",function(){f.imageFragmentAnnotator.active&&q()}),c.addEventListener("message",function(a){if(a.data.type===n.close&&v(),a.data.type===n.addPolygon){var b=a.data;if(l.isUserLogged()){var c=m.createItemFromPolygon(b.poly);k.addItem(c).then(function(){r.postMessage({type:"pundit-add-to-my-items-success"},"*")},function(){r.postMessage({type:"pundit-add-to-my-items-err"},"*")})}else{var d=e.addListener("Consolidation.consolidateAll",function(){console.log("POLIGOOOO");var a=m.createItemFromPolygon(b.poly);k.addItem(a).then(function(){r.postMessage({type:"pundit-add-to-my-items-success"},"*")},function(){r.postMessage({type:"pundit-add-to-my-items-err"},"*")}),e.removeListener(d)});l.login()}}});var r,s,t,u=function(a){var b=decodeURIComponent(a.image);b=b.replace(/'/g,"\\'"),angular.element("[data-ng-app='Pundit2']").append("http://"===b.substring(0,7)||"https://"===b.substring(0,8)?o+b+p:o+"http://"+b+p),s=angular.element("body").css("overflow"),angular.element("body").css("overflow","hidden"),t=a,r=angular.element(".pnd-image-fragment-frame")[0].contentWindow},v=function(){angular.element("body").css("overflow",s),angular.element(".pnd-image-fragment-frame").remove()};return m.createItemFromPolygon=function(a){var b=t.image.substring(t.image.lastIndexOf("/")+1,t.image.length),c={uri:g.fragmentBaseUri+"image/"+(new Date).getTime(),type:[g.fragments.imagePart],label:a.name,description:"This fragment represents a part of the image "+b,isPartOf:t.isPartOf,image:t.image,pageContext:i.getSafePageContext(),polygon:angular.copy(a.points),polygonUri:g.selectors.baseURI+"polygon/"+((new Date).getTime()+1),parentItemXP:t.uri};return new j(c.uri,c)},m.drawPolygonOverImage=function(a,b){if("undefined"==typeof b||"undefined"==typeof a||!b.is("img, svg"))return!1;var c,d=b.width(),e=b.height(),f=(b.outerWidth(!0)-d)/2,g=(b.outerHeight(!0)-e)/2,h='<span class="pnd-cons-svg"></span>',i='<svg xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.0" class="pnd-polygon-layer" width='+d+" height="+e+"></svg>",j=angular.element(h).insertBefore(b).css({position:"absolute","margin-left":f,"margin-top":g}),k=angular.element(i).appendTo(j),l=[];for(c=0;c<a.length;c++)l.push({x:a[c].x*d,y:a[c].y*e});var m=[];for(c=0;c<l.length;c++){var n,o;c===l.length-1?(n=l[c],o=l[0]):(n=l[c],o=l[c+1]),m.push("<line x1="+n.x+" y1="+n.y+" x2="+o.x+" y2="+o.y+" ></line>")}var p='<polygon points="';for(c=0;c<l.length;c++)p+=l[c].x+","+l[c].y+" ";p+='"></polygon>',k.append(m),k.find("line").css({stroke:"red","stroke-width":2}),k.prepend(p),k.find("polygon").css({fill:"red",opacity:.3}),angular.element(j).html(j.html())},m}]),angular.module("Pundit2.Core").factory("Template",["BaseComponent","Utils","TemplatesExchange",function(a,b,c){var d=new a("Template"),e=function(a,e){return"undefined"==typeof a?void d.err("Can't create a template without an id"):(this.id=a,angular.isObject(e)&&(d.log("Extending new Template with values "+this.id,e),b.deepExtend(this,e)),void c.addTemplate(this))};return e}]),angular.module("Pundit2.Core").constant("ITEMDEFAULTS",{iconDefault:"pnd-icon pnd-icon-eye",iconImage:"pnd-icon pnd-icon-camera",iconText:"pnd-icon pnd-icon-align-center",iconWebPage:"pnd-icon pnd-icon-file-text",iconEntity:"pnd-icon pnd-icon-code-fork",classDefault:"pnd-item-default",classImage:"pnd-item-image",classText:"pnd-item-text",classWebPage:"pnd-item-web-page",classEntity:"pnd-item-entity"}).factory("Item",["BaseComponent","NameSpace","Utils","ItemsExchange","ITEMDEFAULTS",function(a,b,c,d,e){var f=new a("Item",e),g=function(a,b){return"undefined"==typeof a?void f.err("Can't create an item without an URI"):(this.uri=a,this.type=[],this.label="default item label",angular.isObject(b)&&(f.log("Extending new Item with values "+this.uri,b),c.deepExtend(this,b)),void d.addItem(this))};return g.prototype.isProperty=function(){return-1!==this.type.indexOf(b.rdf.property)},g.prototype.isTextFragment=function(){return-1!==this.type.indexOf(b.fragments.text)},g.prototype.isImage=function(){return-1!==this.type.indexOf(b.types.image)},g.prototype.isImageFragment=function(){return-1!==this.type.indexOf(b.fragments.imagePart)},g.prototype.isWebPage=function(){return-1!==this.type.indexOf(b.types.page)},g.prototype.isEntity=function(){return!(this.isImage()||this.isProperty()||this.isTextFragment()||this.isImage()||this.isImageFragment()||this.isWebPage())},g.prototype.fromAnnotationRdf=function(a){var c=b.item,d=a[this.uri];if("undefined"==typeof d)return void f.log("Error? No RDF for this item? ",this.uri);for(var e in c){var g=c[e];g in d&&(this[e]=d[g][0].value)}var h=d[b.rdf.type];if(angular.isArray(h)&&h.length>0){this.type=[];for(var i in h)this.type.push(h[i].value)}if(-1!==this.type.indexOf(b.fragments.imagePart)&&b.item.selector in d){var j=d[b.item.selector];for(var k in j){var l=j[k].value;if(l in a){var m=a[l];if(this.polygonUri=l,m[b.rdf.type][0].value===b.selectors.polygonType){var n=JSON.parse(m[b.rdf.value][0].value);this.polygon=n.points}}}}f.log("Created new item from annotation RDF: "+this.label)},g.prototype.toRdf=function(){var a={};return a[b.item.label]=[{type:"literal",value:this.label}],a[b.item.type]=[],this.type.forEach(function(c){a[b.item.type].push({type:"uri",value:c})}),"undefined"!=typeof this.altLabel&&(a[b.item.altLabel]=[{type:"literal",value:this.altLabel}]),"undefined"!=typeof this.description&&(a[b.item.description]=[{type:"literal",value:this.description}]),"undefined"!=typeof this.image&&(a[b.item.image]=[{type:"uri",value:this.image}]),"undefined"!=typeof this.pageContext&&(a[b.item.pageContext]=[{type:"uri",value:this.pageContext}]),"undefined"!=typeof this.isPartOf&&(a[b.item.isPartOf]=[{type:"uri",value:this.isPartOf}]),"undefined"!=typeof this.parentItemXP&&(a[b.item.parentItemXP]=[{type:"uri",value:this.parentItemXP}]),"undefined"!=typeof this.polygonUri&&(a[b.item.selector]=[{type:"uri",value:this.polygonUri}]),a},g.prototype.toJsonLD=function(){},g.prototype.getIcon=function(){return this.isImage()||this.isImageFragment()?f.options.iconImage:this.isTextFragment()?f.options.iconText:this.isWebPage()?f.options.iconWebPage:this.isEntity()?f.options.iconEntity:f.options.iconDefault},g.prototype.getClass=function(){return this.isImage()||this.isImageFragment()?f.options.classImage:this.isTextFragment()?f.options.classText:this.isWebPage()?f.options.classWebPage:this.isEntity()?f.options.classEntity:f.options.classDefault},f.log("Component up and running"),g}]),angular.module("Pundit2.Core").service("ItemsExchange",["BaseComponent",function(a){var b=new a("ItemsExchange"),c="properties",d={},e={},f=[],g={};b.wipe=function(){d={},e={},f=[],g={},b.log("Wiped every loaded item and every container.")},b.isItemInContainer=function(a,b){if("undefined"==typeof b)return!1;var c=e[a.uri];return"undefined"==typeof c?!1:-1===c.indexOf(b)?!1:!0},b.wipeContainer=function(a){return"undefined"==typeof d[a]?void b.log("Cannot wipe undefined container "+a):(d[a].forEach(function(b){if(e[b.uri].splice(e[b.uri].indexOf(a),1),0===e[b.uri].length){delete e[b.uri],delete g[b.uri];var c=f.indexOf(b);-1!==c&&f.splice(c,1)}}),delete d[a],void b.log("Wiped "+a+" container."))},b.getItems=function(){return f},b.getItemsHash=function(){return g},b.getItemByUri=function(a){return a in g?g[a]:void 0},b.getAll=function(){return{itemListByURI:g,itemListByContainer:d,itemContainers:e}},b.getItemsBy=function(a){if("function"==typeof a){var b=[];for(var c in g){var d=g[c];a(d)&&b.push(d)}return b}},b.getItemsFromContainerByFilter=function(a,b){if("function"==typeof b&&"undefined"!=typeof d[a]){var c=[],e=d[a];for(var f in e){var g=e[f];b(g)&&c.push(g)}return c}},b.getItemsByContainer=function(a){return"undefined"!=typeof d[a]?d[a]:[]},b.addItemToContainer=function(a,c){angular.isArray(c)||(c=[c]);for(var f=c.length;f--;){var g=c[f];if(a.uri in e&&-1!==e[a.uri].indexOf(g))return void b.log("Item "+a.label+" already belongs to container "+g);g in d?d[g].push(a):d[g]=[a],a.uri in e?e[a.uri].push(g):e[a.uri]=[g]}},b.removeItemFromContainer=function(a,c){var h=d[c];if("undefined"==typeof h)return void b.err("Cannot remove item "+a.label+" from container "+c+": container not found.");var i=h.indexOf(a);if(-1===i)return void b.err("Cannot remove item "+a.label+" from container "+c+": item not in container.");h.splice(i,1);var j=e[a.uri].indexOf(c);if(e[a.uri].splice(j,1),0===e[a.uri].length){delete e[a.uri],delete g[a.uri];var k=f.indexOf(a);-1!==k&&f.splice(k,1)}b.log("Item "+a.label+" removed from container "+c)},b.addItems=function(a){for(var c=a.length;c--;)b.addItem(a[c])};var h=function(a,b,c){var d,e=g[a];if(0===b.length)e.range=[];else if(e.range.length>0)for(d in b)-1===e.range.indexOf(b[d])&&e.range.push(b[d]);if(0===c.length)e.domain=[];else if(e.domain.length>0)for(d in c)-1===e.domain.indexOf(c[d])&&e.domain.push(c[d])},i=function(a,b){var c=g[a];"undefined"==typeof c.mergedLabel?c.label!==b&&(c.mergedLabel=c.label+"_"+b):-1===c.mergedLabel.indexOf(b)&&(c.mergedLabel+="_"+b)},j=function(a,b){var c=g[a];"undefined"==typeof c.mergedVocabulary?c.mergedVocabulary=[c.vocabulary,b]:-1===c.mergedVocabulary.indexOf(b)&&c.mergedVocabulary.push(b)};return b.addItem=function(a,k){if("undefined"==typeof k&&(k="default"),"undefined"==typeof a.uri||!angular.isArray(a.type))return void b.err("Ouch, cannot add this item ... ",a);if(a.uri in g){if(b.log("Item already present: "+a.uri),a.isProperty()&&!a.isAnnotationProperty)if(g[a.uri].isAnnotationProperty){var l=d[c].indexOf(g[a.uri]);l>-1&&d[c].splice(l,1),delete e[a.uri],delete g[a.uri],k=c}else h(a.uri,a.range,a.domain),i(a.uri,a.label),j(a.uri,a.vocabulary)}else a.isProperty()&&(k=c),g[a.uri]=a,f.push(a),b.addItemToContainer(a,k),b.log("Added item: "+a.uri)},b.log("Component up and running"),b}]),angular.module("Pundit2.Core").service("TypesHelper",["BaseComponent","NameSpace","Utils",function(a,b,c){var d=new a("TypesHelper"),e={};return d.addFromAnnotationRdf=function(a,d){a in e||(e[a]={},a in d?(b.item.label in d[a]&&(e[a].label=d[a][b.item.label][0].value),b.item.description in d[a]&&(e[a].description=d[a][b.item.description][0].value)):e[a].label=c.getLabelFromURI(a))},d.add=function(a,b,c){a in e||(e[a]={}),e[a].label=b,"undefined"!=typeof c&&(e[a].description=c)},d.getLabel=function(a){if("undefined"==typeof e[a]){var d;d=a.match(b.punditOntologyBaseURL)&&a in b.typesLabels?b.typesLabels[a]:c.getLabelFromURI(a),e[a]={label:d}}return e[a].label},d.log("Component up and running"),d}]),angular.module("Pundit2.Core").constant("CONSOLIDATIONDEFAULTS",{}).service("Consolidation",["$rootScope","$location","CONSOLIDATIONDEFAULTS","BaseComponent","EventDispatcher","NameSpace","Config","Item","ItemsExchange","XpointersHelper",function(a,b,c,d,e,f,g,h,i,j){var k=new d("Consolidation",c),l={};k.wipe=function(){l.itemListByType={},l.typeUriMap={},l.uriTypeMap={},l.itemListByURI={},l.fragmentsItemListByParentURI={};for(var a in l.annotators)l.annotators[a].wipe();k.log("Wiped up!")},k.wipe(),l.annotableTypes=[],l.annotators={},l.isRunningAnnomatic=!1,a.$on("annomatic-run",function(){l.isRunningAnnomatic=!0}),a.$on("annomatic-stop",function(){l.isRunningAnnomatic=!1}),k.getItems=function(){return l.itemListByURI},k.getFragmentParentList=function(){return l.fragmentsItemListByParentURI};var m=function(a){angular.isArray(a)||(a=[a]);for(var b=a.length;b--;){var c=a[b],d=k.isConsolidable(c);d!==!1?c.uri in l.itemListByURI?k.log("Item already present: "+c.label):(d in l.itemListByType?(l.itemListByType[d][c.uri]=c,l.typeUriMap[d].push(c.uri)):(l.typeUriMap[d]=[],l.itemListByType[d]={},l.itemListByType[d][c.uri]=c),"undefined"!=typeof c.parentItemXP&&(c.parentItemXP in l.fragmentsItemListByParentURI?l.fragmentsItemListByParentURI[c.parentItemXP].push(c):l.fragmentsItemListByParentURI[c.parentItemXP]=[c]),l.itemListByURI[c.uri]=c,l.uriTypeMap[c.uri]=d,k.log("Added item: "+c.label+" ("+d+")")):k.log("Not adding, item is not consolidable: "+c.label)}};return k.consolidateAll=function(){if(!l.isRunningAnnomatic){var a=[];"undefined"!=typeof g.modules.PageItemsContainer&&(a=a.concat(i.getItemsByContainer(g.modules.PageItemsContainer.container))),"undefined"!=typeof g.modules.MyItems&&(a=a.concat(i.getItemsByContainer(g.modules.MyItems.container))),k.log("Consolidating ALL items"),k.consolidate(a),e.sendEvent("Consolidation.consolidateAll")}},k.consolidate=function(a){k.log("Will try to consolidate "+a.length+" items"),k.wipe(),m(a);for(var b in l.annotators)b in l.itemListByType?(k.log("Consolidating annotator type "+b+", "+l.typeUriMap[b].length+" items"),l.annotators[b].consolidate(l.itemListByType[b])):k.log("Skipping annotator type "+b+": no item to consolidate.")},k.addAnnotator=function(a){k.log("Adding annotable type ",a.label),l.annotableTypes.push(a.label),l.annotators[a.label]=a},k.isConsolidable=function(a){for(var b in l.annotators)if(l.annotators[b].isConsolidable(a))return b;return!1},k.isConsolidated=function(a){return a instanceof h?a.uri in l.itemListByURI:!1},k.getAvailableTargets=function(a){var c=[],d=j.options.namedContentClasses;("undefined"==typeof a||a!==!0)&&c.push(decodeURIComponent(b.absUrl()));for(var e=d.length;e--;)for(var f=d[e],g=angular.element("."+f),h=g.length;h--;){var i=angular.element(g[h]).attr("about");i&&c.push(i)}return c},k}]),angular.module("Pundit2.Annotators",[]),angular.module("Pundit2.Annotators").constant("XPOINTERSHELPERDEFAULTS",{wrapNodeName:"span",wrapNodeClass:"pnd-cons",textFragmentIconClass:"pnd-text-fragment-icon",consolidationClasses:["pnd-cons-svg"],namedContentClasses:["pundit-content"]}).config(["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]).service("XpointersHelper",["XPOINTERSHELPERDEFAULTS","NameSpace","BaseComponent","$document","$location","$window",function(a,b,c,d,e,f){var g=new c("XpointersHelper",a);g.getXPathsFromXPointers=function(a){for(var b=[],c={},d=a.length-1;d>=0;d--){var e=a[d],f=g.xPointerToXPath(e);g.isValidXpointer(e)?(c[e]=f,b.push(e)):g.err("Invalid xpointer passed to getXPathsFromXPointers: THIS SHOULD NOT HAPPEN!",e)}return c},g.isValidXpointerURI=function(a){return"undefined"==typeof a?(g.err("Xpointer is undefined: this should not happend!"),!1):null===a.match(/#xpointer\(start-point\(string-range\(/)||null===a.match(/range-to\(string-range\(/)?!1:!0},g.isValidXpointer=function(a){if(!g.isValidXpointerURI(a))return!1;var b=g.xPointerToXPath(a);return g.isValidRange(b.startNode,b.startOffset,b.endNode,b.endOffset)},g.xPointerToXPath=function(a){var b,c,d={};return g.isValidXpointerURI(a)?(b=a.split("#xpointer(start-point(string-range(")[1].split("))/range-to(string-range("),c=b[0].split(",'',"),d.startXpath=c[0],d.startOffset=c[1],c=b[1].substr(0,b[1].length-3).split(",'',"),d.endXpath=c[0],d.endOffset=c[1],d.startNode=g.getNodeFromXpath(d.startXpath),d.endNode=g.getNodeFromXpath(d.endXpath),d):(g.log("xPointerToXPath() Invalid xpointer! ",a),{startNode:null,startOffset:null,endNode:null,endOffset:null,valid:!1})},g.getNodeFromXpath=function(a){var b=d[0].evaluate(a,d[0],null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return b.singleNodeValue},g.isValidRange=function(a,b,c,e){try{var f=d[0].createRange();return f.setStart(a,b),f.setEnd(c,e),!0}catch(g){return!1}},g.splitAndSortXPaths=function(a){var b=g.getNodeFromXpath("//body"),c=[],e=[];for(var f in a){var h=d[0].createRange(),i=g.getNodeFromXpath(a[f].startXpath);h.setStart(b,0),h.setEnd(i,a[f].startOffset),c.push({xpointer:f,xpath:a[f].startXpath,offset:a[f].startOffset,range:h});var j=d[0].createRange();i=g.getNodeFromXpath(a[f].endXpath),j.setStart(b,0),j.setEnd(i,a[f].endOffset),c.push({xpointer:f,xpath:a[f].endXpath,offset:a[f].endOffset,range:j})}c.sort(function(a,b){return a.range.compareBoundaryPoints(Range.END_TO_END,b.range)}),e[0]=c[0];for(var k=1,l=0,m=c.length;m>k;k++)(c[k].xpath!==e[l].xpath||c[k].offset!==e[l].offset)&&(e[++l]=c[k]);return e},g.getClassesForXpaths=function(a,b,c,d){for(var e=[],f=[],j=0;j<b.length-1;j++){var k=b[j],l=g.getStartingXPs(a,c,k.xpath,k.offset),m=g.getEndingXPs(a,c,k.xpath,k.offset);e=h(e,l),e=i(e,m);for(var n=[],o=e.length-1;o>=0;o--)for(var p=e[o],q=d[p].length-1;q>=0;q--)n.push(d[p][q]);f[j+1]=n}return f};var h=function(a,b){return a.concat(b)},i=function(a,b){for(var c=[],d=a.length-1;d>=0;d--)-1===b.indexOf(a[d])&&c.push(a[d]);return c};return g.getStartingXPs=function(a,b,c,d){for(var e=[],f=a.length-1;f>=0;f--){var g=a[f];b[g].startXpath===c&&b[g].startOffset===d&&e.push(g)}return e},g.getEndingXPs=function(a,b,c,d){for(var e=[],f=a.length-1;f>=0;f--){var g=a[f];b[g].endXpath===c&&b[g].endOffset===d&&e.push(g)}return e},g.updateDOM=function(a,b,c){for(var d=a.length-1;d>0;d--){var e=a[d-1],f=a[d];c[d].length>0&&(g.log("## Updating DOM, xpath "+d+": "+c[d].join(" ")),g.wrapXPaths(e,f,g.options.wrapNodeName,b,c[d]))}g.log("Dom successfully updated!")},g.wrapXPaths=function(a,b,c,e,f){var h=c||g.options.wrapNodeName,i=e||g.options.wrapNodeClass,j=f||[],k=d[0].createRange(),l=g.getNodeFromXpath(a.xpath),m=g.getNodeFromXpath(b.xpath);a.xpath.match(/\[[0-9]+\]$/)||b.xpath.match(/\[[0-9]+\]$/)?(g.isElementNode(l)?k.setStart(l,a.offset):k.setStart(l,a.offset),g.isElementNode(m)?k.setEndAfter(m):k.setEnd(m,b.offset)):k.selectNode(l.childNodes[a.offset]),g.wrapElement(k.commonAncestorContainer,k,h,i,j)},g.wrapElement=function(a,b,c,d,e){if(a.childNodes&&a.childNodes.length>0)for(var f=a.childNodes.length-1;f>=0&&a.childNodes[f];f--)g.wrapElement(a.childNodes[f],b,c,d,e);else g.isTextNodeInsideRange(a,b)?g.wrapNode(a,b,c,d,e):g.isImageNodeInsideRange(a,b)&&g.wrapNode(a,b,c,d,e)},g.isTextNodeInsideRange=function(a,b){var c;return a.nodeType!==Node.TEXT_NODE?!1:(c=a.textContent.replace(/ /g,"").replace(/\n/,""),a.data&&""!==c&&" "!==c?g.isNodeInsideRange(a,b):!1)},g.isImageNodeInsideRange=function(a,b){return a.nodeType!==Node.ELEMENT_NODE?!1:"img"!==a.tagName.toLowerCase()?!1:g.isNodeInsideRange(a,b)},g.isNodeInsideRange=function(a,b){var c=d[0].createRange();try{c.selectNode(a)}catch(e){c.selectNodeContents(a)}return-1!==b.compareBoundaryPoints(Range.END_TO_START||3,c)||1!==b.compareBoundaryPoints(Range.START_TO_END||1,c)?!1:!0},g.wrapNode=function(a,b,c,e,f){var h=d[0].createRange();a===b.startContainer||a===b.endContainer?(h.setStart(a,a===b.startContainer?b.startOffset:0),h.setEnd(a,a===b.endContainer?b.endOffset:a.length)):h.selectNode(a),h.surroundContents(g.createWrapNode(c,e,f))},g.createWrapNode=function(a,b,c){var e=d[0].createElement(a);return angular.element(e).addClass(b),angular.element(e).attr("text-fragment-bit",""),angular.element(e).attr("fragments",c.join(",")),angular.element(e).addClass(c.join(" ")),e},g.mergeTextNodes=function(a){if(a&&"undefined"!=typeof a.childNodes&&a.childNodes.length>0)for(var b,c,d=a.childNodes.length-1;b=a.childNodes[d--];)g.isTextNode(b)&&(c=a.childNodes[d])&&g.isTextNode(c)?(c.nodeValue=c.nodeValue+b.nodeValue,a.removeChild(b)):g.isElementNode(b)&&g.mergeTextNodes(b)},g.isTextNode=function(a){return a.nodeType===Node.TEXT_NODE},g.isElementNode=function(a){return a.nodeType===Node.ELEMENT_NODE},g.isWrapNode=function(a){if(!g.isElementNode(a))return!1;if(a.nodeName.toUpperCase()!==g.options.wrapNodeName.toUpperCase())return!1;var b=angular.element(a);return b.hasClass(g.options.wrapNodeClass)?!0:!1},g.isConsolidationNode=function(a){if(!g.isElementNode(a))return!1;var b=[g.options.textFragmentIconClass,g.options.wrapNodeClass,g.options.imgWrapNodeClass];b=b.concat(g.options.consolidationClasses);for(var c=b.length;c--;)if(angular.element(a).hasClass(b[c]))return!0;return!1},g.isWrappedTextNode=function(a){return g.isWrapNode(a)&&g.isTextNode(a.firstChild)?!0:!1},g.isWrappedElementNode=function(a){return g.isWrapNode(a)&&g.isElementNode(a.firstChild)?!0:!1},g.isNamedContentNode=function(a){if(!g.isElementNode(a))return!1;for(var b=g.options.namedContentClasses,c=b.length;c--;)if(angular.element(a).hasClass(b[c]))return!0;return!1},g.isUIButton=function(a){return g.isElementNode(a)&&angular.element(a).hasClass(g.options.textFragmentIconClass)?!0:!1},g.getSafePageContext=function(){var a,b,c,d=f.location.href;if(-1!==d.indexOf("#")&&(a=d.substring(d.indexOf("#")+1,d.length),d=d.substring(0,d.indexOf("#"))),-1!==d.indexOf("?")){b=d.substring(d.indexOf("?")+1,d.length),d=d.substring(0,d.indexOf("?")),c=e.search(),delete c["pundit-show"];var g=[];for(var h in c)g.push(h+"="+c[h]);b=g.join("&")}return b&&(d+="?"+b),a&&(d+="#"+a),decodeURIComponent(d)},g.log("Component up and running"),g}]),angular.module("Pundit2.Annotators").constant("TEXTFRAGMENTANNOTATORDEFAULTS",{cMenuType:"annotatedTextFragment",annotationIconClass:"pnd-icon-tag",myItemsIconClass:"pnd-icon-bookmark",suggestionIconClass:"pnd-icon-pencil"}).service("TextFragmentAnnotator",["TEXTFRAGMENTANNOTATORDEFAULTS","NameSpace","BaseComponent","Consolidation","XpointersHelper","ItemsExchange","Config","TripleComposer","Toolbar","Annomatic","$compile","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new c("TextFragmentAnnotator",a);m.label="text",m.type=b.fragments[m.label],d.addAnnotator(m),m.isConsolidable=function(a){return angular.isArray(a.type)?0===a.type.length?(m.log("Item not valid: types len 0"),!1):-1===a.type.indexOf(m.type)?(m.log("Item not valid: not a "+m.type),!1):e.isValidXpointerURI(a.uri)?e.isValidXpointer(a.uri)?(m.log("Item valid: try to consolidate "+a.label),!0):(m.log("Item not valid: not consolidable on this page: "+a.uri),!1):(m.log("Item not valid: not a valid xpointer uri: "+a.uri),!1):(m.log("Item not valid: malformed"),!1)};var n={},o={};m.consolidate=function(a){m.log("Consolidating!");var b=[],c=0;n={},o={};for(var d in a)b.push(d),n[d]=["fr-"+c],o["fr-"+c]={uri:d,bits:[],item:a[d]},c++;var f=e.getXPathsFromXPointers(b),g=e.splitAndSortXPaths(f),h=e.getClassesForXpaths(b,g,f,n);e.updateDOM(g,e.options.wrapNodeClass,h),q(),m.log(m.label+" consolidation: done!")};var p=function(){var a=0;for(var b in n){var c=n[b],d=angular.element("."+c).last(),e="text-fragment-icon";j.isRunning()&&(e="suggestion-fragment-icon"),m.log("Placing fragment icon "+a++,c,d.attr("fragments")),d.after("<"+e+' fragment="'+c+'"></'+e+">")}},q=function(){p();var a=angular.element(".pnd-cons");k(a)(l);var b=angular.element("text-fragment-icon, suggestion-fragment-icon");k(b)(l),l.$$phase||l.$digest()};return m.wipe=function(){n={},o={},angular.element("."+e.options.textFragmentIconClass).remove();var a=angular.element("."+e.options.wrapNodeClass);angular.forEach(a,function(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);angular.element(a).remove()}),e.mergeTextNodes(angular.element("body")[0])},m.addFragmentIcon=function(a){o[a.fragment].icon=a,a.item=o[a.fragment].item,m.log("Adding fragment icon for fragment id="+a.fragment)},m.addFragmentBit=function(a){var b=a.fragments;b=b.match(/,/)?b.split(","):[b];for(var c=b.length;c--;){var d=o[b[c]];d.bits.push(a)}m.log("Adding consolidated fragment bit",b)},m.getFragmentIdByUri=function(a){return"undefined"!=typeof n[a]?n[a]:void 0},m.getFragmentIconScopeById=function(a){return"undefined"!=typeof o[a]?o[a].icon:void 0},m.getBitsById=function(a){return"undefined"!=typeof o[a]?o[a].bits:void 0},m.highlightByUri=function(a){return"undefined"==typeof n[a]?void m.log("Not highlighting given URI: fragment id not found"):void m.highlightById(n[a][0])},m.highlightById=function(a){for(var b=o[a].bits.length;b--;)o[a].bits[b].high();m.log("Highlighting fragment id="+a+", # bits: "+o[a].bits.length)},m.clearHighlightByUri=function(a){return"undefined"==typeof n[a]?void m.log("Not clearing highlight on given URI: fragment id not found"):void m.clearHighlightById(n[a])},m.clearHighlightById=function(a){for(var b=o[a].bits.length;b--;)o[a].bits[b].clear();m.log("Clear highlight on fragment id="+a+", # bits: "+o[a].bits.length)},m.showByUri=function(a){if("undefined"==typeof n[a])return void m.log("Not showing fragment for given URI: fragment id not found");for(var b=n[a],c=o[b].bits.length;c--;)o[b].bits[c].show()},m.hideByUri=function(a){if("undefined"==typeof n[a])return void m.log("Not hiding fragment for given URI: fragment id not found");for(var b=n[a],c=o[b].bits.length;c--;)o[b].bits[c].hide()},m.hideAll=function(){for(var a in n)m.hideByUri(a)},m.showAll=function(){for(var a in n)m.showByUri(a)},m.ghostByUri=function(a){if("undefined"==typeof n[a])return void m.log("Fragment id not found");for(var b=n[a],c=o[b].bits.length;c--;)o[b].bits[c].ghost()},m.ghostRemoveByUri=function(a){if("undefined"==typeof n[a])return void m.log("Fragment id not found");for(var b=n[a],c=o[b].bits.length;c--;)o[b].bits[c].expo()},m.ghostAll=function(){for(var a in n)m.ghostByUri(a)},m.ghostRemoveAll=function(){for(var a in n)m.ghostRemoveByUri(a)},m.log("Component up and running"),m}]),angular.module("Pundit2.Annotators").service("ImageAnnotator",["NameSpace","BaseComponent","$location","Consolidation","XpointersHelper","ImageFragmentAnnotatorHelper",function(a,b,c,d,e,f){var g=new b("ImageAnnotator");g.label="image",g.type=a.types[g.label],g.labelIF="imagePart",g.typeIF=a.fragments[g.labelIF];var h="pnd-cons-img";return d.addAnnotator(g),g.isConsolidable=function(a){var b;return angular.isArray(a.type)?0===a.type.length?(g.log("Item not valid: types len 0"+a.uri),!1):-1===a.type.indexOf(g.type)&&-1===a.type.indexOf(g.typeIF)?(g.log("Item not valid: not have type image "+a.uri),!1):(-1!==a.type.indexOf(g.type)?b=a.uri:-1!==a.type.indexOf(g.typeIF)&&(b=a.parentItemXP),e.isValidXpointerURI(b)?e.isValidXpointer(b)?(g.log("Item valid: "+a.label),!0):(g.log("Item not valid: not consolidable on this page: "+b),!1):(g.log("Item not valid: not a valid xpointer uri: "+b),!1)):(g.log("Item not valid: malformed type"+a.uri),!1)},g.consolidate=function(a){g.log("Consolidating!");var b,c,d=[],f={};for(b in a)-1!==a[b].type.indexOf(g.type)?c=a[b].uri:-1!==a[b].type.indexOf(g.typeIF)&&(c=a[b].parentItemXP),d.push(c),"undefined"!=typeof a[b].polygon&&("undefined"!=typeof f[a[b].parentItemXP]?f[a[b].parentItemXP].push(a[b].polygon):f[a[b].parentItemXP]=[a[b].polygon]);var i=e.getXPathsFromXPointers(d);for(b in i){var j=angular.element(i[b].startNode.firstElementChild);j.addClass(h)}},g.wipe=function(){var a=angular.element("."+h);a.removeClass(h)},g.svgHighlightByItem=function(a){var b,c,d=[];-1!==a.type.indexOf(g.typeIF)&&"undefined"!=typeof a.polygon&&(b=a.parentItemXP,d=e.getXPathsFromXPointers([b]),b in d&&(c=angular.element(d[b].startNode.firstElementChild),f.drawPolygonOverImage(a.polygon,c)))},g.svgClearHighlightByItem=function(){angular.element("."+h).siblings("span.pnd-cons-svg").remove()},g.highlightById=function(){},g.clearHighlightById=function(){},g.highlightByUri=function(){},g.clearHighlightByUri=function(){},g.log("Component up and running"),g}]),angular.module("Pundit2.Annotators").directive("textFragmentBit",["TextFragmentAnnotator",function(a){return{restrict:"A",scope:{fragments:"@"},link:function(b,c){a.addFragmentBit(b),b.isHigh=!1,b.high=function(){c.addClass("pnd-textfragment-highlight")},b.clear=function(){c.removeClass("pnd-textfragment-highlight")},b.hide=function(){c.addClass("pnd-textfragment-hidden")},b.show=function(){c.removeClass("pnd-textfragment-hidden")},b.ghost=function(){c.addClass("pnd-textfragment-ghosted")},b.expo=function(){c.removeClass("pnd-textfragment-ghosted")}}}}]),angular.module("Pundit2.Annotators").directive("textFragmentIcon",["TextFragmentAnnotator","ContextualMenu","XpointersHelper","Config","ItemsExchange","ItemPopover",function(a,b,c,d,e,f){return{restrict:"E",scope:{fragment:"@"},templateUrl:"src/Annotators/TextFragmentIcon.dir.tmpl.html",replace:!0,link:function(g,h){g.textFragmentIconClass=c.options.textFragmentIconClass,g.element=h,a.addFragmentIcon(g);var i=d.modules.PageItemsContainer.container,j=d.modules.MyItems.container;g.iconClass=e.isItemInContainer(g.item,j)&&!e.isItemInContainer(g.item,i)?a.options.myItemsIconClass:a.options.annotationIconClass,g.mouseoverHandler=function(){a.highlightById(g.fragment)},g.mouseoutHandler=function(){a.clearHighlightById(g.fragment)},g.clickHandler=function(c){d.modules.Client.active?b.show(c.pageX,c.pageY,g.item,a.options.cMenuType):d.modules.SimplifiedClient.active&&f.show(g.element,g.item),c.stopPropagation(),c.preventDefault()}}}}]),angular.module("Pundit2.Annotators").constant("TEXTFRAGMENTHANDLERDEFAULTS",{ignoreClasses:["pnd-ignore"],removeSelectionOnAbort:!0,container:"createdTextFragments",cMenuType:"textFragmentHandlerItem",labelMaxLength:40}).service("TextFragmentHandler",["$rootScope","TEXTFRAGMENTHANDLERDEFAULTS","NameSpace","BaseComponent","ContextualMenu","XpointersHelper","Item","ItemsExchange","Toolbar","TripleComposer","EventDispatcher","$document",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new d("TextFragmentHandler",b),n=function(){l.off("mouseup",n),null!==m.getSelectedRange()&&q()},o=function(a){l.off("mouseup",o);var b=a.target;if(m.isToBeIgnored(b))return m.log("ABORT: ignoring mouse UP event on document: ignore class spotted."),void q();var c=m.getSelectedRange();if(null!==c){for(var d=c.cloneContents().querySelectorAll("*"),f=d.length;f--;)if(m.isToBeIgnored(d[f]))return m.log("ABORT: ignoring range: ignore class spotted inside it, somewhere."),void q();var g=m.createItemFromRange(c);return h.addItemToContainer(g,m.options.container),m.log("Valid selection ended on document. Text fragment Item produced: "+g.label),i.isActiveTemplateMode()?(m.log("Item used as subject inside triple composer (template mode active)."),j.addToAllSubject(g),j.closeAfterOp(),void k.sendEvent("Annotators.saveAnnotation")):void e.show(a.pageX,a.pageY,g,m.options.cMenuType)}},p=function(a){var b=a.target;return m.isToBeIgnored(b)?(m.log("ABORT: ignoring mouse DOWN event on document: ignore class spotted."),void(m.options.removeSelectionOnAbort&&l.on("mouseup",n))):(l.on("mouseup",o),void m.log("Selection started on document, waiting for mouse up."))};l.on("mousedown",p),m.turnOn=function(){l.on("mousedown",p)},m.turnOff=function(){l.off("mousedown",p)},m.createItemFromRange=function(a){var b={};return b.uri=m.range2xpointer(a),b.type=[c.fragments.text],b.description=a.toString(),b.label=b.description,b.label.length>m.options.labelMaxLength&&(b.label=b.label.substr(0,m.options.labelMaxLength)+" .."),b.pageContext=f.getSafePageContext(),b.isPartOf=b.uri.split("#")[0],new g(b.uri,b)},m.getSelectedRange=function(){var a,b=l[0];return 0===b.getSelection().rangeCount?(m.log("getSelection().rangeCount is 0: no selected range."),null):(a=b.getSelection().getRangeAt(0),null!==a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset?(m.log("Range is not null, but start/end containers and offsets match: no selected range."),null):(m.log("GetSelectedRange returning a DIRTY range: "+a.startContainer.nodeName+"["+a.startOffset+"] > "+a.endContainer.nodeName+"["+a.endOffset+"]"),a))};var q=function(){m.options.removeSelectionOnAbort&&l[0].getSelection().removeAllRanges()};m.isToBeIgnored=function(a){for(var b=m.options.ignoreClasses,c=b.length;"body"!==a.nodeName.toLowerCase();){for(var d=c;d--;)if(angular.element(a).hasClass(b[d]))return!0;if(null===a.parentNode)return!1;a=a.parentNode}return!1},m.range2xpointer=function(a){var b=s(a),c=y(z(b.startContainer),b.cleanStartNumber),d=y(z(b.endContainer),b.cleanEndNumber),e=A(c),f=r(e,c,b.startOffset,d,b.endOffset);return m.log("range2xpointer returning an xpointer: "+f),f};var r=function(a,b,c,d,e){return a+"#xpointer(start-point(string-range("+b+",'',"+c+"))/range-to(string-range("+d+",'',"+e+")))"},s=function(a){var b={};m.log("dirty2cleanRange DIRTY: "+a.startContainer.nodeName+"["+a.startOffset+"] > "+a.endContainer.nodeName+"["+a.endOffset+"]");var c=t(a.startContainer,a.startOffset),d=t(a.endContainer,a.endOffset);return b.startContainer=c.cleanContainer,b.startOffset=c.cleanOffset,b.endContainer=d.cleanContainer,b.endOffset=d.cleanOffset,b.cleanStartNumber=w(b.startContainer),b.cleanEndNumber=w(b.endContainer),m.log("dirty2cleanRange CLEAN: "+b.startContainer.nodeName+"["+b.startOffset+"] > "+b.endContainer.nodeName+"["+b.endOffset+"]"),b
},t=function(a,b){var c,d,e,g=f,h=a.parentNode;if(g.isElementNode(a)&&!g.isConsolidationNode(a))return{cleanContainer:a,cleanOffset:b};for(d=g.isTextNode(a)&&g.isWrapNode(h)?h:a,e=b;c=d.previousSibling;){if(!g.isConsolidationNode(c)&&g.isElementNode(c)&&!g.isWrapNode(c))return g.isTextNode(a)&&g.isWrapNode(h)?{cleanContainer:a,cleanOffset:e}:{cleanContainer:d,cleanOffset:e};g.isTextNode(c)?e+=c.length:g.isWrapNode(c)&&(e+=c.firstChild.length),d=c}return f.isTextNode(a)&&f.isWrapNode(h)?{cleanContainer:a,cleanOffset:e}:{cleanContainer:d,cleanOffset:e}},u=function(a){return f.isTextNode(a)||f.isWrappedTextNode(a)||f.isUIButton(a)},v=function(a){return f.isElementNode(a)&&!f.isUIButton(a)&&!f.isWrappedTextNode(a)},w=function(a){var b,c=1,d=f,e=x(a),g=a.parentNode,h=d.isWrapNode(g)?g:a;if(d.isTextNode(a))for(;b=h.previousSibling;)u(b)&&(v(h)||d.isWrappedElementNode(h))&&c++,h=b;else for(;b=h.previousSibling;)x(b)!==e||d.isConsolidationNode(b)||c++,h=b;return c},x=function(a){return f.isTextNode(a)?"text()":a.nodeName.toUpperCase()},y=function(a,b){return a.replace(/\[[0-9]+\]$/,"["+b+"]")},z=function(a,b){var c=a.parentNode;if(!a)return b;var d=f,e=x(a);if(d.isNamedContentNode(a))return"undefined"!=typeof b?"//DIV[@about='"+angular.element(a).attr("about")+"']/"+b:"//DIV[@about='"+angular.element(a).attr("about")+"']";if("BODY"===e||"HTML"===e)return"undefined"!=typeof b?"//BODY/"+b:"//BODY";if(d.isWrapNode(a))return z(a.parentNode,b);var g,h=1,i=a;if(!d.isTextNode(i))for(;g=i.previousSibling;)x(g)!==e||d.isConsolidationNode(g)||h++,i=g;return b="undefined"!=typeof b?e+"["+h+"]/"+b:e+"["+h+"]",z(c,b)},A=function(a){var b=f.getSafePageContext(),c=a.indexOf("DIV[@about='"),d="about";if(-1===c)return-1!==b.indexOf("#")?b.split("#")[0]:b;if(3>c){var e=c+7+d.length,g=a.indexOf("_text']"),h=a.indexOf(-1!==g?"_text']":"']")-e;return a.substr(e,h)}return m.log("ERROR: getContentURLFromXPath returning something weird? xpath = "+a),""};return m.log("Component up and running"),m}]),angular.module("Pundit2.Annotators").constant("IMAGEHANDLERDEFAULTS",{ignoreClasses:["pnd-ignore"],container:"createdImage",cMenuType:"imageHandlerItem",labelMaxLength:40}).service("ImageHandler",["IMAGEHANDLERDEFAULTS","NameSpace","BaseComponent","Config","TextFragmentHandler","XpointersHelper","Item","$compile","$timeout","$rootScope",function(a,b,c,d,e,f,g,h,i,j){var k=new c("ImageHandler",a),l=null,m=!1,n=null,o=null,p=function(){n.removeClass("pnd-pointed-img"),o.remove(),m=!1,n=null},q=function(a){k.clearTimeout(),null!==n&&a.target.src!==n[0].src&&p(),m||(n=angular.element(a.target).addClass("pnd-pointed-img").after('<img-menu ref="pnd-pointed-img"></img-menu>'),o=h(angular.element("img-menu"))(j),m=!0)},r=function(){k.removeDirective()};angular.element("img").hover(q,r);var s=function(a){var b=document.createRange();return b.selectNode(a),e.range2xpointer(b)};return k.turnOn=function(){angular.element("img").hover(q,r)},k.turnOff=function(){angular.element("img").unbind("mouseenter mouseleave")},k.clearTimeout=function(){null!==l&&(i.cancel(l),l=null)},k.removeDirective=function(){l=i(function(){p()},100)},k.createItemFromImage=function(a){var c={};return c.uri=s(a),c.type=[b.types.image],c.description=a.src,c.image=a.src,c.label=c.description,c.label.length>k.options.labelMaxLength&&(c.label=c.label.substr(0,k.options.labelMaxLength)+" .."),c.pageContext=f.getSafePageContext(),c.isPartOf=c.uri.split("#")[0],new g(c.uri,c)},k}]),angular.module("Pundit2.Annotators").constant("PAGEHANDLERDEFAULTS",{cMenuType:"pageHandlerItem",debug:!1}).service("PageHandler",["$document","PAGEHANDLERDEFAULTS","NameSpace","BaseComponent","Item","XpointersHelper",function(a,b,c,d,e,f){var g=new d("PageHandler",b),h=function(){var a={},b=angular.element("meta");return angular.forEach(b,function(b){"keywords"===b.name&&"undefined"!=typeof b.content&&(a.keywords=b.content.split(",")),"description"===b.name&&"undefined"!=typeof b.content&&(a.description=b.content)}),a};return g.createItemFromPage=function(){var b={};return b=h(),b.uri=f.getSafePageContext(),b.label=a[0].title||"No title","undefined"==typeof b.description&&(b.description=b.label),b.type=[c.types.page],new e(b.uri,b)},g.log("Component up and running"),g}]),angular.module("Pundit2.Annotators").constant("PAGEANNOTATORDEFAULTS",{debug:!1}).service("PageAnnotator",["PAGEANNOTATORDEFAULTS","NameSpace","BaseComponent","XpointersHelper","Consolidation",function(a,b,c,d,e){var f=new c("PageAnnotator",a);return f.label="page",f.type=b.types[f.label],e.addAnnotator(f),f.isConsolidable=function(a){return angular.isArray(a.type)?0===a.type.length?(f.log("Item not valid: types len 0"+a.uri),!1):-1===a.type.indexOf(f.type)?(f.log("Item not valid: not have type page "+a.uri),!1):a.uri!==d.getSafePageContext()?(f.log("Item not valid: not consolidable on this page"),!1):(f.log("Item valid: "+a.label),!0):(f.log("Item not valid: malformed type"+a.uri),!1)},f.consolidate=function(){f.log("Consolidating!")},f.wipe=function(){},f.log("Component up and running"),f}]),angular.module("Pundit2.Annotators").directive("imgMenu",["$rootScope","NameSpace","ContextualMenu","Toolbar","ImageHandler","ImageAnnotator","ItemsExchange","TemplatesExchange","TripleComposer","EventDispatcher",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",scope:{ref:"@"},templateUrl:"src/Annotators/ImgMenu.dir.tmpl.html",link:function(a,f){a.image=angular.element("."+a.ref),a.element=f,a.visible=!1,a.item=null,a.$watch(function(){return d.isActiveTemplateMode()},function(b){a.icon=b?"pnd-icon-plus-circle":"pnd-icon-gear"});var k=function(){var b=a.image.position();a.visible=!0,a.element.css({position:"absolute",color:"#fff",background:"rgba(0, 0, 0, 0.2)",fontSize:"1.7em",height:"30px",width:"30px",left:b.left,top:b.top}),a.element.hover(function(){$(this).css({color:"#333333"})},function(){$(this).css({color:"#fff"})})};k(),a.clickHandler=function(f){if(f.preventDefault(),f.stopPropagation(),e.clearTimeout(),null===a.item&&(a.item=e.createItemFromImage(a.image[0]),g.addItemToContainer(a.item,e.options.container)),d.isActiveTemplateMode()){var k=h.getCurrent().triples;for(var l in k)if(-1===k[l].predicate.domain.indexOf(b.types.image))return;return i.addToAllSubject(g.getItemByUri(a.item.uri)),i.closeAfterOp(),void j.sendEvent("Annotators.saveAnnotation")}var m=g.getItemByUri(a.item.uri);c.show(f.pageX,f.pageY,m,e.options.cMenuType)},a.onMouseOver=function(){e.clearTimeout()},a.onMouseLeave=function(){e.removeDirective()}}}}]),angular.module("Pundit2.Communication",[]),angular.module("Pundit2.Communication").constant("NOTEBOOKDEFAULTS",{iconDefault:"pnd-icon pnd-icon-book",classDefault:"pnd-item-default"}).factory("Notebook",["BaseComponent","NameSpace","MyPundit","Analytics","NotebookExchange","NOTEBOOKDEFAULTS","$http","$q",function(a,b,c,d,e,f,g,h){function i(a,b){this._q=h.defer(),"undefined"!=typeof a?(this.id=a,this.load()):this.create(),e.addNotebook(this,b)}function j(a,b){var c=new i(a,b);return c._q.promise}var k=new a("Notebook",f);i.prototype.addAnnotation=function(a){"undefined"==typeof this.includes&&(this.includes=[]),this.includes.push(a)},i.prototype.removeAnnotation=function(a){if("undefined"==typeof this.includes)return!1;var b=this.includes.indexOf(a);return b>-1?(this.includes.splice(b,1),!0):void 0},i.prototype.getIcon=function(){return k.options.iconDefault},i.prototype.getClass=function(){return k.options.classDefault},i.prototype.setPrivate=function(){this.visibility="private"},i.prototype.isPublic=function(){return"public"===this.visibility},i.prototype.setPublic=function(){this.visibility="public"},i.prototype.setLabel=function(a){this.label=a},i.prototype.isCurrent=function(){var a=e.getCurrentNotebooks();return"undefined"==typeof a?!1:this.id===a.id},i.prototype.create=function(){k.log("Creating a new Notebook on the server"),this._q.resolve("New notebook created: TODO, after LOGIN")},i.prototype.save=function(){},i.prototype.load=function(a){var e=this;"undefined"==typeof a&&(a=!0),k.log("Loading notebook "+e.id+" metadata with cache "+a);var f,h=c.isUserLogged()?"asNBMeta":"asOpenNBMeta";f=g({headers:{Accept:"application/json"},method:"GET",cache:a,url:b.get(h,{id:e.id}),withCredentials:!0}).success(function(a){l(e,a),e._q.resolve(e),d.track("api","get","notebook meta"),k.log("Retrieved notebook "+e.id+" metadata")}).error(function(a,b){e._q.reject("Error from server while retrieving notebook "+e.id+": "+b),d.track("api","error","get notebook meta",b),k.err("Error getting notebook "+e.id+" metadata. Server answered with status code "+b)})};var l=function(a,c){for(var d in c)a.uri=d;var e=b.notebook,f=c[a.uri];if("undefined"==typeof f)return k.err("Malformed notebook uri="+a.uri+", wrong metadata: ",c),!1;for(var g in e){var h=e[g];a[g]=h in f?"type"===g?[f[h][0].value]:f[h][0].value:""}var i=f[e.includes];a.includes=[];for(var j in i){var l=i[j].value.match(/[a-z0-9]*$/);null!==l&&a.includes.push(l[0])}};return k.log("Component up and running"),j}]),angular.module("Pundit2.Communication").service("NotebookExchange",["BaseComponent",function(a){var b=new a("NotebookExchange"),c=[],d={},e=[],f={},g=null;return b.wipe=function(){b.log("Wiping every loaded notebooks."),c=[],d={},e=[],f={}},b.addNotebook=function(a,g){a.id in d?b.log("Not adding notebook "+a.id+": already present."):a._q.promise.then(function(b){"undefined"==typeof d[a.id]&&(d[a.id]=b,c.push(b))}),"undefined"!=typeof g&&g&&(a.id in f?b.log("Not adding notebook "+a.id+" to my notebook, already present."):a._q.promise.then(function(b){"undefined"==typeof f[a.id]&&(f[a.id]=b,e.push(b))}))},b.removeNotebook=function(a){for(var g=-1,h=0;h<c.length;h++)if(c[h].id===a){g=h;break}if(-1===g)return void b.err("Cannot remove notebook "+a+" from notebook list: notebook is not in notebook list.");c.splice(g,1),delete d[a],g=-1;for(var i=0;i<e.length;i++)if(e[i].id===a){g=i;break}return-1===g?void b.err("Cannot remove notebook "+a+" from my notebook list: notebook is not in my notebook list."):(e.splice(g,1),void delete f[a])},b.getNotebookById=function(a){return a in d?d[a]:void 0},b.getNotebooks=function(){return c},b.getMyNotebooks=function(){return e},b.getCurrentNotebooks=function(){return null!==g?d[g]:void 0},b.setCurrentNotebooks=function(a){b.log("set new current as: ",a),g=a},b.log("Component up and running"),b}]),angular.module("Pundit2.Communication").service("NotebookCommunication",["BaseComponent","NameSpace","Notebook","MyPundit","Analytics","Config","$http","$q","NotebookExchange","EventDispatcher",function(a,b,c,d,e,f,g,h,i,j){var k=new a("NotebookCommunication"),l=function(a){j.sendEvent("NotebookCommunication.loading",a)};return k.getMyNotebooks=function(){var a=h.defer();return k.log("Getting my notebooks from the server"),d.isUserLogged()?(l(!0),g({headers:{Accept:"application/json"},method:"GET",url:b.get("asNBOwned"),withCredentials:!0}).success(function(b){if(l(!1),e.track("api","get","notebook owned"),"undefined"==typeof b||""===b)return a.reject("some sort of error?"),void k.log("Error retrieving list of my notebooks - Server undefined response");if("NotebookIDs"in b){for(var d=[],f=b.NotebookIDs.length;f--;)d[f]=new c(b.NotebookIDs[f],!0);h.all(d).then(function(b){a.resolve(b),k.log("Retrieved all of my notebooks")},function(){a.reject("some other error?")})}else a.reject("some sort of error?"),k.log("Error retrieving list of my notebooks -- TODO")}).error(function(b,c){l(!1),a.reject("Error from server while retrieving list of my notebooks: "+c),k.err("Error from server while retrieving list of my notebooks: "+c),e.track("api","error","get notebook owned",c)})):(k.log("Impossible to get my notebooks: you have to be logged in"),a.reject("User not logged in")),a.promise},k.getCurrent=function(){var a=h.defer();return k.log("Getting current notebook"),d.isUserLogged()?(l(!0),g({headers:{"Content-Type":"application/json"},method:"GET",url:b.get("asNBCurrent"),withCredentials:!0}).success(function(b){l(!1),k.log(b.NotebookID+" is the current notebook"),"undefined"==typeof i.getNotebookById(b.NotebookID)&&new c(b.NotebookID,!0),i.setCurrentNotebooks(b.NotebookID),a.resolve(b.NotebookID)}).error(function(b){l(!1),k.log("Impossible to get the current notebook "),a.reject(b)})):(k.log("Impossible to get current: you have to be logged in"),a.reject("User not logged in")),a.promise},k.setCurrent=function(a){var c=h.defer();return k.log("Setting as current "+a),d.isUserLogged()?(l(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBCurrent")+"/"+a,withCredentials:!0}).success(function(){l(!1),k.log(a+" is now current"),i.setCurrentNotebooks(a),c.resolve()}).error(function(b){l(!1),k.log("Impossible to set as current: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setPublic=function(a){var c=h.defer();return k.log("Setting as public "+a),d.isUserLogged()?(l(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBPublic",{id:a}),withCredentials:!0}).success(function(){l(!1),k.log(a+" is now public"),i.getNotebookById(a).setPublic(),c.resolve()}).error(function(b){l(!1),k.log("Impossible to set as public: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setPrivate=function(a){var c=h.defer();return k.log("Setting as private "+a),d.isUserLogged()?(l(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBPrivate",{id:a}),withCredentials:!0}).success(function(){l(!1),k.log(a+" is now private"),i.getNotebookById(a).setPrivate(),c.resolve()}).error(function(b){l(!1),k.log("Impossible to set as private: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.createNotebook=function(a){var f=h.defer();return k.log("Creating a new notebook"),d.login().then(function(d){return d===!1?void f.reject("Ouch!"):(l(!0),void g({headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:b.get("asNB"),withCredentials:!0,data:{NotebookName:a}}).success(function(a){l(!1),"NotebookID"in a?new c(a.NotebookID,!0).then(function(){f.resolve(a.NotebookID),k.log("Created a new notebook: "+a.NotebookID),e.track("api","post","notebook create")}):(f.reject("some sort of error?"),k.log("Error creating a notebook -- TODO"))}).error(function(a,b){l(!1),f.reject("Error from server while retrieving list of my notebooks: "+b),k.err("Error from server while retrieving list of my notebooks: "+b),e.track("api","error","get notebook owned",b)}))}),f.promise},k.deleteNotebook=function(a){var c=h.defer();return k.log("Deleting "+a),d.isUserLogged()?(l(!0),g({headers:{"Content-Type":"application/json"},method:"DELETE",url:b.get("asNB")+"/"+a,withCredentials:!0}).success(function(){l(!1),k.log(a+" is removed"),i.removeNotebook(a),c.resolve()}).error(function(b){l(!1),k.log("Impossible to remove "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setName=function(a,c){var e=h.defer();return k.log("Edit name of notebook "+a),d.isUserLogged()?(l(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBEditMeta",{id:a}),withCredentials:!0,data:{NotebookName:c}}).success(function(){l(!1),k.log(a+" is now edited"),i.getNotebookById(a).setLabel(c),e.resolve()}).error(function(b){l(!1),k.log("Impossible to edit name of notebook: "+a),e.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),e.reject("User not logged in")),e.promise},k}]),angular.module("Pundit2.Communication").factory("Annotation",["BaseComponent","NameSpace","Utils","Item","TypesHelper","Analytics","AnnotationsExchange","Consolidation","MyPundit","ItemsExchange","PageItemsContainer","$http","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){this._q=m.defer(),"undefined"!=typeof a?(this.id=a,this.load(b)):this.create(),g.addAnnotation(this)}function o(a,b){var c=new n(a,b);return c._q.promise}var p=new a("Annotation");n.prototype.create=function(){p.log("Creating a new Annotation on the server"),this._q.resolve("New annotation created: TODO, after LOGIN")},n.prototype.update=function(){var a=this,c=m.defer();return l({headers:{Accept:"application/json"},method:"GET",url:b.get("asAnn",{id:a.id}),withCredentials:!0}).success(function(b){q(a,b),c.resolve(),p.log("Retrieved annotation "+a.id+" metadata")}).error(function(b,d){c.reject(),p.err("Error getting annotation "+a.id+". Server answered with status code "+d)}),c.promise},n.prototype.load=function(a){var c=this,d=i.isUserLogged()?"asAnn":"asOpenAnn";"undefined"==typeof a&&(a=!0),p.log("Loading annotation "+c.id+" with cache "+a);var e;e=l({headers:{Accept:"application/json"},method:"GET",cache:a,url:b.get(d,{id:c.id}),withCredentials:!0}).success(function(a){q(c,a),c._q.resolve(c),p.log("Retrieved annotation "+c.id+" metadata"),f.track("api","get","annotation")}).error(function(a,b){c._q.reject("Error from server while retrieving annotation "+c.id+": "+b),p.err("Error getting annotation "+c.id+". Server answered with status code "+b),f.track("api","error","get annotation",b)})},n.prototype.isBroken=function(){var a,b=this.items;for(var c in b)if(a=j.getItemByUri(b[c].uri),(a.isTextFragment()||a.isImage()||a.isImageFragment()||a.isWebPage())&&h.isConsolidated(a))return!1;return!0};var q=function(a,f){if("undefined"==typeof f||"undefined"==typeof f.graph||"undefined"==typeof f.metadata||"undefined"==typeof f.items)return p.err("Malformed annotation id="+a.id+": ",f),!1;a.items={},a.graph=angular.copy(f.graph);for(var g in f.metadata)a.uri=g;if("undefined"==typeof a.uri)return p.err("Malformed annotation id="+a.id+", wrong metadata: ",f),!1;var h=b.annotation,i=f.metadata[a.uri];for(var l in h){var m=h[l];a[l]=m in i?i[m][0].value:""}if(h.isIncludedIn in i){a.isIncludedInUri=i[h.isIncludedIn][0].value;var n=a.isIncludedInUri.match(/[a-z0-9]*$/);null!==n&&(a.isIncludedIn=n[0])}if(h.target in i){a.target=[];for(var o=0;o<i[h.target].length;o++)a.target.push(i[h.target][o].value)}a.entities=[],a.predicates=[];for(var q in f.graph){-1===a.entities.indexOf(q)&&(a.entities.push(q),a.items[q]={});for(var r in f.graph[q]){-1===a.entities.indexOf(r)&&(a.items[r]={type:[b.rdf.property],label:c.getLabelFromURI(r)},-1===a.predicates.indexOf(r)&&a.predicates.push(r));for(var s in f.graph[q][r]){var t=f.graph[q][r][s];"uri"===t.type&&-1===a.entities.indexOf(t.value)&&(a.entities.push(t.value),a.items[t.value]={})}}}for(var u in a.items){var v=j.getItemByUri(u);"undefined"==typeof v&&(v=angular.equals(a.items[u],{})?new d(u):new d(u,a.items[u]),v.isProperty()&&(v.isAnnotationProperty=!0),v.fromAnnotationRdf(f.items)),v.isProperty()||j.addItemToContainer(v,k.options.container);for(var w in v.type)e.addFromAnnotationRdf(v.type[w],f.items);a.items[u]=v}};return p.log("Component up and running"),o}]),angular.module("Pundit2.Communication").service("AnnotationsExchange",["BaseComponent","NameSpace","MyPundit","Analytics","$http","$q",function(a,b,c,d,e,f){var g=new a("AnnotationsExchange"),h=[],i={};return g.wipe=function(){g.log("Wiping every loaded annotation."),h=[],i={}},g.searchByUri=function(a){angular.isArray(a)||(a=[a]),g.log("Searching for annotations with "+a.length+" URIs from the server");var h,i=f.defer(),j=c.isUserLogged()?"asAnnMetaSearch":"asOpenAnnMetaSearch";return h=e({headers:{Accept:"application/json"},method:"GET",url:b.get(j),cache:!1,params:{scope:"all",query:{resources:a}},withCredentials:!0}).success(function(a){if(d.track("api","get","search"),"undefined"==typeof a)return void i.reject("Any data found on the response");var b=[];for(var c in a){var e=c.match(/[a-z0-9]*$/);null!==e&&b.push(e[0])}i.resolve(b),g.log("Retrieved annotations IDs searching by URIs")}).error(function(a,b){var c="Error from server while searching for annotations by URIs: "+b;i.reject(c),g.err(c),d.track("api","error","get "+j,b)}),i.promise},g.addAnnotation=function(a){a.id in i?g.log("Not adding annotation "+a.id+": already present."):a._q.promise.then(function(b){"undefined"!=typeof b&&"undefined"!=typeof b.graph&&"undefined"!=typeof b.items&&(i[a.id]=b,h.push(b))})},g.removeAnnotation=function(a){if(a in i){var b=h.indexOf(i[a]);h.splice(b,1),delete i[a]}else g.log("Impossible to remove annotation "+a+": not exist.")},g.getAnnotations=function(){return h},g.getAnnotationById=function(a){return a in i?i[a]:void 0},g.getAnnotationsByItem=function(a){var b=[];for(var c in h)"undefined"!=typeof h[c].items[a]&&b.push(h[c]);return b},g.getAnnotationsHash=function(){return i},g.log("Component up and running"),g}]),angular.module("Pundit2.Communication").constant("ANNOTATIONSCOMMUNICATIONDEFAULTS",{preventDownload:!1}).service("AnnotationsCommunication",["BaseComponent","EventDispatcher","NameSpace","Consolidation","MyPundit","AnnotationsExchange","Annotation","NotebookExchange","Notebook","ItemsExchange","Config","XpointersHelper","$http","$q","$rootScope","ANNOTATIONSCOMMUNICATIONDEFAULTS",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=new a("AnnotationsCommunication",p),r=function(a){b.sendEvent("AnnotationsCommunication.loading",a)};return q.getAnnotations=function(){var a=n.defer();if(q.options.preventDownload)return void a.reject("Prevent download forced by conf");r(!0);var c=d.getAvailableTargets(),e=f.searchByUri(c);return q.log("Getting annotations for available targets",c),e.then(function(b){if(q.log("Found "+b.length+" annotations on the current page."),0===b.length)return d.consolidateAll(),void r(!1);for(var c=[],e=0,f=0;f<b.length;f++){var j=new g(b[f]);j.then(function(a){var b=a.isIncludedIn;"undefined"==typeof h.getNotebookById(b)&&new i(b)},function(a){q.log("Could not retrieve annotation: "+a)}).finally().then(function(){e++,q.log("Received annotation "+e+"/"+c.length),e===c.length&&(q.log("All promises settled, consolidating"),d.consolidateAll(),r(!1),a.resolve(e))}),c.push(j)}},function(c){q.err("Could not search for annotations, error from the server: "+c),b.sendEvent("Pundit.error","Could not search for annotations, error from the server!"),a.reject(c)}),a.promise},q.deleteAnnotation=function(a){var b=n.defer();return e.isUserLogged()?(r(!0),m({method:"DELETE",url:c.get("asAnn",{id:a}),withCredentials:!0}).success(function(){r(!1),q.log("Success annotation: "+a+" correctly deleted");var c=f.getAnnotationById(a).isIncludedIn,d=h.getNotebookById(c);"undefined"!=typeof d&&d.removeAnnotation(a),j.wipeContainer(k.modules.PageItemsContainer.container),f.wipe(),q.getAnnotations().then(function(){b.resolve(a)},function(){b.reject("Error during getAnnotations after a delete of: "+a)})}).error(function(){r(!1),q.log("Error impossible to delete annotation: "+a+" please retry."),b.reject("Error impossible to delete annotation: "+a)})):(q.log("Error impossible to delete annotation: "+a+" you are not logged"),b.reject("Error impossible to delete annotation: "+a+" you are not logged")),b.promise},q.saveAnnotation=function(a,j,o,p,s){var t=n.defer(),u=function(a,b){console.log(a),m({headers:{"Content-Type":"application/json"},method:"POST",url:a,params:{},data:{annotationID:b}}).success(function(){q.log("Post save success")}).error(function(a){q.log("Post save error ",a)})};if(e.isUserLogged()){r(!0);var v={graph:a,items:j};"undefined"!=typeof p&&(v.metadata={template:p}),m({headers:{"Content-Type":"application/json"},method:"POST",url:c.get("asNBCurrent"),params:{context:angular.toJson({targets:o,pageContext:l.getSafePageContext()})},withCredentials:!0,data:v}).success(function(a){if(new g(a.AnnotationID).then(function(){var c=f.getAnnotationById(a.AnnotationID),e=h.getNotebookById(c.isIncludedIn);"undefined"==typeof e?new i(c.isIncludedIn,!0).then(function(b){h.getNotebookById(b).addAnnotation(a.AnnotationID)}):h.getNotebookById(c.isIncludedIn).addAnnotation(a.AnnotationID),"undefined"!=typeof s&&s||(d.consolidateAll(),b.sendEvent("AnnotationsCommunication.saveAnnotation",a.AnnotationID)),r(!1),t.resolve(c.id)},function(){q.log("Error: impossible to get annotation from server after save"),r(!1),t.reject()}),"undefined"!=typeof k.postSave&&k.postSave.active){var c=k.postSave.callbacks;angular.isArray(c)&&angular.forEach(c,function(b){u(b,a.AnnotationID)})}}).error(function(a){q.log("Error: impossible to save annotation",a),r(!1),t.reject()})}else q.log("Error impossible to save annotation you are not logged"),t.reject("Error impossible to save annotation you are not logged");return t.promise},q.editAnnotation=function(a,g,h,i){var j=0,k=n.defer();return e.isUserLogged()?(r(!0),m({headers:{"Content-Type":"application/json"},method:"PUT",url:c.get("asAnnContent",{id:a}),params:{context:angular.toJson({targets:i,pageContext:l.getSafePageContext()})},withCredentials:!0,data:{graph:g}}).success(function(){j>0&&f.getAnnotationById(a).update().then(function(){d.consolidateAll(),b.sendEvent("AnnotationsCommunication.editAnnotation",a),r(!1),k.resolve()}),j++,q.log("Graph correctly updated: "+a)}).error(function(){r(!1),k.reject(),q.log("Error during graph editing of "+a)}),m({headers:{"Content-Type":"application/json"},method:"PUT",url:c.get("asAnnItems",{id:a}),withCredentials:!0,data:h}).success(function(){j>0&&f.getAnnotationById(a).update().then(function(){d.consolidateAll(),b.sendEvent("AnnotationsCommunication.editAnnotation",a),r(!1),k.resolve()}),j++,q.log("Items correctly updated: "+a)}).error(function(){r(!1),k.reject(),q.log("Error during items editing of "+a)})):(q.log("Error impossible to edit annotation: "+a+" you are not logged"),k.reject("Error impossible to edit annotation: "+a+" you are not logged")),k.promise},q}]),angular.module("Pundit2.Communication").service("TemplatesExchange",["BaseComponent",function(a){var b,c=new a("TemplatesExchange"),d=[],e={};return c.wipe=function(){c.log("Wiping every loaded template."),d=[],e={}},c.addTemplate=function(a){a.id in e?c.log("Not adding template "+a.id+": already present."):(e[a.id]=a,d.push(a))},c.removeTemplate=function(a){if(a in e){var b=d.indexOf(e[a]);d.splice(b,1),delete e[a]}else c.log("Impossible to remove template "+a+": not exist.")},c.getTemplates=function(){return d},c.getTemplateById=function(a){return a in e?e[a]:void 0},c.setCurrent=function(a){b=a},c.getCurrent=function(){return e[b]},c}]),angular.module("Pundit2.Annomatic",[]),angular.module("Pundit2.Annomatic").directive("annomaticPanel",function(){return{restrict:"AE",scope:{first:"=",second:"&funName"},templateUrl:"src/Annomatic/AnnomaticPanel.dir.tmpl.html",link:function(){}}}),angular.module("Pundit2.Annomatic").controller("AnnomaticPanelCtrl",["$scope","Annomatic","Consolidation","ItemsExchange","TextFragmentAnnotator","XpointersHelper","AnnotationSidebar","$window","$q",function(a,b,c,d,e,f,g,h,i){a.targets=c.getAvailableTargets(!0),a.gotAnnotations=!1,a.getSuggestions=function(){if(!a.gotAnnotations){a.gotAnnotations=!0,b.hardReset(),g.toggleLoading();for(var e=[],h=f.options.namedContentClasses,j=[],k=a.targets.length;k--;)j.push("[about='"+a.targets[k]+"']");j.join(","),angular.forEach(angular.element(j.join(",")),function(a){for(var b=h.length;b--;)if(angular.element(a).hasClass(h[b])){e.push(a);break}}),b.log("Asking for annotations on "+e.length+" nodes: ",e);for(var l=[],m=e.length;m--;)l.push(b.getAnnotations(e[m]));i.all(l).then(function(){g.toggleLoading(),c.consolidate(d.getItemsByContainer(b.options.container))})}},a.getSuggestionsArea=function(){b.getAnnotationByArea()},a.startReview=function(){b.reviewNext(0)},a.saveReview=function(){b.saveAll()},a.Annomatic=b,a.$watch(function(){return b.ann.savedById},function(b){a.annotations=b}),a.$watch("filteredTypes",function(a,c){("undefined"!=typeof a||"undefined"!=typeof c)&&b.setTypeFilter(a)},!0)}]),angular.module("Pundit2.Annomatic").constant("ANNOMATICDEFAULTS",{container:"annomatic",cMenuType:"annomatic",source:"DataTXT",property:"http://purl.org/pundit/ont/oa#isRelatedTo",minConfidence:.65,partialSelection:!1}).service("Annomatic",["ANNOMATICDEFAULTS","BaseComponent","EventDispatcher","NameSpace","DataTXTResource","XpointersHelper","ItemsExchange","TextFragmentHandler","ImageHandler","TypesHelper","Toolbar","DBPediaSpotlightResource","Item","GramsciResource","AnnotationsCommunication","$rootScope","$timeout","$document","$window","$q","Consolidation","ContextualMenu",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=new b("Annomatic",a);w.ann={byUri:{},byNum:[],numToUriMap:{},uriToNumMap:{},byId:{},autoAnnScopes:[],byState:{},byType:{},typesOptions:[],savedById:[],savedByNum:[]},w.area=null,w.annotationNumber=0,w.options.partialSelection&&v.addAction({type:[w.options.cMenuType],name:"showAllItems",label:"Search items in this area",showIf:function(){return!0},priority:10,action:function(){u.wipe(),w.getAnnotationByArea(),N=!1}});var x=function(a,b){var c=a[0];w.log("##### Wrapping annotations ",b.length,b);for(var d,e,g,h,i,j,k=[c],l=0,m=0,n=b[m],o=[],p=!1;(i=k.pop())&&m<b.length;)if(w.log("Popped node ",i," current offset = "+l),h=0,f.isTextNode(i)){var q=y(i.textContent);if(0===q.length)0===l?w.log("Skipping FIRST empty text node."):p?w.log("Skipping Consecutive empty text node, without correcting again."):1===z(i.textContent).length?(w.log("Skipping intermediate empty text node, correcting offset by 1"),l+=1,p=!0):w.log("OUCH! trimDoubleSpaces fail?!!? --"+z(i.textContent)+"--");else{for(;n.end<=l+q.length+1;){j=!1;var s=B(i.textContent);s.push(0);for(var t=s.length;t--;)if(e=s[t]+n.start-l+h,g=s[t]+n.end-l+h,d=i.textContent.substring(e,g),w.log("Trying to add "+s[t]+" spaces: --"+d+"-- vs --"+n.spot+"-- ("+e+" to "+g+")"),n.spot===d){h+=s[t],j=!0,w.log("@@ Found annotation "+n.spot);var u=r[0].createRange();u.setStart(i,e),u.setEnd(i,g),u.toString()!==n.spot?w.err("Annotation and range content do not match!! :(("):o.push({range:u,annotation:n});break}if(j||w.log("Annotation NOT FOUND: ",n),m++,n=b[m],m>=b.length){w.log("Annotations are over!!! We are done!!");break}}var v=z(i.textContent);v.match(/^\s\s*/)&&(p||0===l)?(l+=v.length-1,w.log("Moving to next node (corrected by leading space) with current offset = "+l)):(l+=v.length,w.log("Moving to next node with current offset = "+l)),p=!1}}else if(i.hasChildNodes())for(var x=i.childNodes,A=x.length;A--;)k.push(x[A]),w.log("Pushing node ",x[A]);return w.log("Dance finished, found "+o.length+" annotations: ",o),o},y=function(a){return a.replace(/[\r\n]/g," ").replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},z=function(a){return a.replace(/[\r\n]/g," ").replace(/\s+/g," ")},A=function(a){var b=a.match(/(\s\s+)/g);if(null===b)return[];for(var c=b.length;c--;)b[c].match(/\n/)&&(b[c]=b[c].replace(/[\r\n]/g," "));return b},B=function(a){var b=A(a),c=b.length;if(0===c)return[];for(var d=[],e={},f=0;c>f;f++){var g=b[f].length-1;"undefined"==typeof e[g]&&(e[g]=!0,d.push(g))}return d.sort(function(a,b){return a-b})};w.stateClassMap={waiting:"ann-waiting",active:"ann-active",accepted:"ann-ok",removed:"ann-removed",hidden:"ann-hidden"},w.reset=function(){w.ann.typesOptions=[];for(var a in w.stateClassMap)w.ann.byState[a]=[]},w.reset();var C=function(a,b){var c=w.ann.byId,d=w.ann.byType;w.log("Analyzing from "+a+" to "+b);for(var e=a;b>e;e++){var f=w.ann.byNum[e],g=f.id,h=f.types||[];g in c?c[g].push(e):c[g]=[e];for(var i=h.length;i--;){var k=h[i];k in d?d[k].push(e):(w.ann.typesOptions.push({value:k}),d[k]=[e])}f.state="waiting",f.lastState="waiting",w.ann.byState[f.state].push(e)}for(e=w.ann.typesOptions.length;e--;){var l=w.ann.typesOptions[e],m=l.value;l.label=j.getLabel(m)+" ("+d[m].length+")"}w.ann.typesOptions=w.ann.typesOptions.sort(function(a,b){return d[b.value].length-d[a.value].length})},D=function(a,b,c){var d=w.ann.byState,e=d[b].indexOf(a);d[c].push(a),d[b].splice(e,1)};w.setState=function(a,b){var c=w.ann.byNum[a],d=w.ann.autoAnnScopes[a];
D(a,c.state,b),c.lastState=c.state,c.state=b;var e=w.stateClassMap[b];c.hidden&&(e+=" "+w.stateClassMap.hidden),d.setStateClass(w.stateClassMap[c.lastState],e)},w.setLastState=function(a){var b=w.ann.byNum[a],c=w.ann.autoAnnScopes[a];D(a,b.state,b.lastState),b.state=b.lastState;var d=w.stateClassMap[b.state];b.hidden&&(d+=" "+w.stateClassMap.hidden),c.setStateClass(w.stateClassMap[b.lastState],d)},w.getDataTXTAnnotations=function(a){var b=t.defer(),c=angular.element(a),d=c.text();return d=y(d),w.log("Querying DataTXT for annotations on content: ",d),w.annotations=e.getAnnotations({$app_id:"cc85cdd8",$app_key:"668e4ac4f00f64c43ab4fefd5c8899fa",text:d},function(a){w.log("Received "+a.annotations.length+" annotations from DataTXT");var d,e=x(c,a.annotations),f=[],i=w.annotationNumber;for(var j in e)e[j].annotation.confidence>w.options.minConfidence&&f.push(e[j]);w.annotationNumber+=f.length,w.currAnn=0;for(var k=f.length,l=0;k>l;l++){var m=i+l;d=h.createItemFromRange(f[l].range),w.ann.byNum[m]=f[l].annotation,w.ann.numToUriMap[m]=d.uri,w.ann.uriToNumMap[d.uri]=m,w.ann.byUri[d.uri]=f[l].annotation,g.addItemToContainer(d,w.options.container),d=E(f[l].annotation),g.addItemToContainer(d,w.options.container)}C(i,w.annotationNumber),b.resolve()},function(a){w.err("Error loading annotations from DataTXT"),b.resolve(a)}),b.promise};var E=function(a){var b={};return b.uri=a.uri,b.type="undefined"==typeof a.types?["http://dbpedia.org/ontology/Thing"]:0===a.types.length?["http://dbpedia.org/ontology/Thing"]:angular.copy(a.types),b.description=a.abstract,b.label=a.label,b.label.length>h.options.labelMaxLength&&(b.label=b.label.substr(0,h.options.labelMaxLength)+" .."),"thumbnail"in a.image&&(b.image=a.image.thumbnail),new m(b.uri,b)};w.hideAnn=function(a){var b=w.ann.byNum[a],c=w.ann.autoAnnScopes[a];b.hidden=!0,c.setStateClass(w.stateClassMap[b.state],w.stateClassMap.hidden)},w.showAnn=function(a){var b=w.ann.byNum[a],c=w.ann.autoAnnScopes[a];b.hidden=!1,c.setStateClass(w.stateClassMap.hidden,w.stateClassMap[b.state])},w.setTypeFilter=function(a){var b=w.ann.byType,c=w.ann.byNum,d={};if(w.log("Setting type filter to ",a),0===a.length)for(var e=c.length;e--;)w.showAnn(e);else{for(var f in a)for(var g=a[f],h=b[g].length;h--;)d[b[g][h]]=!0;for(var i=c.length;i--;)i in d?w.showAnn(i):w.hideAnn(i)}var j=p.$$phase;"$apply"===j||"$digest"===j?q(function(){p.$apply()},1):p.$apply()},w.closeAll=function(){for(var a=w.ann.byState.active.length;a--;){var b=w.ann.byState.active[a];w.ann.autoAnnScopes[b].hide()}},w.currAnn=0,w.reviewNext=function(a){if(0===w.annotationNumber)return void w.log("No annotation to review....");if(0===w.ann.byState.waiting.length)return void w.log("All reviewed!");for(w.closeAll(),a="undefined"==typeof a?w.currAnn:parseInt(a,10),w.currAnn=a>=w.annotationNumber||0>a?0:a;(w.ann.byNum[w.currAnn].hidden===!0||"waiting"!==w.ann.byNum[w.currAnn].state)&&(w.currAnn++,w.currAnn!==w.annotationNumber););w.currAnn<w.annotationNumber&&w.ann.autoAnnScopes[w.currAnn].show()},w.log("Component up and running"),w.hardReset=function(){g.wipeContainer(w.options.container),w.ann={byUri:{},byNum:[],numToUriMap:{},uriToNumMap:{},byId:{},autoAnnScopes:[],byState:{},byType:{},typesOptions:[],savedByNum:[],savedById:[]},w.annotationNumber=0,w.area=null,w.reset()},w.run=function(){J.isRunning=!0,h.turnOff(),i.turnOff(),k.isActiveTemplateMode()&&k.toggleTemplateMode(),w.options.partialSelection&&angular.element("body").on("mousedown",O),p.$emit("annomatic-run")},w.stop=function(){w.hardReset(),J.isRunning=!1,h.turnOn(),i.turnOn(),w.options.partialSelection&&(angular.element("body").off("mousedown",O),angular.element("body").off("mouseup",P)),p.$emit("annomatic-stop")};var F=function(a,b,c){var d=g.getItemByUri(a),e=g.getItemByUri(b),f=g.getItemByUri(c),h=[];if("undefined"!=typeof d&&"undefined"!=typeof e&&"undefined"!=typeof f)return(d.isTextFragment()||d.isImage()||d.isImageFragment())&&-1===h.indexOf(d.uri)&&h.push(d.uri),(e.isTextFragment()||e.isImage()||e.isImageFragment())&&-1===h.indexOf(e.uri)&&h.push(e.uri),(f.isTextFragment()||f.isImage()||f.isImageFragment())&&-1===h.indexOf(f.uri)&&h.push(f.uri),h},G=function(a,b,c){var d=g.getItemByUri(a),e=g.getItemByUri(b),f=g.getItemByUri(c),h={};if("undefined"!=typeof d&&"undefined"!=typeof e&&"undefined"!=typeof f)return h[d.uri]={},h[d.uri][e.uri]=[{type:"uri",value:f.uri}],h},H=function(a,b,c){var e=g.getItemByUri(a),f=g.getItemByUri(b),h=g.getItemByUri(c),i={};if("undefined"!=typeof e&&"undefined"!=typeof f&&"undefined"!=typeof h)return i[e.uri]=e.toRdf(),i[f.uri]=f.toRdf(),i[h.uri]=h.toRdf(),h.type.forEach(function(a,b){var c=h.type[b];i[c]={},i[c][d.rdfs.label]=[{type:"literal",value:j.getLabel(a)}]}),e.type.forEach(function(a,b){var c=e.type[b];i[c]={},i[c][d.rdfs.label]=[{type:"literal",value:j.getLabel(a)}]}),f.type.forEach(function(a,b){var c=f.type[b];i[c]={},i[c][d.rdfs.label]=[{type:"literal",value:j.getLabel(a)}]}),i};w.save=function(a){var b=w.ann.numToUriMap[a],c=w.ann.byUri[b],d=H(b,w.options.property,c.uri),e=G(b,w.options.property,c.uri),f=F(b,w.options.property,c.uri);o.saveAnnotation(e,d,f,void 0,!0).then(function(b){w.ann.savedById.push(b),w.ann.savedByNum.push(a),w.setState(a,"accepted"),w.reviewNext(a+1)})},w.isRunning=function(){return J.isRunning},w.getGrasciAnnotations=function(a){var b=t.defer();if("undefined"==typeof a)return void b.resolve();var c=angular.element(a),d=c.attr("about"),e=c.parent().html();return n.getAnnotations({doc_id:d,html_fragment:e},function(a){L(a),b.resolve()},function(a){w.log("Error msg: ",a),b.resolve()}),b.promise},w.getAnnotations=function(a){return"DataTXT"===w.options.source?w.getDataTXTAnnotations(a):"gramsci"===w.options.source?w.getGrasciAnnotations(a):void 0};var I,J={isRunning:!1},K=function(a){var b={};return b.uri=a.uri,b.label=a.label,b.label.length>h.options.labelMaxLength&&(b.label=b.label.substr(0,h.options.labelMaxLength)+" .."),b.type="undefined"==typeof a.types?["http://dbpedia.org/ontology/Thing"]:angular.copy(a.types),b.description="undefined"==typeof a.abstract?a.label+" imported from Gramsci Dictionary":a.abstract,new m(b.uri,b)},L=function(a){var b,c=a.annotations,d=[];for(b=0;b<c.length;b++){var e=c[b],i=f.getNodeFromXpath(e.startXpath.replace("/html[1]/body[1]","/")),j=f.getNodeFromXpath(e.endXpath.replace("/html[1]/body[1]","/"));if(w.log("get node from xpath",i,j),f.isTextNode(i)&&f.isTextNode(j)){var k=r[0].createRange();if(k.setStart(i,e.startOffset),k.setEnd(j,e.endOffset),k.toString()!==e.spot)w.err("Annotation spot and range do not match!! :((");else{w.log("Annotation spot and range match!! :))");var l=h.createItemFromRange(k);g.addItemToContainer(l,w.options.container),d.push({ann:e,frUri:l.uri}),g.addItemToContainer(K(e),w.options.container)}}else w.err("node is not text",i,j)}var m=w.annotationNumber;for(w.annotationNumber+=d.length,w.currAnn=0,b=0;b<d.length;b++){var n=b+m,e=d[b].ann;w.ann.byNum[n]=e,w.ann.numToUriMap[n]=d[b].frUri,w.ann.uriToNumMap[d[b].frUri]=n,w.ann.byUri[d[b].frUri]=e}C(m,w.annotationNumber)},M=function(){var a;return 0===s.getSelection().rangeCount?null:(a=s.getSelection().getRangeAt(0),null!==a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset?null:a)},N=!1,O=function(){angular.element("body").on("mousemove",function(){var a=M();a&&a.commonAncestorContainer!==I&&(I&&angular.element(I).removeClass("selecting-ancestor"),I=a.commonAncestorContainer,I.nodeType===Node.TEXT_NODE&&(I=I.parentNode),angular.element(I).addClass("selecting-ancestor")),N=!1}),angular.element("body").on("mouseup",P)},P=function(a){angular.element("body").off("mouseup",P),angular.element("body").off("mousemove");var b=M();null===b||N||I&&(angular.element(I).removeClass("selecting-ancestor"),annotationsRootNode=angular.element(I),w.area=annotationsRootNode,N=!0,r[0].getSelection().removeAllRanges(),v.show(a.pageX,a.pageY,annotationsRootNode,w.options.cMenuType))};return w.getAnnotationByArea=function(){annotationsRootNode=w.area,null!=annotationsRootNode&&(w.hardReset(),c.sendEvent("Annomatic.loading",!0),w.getAnnotations(annotationsRootNode).then(function(){c.sendEvent("Annomatic.loading",!1),u.consolidate(g.getItemsByContainer(w.options.container))}))},w}]),angular.module("Pundit2.Annomatic").service("GramsciResource",["$resource",function(a){var b="http://metasound.dibet.univpm.it:8080/DOMAnnotationService/api/annotator/v1/gramsci-dictionary";return a(b,{},{getAnnotations:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}})}]),angular.module("Pundit2.Annomatic").service("DataTXTResource",["$resource",function(a){var b="https://api.dandelion.eu/datatxt/nex/v1";return a(b,{},{getAnnotations:{params:{min_confidence:0,min_length:3,include_types:!0,include_categories:!0,include_abstract:!0,include_lod:!0,include_image:!0},method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}})}]),angular.module("Pundit2.Annomatic").service("DBPediaSpotlightResource",["$http","$q",function(a,b){var c,d=b.defer(),e="http://spotlight.dbpedia.org/rest/annotate";return c={getAnnotations:function(b){return a({data:"text="+encodeURIComponent(b),headers:{"content-type":"application/x-www-form-urlencoded",Accept:"application/json"},method:"POST",url:e}).success(function(a){d.resolve(a)}),d.promise}}}]),angular.module("Pundit2.Annomatic").controller("AnnomaticPopoverCtrl",["$rootScope","$scope","Annomatic","EventDispatcher",function(a,b,c,d){b.num=parseInt(b.content,10),b.ann=c.ann,b.showDetails=!0,b.instances=b.ann.byId[b.ann.byNum[b.num].id].length,b.hide=function(a){b.$hide(),c.setLastState(b.num),a.stopPropagation(),a.preventDefault()},b.setOk=function(a){b.$hide(),-1===b.ann.savedByNum.indexOf(b.num)?c.save(b.num):c.setState(b.num,"accepted"),a.stopPropagation(),a.preventDefault()},b.setKo=function(){b.$hide(),c.setState(b.num,"removed"),c.reviewNext(b.num+1)},b.goNext=function(a){b.$hide(),c.setLastState(b.num),c.reviewNext(b.num+1),a.stopPropagation(),a.preventDefault()},b.toggleSimilar=function(){for(var a=b.ann.byNum[b.num],d=a.id,e=b.ann.byId[d],f=e.length;f--;)if(e[f]!==b.num){var g=c.ann.byNum[e[f]];"active"!==g.state?c.setState(e[f],"active"):c.setLastState(e[f])}},d.addListener("AnnotationSidebar.activateAnnotationsPanel",function(){b.$hide()})}]),angular.module("Pundit2.Annomatic").directive("suggestionFragmentIcon",function(){return{restrict:"E",scope:{fragment:"@"},templateUrl:"src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",replace:!0,controller:"SuggestionFragmentIconCtrl",link:function(){}}}),angular.module("Pundit2.Annomatic").controller("SuggestionFragmentIconCtrl",["$scope","$popover","$element","$rootScope","TextFragmentAnnotator","XpointersHelper","Annomatic",function(a,b,c,d,e,f,g){a.textFragmentIconClass=f.options.textFragmentIconClass,a.iconClass=e.options.suggestionIconClass,a.element=c,e.addFragmentIcon(a);var h=function(){a.uri=a.item.uri,a.num=g.ann.uriToNumMap[a.uri],g.ann.autoAnnScopes[a.num]=a,angular.element("."+a.fragment).addClass("ann-auto");var c={content:""+a.num,placement:"bottom",template:"src/Annomatic/AnnomaticPopover.tmpl.html",trigger:"manual"};a.popover=b(a.element,c)};h(),a.mouseoverHandler=function(){e.highlightById(a.fragment)},a.mouseoutHandler=function(){e.clearHighlightById(a.fragment)},a.clickHandler=function(b){g.ann.byNum[a.num].hidden||(a.popover.$isShown?a.hide():a.show(),b.stopPropagation(),b.preventDefault())},a.show=function(){a.popover.$isShown!==!0&&(g.closeAll(),g.setState(a.num,"active"),a.popover.show())},a.hide=function(){a.popover.$isShown!==!1&&(g.setLastState(a.num),a.popover.hide())},a.setStateClass=function(b,c){angular.element("."+a.fragment).removeClass(b+" ann-active"),angular.element("."+a.fragment).addClass(c),b===g.stateClassMap.hidden?element.removeClass("ann-hidden"):c===g.stateClassMap.hidden&&element.addClass("ann-hidden")},a.setStateClass("",g.stateClassMap.waiting)}]),angular.module("Pundit2.AnnotationSidebar",[]),angular.module("Pundit2.AnnotationSidebar").directive("annotationSidebar",["AnnotationSidebar",function(a){return{restrict:"E",scope:{},templateUrl:"src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",controller:"AnnotationSidebarCtrl",link:function(){angular.element("body").addClass(a.options.bodyClass)}}}]),angular.module("Pundit2.AnnotationSidebar").controller("AnnotationSidebarCtrl",["$scope","$filter","$timeout","$document","$window","EventDispatcher","AnnotationSidebar","Dashboard","Config",function(a,b,c,d,e,f,g,h,i){var j,k=g.options.bodyExpandedClass+" "+g.options.bodyCollapsedClass,l=g.options.sidebarExpandedClass+" "+g.options.sidebarCollapsedClass,m=angular.element("body"),n=angular.element(".pnd-annotation-sidebar-container"),o=parseInt(angular.element("toolbar nav").css("height"),10),p={toolbarHeight:o,newMarginTopSidebar:0,sidebarCurrentHeight:0,sidebarNewHeight:0},q={iconMagnifier:g.options.inputIconSearch,iconFilter:g.options.inputIconFilter,clean:g.options.inputIconClear};a.annotationSidebar=g,a.filters=g.getFilters(),a.isAnnomaticActive=i.isModuleActive("Annomatic"),a.isAnnotationSidebarExpanded=g.options.isAnnotationSidebarExpanded,a.isLoadingData=!1,a.isLoading=!1,a.fromMinDate=new Date,a.toMinDate=new Date,a.fromMaxDate=new Date,a.fromToDate=new Date,m.css("position","static"),n.css("height",m.innerHeight()+"px"),g.options.isAnnotationSidebarExpanded?(m.addClass(g.options.bodyExpandedClass),n.addClass(g.options.sidebarExpandedClass)):(m.addClass(g.options.bodyCollapsedClass),n.addClass(g.options.sidebarCollapsedClass));var r=function(){var a=g.minHeightRequired,b=m.innerHeight(),c=Math.max(a,b);n.css("height",c+"px")},s=function(a){var c=new Date(a&&!isNaN(Date.parse(a))?Date.parse(a):0);return c.setDate(c.getDate()-1),b("date")(c,"yyyy-MM-dd")};a.isSuggestionsPanelActive=function(){return g.isSuggestionsPanelActive()},a.activateSuggestionsPanel=function(){g.activateSuggestionsPanel()},a.isAnnotationsPanelActive=function(){return g.isAnnotationsPanelActive()},a.activateAnnotationsPanel=function(){g.activateAnnotationsPanel()},a.updateSearch=function(a){c.cancel(j),j=c(function(){g.filters.freeText.expression=a},1e3)},a.isFilterLabelShowed=function(a){return"string"==typeof a?a.length>0:void 0},a.toggleFilterList=function(b){var c=angular.element(".pnd-annotation-sidebar-filter-show"),d=angular.element(b.target.parentElement);a.searchAuthors="",a.searchNotebooks="",a.searchTypes="",a.searchPredicates="",a.searchEntities="",c.not(d).removeClass("pnd-annotation-sidebar-filter-show"),d.toggleClass("pnd-annotation-sidebar-filter-show")},a.toggleFilter=function(a,b){var c=g.filters[a].expression.indexOf(b);-1===c?(g.filters[a].expression.push(b),g.toggleActiveFilter(a,b)):(g.filters[a].expression.splice(c,1),g.toggleActiveFilter(a,b))},a.toggleBrokenAnnotations=function(){g.filters.broken.expression=""===g.filters.broken.expression?"hideBroken":""},a.setSearchIcon=function(a){return"undefined"==typeof a||""===a?q.iconMagnifier:q.clean},a.setFilterIcon=function(a){return"undefined"==typeof a||""===a?q.iconFilter:q.clean},f.addListener("Pundit.loading",function(b){var c=b.args;c!==a.isLoadingData&&(g.toggleLoading(),a.isLoadingData=c)}),f.addListener("AnnotationSidebar.toggleLoading",function(b){a.isLoading=b.args}),f.addListener("AnnotationSidebar.toggle",function(b){var c=b.args;c!==a.isAnnotationSidebarExpanded&&(m.toggleClass(k),n.toggleClass(l),g.setAnnotationsPosition(),a.isAnnotationSidebarExpanded=c)}),f.addListener("AnnotationSidebar.toggleFiltersContent",function(b){a.isFiltersShowed=b.args}),a.$watch(function(){return g.getAllAnnotations()},function(b){a.allAnnotations=b,a.annotations=g.needToFilter()?g.getAllAnnotationsFiltered(g.filters):b}),a.$watch(function(){return g.getMinDate()},function(c){if("undefined"!=typeof c){var d=b("date")(c,"yyyy-MM-dd");a.fromMinDate=s(d),""===g.filters.fromDate.expression&&(a.toMinDate=s(d))}}),a.$watch(function(){return g.getMaxDate()},function(c){if("undefined"!=typeof c){var d=b("date")(c,"yyyy-MM-dd");a.toMaxDate=d,""===g.filters.toDate.expression&&(a.fromMaxDate=d)}}),a.$watch("annotationSidebar.filters.fromDate.expression",function(b){a.toMinDate=s("undefined"!=typeof b?b:a.fromMinDate)}),a.$watch("annotationSidebar.filters.toDate.expression",function(b){a.fromMaxDate="undefined"!=typeof b?b:a.toMaxDate}),a.$watch("annotationSidebar.filters",function(b){""===g.filters.freeText.expression&&(a.freeText=""),a.annotations=g.getAllAnnotationsFiltered(b)},!0),a.$watch(function(){return h.getContainerHeight()},function(a){p.newMarginTopSidebar=p.toolbarHeight+a,n.css("margin-top",p.newMarginTopSidebar+"px")}),a.$watch(function(){return h.isDashboardVisible()},function(a){a?(p.newMarginTopSidebar=p.toolbarHeight+h.getContainerHeight(),n.css("margin-top",p.newMarginTopSidebar+"px")):n.css("margin-top",p.toolbarHeight+"px")}),a.$watch(function(){return g.minHeightRequired},function(){r()}),a.$watch(function(){return d.innerHeight()},function(){r()}),angular.element(e).bind("resize",function(){r()}),g.log("Controller Run")}]),angular.module("Pundit2.AnnotationSidebar").filter("orderObjectBy",function(){return function(a,b,c){var d=[];if(!angular.isObject(a))return a;for(var e in a)d.push(a[e]);return d.sort(function(a,d){return a=parseInt(a[b],10),d=parseInt(d[b],10),"asc"===c?a-d:d-a}),d}}).filter("freeText",function(){return function(a,b){var c=[];return b.length>0?angular.forEach(a,function(a){for(var d in a.items){var e=a.items[d].label,f=b.toLowerCase().replace(/\s+/g," "),g=f.split(" "),h=new RegExp(g.join(".*"));if(null!==e.toLowerCase().match(h))return void c.push(a)}for(var i in a.graph)for(var j in a.graph[i])for(var k in a.graph[i][j]){var l=a.graph[i][j][k];if("literal"===l.type){var m=l.value,n=b.toLowerCase().replace(/\s+/g," "),o=n.split(" "),p=new RegExp(o.join(".*"));if(null!==m.toLowerCase().match(p))return void c.push(a)}}}):c=a,c}}).filter("broken",function(){return function(a,b){var c=[];if(b.length>0)for(var d in a)a[d].broken||c.push(a[d]);else c=a;return c}}).filter("authors",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){c=a.creator,-1!==b.indexOf(c)&&d.push(a)}):d=a,d}}).filter("notebooks",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){c=a.isIncludedInUri,-1!==b.indexOf(c)&&d.push(a)}):d=a,d}}).filter("predicates",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.predicates)if(c=a.predicates[e],-1!==b.indexOf(c))return void d.push(a)}):d=a,d}}).filter("entities",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.entities)if(c=a.entities[e],-1!==b.indexOf(c))return void d.push(a)}):d=a,d}}).filter("types",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.items){var f=a.items[e];for(var g in f.type)if(c=f.type[g],-1!==b.indexOf(c))return void d.push(a)}}):d=a,d}}).filter("fromDate",function(){return function(a,b){var c,d=[];return b?(c=new Date(b&&!isNaN(Date.parse(b))?Date.parse(b):0),c.setHours(0,0,0),angular.forEach(a,function(a){var b=Date.parse(a.created);b>=c&&d.push(a)})):d=a,d}}).filter("toDate",function(){return function(a,b){var c,d=[];return b?(c=new Date(b&&!isNaN(Date.parse(b))?Date.parse(b):(new Date).getTime()),c.setHours(23,59,59),angular.forEach(a,function(a){var b=Date.parse(a.created);c>=b&&d.push(a)})):d=a,d}}),angular.module("Pundit2.AnnotationSidebar").constant("ANNOTATIONSIDEBARDEFAULTS",{isAnnotationSidebarExpanded:!1,isFiltersShowed:!1,annotationsRefresh:300,bodyClass:"pnd-annotation-sidebar-active",bodyExpandedClass:"pnd-annotation-sidebar-expanded",bodyCollapsedClass:"pnd-annotation-sidebar-collapsed",sidebarExpandedClass:"pnd-annotation-sidebar-expanded",sidebarCollapsedClass:"pnd-annotation-sidebar-collapsed",inputIconSearch:"pnd-icon-search",inputIconFilter:"pnd-icon-filter",inputIconClear:"pnd-icon-times",annotationsPanelActive:!0,suggestionsPanelActive:!1,annotationHeigth:25,startTop:55,clientDomTemplate:"src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html",debug:!1}).service("AnnotationSidebar",["ANNOTATIONSIDEBARDEFAULTS","$rootScope","$filter","$timeout","BaseComponent","EventDispatcher","AnnotationsExchange","Annomatic","Consolidation","Dashboard","ItemsExchange","NotebookExchange","TypesHelper","TextFragmentAnnotator","XpointersHelper",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=new e("AnnotationSidebar",a),q={isSidebarExpanded:p.options.isAnnotationSidebarExpanded,isFiltersExpanded:p.options.isFiltersShowed,isLoading:!1,allAnnotations:[],filteredAnnotations:[],isAnnotationsPanelActive:p.options.annotationsPanelActive,isSuggestionsPanelActive:p.options.suggestionsPanelActive},r={annotationsDate:[],authors:{},notebooks:{},entities:{},predicates:{},types:{}},s=p.options.startTop,t=30,u=[];p.minHeightRequired=s,p.filters={freeText:{filterName:"freeText",filterLabel:"Free text",expression:""},authors:{filterName:"authors",filterLabel:"Author",expression:[]},notebooks:{filterName:"notebooks",filterLabel:"Notebooks",expression:[]},fromDate:{filterName:"fromDate",filterLabel:"From date",expression:""},toDate:{filterName:"toDate",filterLabel:"To date",expression:""},predicates:{filterName:"predicates",filterLabel:"Predicates",expression:[]},entities:{filterName:"entities",filterLabel:"Entities",expression:[]},types:{filterName:"types",filterLabel:"Types",expression:[]},broken:{filterName:"broken",filterLabel:"Broken",expression:""}},p.filtersCount={},p.annotationPositionReal={};var v=function(a){return"undefined"==typeof p.filtersCount[a]?p.filtersCount[a]=1:p.filtersCount[a]++,p.filtersCount[a]},w=function(a){p.filtersCount={},angular.forEach(r,function(a){for(var b in a)"undefined"!=typeof a[b]&&(a[b].count=0,a[b].partial=0)}),angular.forEach(a,function(a){var b,c={};b=v(a.creator),r.authors[a.creator].count=b,r.authors[a.creator].partial=b,b=v(a.isIncludedIn),r.notebooks[a.isIncludedInUri].count=b,r.notebooks[a.isIncludedInUri].partial=b,angular.forEach(a.predicates,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},b=v(a),r.predicates[a].count=b,r.predicates[a].partial=b)}),angular.forEach(a.entities,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},b=v(a),r.entities[a].count=b,r.entities[a].partial=b)}),angular.forEach(a.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},b=v(a),r.types[a].count=b,r.types[a].partial=b)})})})},x=function(a,b,c){if(p.filtersCount={},c)for(var d in r[b])"undefined"!=typeof r[b][d]&&(r[b][d].partial=0);else for(var e in r)if(e!==b)for(var f in r[e])"undefined"!=typeof r[e][f]&&(r[e][f].partial=0);angular.forEach(a,function(a){var d={};("authors"!==b&&!c||"authors"===b&&c)&&(r.authors[a.creator].partial=v(a.creator)),("notebooks"!==b&&!c||"notebooks"===b&&c)&&(r.notebooks[a.isIncludedInUri].partial=v(a.isIncludedIn)),("predicates"!==b&&!c||"predicates"===b&&c)&&angular.forEach(a.predicates,function(a){"undefined"==typeof d[a]&&(d[a]={uri:a},r.predicates[a].partial=v(a))}),("entities"!==b&&!c||"entities"===b&&c)&&angular.forEach(a.entities,function(a){"undefined"==typeof d[a]&&(d[a]={uri:a},r.entities[a].partial=v(a))}),("types"!==b&&!c||"types"===b&&c)&&angular.forEach(a.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof d[a]&&(d[a]={uri:a},r.types[a].partial=v(a))})})})},y=function(a,b){var c,d,e;s=p.options.startTop,p.annotationPositionReal={},"undefined"!=typeof a&&"number"==typeof b?(e=u.map(function(a){return a.id}).indexOf(a),-1!==e&&(u[e].height=b)):u.sort(function(a,b){return a.top-b.top}),c=u;for(var f in c)p.annotationPositionReal[c[f].id]={id:c[f].id,top:c[f].top,height:c[f].height,broken:c[f].broken},d=c[f].top,d>s?(p.annotationPositionReal[c[f].id].top=d,s=d+c[f].height):(p.annotationPositionReal[c[f].id].top=s,s+=c[f].height);p.minHeightRequired=s+p.options.annotationHeigth},z=function(a){var b,c,d,e,f=a.graph;for(var g in f){if(c=k.getItemByUri(g),(c.isTextFragment()||c.isImageFragment()||c.isImage()||c.isWebPage())&&i.isConsolidated(c))return g;for(var h in f[g]){b=f[g][h];for(var j in b)if(d=b[j].value,e=b[j].type,"uri"===e&&(c=k.getItemByUri(d),(c.isTextFragment()||c.isImageFragment()||c.isImage()||c.isWebPage())&&i.isConsolidated(c)))return d}}},A=function(a,b){var c,d=p.needToFilter()?q.filteredAnnotations:q.allAnnotations,e=!1,f=0;c=j.isDashboardVisible()?j.getContainerHeight():0,d.length>0&&(s=p.options.startTop,u=[],"undefined"!=typeof a&&"number"==typeof b&&(e=!0),angular.forEach(d,function(d){var g,h,i;if(g=z(d),"undefined"==typeof g)f=p.options.annotationHeigth,e&&a===d.id&&(f=b),u.push({id:d.id,top:-3,height:f,broken:!0});else{var j,l,m;h=k.getItemByUri(g),h.isTextFragment()?(j=-1,i=n.getFragmentIdByUri(g),"undefined"!=typeof i?j=angular.element("."+i).offset().top-t-c:p.log("Something wrong with the fragments of this annotation: ",d)):h.isImage()?(j=-1,m=o.xPointerToXPath(h.uri),l=angular.element(m.startNode.firstElementChild),"undefined"!=typeof l.offset()&&(j=l.offset().top-t-c)):h.isImageFragment()?(j=-1,m=o.xPointerToXPath(h.parentItemXP),l=angular.element(m.startNode.firstElementChild),"undefined"!=typeof l.offset()&&(j=l.offset().top-t-c)):h.isWebPage()&&(j=-2),f=p.options.annotationHeigth,e&&a===d.id&&(f=b),u.push({id:d.id,top:j,height:f,broken:!1})}}),y())},B=function(){for(var a in q.allAnnotations)q.allAnnotations[a].broken=q.allAnnotations[a].isBroken()},C=function(a){var b;n.hideAll(),angular.forEach(a,function(a){for(var c in a.items)-1===a.predicates.indexOf(c)&&(b=k.getItemByUri(c),i.isConsolidated(b)&&n.showByUri(b.uri))})},D=function(a){p.filtersCount={},angular.forEach(a,function(a){var c={};"undefined"==typeof r.authors[a.creator]&&(r.authors[a.creator]={uri:a.creator,label:a.creatorName,active:!1,count:0}),-1===r.annotationsDate.indexOf(a.created)&&r.annotationsDate.push(a.created);var d=a.isIncludedIn,e=a.isIncludedInUri;if("undefined"==typeof r.notebooks[e]){var f="Downloading in progress",g=b.$watch(function(){return l.getNotebookById(d)},function(a){"undefined"!=typeof a&&(f=a.label,r.notebooks[e].label=f,g())});r.notebooks[e]={uri:e,label:f,notebookId:d,active:!1,count:0}}angular.forEach(a.predicates,function(b){"undefined"==typeof c[b]&&(c[b]={uri:b},"undefined"==typeof r.predicates[b]&&(r.predicates[b]={uri:b,label:a.items[b].label,active:!1,count:0}))}),angular.forEach(a.entities,function(b){"undefined"==typeof c[b]&&(c[b]={uri:b},"undefined"==typeof r.entities[b]&&(r.entities[b]={uri:b,label:a.items[b].label,active:!1,count:0}))}),angular.forEach(a.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof r.types[a]&&(r.types[a]={uri:a,label:m.getLabel(a),active:!1,count:0}))})})}),w(a)};return p.toggle=function(){q.isSidebarExpanded=!q.isSidebarExpanded,f.sendEvent("AnnotationSidebar.toggle",q.isSidebarExpanded)},p.toggleLoading=function(){q.isLoading=!q.isLoading,f.sendEvent("AnnotationSidebar.toggleLoading",q.isLoading)},p.toggleFiltersContent=function(){q.isFiltersExpanded=!q.isFiltersExpanded,f.sendEvent("AnnotationSidebar.toggleFiltersContent",q.isFiltersExpanded)},p.isAnnotationSidebarExpanded=function(){return q.isSidebarExpanded},p.isFiltersExpanded=function(){return q.isFiltersExpanded},p.isAnnotationsPanelActive=function(){return q.isAnnotationsPanelActive},p.activateAnnotationsPanel=function(){q.isFiltersExpanded&&p.toggleFiltersContent(),q.isSuggestionsPanelActive&&(h.stop(),f.sendEvent("AnnotationSidebar.activateAnnotationsPanel"),i.wipe(),i.consolidateAll()),q.isAnnotationsPanelActive=!0,q.isSuggestionsPanelActive=!1},p.isSuggestionsPanelActive=function(){return q.isSuggestionsPanelActive},p.activateSuggestionsPanel=function(){q.isAnnotationsPanelActive&&(q.isFiltersExpanded&&(q.isFiltersExpanded=!1),i.wipe(),h.run()),q.isSuggestionsPanelActive=!0,q.isAnnotationsPanelActive=!1},p.getAllAnnotations=function(){return q.allAnnotations},p.getAllAnnotationsFiltered=function(a){var b,d,e={};q.filteredAnnotations=angular.copy(q.allAnnotations),angular.forEach(a,function(a){d=a.filterName,b=a.expression,("string"==typeof b&&""!==b||angular.isArray(b)&&b.length>0)&&(q.filteredAnnotations=c(d)(q.filteredAnnotations,b),e[d]=c(d)(q.allAnnotations,b))});var f=function(a,b){var c=[];for(var d in a)for(var e in b)angular.equals(a[d],b[e])&&c.push(a[d]);return c},g=function(a,b,c){var d=c;for(var e in a)e!==b&&(d=f(d,a[e]));return d};x(q.filteredAnnotations,"none",!1);var h={};for(var i in e)h[i]=g(e,i,angular.copy(q.allAnnotations)),x(h[i],i,!0);return C(q.filteredAnnotations),A(),q.filteredAnnotations},p.getFilters=function(){return r},p.getMinDate=function(){return r.annotationsDate.length>0?r.annotationsDate.reduce(function(a,b){return b>a?a:b}):void 0},p.getMaxDate=function(){return r.annotationsDate.length>0?r.annotationsDate.reduce(function(a,b){return a>b?a:b}):void 0},p.getLoadingStatus=function(){return q.isLoading},p.setAllPosition=function(a,b){y(a,b)},p.setAnnotationPosition=function(a,b){var c;"undefined"!=typeof a&&"number"==typeof b&&(c=u.map(function(a){return a.id}).indexOf(a),-1!==c&&(u[c].height=b))},p.setAnnotationsPosition=function(){A()},p.needToFilter=function(){for(var a in p.filters){var b=p.filters[a].expression;if("string"==typeof b&&""!==b)return!0;if(angular.isArray(b)&&b.length>0)return!0}return!1},p.toggleActiveFilter=function(a,b){r[a][b].active=!r[a][b].active},p.setFilter=function(a,b){var c,d,e=p.filters[a].expression;"string"==typeof e?p.filters[a].expression=b:"object"==typeof e&&(c=p.filters[a].expression.indexOf(b),d=r[a][b],-1===c&&"undefined"!=typeof d&&(d.active=!0,p.filters[a].expression.push(b)))},p.removeFilter=function(a,b){var c,d=p.filters[a].expression;"string"==typeof d?p.filters[a].expression="":"object"==typeof d&&(c=p.filters[a].expression.indexOf(b),-1!==c&&(r[a][b].active=!1,p.filters[a].expression.splice(c,1)))},p.resetFilters=function(){angular.forEach(p.filters,function(a){if("string"==typeof a.expression)a.expression="";else if("object"==typeof a.expression){for(var b in r[a.filterName])r[a.filterName][b].active=!1;a.expression=[]}})},f.addListener("Consolidation.consolidateAll",function(){p.log("Update annotations in sidebar");var a=g.getAnnotations();q.allAnnotations=angular.copy(a),B(),D(q.allAnnotations),A()}),p.log("Component running"),p}]),angular.module("Pundit2.AnnotationSidebar").directive("annotationDetails",function(){return{restrict:"E",scope:{id:"@",broken:"=broken"},templateUrl:"src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",controller:"AnnotationDetailsCtrl"}}),angular.module("Pundit2.AnnotationSidebar").controller("AnnotationDetailsCtrl",["$scope","$rootScope","$element","$modal","$timeout","$window","AnnotationSidebar","AnnotationDetails","AnnotationsExchange","AnnotationsCommunication","Config","EventDispatcher","NotebookExchange","ItemsExchange","TripleComposer","Dashboard","ImageAnnotator","TextFragmentAnnotator","TypesHelper","MyPundit","Consolidation",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){h.addAnnotationReference(a);var v,w=a.id,x=angular.element(c).find(".pnd-annotation-details-wrap"),y=g.options.annotationHeigth;a.annotation=h.getAnnotationDetails(w),a.openGraph=k.lodLive.baseUrl+k.pndPurl+"annotation/"+w,a.moreInfo=h.options.moreInfo,a.notebookName="Downloading notebook in progress",a.isLoading=!1,"undefined"!=typeof a.annotation&&(a.askLink=h.isUserToolShowed(a.annotation.creator)?k.askBaseURL+"#/myNotebooks/":k.askBaseURL+"#/notebooks/",v=a.annotation.notebookId),"undefined"!=typeof k.lodLive&&k.lodLive.active?(a.lodLiveBaseUrl=k.lodLive.baseUrl,a.lodLive=!0):a.lodLive=!1,a.forceTemplateEdit="undefined"!=typeof k.forceTemplateEdit&&k.forceTemplateEdit?!0:!1,a.forceEdit="undefined"!=typeof k.forceEditAndDelete&&k.forceEditAndDelete?!0:!1;
var z=b.$new();z.titleMessage="Delete Annotation";var A=d({container:'[data-ng-app="Pundit2"]',template:"src/Core/Templates/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:z}),B=function(){z.notifyMessage="Are you sure you want to delete this annotation? After you can no longer recover.",A.$promise.then(A.show)};z.confirm=function(){t.isUserLogged()&&(x.addClass("pnd-annotation-details-delete-in-progress"),j.deleteAnnotation(a.annotation.id).then(function(){z.notifyMessage="Your annotation has been deleted successfully"},function(){x.removeClass("pnd-annotation-details-delete-in-progress"),z.notifyMessage="Impossible to delete the annotation. Please reatry later."})),e(function(){A.hide()},1e3)},z.cancel=function(){A.hide()},a.toggleAnnotation=function(){g.isAnnotationSidebarExpanded()||g.toggle(),a.metaInfo=!1,h.toggleAnnotationView(w),a.annotation.expanded||g.setAllPosition(w,y)},a.deleteAnnotation=function(){B()},a.showEdit=function(){return"undefined"==typeof a.annotation.hasTemplate||a.forceTemplateEdit},a.editAnnotation=function(){o.editAnnotation(a.annotation.id),p.isDashboardVisible()||(o.closeAfterOp(),p.toggle()),l.sendEvent("AnnotationDetails.editAnnotation",o.options.clientDashboardTabTitle)},a.isUserToolShowed=function(){return(h.isUserToolShowed(a.annotation.creator)||a.forceEdit&&t.isUserLogged())&&g.isAnnotationsPanelActive()},a.mouseoverAllHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=n.getItemByUri(c[d]),"undefined"!=typeof b&&b.isImageFragment()&&u.isConsolidated(b)&&q.svgHighlightByItem(b)}},a.mouseoutAllHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=n.getItemByUri(c[d]),"undefined"!=typeof b&&b.isImageFragment()&&u.isConsolidated(b)&&q.svgClearHighlightByItem(b)}},a.mouseoverHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=n.getItemByUri(c[d]),"undefined"!=typeof b&&(b.isTextFragment()?r.highlightByUri(c[d]):b.isImageFragment()||b.isImage()&&q.highlightByUri(c[d]))}},a.mouseoutHandler=function(){if(!a.annotation.broken){var b,c=a.annotation.itemsUriArray;for(var d in c)b=n.getItemByUri(c[d]),"undefined"!=typeof b&&(b.isTextFragment()?r.clearHighlightByUri(c[d]):b.isImageFragment()||b.isImage()&&q.clearHighlightByUri(c[d]))}},a.mouseoverItemHandler=function(b){if(!a.annotation.broken){var c=n.getItemByUri(b);"undefined"!=typeof c&&(c.isTextFragment()?r.highlightByUri(b):c.isImageFragment()&&u.isConsolidated(c)?(q.svgClearHighlightByItem(c),q.svgHighlightByItem(c)):c.isImage()&&q.highlightByUri(b))}},a.mouseoutItemHandler=function(b){if(!a.annotation.broken){var c=n.getItemByUri(b);"undefined"!=typeof c&&(c.isTextFragment()?r.clearHighlightByUri(b):c.isImageFragment()||c.isImage()&&q.clearHighlightByUri(b))}},l.addListener("Pundit.loading",function(b){a.isLoading=b.args}),l.addListener("AnnotationSidebar.toggle",function(a){var b=a.args;b||h.closeViewAndReset()});var C=a.$watch(function(){return m.getNotebookById(v)},function(b){"undefined"!=typeof b&&(a.notebookName=b.label,C())});a.$watch(function(){return x.height()},function(b,c){"undefined"!=typeof a.annotation&&b!==c&&a.annotation.expanded&&g.setAllPosition(w,b)}),h.log("Controller Details Run")}]),angular.module("Pundit2.AnnotationSidebar").constant("ANNOTATIONDETAILSDEFAULTS",{defaultExpanded:!1,moreInfo:!1,debug:!1}).service("AnnotationDetails",["ANNOTATIONDETAILSDEFAULTS","$rootScope","$filter","$timeout","$document","BaseComponent","EventDispatcher","Annotation","AnnotationSidebar","AnnotationsExchange","TemplatesExchange","Consolidation","ContextualMenu","Dashboard","ImageHandler","ItemsExchange","MyPundit","TextFragmentAnnotator","TypesHelper",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=new f("AnnotationDetails",a),u={annotations:[],defaultExpanded:t.options.defaultExpanded,isUserLogged:!1,isGhostedActive:!1,userData:{}};m.addAction({type:[r.options.cMenuType,o.options.cMenuType],name:"showAllAnnotations",label:"Show all annotations of this item",showIf:function(a){return"undefined"!=typeof a?l.isConsolidated(a)||a.uri in l.getFragmentParentList():void 0},priority:10,action:function(a){i.isAnnotationSidebarExpanded()||i.toggle(),t.closeViewAndReset(),i.isFiltersExpanded()&&i.toggleFiltersContent();var b,c=l.getFragmentParentList();a.uri in c&&(b=c[a.uri]);for(var d in u.annotations){-1===u.annotations[d].itemsUriArray.indexOf(a.uri)&&(u.annotations[d].ghosted=!0);for(var e in b)-1===u.annotations[d].itemsUriArray.indexOf(b[e].uri)||(u.annotations[d].ghosted=!1)}u.isGhostedActive=!0,r.ghostAll(),r.ghostRemoveByUri(a.uri)}});var v=function(a){for(var b="pnd-annotation-details-wrap",c="pnd-annotation-sidebar-filter-content",d="pnd-annotation-details-ghosted";"body"!==a.nodeName.toLowerCase();){if(angular.element(a).hasClass(b)&&0===angular.element(a).find("."+d).length)return!1;if(angular.element(a).hasClass(c))return!1;if(null===a.parentNode)return!0;a=a.parentNode}return!0},w=function(a){var b,c=p.getItemByUri(a);return"undefined"!=typeof c&&(b={uri:a,label:c.label,description:c.description,image:"undefined"!=typeof c.image?c.image:null,"class":c.getClass(),icon:c.getIcon(),typeLabel:"undefined"!=typeof c.type[0]?s.getLabel(c.type[0]):null,typeClass:"uri"}),b},x=function(a){var b,c=a,d={};for(b in c.graph)break;return d=w(b)},y=function(a){var b,c,d=[];for(var e in a)b=a[e].value,c=a[e].type,d.push("uri"===c?w(b):{uri:null,label:b,description:b,image:null,"class":null,icon:null,typeLabel:c,typeClass:c});return d},z=function(a){var b=a,c=b.graph,d=[];for(var e in c)for(var f in c[e])d.push({subject:w(e),predicate:w(f),objects:y(c[e][f],b)});return d},A=function(a){var b=a,c=b.items,d=[];for(var e in c)-1===d.indexOf(e)&&d.push(e);return d};return t.getAnnotationDetails=function(a){return a in u.annotations?u.annotations[a]:void 0},t.getAnnotationViewStatus=function(a){return u.annotations[a].expanded},t.setGhosted=function(a){"undefined"!=typeof u.annotations[a]&&(u.annotations[a].ghosted=!0),u.isGhostedActive=!0},t.resetGhosted=function(){for(var a in u.annotations)u.annotations[a].ghosted=!1;u.isGhostedActive=!1},t.closeViewAndReset=function(){for(var a in u.annotations)u.annotations[a].ghosted=!1,u.annotations[a].expanded=!1,i.setAllPosition(a,i.options.annotationHeigth);u.isGhostedActive=!1,r.ghostRemoveAll()},t.closeAllAnnotationView=function(a){for(var b in u.annotations)b!==a&&(u.annotations[b].expanded=!1,i.setAnnotationPosition(b,i.options.annotationHeigth))},t.openAnnotationView=function(a){"undefined"!=typeof u.annotations[a]?(i.isAnnotationSidebarExpanded()||i.toggle(),t.closeAllAnnotationView(a),u.annotations[a].expanded=!0):t.log("Cannot find this annotation: id -> "+a)},t.toggleAnnotationView=function(a){t.closeAllAnnotationView(a),u.annotations[a].expanded=!u.annotations[a].expanded},t.isAnnotationGhosted=function(a){return u.annotations[a].ghosted},t.isAnnotationUser=function(a){return a===u.userData.uri},t.isUserToolShowed=function(a){return u.isUserLogged===!0&&a===u.userData.uri},t.addAnnotationReference=function(a,b){var c,d,e,f,g=a.id,h=a.broken;"undefined"!=typeof g&&(c=j.getAnnotationById(g),d=b?!0:u.defaultExpanded,e=k.getTemplateById(c.hasTemplate),"undefined"!=typeof e&&(f=e.hasColor),("undefined"==typeof u.annotations[g]||"undefined"!=typeof b)&&(u.annotations[g]={id:g,creator:c.creator,creatorName:c.creatorName,created:c.created,notebookId:c.isIncludedIn,scopeReference:a,mainItem:x(c),itemsArray:z(c),itemsUriArray:A(c),broken:h,expanded:d,ghosted:!1,color:f,hasTemplate:e}))},g.addListeners(["AnnotationsCommunication.saveAnnotation","AnnotationsCommunication.editAnnotation"],function(a){t.log("Update annotation");var b,c,e=a.args;"undefined"!=typeof e&&(c=j.getAnnotationById(e),b={id:e,broken:c.isBroken()},i.isAnnotationSidebarExpanded()||i.toggle(),t.closeAllAnnotationView(e),t.addAnnotationReference(b,!0),d(function(){var a=angular.element("#"+e);a.length>0&&angular.element("body").animate({scrollTop:a.offset().top-n.getContainerHeight()-30},"slow")},100))}),g.addListener("MyPundit.isUserLogged",function(a){u.isUserLogged=a.args,u.userData=q.getUserData()}),e.on("mousedown",function(a){var c=a.target;u.isGhostedActive&&v(c)&&t.closeViewAndReset(),b.$$phase||b.$digest()}),t.log("Component running"),t}]),angular.module("Pundit2.Dashboard",[]),angular.module("Pundit2.Dashboard").directive("dashboard",function(){return{restrict:"E",scope:{},templateUrl:"src/Dashboard/Dashboard.dir.tmpl.html",controller:"DashboardCtrl"}}),angular.module("Pundit2.Dashboard").controller("DashboardCtrl",["$document","$window","$rootScope","$scope","$compile","Dashboard",function(a,b,c,d,e,f){var g={container:angular.element(".pnd-dashboard-container"),footer:angular.element(".pnd-dashboard-footer"),body:angular.element("body")};g.footer.css({height:f.options.footerHeight}),d.isDashboardVisible=f.isDashboardVisible();var h=function(){var a=angular.element("body"),b=parseInt(a.innerWidth(),10),e=parseInt(a.css("margin-left"),10),g=parseInt(a.css("margin-right"),10),h=b+g+e;h!==f.getContainerWidth()&&(f.setContainerWidth(h),c.$$phase||d.$digest())};d.$watch(function(){return g.body.innerWidth()},h),angular.element(b).resize(h),d.$watch(function(){return f.getConfiguredPanels()},function(a){for(var b in a)f.log("Adding configured panel to Dashboard: "+b),g.container.append('<dashboard-panel paneltitle="'+b+'"></dashboard-panel>');var c=angular.element("dashboard-panel");e(c)(d)}),d.$watch(function(){return f.getContainerHeight()},function(a){g.container.css({height:a});var b=parseInt(g.container.css("top"),10);g.body.css({marginTop:b+a})}),d.$watch(function(){return f.getContainerWidth()},function(a){g.container.css({width:a})}),d.$watch(function(){return f.isDashboardVisible()},function(a,b){if(d.isDashboardVisible=a,"undefined"!=typeof a&&"undefined"!=typeof b){var c=parseInt(g.container.css("top"),10),e=a?c+f.getContainerHeight():c;g.body.css({marginTop:e})}}),f.log("Controller Run")}]),angular.module("Pundit2.Dashboard").constant("DASHBOARDDEFAULTS",{clientDomTemplate:"src/Dashboard/ClientDashboard.tmpl.html",debug:!1,isDashboardVisible:!1,containerMinHeight:200,containerMaxHeight:800,containerHeight:300,footerHeight:20,separatorWidth:8,panels:{lists:{minWidth:243},tools:{minWidth:478},details:{minWidth:239}},panelCollapsedWidth:28,panelTabsHeight:27,panelContentHeaderHeight:43,panelInnerTabsHeight:31,panelFooterHeight:40}).service("Dashboard",["BaseComponent","DASHBOARDDEFAULTS","$window","$rootScope",function(a,b,c,d){var e=new a("Dashboard",b),f=0;for(var g in e.options.panels)f+=e.options.panels[g].minWidth;var h={isDashboardVisible:e.options.isDashboardVisible,containerWidth:Math.max(angular.element("body").innerWidth(),f),containerHeight:e.options.containerHeight,panelsContent:{}};e.getConfiguredPanels=function(){return e.options.panels},e.canCollapsePanel=function(){var a=i.filter(function(a){return a.isCollapsed}).length;return a<i.length-1},e.toggle=function(){if(h.isDashboardVisible=!h.isDashboardVisible,h.isDashboardVisible)for(var a in i)i[a].setTabContentHeight()},e.isDashboardVisible=function(){return h.isDashboardVisible},e.getContainerHeight=function(){return h.containerHeight},e.increaseContainerHeight=function(a){if(h.containerHeight===e.options.containerMaxHeight&&a>0)return!1;if(h.containerHeight===e.options.containerMinHeight&&0>a)return!1;var b=h.containerHeight+a;return h.containerHeight=b<e.options.containerMinHeight?e.options.containerMinHeight:b>e.options.containerMaxHeight?e.options.containerMaxHeight:b,d.$$phase||d.$digest(),!0},e.getContainerWidth=function(){return h.containerWidth},e.setContainerWidth=function(a){return f>=a?(h.containerWidth=f,e.resizeAll(),void e.log("Dashboard is at min-width")):(h.containerWidth=a,void e.resizeAll())};var i=[];return e.addPanel=function(a){e.log("Adding panel",a.paneltitle);var b=i.length;if(b>0&&(i[b-1].isLast=!1,i[b-1].collapsedWidth=e.options.panelCollapsedWidth),a.isLast=!0,a.collapsedWidth=e.options.panelCollapsedWidth-e.options.separatorWidth,a.minWidth=e.options.panels[a.paneltitle].minWidth,a.index=b,i.push(a),a.paneltitle in h.panelsContent)for(var c=h.panelsContent[a.paneltitle],d=c.length;d--;)e.log("Adding tab "+c[d].tabName+" to existing panel "+a.paneltitle),a.addContent(c[d].tabName,c[d].tabTemplate);var f,g=0;for(f in e.options.panels)g++;i.length===g&&e.resizeAll()},e.resizeAll=function(a){var b,c,f=e.getContainerWidth(),g=0;angular.isObject(a)||(a={});for(c in a)g++,f-=a[c];var h=i.filter(function(a){return a.isCollapsed}),j=i.filter(function(a){return!a.isCollapsed});f-=h.reduce(function(a,b){return a+b.collapsedWidth},0);var k=j.reduce(function(b,c){return c.width<c.minWidth&&(c.width=c.minWidth),c.index in a?b:b+c.width},0);for(b=j.length;b--;)j[b].ratio=j[b].width/k;var l=0,m=[],n=0;for(b=i.length,c=0;b>c;c++){if(c in a)i[c].width=a[c];else if(i[c].isCollapsed)i[c].width=i[c].collapsedWidth;else{var o=i[c].ratio*f;o<i[c].minWidth?(n+=o-i[c].minWidth,i[c].width=i[c].minWidth):(i[c].width=o,m.push(i[c]))}i[c].left=l,l+=i[c].width}for(var p,q;0>n;){for(p=0,q=0,l=0,c=0;c<m.length;c++)q+=m[c].width;for(m=m.filter(function(a){a.ratio=a.width/q;var b=a.width+a.ratio*n;return b<a.minWidth?(p+=b-a.minWidth,a.width=a.minWidth,!1):(a.width=b,!0)}),c=0;c<i.length;c++)i[c].left=l,l+=i[c].width;n=p}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest()},e.tryToResizeCouples=function(a,b){var c,e,f,g=i[a];if(g.isCollapsed){if(!(a+1<i.length)||i[a+1].isCollapsed)return!1;for(c=a-1;c>=0;c--)if(!i[c].isCollapsed){g=i[c],a=c;break}if(0>c)return!1}var h=!0;if(a<i.length-1){for(c=a+1;c<i.length;c++)if(!i[c].isCollapsed){h=!1;break}if(h)return!1}if(0>b){if(e=g.width-Math.max(g.minWidth,g.width+b),g.width=Math.max(g.minWidth,g.width+b),e>0){for(f=g.left,c=a+1;c<i.length;c++){if(!i[c].isCollapsed){i[c].width=i[c].width+e,i[c].left=i[c-1].left+i[c-1].width;break}i[c].left=f+i[c-1].width}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!0}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!1}if(i.length>a+1){var j;for(c=a+1;c<i.length;c++)if(!i[c].isCollapsed){j=c;break}var k=i[j];if(e=k.width-Math.max(k.minWidth,k.width-b),k.width=Math.max(k.minWidth,k.width-b),e>0){for(g.width=g.width+e,f=g.left+g.width,c=a+1;j>c;c++)i[c].left=f,f+=i[c].width;if(k.left=f,!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!0}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!1}},e.addContent=function(a,b,c){for(var d in i)if(i[d].paneltitle===a)return e.log("Adding tab "+b+" to existing panel "+a),void i[d].addContent(b,c);var f={tabName:b,tabTemplate:c};a in h.panelsContent?h.panelsContent[a].push(f):h.panelsContent[a]=[f],e.log("Added tab "+b+" to non-existing panel "+a+": for later use.")},e.log("Service run"),e}]),angular.module("Pundit2.Dashboard").directive("dashboardPanel",function(){return{restrict:"E",transclude:!0,scope:{paneltitle:"@"},templateUrl:"src/Dashboard/DashboardPanel.dir.tmpl.html",controller:"DashboardPanelCtrl"}}),angular.module("Pundit2.Dashboard").controller("DashboardPanelCtrl",["$document","$window","$scope","$rootScope","$element","$timeout","Dashboard","ResourcePanel","Annomatic",function(a,b,c,d,e,f,g,h,i){c.collapsedWidth=g.options.panelCollapseWidth,c.bottom=g.options.footerHeight,c.minWidth=100,c.ratio=1,c.isCollapsed=!1,c.canCollapsePanel=!0,c.left=0,c.width=200,c.tabs=[],c.isAnnomaticRunning=!1,c.$watch(function(){return i.isRunning()},function(a){a&&g.isDashboardVisible()&&g.toggle(),c.isAnnomaticRunning=a}),c.$watch(function(){return c.tabs.activeTab},function(){f(function(){c.setTabContentHeight()},30)}),c.toggleCollapse=function(){if(h.hide(),c.isCollapsed){c.isCollapsed=!c.isCollapsed;var a={};a[c.index]=c.minWidth,g.resizeAll(a)}else g.canCollapsePanel()&&(c.isCollapsed=!c.isCollapsed,g.resizeAll())},c.addContent=function(a,b){c.tabs.push({title:a,template:b}),g.log("Added content "+a+" to panel "+c.title)};var j,k=function(a){var b,d=a.pageX-j;0!==d&&(b=g.tryToResizeCouples(c.index,d),b&&(j=a.pageX),h.updatePosition())},l=function(){a.off("mousemove",k),a.off("mouseup",l)};c.mouseDownHandler=function(b){b.preventDefault(),j=b.pageX,a.on("mousemove",k),a.on("mouseup",l)},c.$watch(function(){return g.getContainerHeight()},function(){c.setTabContentHeight()}),c.$watch(function(){return g.canCollapsePanel()},function(a){c.canCollapsePanel=a}),c.setTabContentHeight=function(){var a=g.getContainerHeight(),b=angular.element(e).find(".pnd-inner .pnd-tab-content"),c=angular.element(e).find(".pnd-inner-scrollable"),d=angular.element(e).find(".pnd-inner-scrollable.pnd-inner-no-tabs");a-=g.options.panelTabsHeight,a-=g.options.panelContentHeaderHeight,a-=g.options.panelFooterHeight,a-=g.options.footerHeight,b.length>0&&(a-=g.options.panelInnerTabsHeight,b.height(a-1)),c.length>0&&c.height(a+2),d.length>0&&(a+=g.options.panelContentHeaderHeight,d.height(a-9))};var m,n=function(){a.off("mousemove",o),a.off("mouseup",n)},o=function(a){var b=a.pageY-m;g.increaseContainerHeight(b)&&(m=a.pageY)};c.footerMouseDownHandler=function(b){1===b.which&&(b.preventDefault(),a.on("mouseup",n),a.on("mousemove",o),m=b.pageY)},g.addPanel(c),d.$$phase||c.$digest(),g.log("Panel "+c.title+" Controller Run")}]),angular.module("Pundit2.Dashboard").directive("pndTabs",function(){return{restrict:"EAC",scope:!0,templateUrl:"src/Dashboard/pndTabs.dir.tmpl.html",controller:"pndTabsCtrl"}}),angular.module("Pundit2.Dashboard").controller("pndTabsCtrl",["$document","$window","$rootScope","$scope","$element","Dashboard","ResourcePanel","EventDispatcher",function(a,b,c,d,e,f,g,h){var i={animation:"am-fade",offsetButton:40};d.hiddenTabsDropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",i.animation&&e.addClass(i.animation);var j=function(a){for(var b=0;b<d.panes.length;b++)if(d.panes[b].title===a)return d.active!==b&&d.setActive(b),void(d.$parent.isCollapsed&&d.$parent.toggleCollapse())};d.panes=null,d.hiddenTabs=[],d.$watch("tabs",function(a){if(!angular.equals(a,d.panes)){d.panes=angular.copy(a);for(var b in d.panes)d.panes[b].isVisible=!0}},!0);var k=0,l=!1;d.$watch(function(){return angular.element(e).children("ul.pnd-tab-header").children("li:not(.pull-right)").length},function(a){a>0&&(k=a,l=!0,o())});var m=0,n=angular.element(e).children("ul.pnd-tab-header");d.$watch(function(){return n.width()},function(a){m=parseInt(a,10),o(),d.hiddenTabIsActive=-1===r()?!1:!0});var o=function(){k>0&&m>0&&(l&&(l=!1,p()),q(m))},p=function(){for(var a=angular.element(e).children("ul.pnd-tab-header").children("li:not(.pull-right)"),b=0;b<a.length;b++){var c=parseInt(angular.element(a[b]).css("width"),10);d.panes[b].width=c}},q=function(a){d.hiddenTabs=[];for(var b,c,e,f=a-i.offsetButton,g=0,h=0;h<d.panes.length;h++){if(b=d.panes[h],e=g+b.width,e>f){c=h;break}g=e}for(h=0;h<d.panes.length;h++)if(b=d.panes[h],c>h||"undefined"==typeof c)b.isVisible=!0;else{b.isVisible=!1;var j={text:b.title,click:"setActive("+h+", $event)"};j.isActive=h===d.tabs.activeTab?!0:!1,d.hiddenTabs.push(j)}},r=function(a){var b;if("undefined"==typeof d.hiddenTabs)return-1;if(0===d.hiddenTabs.length)return-1;if("undefined"==typeof d.tabs.activeTab)return-1;if(""===a||"undefined"==typeof a){var c=d.tabs.activeTab;b=d.panes[c]}else b=a;for(var e=0;e<d.hiddenTabs.length;e++)if(d.hiddenTabs[e].text===b.title)return e;return-1};e.addClass("tabs"),d.active=d.activePane=0,h.addListeners(["TripleComposer.openTripleComposer","AnnotationDetails.editAnnotation","MyNotebooksContainer.createNewNotebook","MyNotebooksContainer.editNotebook"],function(a){var b=a.args;j(b)}),d.setActive=function(a){if(g.hide(),0!==d.hiddenTabs.length)for(var b=0;b<d.hiddenTabs.length;b++)d.hiddenTabs[b].isActive=!1;if(d.active=a,d.tabs.activeTab=a,d.panes[a].isVisible)d.hiddenTabIsActive=!1;else{d.hiddenTabIsActive=!0;var c=r(d.panes[a]);d.hiddenTabs[c].isActive=!0}};var s=!1;d.$watch(function(){return d.hiddenTabs},function(){s=d.hiddenTabs.length>0}),d.hiddenTabsToShow=function(){return s}}]),angular.module("Pundit2.ContextualMenu",[]),angular.module("Pundit2.ContextualMenu").constant("CONTEXTUALMENUDEFAULTS",{position:"bottom-left",overflowClass:"pnd-contextual-menu-scroll",overflowContentClass:"pnd-tab-content",debug:!1}).service("ContextualMenu",["$rootScope","BaseComponent","CONTEXTUALMENUDEFAULTS","$dropdown","$window",function(a,b,c,d,e){var f=new b("ContextualMenu",c),g={menu:null,menuElements:[],menuResource:null,menuType:null,lastX:0,lastY:0,anchor:null,content:null,mockMenu:null};angular.element("[data-ng-app='Pundit2']").prepend("<div class='pnd-dropdown-contextual-menu-anchor' style='position: absolute; left: -500px; top: -500px;'><div>"),g.anchor=angular.element(".pnd-dropdown-contextual-menu-anchor");var h={scope:a.$new()},i={scope:a.$new()},j=function(a,b){return a.scope.content=g.content,a.placement="undefined"!=typeof b?b:f.options.position,a.template="src/ContextualMenu/dropdown.tmpl.html",d(g.anchor,a)};return f.getState=function(){return g},f.buildContent=function(){var a=[],b=g.menuElements.filter(function(a){return a.type.indexOf(g.menuType)>-1});b.sort(function(a,b){return b.priority-a.priority});for(var c in b)b[c].showIf(g.menuResource)&&a.push(b[c].submenu?{text:b[c].label,submenu:!0,hover:b[c].hover,leave:b[c].leave}:b[c].divider?{divider:!0}:{text:b[c].label,header:b[c].header?!0:!1,click:function(a){return function(){b[a].action(g.menuResource)}}(c)});var d=0;a.some(function(a,b){return"undefined"==typeof a.divider?(d=b,!0):void 0}),a.splice(0,d);for(var e=a.length-1;e>=0&&"undefined"!=typeof a[e].divider;e--)a.pop();return f.log("buildContent built "+a.length+" elements for type="+g.menuType),a},f.position=function(a,b,c){var d,f=a.outerWidth(),g=a.outerHeight();return d=c+g>angular.element(e).innerHeight()?"top":"bottom",d+=b+f>angular.element(e).innerWidth()?"-right":"-left"},f.show=function(a,b,c,d){return null!==g.menu&&(g.menu.hide(),g.menu.destroy(),g.menu=null),0===g.menuElements.length?void f.err("Cannot show a contextual menu without any element!!"):"undefined"==typeof c?void f.err("Try to show menu without resource for type "+d):(g.menuResource=c,g.menuType=d,g.content=f.buildContent(),0===g.content.length?void f.err("Tried to show menu for type "+d+" without any content (buildContent fail)"):(f.log("Showing menu for type="+d+" at "+a+","+b),g.lastX=a,g.lastY=b,g.mockMenu=j(i),void g.mockMenu.$promise.then(g.mockMenu.show)))},i.scope.$on("tooltip.show",function(){var a=f.position(angular.element(g.mockMenu.$element),g.lastX,g.lastY);g.anchor.css({left:g.lastX,top:g.lastY}),angular.element(g.mockMenu.$element).remove(),g.menu=j(h,a),g.menu.$promise.then(g.menu.show);var b=angular.element(e).scrollTop(),c=angular.element(e).scrollLeft();angular.element(e).bind("scroll",function(){$(this).scrollTop(b).scrollLeft(c)}),angular.element("body").addClass(f.options.overflowClass)}),i.scope.$on("tooltip.hide",function(){angular.element(e).unbind("scroll"),angular.element("body").removeClass(f.options.overflowClass)}),f.hide=function(){null!==g.menu&&(g.menu.hide(),g.menu.destroy(),g.menu=null)},f.addAction=function(a){var b=g.menuElements.some(function(b){return a.name===b.name});return b?(f.err("Not adding duplicated action "+a.name),!1):(g.menuElements.push(angular.copy(a)),f.log("Added action "+a.name+" for types "+a.type),!0)},f.removeActionByName=function(a){var b,c;return g.menuElements.some(function(d,e){a===d.name&&(b=d,c=e)}),"undefined"!=typeof b?(g.menuElements.splice(c,1),f.log("Remove action "+b.name+" for types "+b.type),!0):(f.err("Action "+a+" not found"),!1)},f.wipeActionsByType=function(a){g.menuElements=g.menuElements.filter(function(b,c){return a===g.menuElements[c].type?!1:!0})},f.modifyHeaderActionByName=function(a,b){var c,d;return g.menuElements.some(function(b,e){a===b.name&&(c=b,d=e)}),"undefined"!=typeof c?(g.menuElements[d].header=b,f.log("Disactive "+c.name),!0):(f.err("Action "+a+" not found"),!1)},f.addSubMenu=function(a){var b=g.menuElements.some(function(b){return angular.equals(a.name,b.name)});if(b)return f.err("Try to add duplicated submenu element"),!1;var c=angular.copy(a);return c.submenu=!0,g.menuElements.push(c),!0},f.addDivider=function(a){var b=angular.copy(a);b.divider=!0,b.showIf=function(){return!0},g.menuElements.push(b)},f.getSubMenuPlacement=function(){var a=h.placement.indexOf("-"),b=h.placement.substring(a+1);return"right"===b?"left":"right"},f.log("service run"),f}]),angular.module("Pundit2.PageItemsContainer",[]),angular.module("Pundit2.PageItemsContainer").directive("pageItemsContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",controller:"PageItemsContainerCtrl"}}),angular.module("Pundit2.PageItemsContainer").controller("PageItemsContainerCtrl",["$scope","$element","PageItemsContainer","ItemsExchange","Preview","TypesHelper","MyItems","TripleComposer","EventDispatcher","Status",function(a,b,c,d,e,f,g,h,i,j){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.itemSelected=null,a.isUseActive=!1,a.canAddItemAsSubject=!1,a.canAddItemAsObject=!1,a.isUserLogged=!1,a.itemMenuType=c.options.cMenuType;var k=angular.element(b).find(".page-items-btn-order");a.message={flag:!0,text:"No page items found."};var l=c.options.order;a.reverse=c.options.reverse,a.tabs=[{title:"All items",template:"src/Lists/itemList.tmpl.html",filterFunction:function(){return!0}},{title:"Text",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isTextFragment()}},{title:"Images",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isImage()||a.isImageFragment()}},{title:"Entities",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isEntity()}},{title:"Pages",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isWebPage()}}],a.tabs.activeTab=c.options.initialActiveTab;var m=function(){a.itemSelected=null,a.isUseActive=!1,a.canAddItemAsSubject=!1,a.canAddItemAsObject=!1},n=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label asc",click:function(){l="label",a.reverse=!1,n(0)},isActive:"label"===l&&a.reverse===!1},{text:"Label desc",click:function(){l="label",a.reverse=!0,n(1)},isActive:"label"===l&&a.reverse===!0},{text:"Type asc",click:function(){a.dropdownOrdering[2].disable||(l="type",a.reverse=!1,n(2))},isActive:"type"===l&&a.reverse===!1},{text:"Type desc",click:function(){a.dropdownOrdering[3].disable||(l="type",a.reverse=!0,n(3))},isActive:"type"===l&&a.reverse===!0}];var o=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===l?o(a.label):"type"===l?o(f.getLabel(a.type[0])):void 0};var p=function(b){b=b.toLowerCase().replace(/\s+/g," ");var d=b.split(" "),e=new RegExp(d.join(".*"));a.displayedItems=c.getItemsArrays()[a.tabs.activeTab].filter(function(a){return null!==a.label.toLowerCase().match(e)}),a.message.text=""===b?"No page items found.":"No item found to: "+b};a.$watch(function(){return a.tabs.activeTab},function(b){a.displayedItems=c.getItemsArrays()[b],a.tabs[b].title!==a.tabs[0].title&&a.tabs[b].title!==a.tabs[3].title?(a.dropdownOrdering[2].disable=!0,a.dropdownOrdering[3].disable=!0):(a.dropdownOrdering[2].disable=!1,a.dropdownOrdering[3].disable=!1),"undefined"!=typeof a.displayedItems&&"undefined"!=typeof a.search.term&&p(a.search.term)}),a.search={icon:c.options.inputIconSearch,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=c.options.inputIconSearch):a.search.icon=c.options.inputIconClear,p(b))}),a.$watch(function(){return d.getItemsByContainer(c.options.container)},function(b){a.displayedItems=c.buildItemsArray(a.tabs.activeTab,a.tabs,b)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,k.addClass("disabled")):(a.message.flag=!1,k.removeClass("disabled"))}),a.isSelected=function(b){return null!==a.itemSelected&&a.itemSelected.uri===b.uri?!0:!1},a.select=function(b){e.setItemDashboardSticky(b),i.sendEvent("Pundit.changeSelection"),a.isUseActive=!0,a.itemSelected=b,a.canAddItemAsSubject=h.canAddItemAsSubject(b),a.canAddItemAsObject=h.canAddItemAsObject(b)},a.onClickAdd=function(){null!==a.itemSelected&&(j.getUserStatus()&&!d.isItemInContainer(a.itemSelected,g.options.container)&&g.addItemAndConsolidate(a.itemSelected),m())},a.onClickUseSubject=function(){null!==a.itemSelected&&(j.getTemplateModeStatus()?h.addToAllSubject(a.itemSelected):h.addToSubject(a.itemSelected),m())},a.onClickUseObject=function(){null!==a.itemSelected&&(h.addToObject(a.itemSelected),m())},i.addListener("Pundit.changeSelection",function(){m()}),i.addListener("MyPundit.isUserLogged",function(b){a.isUserLogged=b.args})}]),angular.module("Pundit2.PageItemsContainer").constant("PAGEITEMSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Page items",initialActiveTab:0,cMenuType:"pageItems",order:"label",reverse:!1,container:"pageItems",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("PageItemsContainer",["PAGEITEMSCONTAINERDEFAULTS","BaseComponent",function(a,b){var c=new b("PageItemsContainer",a),d=[];return c.buildItemsArray=function(a,b,c){for(var e=0;e<b.length;e++)angular.isObject(b[e])&&"undefined"!=typeof b[e].filterFunction&&(d[e]=c.filter(function(a){return b[e].filterFunction(a)}));return d[a]},c.getItemsArrays=function(){return d},c}]),angular.module("Pundit2.PredicatesContainer",[]),angular.module("Pundit2.PredicatesContainer").directive("predicatesContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/PredicatesContainer/PredicatesContainer.dir.tmpl.html",controller:"PredicatesContainerCtrl"}}),angular.module("Pundit2.PredicatesContainer").controller("PredicatesContainerCtrl",["$scope","$rootScope","$element","Config","ItemsExchange","PredicatesContainer","TripleComposer","Preview","EventDispatcher",function(a,b,c,d,e,f,g,h,i){var j="pnd-icon-search",k="pnd-icon-times",l=[];a.displayedItems=l,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.itemSelected=null,a.isUseActive=!1,a.canBeUseAsPredicate=!1;var m=angular.element(c).find(".predicates-items-btn-order");a.itemMenuType=f.options.cMenuType,a.message={flag:!0,text:"No predicates found."};var n="label";a.reverse=!1;var o=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0},p=function(){a.itemSelected=null,a.isUseActive=!1,a.canBeUseAsPredicate=!1};a.dropdownOrdering=[{text:"Label Asc",click:function(){n="label",a.reverse=!1,o(0)},isActive:"label"===n&&a.reverse===!1},{text:"Label Desc",click:function(){n="label",a.reverse=!0,o(1)},isActive:"label"===n&&a.reverse===!0}];var q=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return q(a.label)};var r=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedItems=l.filter(function(a){return"undefined"==typeof a.mergedLabel?null!==a.label.toLowerCase().match(d):null!==a.mergedLabel.toLowerCase().match(d)}),a.message.text=""===b?"No predicates found.":"No predicates found to: "+b};a.search={icon:j,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=j):a.search.icon=k,r(b))}),a.$watch(function(){return e.getItemsByContainer(d.modules.Client.relationsContainer)},function(b){l=b,r(a.search.term)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,m.addClass("disabled")):(a.message.flag=!1,m.removeClass("disabled"))}),a.isSelected=function(b){return null!==a.itemSelected&&a.itemSelected.uri===b.uri?!0:!1},a.select=function(b){h.setItemDashboardSticky(b),i.sendEvent("Pundit.changeSelection"),a.isUseActive=!0,a.itemSelected=b,a.canBeUseAsPredicate=g.canBeUseAsPredicate(b)
},a.onClickUsePredicate=function(){null!==a.itemSelected&&(g.addToPredicate(a.itemSelected),p())},i.addListener("Pundit.changeSelection",function(){p()})}]),angular.module("Pundit2.PredicatesContainer").constant("PREDICATESCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/PredicatesContainer/ClientPredicatesContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Predicates",cMenuType:"predicates"}).service("PredicatesContainer",["PREDICATESCONTAINERDEFAULTS","BaseComponent",function(a,b){return new b("PredicatesContainer",a)}]),angular.module("Pundit2.MyNotebooksContainer",[]),angular.module("Pundit2.MyNotebooksContainer").directive("myNotebooksContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",controller:"MyNotebooksContainerCtrl"}}),angular.module("Pundit2.MyNotebooksContainer").controller("MyNotebooksContainerCtrl",["$scope","$rootScope","$element","MyNotebooksContainer","NotebookExchange","NotebookComposer","EventDispatcher",function(a,b,c,d,e,f,g){var h="pnd-icon-search",i="pnd-icon-times",j=[];a.displayedNotebook=j,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var k=angular.element(c).find(".my-notebooks-btn-order");a.notebookMenuType=d.options.cMenuType,a.message={flag:!0,text:"No notebooks found."};var l="label";a.reverse=!1;var m=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label Asc",click:function(){l="label",a.reverse=!1,m(0)},isActive:"label"===l&&a.reverse===!1},{text:"Label Desc",click:function(){l="label",a.reverse=!0,m(1)},isActive:"label"===l&&a.reverse===!0}];var n=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return n(a.label)},a.createNewNotebook=function(){g.sendEvent("MyNotebooksContainer.createNewNotebook",f.options.clientDashboardTabTitle),f.setNotebookToEdit(null)};var o=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedNotebook=j.filter(function(a){return null!==a.label.toLowerCase().match(d)}),a.message.text=""===b?"No notebook found.":"No notebook found to: "+b};a.search={icon:h,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedNotebook&&("undefined"==typeof b||""===b?(b="",a.search.icon=h):a.search.icon=i,o(b))}),a.$watch(function(){return e.getMyNotebooks()},function(b){j=b,o(a.search.term)},!0),a.$watch(function(){return a.displayedNotebook.length},function(b){0===b?(a.message.flag=!0,k.addClass("disabled")):(a.message.flag=!1,k.removeClass("disabled"))})}]),angular.module("Pundit2.MyNotebooksContainer").constant("MYNOTEBOOKSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"My notebooks",cMenuType:"myNotebooks",container:"myNotebooks",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("MyNotebooksContainer",["$rootScope","MYNOTEBOOKSCONTAINERDEFAULTS","BaseComponent","EventDispatcher","NotebookExchange","ItemsExchange","PageItemsContainer","AnnotationsExchange","NotebookCommunication","Consolidation","ContextualMenu","Config","Dashboard","NotebookComposer","AnnotationsCommunication","NameSpace","$modal","$timeout","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=new c("MyNotebooksContainer",b),u=function(){var a=[t.options.cMenuType],b=!1;"undefined"!=typeof l.lodLive&&l.lodLive.active&&(b=!0);var c=!1;"undefined"!=typeof l.timeline&&l.timeline.active&&(c=!0),k.addAction({name:"openNTlod",type:a,label:"Open graph",priority:102,showIf:function(){return b},action:function(a){s.open(l.lodLive.baseUrl+l.pndPurl+"notebook/"+a.id,"_blank")}}),k.addAction({name:"openTM",type:a,label:"Open Timeline",priority:102,showIf:function(){return c},action:function(a){s.open(l.timeline.baseUrl+"notebook-ids="+a.id+"&namespace="+l.pndPurl+"notebook/&api="+p.asOpen,"_blank")}}),k.addAction({name:"setAsPrivate",type:a,label:"Set notebook as private",priority:100,showIf:function(a){return"public"===a.visibility},action:function(a){i.setPrivate(a.id)}}),k.addAction({name:"setAsPublic",type:a,label:"Set notebook as public",priority:100,showIf:function(a){return"private"===a.visibility},action:function(a){i.setPublic(a.id)}}),k.addAction({name:"setAsCurrent",type:a,label:"Set notebook as current",priority:100,showIf:function(a){return!a.isCurrent()},action:function(a){i.setCurrent(a.id)}}),k.addAction({name:"deleteNotebook",type:a,label:"Delete notebook",priority:100,showIf:function(a){return!a.isCurrent()},action:function(a){x(a)}}),k.addAction({name:"editNotebook",type:a,label:"Edit notebook",priority:101,showIf:function(){return!0},action:function(a){m.isDashboardVisible()||m.toggle(),d.sendEvent("MyNotebooksContainer.editNotebook",n.options.clientDashboardTabTitle),n.setNotebookToEdit(a)}})};d.addListener("Client.boot",function(){u()});var v=a.$new();v.titleMessage="Delete notebook",v.confirm=function(){i.deleteNotebook(v.notebook.id).then(function(){v.notifyMessage="Notebook "+v.notebook.label+" correctly deleted.",h.wipe(),f.wipeContainer(g.options.container),o.getAnnotations(),r(function(){w.hide()},1e3)},function(){v.notifyMessage="Error impossible to delete this notebook, please retry.",r(function(){w.hide()},1e3)})},v.cancel=function(){w.hide()};var w=q({container:"[data-ng-app='Pundit2']",template:"src/Core/Templates/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:v}),x=function(a){v.notifyMessage="Are you sure you want to delete this notebook? will also remove all the annotation contained in it.",v.notebook=a,w.$promise.then(w.show)};return t}]),angular.module("Pundit2.Item",[]),angular.module("Pundit2.Item").directive("item",function(){return{restrict:"E",scope:{uri:"@",menuType:"@",isSelected:"=isSelected",forceSticky:"=forceSticky",hideOptions:"@",hideStickyButton:"@",useInKorbo:"@"},templateUrl:function(a,b){return b.useInKorbo?"src/Item/KorboItem.dir.tmpl.html":"src/Item/Item.dir.tmpl.html"},controller:"ItemCtrl"}}),angular.module("Pundit2.Item").controller("ItemCtrl",["$scope","ItemsExchange","TypesHelper","Preview","ContextualMenu",function(a,b,c,d,e){a.item=b.getItemByUri(a.uri),"undefined"!=typeof a.item.type&&a.item.type.length>0&&(a.itemTypeLabel=c.getLabel(a.item.type[0])),a.onItemMouseOver=function(){d.showDashboardPreview(a.item)},a.onItemMouseLeave=function(){d.hideDashboardPreview()},a.isSticky=function(){return d.isStickyItem(a.item)},a.onClickSticky=function(b){return d.isStickyItem(a.item)?d.clearItemDashboardSticky():d.setItemDashboardSticky(a.item),b.preventDefault(),b.stopPropagation(),!1},a.setStickInForceMode=function(){a.forceSticky&&(d.isStickyItem(a.item)?d.clearItemDashboardSticky():d.setItemDashboardSticky(a.item))},a.onClickMenu=function(b){return e.show(b.pageX,b.pageY,a.item,a.menuType),b.preventDefault(),b.stopPropagation(),!1},a.isItemSelected=function(){return a.isSelected===!1||"undefined"==typeof a.isSelected?!1:!0}}]),angular.module("Pundit2.Item").directive("itemNotebook",function(){return{restrict:"E",scope:{nid:"@",hideStickyButton:"@",forceSticky:"=forceSticky",menuType:"@"},templateUrl:"src/Item/ItemNotebook.dir.tmpl.html",controller:"NotebookCtrl"}}),angular.module("Pundit2.Item").controller("NotebookCtrl",["$scope","NotebookExchange","Preview","ContextualMenu",function(a,b,c,d){a.notebook=b.getNotebookById(a.nid),a.onItemMouseOver=function(){c.showDashboardPreview(a.notebook)},a.onItemMouseLeave=function(){c.hideDashboardPreview()},a.isSticky=function(){return c.isStickyItem(a.notebook)},a.onClickSticky=function(b){return c.isStickyItem(a.notebook)?c.clearItemDashboardSticky():c.setItemDashboardSticky(a.notebook),b.preventDefault(),b.stopPropagation(),!1},a.setStickInForceMode=function(){a.forceSticky&&(c.isStickyItem(a.notebook)?c.clearItemDashboardSticky():c.setItemDashboardSticky(a.notebook))},a.onClickMenu=function(b){return d.show(b.pageX,b.pageY,a.notebook,a.menuType),b.preventDefault(),b.stopPropagation(),!1}}]),angular.module("Pundit2.MyItemsContainer",[]),angular.module("Pundit2.MyItemsContainer").directive("myItemsContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",controller:"MyItemsContainerCtrl"}}),angular.module("Pundit2.MyItemsContainer").controller("MyItemsContainerCtrl",["$scope","$rootScope","$modal","$timeout","$element","MyItemsContainer","ItemsExchange","MyItems","MyPundit","Preview","TypesHelper","PageHandler","TripleComposer","EventDispatcher","Status",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.itemMenuType=f.options.cMenuType,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.itemSelected=null,a.isUseActive=!1,a.canAddItemAsSubject=!1,a.canAddItemAsObject=!1;var p=angular.element(e).find(".my-items-btn-delete"),q=angular.element(e).find(".my-items-btn-order");a.message={flag:!0,text:"No my items found."},a.isUserLogged=!1,a.$watch(function(){return i.isUserLogged()},function(b){b?(a.isUserLogged=!0,a.message.text="No my items found."):(a.isUserLogged=!1,a.message.text="Please login to see your items.")});var r=f.options.order;a.reverse=f.options.reverse,a.tabs=[{title:"All Items",template:"src/Lists/itemList.tmpl.html",filterFunction:function(){return!0}},{title:"Text",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isTextFragment()}},{title:"Images",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isImage()||a.isImageFragment()}},{title:"Entities",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isEntity()}},{title:"Pages",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isWebPage()}}],a.tabs.activeTab=f.options.initialActiveTab;var s=function(){a.itemSelected=null,a.isUseActive=!1,a.canAddItemAsSubject=!1,a.canAddItemAsObject=!1},t=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0};a.dropdownOrdering=[{text:"Label asc",click:function(){r="label",a.reverse=!1,t(0)},isActive:"label"===r&&a.reverse===!1},{text:"Label desc",click:function(){r="label",a.reverse=!0,t(1)},isActive:"label"===r&&a.reverse===!0},{text:"Type asc",click:function(){a.dropdownOrdering[2].disable||(r="type",a.reverse=!1,t(2))},isActive:"type"===r&&a.reverse===!1},{text:"Type desc",click:function(){a.dropdownOrdering[3].disable||(r="type",a.reverse=!0,t(3))},isActive:"type"===r&&a.reverse===!0}];var u=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===r?u(a.label):"type"===r?u(k.getLabel(a.type[0])):void 0},a.onClickDeleteAllMyItems=function(){y()},a.$watch(function(){return a.tabs.activeTab},function(b){a.displayedItems=f.getItemsArrays()[b],a.tabs[b].title!==a.tabs[0].title&&a.tabs[b].title!==a.tabs[3].title?(a.dropdownOrdering[2].disable=!0,a.dropdownOrdering[3].disable=!0):(a.dropdownOrdering[2].disable=!1,a.dropdownOrdering[3].disable=!1),"undefined"!=typeof a.displayedItems&&"undefined"!=typeof a.search.term&&v(a.search.term)}),a.onClickAddPageToMyItems=function(){if(i.isUserLogged()){var a=l.createItemFromPage();h.addItem(a)}else f.err("User not logged")};var v=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedItems=f.getItemsArrays()[a.tabs.activeTab].filter(function(a){return null!==a.label.toLowerCase().match(d)}),a.message.text=""===b?i.isUserLogged()?"No my items found.":"Please login to see your items.":"No item found to: "+b};a.search={icon:f.options.inputIconSearch,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=f.options.inputIconSearch):a.search.icon=f.options.inputIconClear,v(b))}),a.$watch(function(){return g.getItemsByContainer(h.options.container)},function(b){a.displayedItems=f.buildItemsArray(a.tabs.activeTab,a.tabs,b)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,p.addClass("disabled"),q.addClass("disabled")):(a.message.flag=!1,p.removeClass("disabled"),q.removeClass("disabled"))});var w=b.$new();w.titleMessage="Delete all my items",w.confirm=function(){i.isUserLogged()&&h.deleteAllItems().then(function(){w.notifyMessage="Success, my items correctly deleted."},function(){w.notifyMessage="Error impossible to delete my items, please retry."}),d(function(){x.hide()},1e3)},w.cancel=function(){x.hide()};var x=c({container:"[data-ng-app='Pundit2']",template:"src/Core/Templates/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:w}),y=function(){w.notifyMessage="Are you sure you want to delete all my items? After you can no longer recover.",x.$promise.then(x.show)};a.isSelected=function(b){return null!==a.itemSelected&&a.itemSelected.uri===b.uri?!0:!1},a.select=function(b){j.setItemDashboardSticky(b),n.sendEvent("Pundit.changeSelection"),a.isUseActive=!0,a.itemSelected=b,a.canAddItemAsSubject=m.canAddItemAsSubject(b),a.canAddItemAsObject=m.canAddItemAsObject(b)},a.onClickRemove=function(){null!==a.itemSelected&&(o.getUserStatus()&&g.isItemInContainer(a.itemSelected,h.options.container)&&h.deleteItemAndConsolidate(a.itemSelected),s())},a.onClickUseSubject=function(){null!==a.itemSelected&&(o.getTemplateModeStatus()?m.addToAllSubject(a.itemSelected):m.addToSubject(a.itemSelected),s())},a.onClickUseObject=function(){null!==a.itemSelected&&(m.addToObject(a.itemSelected),s())},n.addListener("Pundit.changeSelection",function(){s()})}]),angular.module("Pundit2.MyItemsContainer").constant("MYITEMSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"My items",initialActiveTab:0,cMenuType:"myItems",order:"label",reverse:!1,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("MyItemsContainer",["MYITEMSCONTAINERDEFAULTS","BaseComponent",function(a,b){var c=new b("MyItemsContainer",a),d=[];return c.buildItemsArray=function(a,b,c){for(var e=0;e<b.length;e++)angular.isObject(b[e])&&"undefined"!=typeof b[e].filterFunction&&(d[e]=c.filter(function(a){return b[e].filterFunction(a)}));return d[a]},c.getItemsArrays=function(){return d},c}]),angular.module("Pundit2.MyItemsContainer").constant("MYITEMSDEFAULTS",{apiPreferencesKey:"favorites",container:"myItems",debug:!1}).service("MyItems",["MYITEMSDEFAULTS","BaseComponent","EventDispatcher","NameSpace","Item","ItemsExchange","ContextualMenu","MyPundit","Config","Consolidation","$http","$rootScope","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new b("MyItems",a),o=!1,p=function(a){c.sendEvent("MyItems.loading",a)},q=function(){var a=[i.modules.TextFragmentHandler.cMenuType,i.modules.PageItemsContainer.cMenuType,i.modules.MyItemsContainer.cMenuType,i.modules.TextFragmentAnnotator.cMenuType,i.modules.ImageHandler.cMenuType,i.modules.SelectorsManager.cMenuType];g.addDivider({priority:97,type:a}),g.addAction({name:"addToMyItems",type:a,label:"Add to my items",priority:99,showIf:function(a){return h.isUserLogged()&&!f.isItemInContainer(a,n.options.container)},action:function(a){return n.addItem(a).then(function(){j.consolidateAll()}),!0}}),g.addAction({name:"removeFromMyItems",type:a,label:"Remove from my items",priority:99,showIf:function(a){return h.isUserLogged()&&f.isItemInContainer(a,n.options.container)},action:function(a){return n.deleteItem(a).then(function(){j.consolidateAll()}),!0}})};return c.addListener("Client.boot",function(){q()}),n.getAllItems=function(){var a,b=m.defer();return o||!h.isUserLogged()?void n.log("User not logged"):(o=!0,p(!0),k({headers:{Accept:"application/json"},method:"GET",url:d.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0}).success(function(c){var d=0;if(p(!1),"undefined"==typeof c)return o=!1,b.resolve(),void n.log("Undefined Server response");if("undefined"!=typeof c.redirectTo)return o=!1,b.resolve(),void n.log("Get all my items on server produce a redirect response to: ",c);for(var g in c.value)d++,c.value[g].rdftype&&(delete c.value[g].type,delete c.value[g].rdfData,delete c.value[g].favorite,c.value[g].type=c.value[g].rdftype,delete c.value[g].rdftype,c.value[g].uri=c.value[g].value,delete c.value[g].value),a=new e(c.value[g].uri,c.value[g]),f.addItemToContainer(a,n.options.container);o=!1,b.resolve(),n.log("Retrieved my items from the server: "+d+" items")}).error(function(a){p(!1),o=!1,b.reject(),n.log("Http error while retrieving my items from the server: ",a)}),b.promise)},n.deleteAllItems=function(){var a=new Date,b=m.defer();return o||!h.isUserLogged()?void n.log("User not logged"):(o=!0,p(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:d.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:[],created:a.getTime()})}).success(function(a){return p(!1),"undefined"!=typeof a.redirectTo?(o=!1,b.resolve(),void n.log("Deleted all my items on server produce a redirect response to: ",a)):(f.wipeContainer(n.options.container),o=!1,b.resolve(),j.consolidateAll(),void n.log("Deleted all my items on server",a))}).error(function(a){p(!1),o=!1,b.reject(),n.err("Cant delete my items on server: ",a)}),b.promise)},n.deleteItem=function(a){if(o||!h.isUserLogged())return void n.log("User not logged");o=!0;var b=new Date,c=f.getItemsByContainer(n.options.container),e=c.indexOf(a),g=angular.copy(c),i=m.defer();return e>-1&&g.splice(e,1),p(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:d.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:g,created:b.getTime()})}).success(function(b){return"undefined"!=typeof b.redirectTo?(o=!1,p(!1),i.resolve(),void n.log("Deleted single my item on server produce a redirect response to: ",b)):(f.removeItemFromContainer(a,n.options.container),i.resolve(),o=!1,p(!1),void n.log("Deleted from my item: "+a.label))}).error(function(a){o=!1,p(!1),i.reject(),n.err("Cant delete a my item on the server: ",a)}),i.promise},n.deleteItemAndConsolidate=function(a){n.deleteItem(a).then(function(){j.consolidateAll()})},n.addItem=function(a){if(o||!h.isUserLogged())return void n.log("User not logged");o=!0;var b=new Date,c=angular.copy(f.getItemsByContainer(n.options.container)),e=m.defer();return c.push(a),p(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:d.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:c,created:b.getTime()})}).success(function(b){return"undefined"!=typeof b.redirectTo?(o=!1,p(!1),e.resolve(),void n.log("Add single item to my items on server produce a redirect response to: ",b)):(f.addItemToContainer(a,n.options.container),o=!1,p(!1),e.resolve(),void n.log("Added item to my items: "+a.label))}).error(function(a){o=!1,p(!1),e.reject(),n.err("Cant add item to my items on the server: ",a)}),e.promise},n.addItemAndConsolidate=function(a){n.addItem(a).then(function(){j.consolidateAll()})},n}]),angular.module("Pundit2.VocabulariesContainer",[]),angular.module("Pundit2.VocabulariesContainer").directive("vocabulariesContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",controller:"VocabulariesContainerCtrl"}}),angular.module("Pundit2.VocabulariesContainer").controller("VocabulariesContainerCtrl",["$scope","$timeout","$injector","$element","$q","BaseComponent","SelectorsManager","ItemsExchange","TypesHelper","Preview","TripleComposer","MyItems","EventDispatcher","Status",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.itemSelected=null,a.isUseActive=!1,a.canAddItemAsSubject=!1,a.canAddItemAsObject=!1;var o=angular.element(d).find(".vocab-items-btn-order");a.message={flag:!0,text:"Enter text to search in the vocabularies."},a.itemMenuType=g.options.cMenuType;var p=g.options.order;a.reverse=g.options.reverse,a.tabs=[];var q=g.getActiveSelectors();for(var r in q)a.tabs.push({title:q[r].config.label,template:"src/Lists/itemList.tmpl.html",itemsContainer:q[r].config.container});a.tabs.activeTab=g.options.initialActiveTab;var s=function(b){for(var c in a.dropdownOrdering)a.dropdownOrdering[c].isActive=!1;a.dropdownOrdering[b].isActive=!0},t=function(){a.itemSelected=null,a.isUseActive=!1,a.canAddItemAsSubject=!1,a.canAddItemAsObject=!1};a.dropdownOrdering=[{text:"Label Asc",click:function(){p="label",a.reverse=!1,s(0)},isActive:"label"===p&&a.reverse===!1},{text:"Label Desc",click:function(){p="label",a.reverse=!0,s(1)},isActive:"label"===p&&a.reverse===!0},{text:"Type Asc",click:function(){p="type",a.reverse=!1,s(2)},isActive:"type"===p&&a.reverse===!1},{text:"Type Desc",click:function(){p="type",a.reverse=!0,s(3)},isActive:"type"===p&&a.reverse===!0}];var u=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===p?u(a.label):"type"===p?u(i.getLabel(a.type[0])):void 0},a.search={icon:g.options.inputIconSearch,term:""};var v;a.$watch(function(){return a.search.term},function(c){return"undefined"==typeof c||""===c?(c="",a.search.icon=g.options.inputIconSearch,void b.cancel(v)):(a.search.icon=g.options.inputIconClear,b.cancel(v),void(v=b(function(){z()},500)))}),a.displayedItems=[];var w,x=function(){0===a.displayedItems.length&&""!==a.search.term&&"undefined"!=typeof a.search.term&&(a.message.text="No item found to: "+a.search.term)},y=null,z=function(){null!==y&&y.resolve(),y=e.defer(),g.getItems(a.search.term,y.promise).then(function(){x()},function(){x()}),w=a.tabs[a.tabs.activeTab].itemsContainer+a.search.term.split(" ").join("$")};a.$watch(function(){return h.getItemsByContainer(w)},function(b){a.displayedItems=b,0===a.displayedItems.length?(a.message.flag=!0,o.addClass("disabled")):(a.message.flag=!1,o.removeClass("disabled"))},!0),a.$watch(function(){return a.tabs.activeTab},function(b,c){b!==c&&(w=a.tabs[a.tabs.activeTab].itemsContainer+a.search.term.split(" ").join("$"),x())}),a.isSelected=function(b){return null!==a.itemSelected&&a.itemSelected.uri===b.uri?!0:!1},a.select=function(b){j.setItemDashboardSticky(b),m.sendEvent("Pundit.changeSelection"),a.isUseActive=!0,a.itemSelected=b,a.canAddItemAsSubject=k.canAddItemAsSubject(b),a.canAddItemAsObject=k.canAddItemAsObject(b)},a.onClickAdd=function(){null!==a.itemSelected&&(n.getUserStatus()&&!h.isItemInContainer(a.itemSelected,l.options.container)&&l.addItemAndConsolidate(a.itemSelected),t())},a.onClickUseSubject=function(){null!==a.itemSelected&&(n.getTemplateModeStatus()?k.addToAllSubject(a.itemSelected):k.addToSubject(a.itemSelected),t())},a.onClickUseObject=function(){null!==a.itemSelected&&(k.addToObject(a.itemSelected),t())},m.addListener("Pundit.changeSelection",function(){t()})}]),angular.module("Pundit2.TripleComposer",[]),angular.module("Pundit2.TripleComposer").directive("tripleComposer",function(){return{restrict:"E",scope:{},templateUrl:"src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",controller:"TripleComposerCtrl"}}),angular.module("Pundit2.TripleComposer").controller("TripleComposerCtrl",["$rootScope","$scope","$http","$q","$timeout","NameSpace","EventDispatcher","MyPundit","Toolbar","TripleComposer","AnnotationsCommunication","AnnotationsExchange","TemplatesExchange",function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.statements=j.getStatements(),b.saving=!1,b.textMessage=j.options.savingMsg,b.headerMessage="Create new annotation",b.editMode=!1,b.$watch(function(){return j.isEditMode()},function(a){b.headerMessage=a?"Edit and update your annotation":"Create new annotation",b.editMode=a}),b.templateMode;var n;b.$watch(function(){return i.isActiveTemplateMode()},function(a,c){b.templateMode=a,a?(n=b.headerMessage,b.headerMessage="Complete your annotation and save!"):a!==c&&(b.headerMessage=n)});var o="Loading",p="Saved",q="Warning!",r="pnd-icon-refresh pnd-icon-spin",s="pnd-icon-check-circle",t="pnd-icon-exclamation-circle",u="pnd-message",v="pnd-message-success",w="pnd-message-warning";b.shortMessagge=o,b.savingIcon=r,b.shortMessageClass=u,this.removeStatement=function(a){a=parseInt(a,10),j.removeStatement(a),j.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled")},this.addStatementScope=function(a,b){a=parseInt(a,10),j.addStatementScope(a,b)},this.duplicateStatement=function(a){a=parseInt(a,10),j.duplicateStatement(a)},this.isAnnotationComplete=function(){j.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled")},this.isTripleErasable=function(){j.isTripleErasable()},b.isAnnotationErasable=function(){return!j.isTripleEmpty()},b.onClickAddStatement=function(){angular.element(".pnd-triplecomposer-save").addClass("disabled"),j.addStatement()},b.cancel=function(){b.editMode&&(angular.element(".pnd-triplecomposer-save").addClass("disabled"),j.reset(),j.setEditMode(!1),j.updateVisibility()),g.sendEvent("Pundit.changeSelection")},b.resetComposer=function(){return angular.element(".pnd-triplecomposer-save").addClass("disabled"),b.templateMode?void j.wipeNotFixedItems():(j.reset(),void g.sendEvent("Pundit.changeSelection"))},b.editAnnotation=function(){var a=j.getEditAnnID();if("undefined"!=typeof a){var b=z();angular.element(".pnd-triplecomposer-cancel").addClass("disabled"),k.editAnnotation(a,j.buildGraph(),j.buildItems(),j.buildTargets()).then(function(){A(b,j.options.notificationSuccessMsg,j.options.notificationMsgTime,!1)},function(){A(b,j.options.notificationErrorMsg,j.options.notificationMsgTime,!0)})}};var x,y=function(a,c,d){b.textMessage=a,d?(b.shortMessagge=q,b.savingIcon=t,b.shortMessageClass=w):(b.shortMessagge=p,b.savingIcon=s,b.shortMessageClass=v),e(function(){j.setEditMode(!1),angular.element(".pnd-triplecomposer-cancel").removeClass("disabled"),b.saving=!1,j.updateVisibility()},c)},z=function(){return angular.element(".pnd-triplecomposer-save").addClass("disabled"),b.textMessage=j.options.savingMsg,b.shortMessagge=o,b.savingIcon=r,b.shortMessageClass=u,x=!1,b.saving=!0,e(function(){x=!0},j.options.savingMsgTime)},A=function(a,c,d,e){return x?y(c,d,e):a.then(function(){y(c,d,e)}),b.templateMode?void j.wipeNotFixedItems():void j.reset()};b.saveAnnotation=function(){var a=d.defer();return h.login().then(function(c){if(c){var d=b.statements.some(function(a){var b=a.scope.get();return!a.scope.isMandatory||null!==b.subject&&null!==b.predicate&&null!==b.object?void 0:!0});if(d)return void a.reject();var e,f=z();e=b.templateMode?k.saveAnnotation(j.buildGraph(),j.buildItems(),j.buildTargets(),m.getCurrent().id):k.saveAnnotation(j.buildGraph(),j.buildItems(),j.buildTargets()),e.then(function(){A(f,j.options.notificationSuccessMsg,j.options.notificationMsgTime,!1),a.resolve()},function(){j.closeAfterOpOff(),A(f,j.options.notificationErrorMsg,j.options.notificationMsgTime,!0),a.resolve()})}}),g.sendEvent("Pundit.changeSelection"),a.promise},g.addListener("Annotators.saveAnnotation",function(){var a=b.statements.some(function(a){var b=a.scope.get();return null===b.subject||null===b.predicate||null===b.object?!0:void 0});a?j.openTripleComposer():b.saveAnnotation().catch(function(){j.openTripleComposer()})})}]),angular.module("Pundit2.TripleComposer").constant("TRIPLECOMPOSERDEFAULTS",{clientDashboardTemplate:"src/Tools/TripleComposer/ClientTripleComposer.tmpl.html",clientDashboardPanel:"tools",clientDashboardTabTitle:"Annotation composer",savingMsg:"We are saving your annotation",savingMsgTime:1250,notificationSuccessMsg:"Your annotation has been saved successfully",notificationErrorMsg:"We were unable to save your annotation",notificationMsgTime:1500,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",cMenuType:"tripleComposer",debug:!1}).service("TripleComposer",["$rootScope","BaseComponent","EventDispatcher","TRIPLECOMPOSERDEFAULTS","TypesHelper","NameSpace","Config","AnnotationsExchange","ItemsExchange","Dashboard","ContextualMenu","TemplatesExchange","Status","Utils",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p=new b("TripleComposer",d),q=1,r=[{id:q}],s=!1,t=!1,u=function(){c.sendEvent("TripleComposer.statementChange")},v=function(){k.addAction({type:[g.modules.PageItemsContainer.cMenuType,g.modules.MyItemsContainer.cMenuType,g.modules.SelectorsManager.cMenuType,g.modules.TextFragmentHandler.cMenuType,g.modules.TextFragmentAnnotator.cMenuType,g.modules.ImageHandler.cMenuType],name:"useAsSubject",label:"Use as subject",showIf:function(a){return p.canAddItemAsSubject(a)},priority:101,action:function(a){m.getTemplateModeStatus()?p.addToAllSubject(a):p.addToSubject(a)}}),k.addAction({type:[g.modules.PageItemsContainer.cMenuType,g.modules.MyItemsContainer.cMenuType,g.modules.SelectorsManager.cMenuType,g.modules.TextFragmentHandler.cMenuType,g.modules.TextFragmentAnnotator.cMenuType,g.modules.ImageHandler.cMenuType],name:"useAsObject",label:"Use as object",showIf:function(a){return p.canAddItemAsObject(a)},priority:100,action:function(a){p.addToObject(a)}}),k.addAction({type:[g.modules.PredicatesContainer.cMenuType],name:"useAsPredicate",label:"Use as predicate",showIf:function(a){return p.canBeUseAsPredicate(a)?k.modifyHeaderActionByName("useAsPredicate",!1):k.modifyHeaderActionByName("useAsPredicate",!0),!0},priority:100,action:function(a){p.addToPredicate(a)}}),k.addAction({name:"newTriple",type:p.options.cMenuType,label:"New triple",priority:3,showIf:function(){return!0},action:function(){angular.element(".pnd-triplecomposer-save").addClass("disabled"),p.addStatement(),u()}}),k.addAction({name:"duplicateTriple",type:p.options.cMenuType,label:"Duplicate triple",priority:3,showIf:function(){return!0},action:function(a){var b=parseInt(a.id,10);p.duplicateStatement(b),u()}}),k.addAction({name:"removeTriple",type:p.options.cMenuType,label:"Remove triple",priority:3,showIf:function(){return!0},action:function(a){var b=parseInt(a.id,10);p.removeStatement(b),p.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled"),u()}})};return c.addListener("Client.boot",function(){v()}),p.getStatements=function(){return r},p.isEditMode=function(){return s},p.closeAfterOp=function(){t=!0},p.closeAfterOpOff=function(){t=!1},p.updateVisibility=function(){t&&j.isDashboardVisible()&&j.toggle(),t=!1},p.getEditAnnID=function(){return o},p.setEditMode=function(a){s=a;for(var b in r)"undefined"!=typeof r[b].scope&&(r[b].scope.editMode=a)},p.addStatement=function(){q+=1;var a=r.push({id:q});return r[a-1]},p.removeStatement=function(a){if(1===r.length)return void r[0].scope.wipe();var b=-1;r.some(function(c,d){return c.id===a?(b=d,!0):void 0}),b>-1&&r.splice(b,1),1===r.length&&r[0].scope.isStatementEmpty()&&k.modifyHeaderActionByName("removeTriple",!0),p.log("Try to remove statement at index",b)},p.reset=function(){q=1,r.splice(0,r.length),r.push({id:q}),c.sendEvent("TripleComposer.reset"),p.log("statements reset",r)},p.wipeNotFixedItems=function(){for(var a in r)r[a].scope.subjectFixed||r[a].scope.wipeSubject(),r[a].scope.predicateFixed||r[a].scope.wipePredicate(),r[a].scope.objectFixed||r[a].scope.wipeObject();p.log("Wiped not fixed items.")},p.addStatementScope=function(a,b){var c=-1;r.some(function(b,d){return b.id===a?(c=d,!0):void 0}),c>-1&&(b.editMode=s,r[c].scope=b),r.length>1&&k.modifyHeaderActionByName("removeTriple",!1),p.log("statement extended with scope",r[c])},p.duplicateStatement=function(a){var b=-1;r.some(function(c,d){return c.id===a?(b=d,!0):void 0}),b>-1&&(q+=1,r.push({id:q,scope:{duplicated:r[b].scope.copy()}})),r.length>1&&k.modifyHeaderActionByName("removeTriple",!1)},p.canAddItemAsSubject=function(a){var b=-1;if(r.some(function(a,c){return a.scope.subjectFound?void 0:(b=c,!0)}),-1===b)return!1;var c=!1,d=r[b].scope.get().predicate;return null===d||0===d.domain.length?!0:(a.type.some(function(a){return d.domain.indexOf(a)>-1?c=!0:void 0
}),p.log(c?"Predicate domain match.":"Impossible to add item as Subject: predicate domain not match"),c)},p.canBeUseAsPredicate=function(a){var b=!1,c=!1,d=-1;if(r.some(function(a,b){return a.scope.predicateFound?void 0:(d=b,!0)}),-1===d)return!1;var e=r[d].scope.get().subject,f=r[d].scope.get().object;return null===e&&null===f?!0:(null!==e&&0!==a.domain.length?a.domain.some(function(a){return e.type.indexOf(a)>-1?b=!0:void 0}):b=!0,null!==f&&0!==a.range.length?a.range.some(function(a){return f.type.indexOf(a)>-1?c=!0:void 0}):c=!0,b&&c)},p.canAddItemAsObject=function(a){var b=-1;if(r.some(function(a,c){return a.scope.objectFound?void 0:(b=c,!0)}),-1===b)return!1;var c=!1,d=r[b].scope.get().predicate;return null===d||0===d.range.length?!0:(a.type.some(function(a){return d.range.indexOf(a)>-1?c=!0:void 0}),p.log(c?"Predicate range match.":"Impossible to add item as Object: predicate range not match"),c)},p.openTripleComposer=function(){j.isDashboardVisible()||j.toggle(),a.$$phase||a.$digest(),c.sendEvent("TripleComposer.openTripleComposer",p.options.clientDashboardTabTitle)},p.addToObject=function(b){p.closeAfterOp(),p.openTripleComposer();for(var c in r)if(!r[c].scope.objectFound)return r[c].scope.setObject(b),a.$$phase||a.$digest(),void p.log("Add item as object: "+b.label);p.log("Error: impossible to add object (all full)")},p.addToPredicate=function(b){p.closeAfterOp(),p.openTripleComposer();for(var c in r)if(!r[c].scope.predicateFound)return r[c].scope.setPredicate(b),a.$$phase||a.$digest(),void p.log("Add item as predicate: "+b.label);p.log("Error: impossible to add predicate (all full)")},p.addToSubject=function(b){p.closeAfterOp(),p.openTripleComposer();for(var c in r)if(!r[c].scope.subjectFound)return r[c].scope.setSubject(b),a.$$phase||a.$digest(),void p.log("Add item as subject: "+b.label);p.log("Error: impossible to add subject (all full)")},p.addToAllSubject=function(b){for(var c in r)r[c].scope.setSubject(b);a.$$phase||a.$digest(),p.log("Add item: "+b.uri+"as subject of all triples")},p.isAnnotationComplete=function(){var a=!0;return r.some(function(b){return b.scope.isMandatory&&!b.scope.isStatementComplete()?(a=!1,!0):void 0}),a},p.isTripleEmpty=function(){if(r.length>1&&!r[0].scope.templateMode)return!1;var a=!0;return r.some(function(b){return b.scope.isStatementEmpty()?void 0:void(a=!1)}),a},p.isTripleErasable=function(){1===r.length&&(r[0].scope.isStatementEmpty()?k.modifyHeaderActionByName("removeTriple",!0):k.modifyHeaderActionByName("removeTriple",!1))},p.showCurrentTemplate=function(){p.reset();var b,c=l.getCurrent();if("undefined"!=typeof c){for(b=1;b<c.triples.length;b++)p.addStatement();var d=a.$watch(function(){return r[c.triples.length-1].scope},function(a){if("undefined"!=typeof a){for(p.log("Now the last statement is populated with relative scope"),b=0;b<r.length;b++){var e=c.triples[b];"undefined"!=typeof e.predicate&&r[b].scope.setPredicate(i.getItemByUri(e.predicate.uri),!0),"undefined"!=typeof e.subject&&r[b].scope.setSubject(e.subject.value,!0),"undefined"!=typeof e.object&&r[b].scope.setObject(e.object.value,!0),"undefined"!=typeof e.mandatory&&(r[b].scope.isMandatory=e.mandatory),p.log("New statement populated with",e)}d()}});p.log("Showed template: "+c.label)}},p.editAnnotation=function(b){p.reset(),o=b;var c,d=h.getAnnotationById(b),e=[];for(var f in d.graph)for(var g in d.graph[f])for(var j in d.graph[f][g])e.push({subject:f,predicate:g,object:d.graph[f][g][j]});var k=e.length;for(c=0;k-1>c;c++)p.addStatement();var l=a.$watch(function(){return r[k-1].scope},function(a){if("undefined"!=typeof a){for(p.log("Now the last statement is populated with relative scope"),c=0;c<r.length;c++)r[c].scope.setSubject(i.getItemByUri(e[c].subject)),r[c].scope.setPredicate(i.getItemByUri(e[c].predicate)),"uri"===e[c].object.type?r[c].scope.setObject(i.getItemByUri(e[c].object.value)):"literal"===e[c].object.type?r[c].scope.setObject(n.isValidDate(e[c].object.value)?new Date(e[c].object.value):e[c].object.value):p.log("Try to add incompatible type of object",e[c].object),p.setEditMode(!0),p.log("New statement populated with",e[c]);l()}})},p.buildItems=function(){var a,b={};return r.forEach(function(c){var d=c.scope.get();null!==d.subject&&null!==d.predicate&&null!==d.object&&("undefined"!=typeof d.subject.polygon&&"undefined"!=typeof d.subject.polygonUri&&(b[d.subject.polygonUri]={},b[d.subject.polygonUri][f.item.type]=[{type:"uri",value:f.selectors.polygonType}],a={type:"polygon",points:d.subject.polygon},b[d.subject.polygonUri][f.rdf.value]=[{type:"literal",value:angular.toJson(a)}]),"undefined"!=typeof d.object.polygon&&"undefined"!=typeof d.object.polygonUri&&(b[d.object.polygonUri]={},b[d.object.polygonUri][f.item.type]=[{type:"uri",value:f.selectors.polygonType}],a={type:"polygon",points:d.object.polygon},b[d.object.polygonUri][f.rdf.value]=[{type:"literal",value:angular.toJson(a)}]),b[d.subject.uri]=d.subject.toRdf(),b[d.predicate.uri]=d.predicate.toRdf(),"undefined"!=typeof d.object.uri&&(b[d.object.uri]=d.object.toRdf(),d.object.type.forEach(function(a,c){var g=d.object.type[c];b[g]={},b[g][f.rdfs.label]=[{type:"literal",value:e.getLabel(a)}]})),d.subject.type.forEach(function(a,c){var g=d.subject.type[c];b[g]={},b[g][f.rdfs.label]=[{type:"literal",value:e.getLabel(a)}]}),d.predicate.type.forEach(function(a,c){var g=d.predicate.type[c];b[g]={},b[g][f.rdfs.label]=[{type:"literal",value:e.getLabel(a)}]}))}),b},p.buildObject=function(a){return"string"==typeof a?{type:"literal",value:a}:{type:"uri",value:a.uri}},p.buildTargets=function(){var a=[];return r.forEach(function(b){var c=b.scope.get();null!==c.subject&&null!==c.predicate&&null!==c.object&&((c.subject.isTextFragment()||c.subject.isImage()||c.subject.isImageFragment())&&-1===a.indexOf(c.subject.uri)&&a.push(c.subject.uri),(c.predicate.isTextFragment()||c.predicate.isImage()||c.predicate.isImageFragment())&&-1===a.indexOf(c.predicate.uri)&&a.push(c.predicate.uri),"string"!=typeof c.object&&(c.object.isTextFragment()||c.object.isImage()||c.object.isImageFragment())&&-1===a.indexOf(c.object.uri)&&a.push(c.object.uri))}),a},p.buildGraph=function(){var a={};return r.forEach(function(b){var c=b.scope.get();if(null!==c.subject&&null!==c.predicate&&null!==c.object)if("undefined"==typeof a[c.subject.uri])a[c.subject.uri]={},a[c.subject.uri][c.predicate.uri]=[p.buildObject(c.object)];else if("undefined"==typeof a[c.subject.uri][c.predicate.uri])a[c.subject.uri][c.predicate.uri]=[p.buildObject(c.object)];else{var d=c.object.uri,e=a[c.subject.uri][c.predicate.uri],f=e.some(function(a){return angular.equals(a.value,d)});f||e.push(p.buildObject(c.object))}}),a},p}]),angular.module("Pundit2.TripleComposer").directive("statement",function(){return{restrict:"E",scope:{id:"@",duplicated:"="},templateUrl:"src/Tools/TripleComposer/Statement.dir.tmpl.html",controller:"StatementCtrl",require:"^tripleComposer",link:function(a,b,c,d){a.tripleComposerCtrl=d,a.$watch("duplicated",function(b){"undefined"!=typeof b&&a.init()}),d.addStatementScope(a.id,a)}}}),angular.module("Pundit2.TripleComposer").controller("StatementCtrl",["$scope","$element","TypesHelper","ContextualMenu","ResourcePanel","NameSpace","TripleComposer","Toolbar","Preview","EventDispatcher",function(a,b,c,d,e,f,g,h,i,j){a.subjectLabel="",a.subjectTypeLabel="",a.subjectFound=!1,a.subjectFixed=!1,a.predicateLabel="",a.predicateFound=!1,a.predicateFixed=!1,a.objectLabel="",a.objectTypeLabel="",a.objectFound=!1,a.objectLiteral=!1,a.objectFixed=!1,a.canBeObjectDate=!0,a.canBeObjectLiteral=!0,a.templateMode,a.isMandatory=!0,g.getStatements().length<2?d.modifyHeaderActionByName("removeTriple",!0):d.modifyHeaderActionByName("removeTriple",!1);var k,l={subject:null,predicate:null,object:null},m=function(b,c){if(null!==l.predicate){var d=l[b],e=l.predicate[c];if("undefined"!=typeof e&&!(e.length<1)&&"undefined"!=typeof d&&null!==d&&"undefined"!=typeof d.type){if(d.type.length<1)return void a.wipePredicate();var f=!1,g=d.type;angular.forEach(e,function(a){for(var b=0;b<g.length;b++)if(g[b]===a)return void(f=!0)}),f||a.wipePredicate()}}},n=function(a){var b=a.getMonth()+1,c=a.getDate();return 10>b&&(b="0"+b),10>c&&(c="0"+c),a.getFullYear()+"-"+b+"-"+c};a.isStatementComplete=function(){return null!==l.subject&&null!==l.predicate&&null!==l.object?!0:!1},a.isStatementEmpty=function(){return null!==l.subject&&!a.subjectFixed||null!==l.predicate&&!a.predicateFixed||null!==l.object&&!a.objectFixed?!1:!0},a.remove=function(){e.hide(),a.tripleComposerCtrl.removeStatement(a.id)},a.duplicate=function(){e.hide(),a.tripleComposerCtrl.duplicateStatement(a.id)},a.copy=function(){var b=angular.copy(l);return a.objectDate&&(b.isDate=!0),a.objectLiteral&&(b.isLiteral=!0),b},a.get=function(){return l},a.wipe=function(){a.wipeSubject(),a.wipePredicate(),a.wipeObject(),i.clearItemDashboardSticky(),j.sendEvent("Pundit.changeSelection")},a.wipeSubject=function(){a.subjectLabel="",a.subjectTypeLabel="",a.subjectFound=!1,a.subjectFixed=!1,l.subject=null,e.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.tripleComposerCtrl.isTripleErasable(),i.clearItemDashboardSticky(),j.sendEvent("Pundit.changeSelection")},a.wipePredicate=function(){a.predicateLabel="",a.predicateFound=!1,a.canBeObjectDate=!0,a.canBeObjectLiteral=!0,a.predicateFixed=!1,l.predicate=null,e.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.tripleComposerCtrl.isTripleErasable(),i.clearItemDashboardSticky(),j.sendEvent("Pundit.changeSelection")},a.wipeObject=function(){a.objectLabel="",a.objectTypeLabel="",a.objectFound=!1,a.objectLiteral=!1,a.objectDate=!1,a.objectFixed=!1,l.object=null,e.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.tripleComposerCtrl.isTripleErasable(),j.sendEvent("Pundit.changeSelection")},a.onSubjectMouseOver=function(){i.showDashboardPreview(l.subject)},a.onPredicateMouseOver=function(){i.showDashboardPreview(l.predicate)},a.onObjectMouseOver=function(){a.objectDate||a.objectLiteral||i.showDashboardPreview(l.object)},a.onItemMouseOut=function(){i.hideDashboardPreview()},a.setSubject=function(b,d){a.subjectLabel=b.label,a.subjectTypeLabel=c.getLabel(b.type[0]),a.subjectFound=!0,l.subject=b,"undefined"!=typeof d&&(a.subjectFixed=d),m("subject","domain"),e.hide(),a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable(),i.clearItemDashboardSticky()},a.onClickSubject=function(b){return a.templateMode?void((a.subjectFixed||a.subjectFound)&&i.setItemDashboardSticky(l.subject)):(e.showItemsForSubject(l,b.target).then(a.setSubject),void(a.subjectFound&&(j.sendEvent("Pundit.changeSelection"),i.setItemDashboardSticky(l.subject))))},a.setPredicate=function(b,c){a.predicateLabel=b.label,a.predicateFound=!0,l.predicate=b,"undefined"!=typeof c&&(a.predicateFixed=c),-1===b.range.indexOf(f.rdfs.literal)&&b.range.length>0&&(a.canBeObjectLiteral=!1),-1===b.range.indexOf(f.dateTime)&&b.range.length>0&&(a.canBeObjectDate=!1),e.hide(),a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable(),i.clearItemDashboardSticky()},a.onClickPredicate=function(b){return a.templateMode&&a.predicateFixed?void i.setItemDashboardSticky(l.predicate):(e.showProperties(l,b.target).then(a.setPredicate),void(a.predicateFound&&(j.sendEvent("Pundit.changeSelection"),i.setItemDashboardSticky(l.predicate))))},a.setObject=function(b,d){a.objectFound=!0,"undefined"!=typeof d&&(a.objectFixed=d),l.object=b,"string"==typeof b?(a.objectLabel=b,a.objectTypeLabel=c.getLabel(f.rdfs.literal),a.objectLiteral=!0):b instanceof Date?(k=b,l.object=n(b),a.objectLabel=l.object,a.objectTypeLabel=c.getLabel(f.dateTime),a.objectDate=!0):(a.objectLabel=b.label,a.objectTypeLabel=c.getLabel(b.type[0]),m("object","range")),e.hide(),a.tripleComposerCtrl.isAnnotationComplete(),a.tripleComposerCtrl.isTripleErasable(),i.clearItemDashboardSticky()},a.onClickObject=function(b){return a.templateMode&&a.objectFixed?void i.setItemDashboardSticky(l.object):(null===l.object||!a.objectLiteral&&!a.objectDate?e.showItemsForObject(l,b.target).then(a.setObject):a.objectLiteral?a.onClickObjectLiteral(b):a.objectDate&&a.onClickObjectCalendar(b),void(!a.objectFound||a.objectLiteral||a.objectDate||(j.sendEvent("Pundit.changeSelection"),i.setItemDashboardSticky(l.object))))},a.onClickObjectCalendar=function(b){var c;c=a.objectDate?k:new Date,e.showPopoverCalendar(c,b.target).then(function(b){isNaN(b)||a.setObject(b)})},a.onClickObjectLiteral=function(b){var c="";"string"==typeof l.object&&(c=l.object),e.showPopoverLiteral(c,b.target).then(a.setObject)},a.showDropdown=function(b){var c={id:a.id};e.hide(),d.show(b.pageX,b.pageY,c,g.options.cMenuType),b.stopPropagation()},a.init=function(){l=a.duplicated,delete a.duplicated,null!==l.predicate&&a.setPredicate(l.predicate),null!==l.subject&&a.setSubject(l.subject),null!==l.object&&a.setObject(l.isDate?new Date(l.object):l.object)},a.$watch(function(){return h.isActiveTemplateMode()},function(b){a.templateMode=b})}]),angular.module("Pundit2.Toolbar",[]),angular.module("Pundit2.Toolbar").config(["$dropdownProvider",function(a){angular.extend(a.defaults,{trigger:"click",html:!0})}]).directive("toolbar",["Toolbar",function(a){return{restrict:"E",scope:{},templateUrl:"src/Toolbar/Toolbar.dir.tmpl.html",link:function(){angular.element("body").addClass(a.options.bodyClass),a.log("Adding "+a.options.bodyClass+" to body element")}}}]),angular.module("Pundit2.Toolbar").controller("ToolbarCtrl",["$scope","$rootScope","$modal","$http","$window","NameSpace","Config","Toolbar","SelectorsManager","Fp3","MyPundit","Dashboard","TripleComposer","AnnotationSidebar","Annomatic","ResourcePanel","NotebookExchange","NotebookCommunication","TemplatesExchange",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.dropdownTemplateMyNotebook="src/Toolbar/myNotebooksDropdown.tmpl.html",a.dropdownTemplateTemplates="src/Toolbar/templatesDropdown.tmpl.html",a.isAnnotationSidebarExpanded=!1,a.isAnnotationFiltersActive=!1,a.isDashboardVisible=!1,a.isUserLogged=!1,a.askThePundit=h.options.askThePundit,a.myNotebooks=h.options.myNotebooks,a.dashboard=!1,a.sidebar=!1,a.menuCustom=!1,a.menuCustomBtn=!1,a.menuCustomDropdown=[],a.menuCustomBtn=[];var t=h.options.menuCustom;t.active&&(a.menuCustom=!0,t.dropdown?angular.forEach(t.list,function(b,c){a.menuCustomDropdown.push({text:c,click:function(){a.openUrl(b)}})}):a.menuCustomBtn=t.list),g.useOnlyTemplateMode&&angular.element(".pnd-toolbar-template-mode-button").addClass("pnd-not-clickable"),g.modules.Dashboard.active&&(a.dashboard=!0),g.modules.AnnotationSidebar.active&&(a.sidebar=!0);var u=!1;"undefined"!=typeof g.lodLive&&g.lodLive.active&&(u=!0),a.login=function(){p.hide(),k.login()};var v=function(){p.hide(),k.logout()},w=function(){if(k.isUserLogged()){var a=k.getUserData();e.open(g.lodLive.baseUrl+g.pndPurl+"user/"+a.id,"_blank")}},x=b.$new(),y=b.$new(),z=c({container:"[data-ng-app='Pundit2']",template:"src/Core/Templates/info.modal.tmpl.html",show:!1,backdrop:"static",scope:x}),A=c({container:"[data-ng-app='Pundit2']",template:"src/Core/Templates/send.modal.tmpl.html",show:!1,backdrop:"static",scope:y});x.titleMessage="About Pundit",x.info=[{label:"Pundit version: ",value:PUNDITVERSION.version},{label:"Annotation server URL: ",value:f.as},{label:"Korbo basket: ",value:"-"},{label:"Contact the Pundit team:",value:"punditdev@netseven.it"},{label:"License: ",value:"http://url3.com"},{label:"Credits: ",value:"-"}],x.links=[{label:"Developed by:",linkLabel:"Net7 srl",ref:"http://www.netseven.it"}],"local"!==g.confURL&&x.links.push({label:"Configuration file",linkLabel:g.confURL,ref:g.confURL}),g.vocabularies.length>0?x.info.push({label:"Predicates vocabularies: ",value:g.vocabularies.toString()}):g.useBasicRelations&&x.info.push({label:"Predicates vocabularies: ",value:"Pundit default basic relations"});var B="",C=i.getActiveSelectors();for(var D in C)B+=" "+C[D].config.label;x.info.push({label:"Providers:",value:B}),y.titleMessage="Found a bug? tell us!",y.text={msg:"",subject:""};var E=function(a,b){var c=k.getUserData(),d="mailto:punditbug@netseven.it?cc=&subject="+escape(a)+"&body="+escape(b)+"%0A%0APundit version: "+PUNDITVERSION.version+"%0A%0AConfiguration file: "+g.confURL+"%0AWeb page: "+document.URL+"%0ABroswer info: "+window.navigator.userAgent+"%0A%0AUser openid: "+c.openid+"%0AUser uri: "+c.uri+"%0AUser name: "+c.fullName+"%0AUser mail: "+c.email;window.location.href=d};y.send=function(){E(y.text.subject,y.text.msg),A.hide()},y.cancel=function(){A.hide()},x.send=function(){A.$promise.then(function(){y.text.msg="",y.text.subject="",A.show();var b=angular.element(".pnd-send-modal-send");a.$watch(function(){return y.text.subject},function(a){a.length>2?b.removeClass("disabled"):b.addClass("disabled")},!0)})},x.close=function(){z.hide()};var F=function(){z.$promise.then(z.show)},G=function(){x.send()};a.isAnnomaticRunning=!1,a.$watch(function(){return o.isRunning()},function(b){a.isAnnomaticRunning=b}),a.$watch(function(){return n.isAnnotationSidebarExpanded()},function(b){a.isAnnotationSidebarExpanded=b}),a.$watch(function(){return n.needToFilter()},function(b){a.isAnnotationFiltersActive=b}),a.$watch(function(){return l.isDashboardVisible()},function(b){a.isDashboardVisible=b}),a.errorMessageDropdown=h.getErrorMessageDropdown(),a.userNotLoggedDropdown=[{text:"Please sign in to use Pundit",header:!0},{text:"Sign in",click:a.login}],a.infoDropdown=[{text:"About Pundit",click:F},{text:"Report a bug",click:G}],j.options.active&&a.infoDropdown.push({text:j.options.label,click:j.post}),a.userLoggedInDropdown=u?[{text:"Open your graph",click:w},{text:"Log out",click:v}]:[{text:"Log out",click:v}];var H;a.$watch(function(){return q.getMyNotebooks()},function(a){H=a,I()},!0),a.currentNotebookLabel="Loading...",a.$watch(function(){return q.getCurrentNotebooks()},function(b){"undefined"!=typeof b&&(I(),a.currentNotebookLabel=b.label)}),a.userNotebooksDropdown=[{text:"Please select notebook you want to use",header:!0}];var I=function(){for(var b=H,c=1,d=0;d<b.length;d++)a.userNotebooksDropdown[c]={text:b[d].label,currentNotebook:function(){var a=q.getCurrentNotebooks();return"undefined"!=typeof a&&b[d].id===a.id?!0:!1}(),visibility:b[d].visibility,click:function(a){return function(){r.setCurrent(b[a].id)}}(d)},c++};if(a.useTemplates=g.useTemplates,0===g.templates.length&&(a.useTemplates=!1),a.useTemplates){a.userTemplateDropdown=[{text:"Select the template you wish to use",header:!0}],a.currentTemplateLabel="Loading...",a.$watch(function(){return s.getTemplates().length},function(){L()}),a.$watch(function(){return s.getCurrent()},function(b){"undefined"!=typeof b&&(L(),a.currentTemplateLabel=b.label,a.currentTemplateColor=b.hasColor)});var J=angular.element(".pnd-toolbar-template-mode-button span"),K=angular.element(".pnd-toolbar-template-menu-button span");a.$watch(function(){return h.isActiveTemplateMode()},function(a){a?(J.removeClass("pnd-toolbar-not-active-element"),K.removeClass("pnd-toolbar-not-active-element")):(J.addClass("pnd-toolbar-not-active-element"),K.addClass("pnd-toolbar-not-active-element"))});var L=function(){for(var b=s.getTemplates(),c=1,d=0;d<b.length;d++)a.userTemplateDropdown[c]={text:b[d].label,hasColor:b[d].hasColor,currentTemplate:function(){var a=s.getCurrent();return"undefined"!=typeof a&&b[d].id===a.id?!0:!1}(),click:function(a){return function(){s.setCurrent(b[a].id),h.isActiveTemplateMode()&&(m.showCurrentTemplate(),angular.element(".pnd-triplecomposer-save").addClass("disabled"))}}(d)},c++}}a.userData={},a.$watch(function(){return k.isUserLogged()},function(b){a.isUserLogged=b,a.userData=k.getUserData()}),a.showStatusButtonOk=function(){return!h.getErrorShown()&&!h.isLoading()},a.showStatusButtonError=function(){return h.getErrorShown()},a.showStatusButtonLoading=function(){return h.isLoading()&&!h.getErrorShown()},a.showLogin=function(){return a.isUserLogged===!1},a.showUserButton=function(){return a.isUserLogged===!0},a.isDashboardActive=function(){return a.isUserLogged===!0},a.toggleTemplateMode=function(){m.isEditMode()||a.isAnnomaticRunning||(p.hide(),h.toggleTemplateMode())},a.onClickTemplateDropdown=function(){p.hide()},a.isTemplateMenuActive=function(){return a.isUserLogged===!0},a.isNotebookMenuActive=function(){return a.isUserLogged===!0},a.getAskLink=function(){return h.getAskLink()},a.dashboardClickHandler=function(){a.isAnnomaticRunning||(p.hide(),l.toggle())},a.annotationsClickHandler=function(){p.hide(),n.toggle()},a.openUrl=function(a){e.open(a,"_self")}}]),angular.module("Pundit2.Toolbar").constant("TOOLBARDEFAULTS",{myNotebooks:!0,askThePundit:!0,menuCustom:{active:!1,dropdown:!0,list:{}},bodyClass:"pnd-toolbar-active",clientDomTemplate:"src/Toolbar/ClientToolbar.tmpl.html",debug:!1}).service("Toolbar",["BaseComponent","EventDispatcher","TOOLBARDEFAULTS","Config","MyPundit","TripleComposer",function(a,b,c,d,e,f){var g=new a("Toolbar",c),h=0,i=!1,j=!1,k=[],l=d.useOnlyTemplateMode;return g.getErrorShown=function(){return j},g.isLoading=function(){return i},g.setLoading=function(a){g.log("Setting loading to "+a),i=a},g.addError=function(a,b){var c=h,d=function(){g.removeError(c),"function"==typeof b&&""!==b&&b()},e={text:a,click:d,id:c};if(h++,k.push(e),j=!0,0===angular.element(".pnd-toolbar-error-button ul").length){var f=angular.element(".pnd-toolbar-error-button a");f.trigger("click")}return c},g.removeError=function(a){for(var b=0;b<k.length;b++)if(k[b].id===a){k.splice(b,1);break}0===k.length&&(j=!1)},g.getErrorMessageDropdown=function(){return k},g.getAskLink=function(){return e.isUserLogged()?d.askBaseURL+"#/myAsk/":d.askBaseURL},g.isActiveTemplateMode=function(){return l},g.toggleTemplateMode=function(){d.useOnlyTemplateMode||(f.reset(),l=!l,l?(b.sendEvent("Pundit.templateMode",!0),f.showCurrentTemplate()):(b.sendEvent("Pundit.templateMode",!1),angular.element(".pnd-triplecomposer-save").addClass("disabled")))},b.addListener("Pundit.error",function(a){g.addError(a.args)}),b.addListener("Pundit.loading",function(a){g.setLoading(a.args)}),b.addListener("AnnotationDetails.editAnnotation",function(){l&&g.toggleTemplateMode()}),g}]),angular.module("Pundit2.Core").controller("LoginModalCtrl",["$scope","MyPundit",function(a,b){var c={};c.loggedOff="To continue with this operation you must log in.",c.waitingForLogIn="Please complete the process in the login window.",c.loggedIn="You are logged in as: ",a.$watch(function(){return b.getLoginStatus()},function(d){if(a.notifyMessage=c[d],b.isUserLogged()){var e=b.getUserData();a.notifyMessage=c[d]+" "+e.fullName}}),a.loginPopUp=function(){b.openLoginPopUp()},a.logout=function(){b.logout()},a.closeModal=function(){b.closeLoginModal()},a.cancelModal=function(){b.cancelLoginModal()},a.isUserLogged=function(){return b.isUserLogged()}}]),angular.module("Pundit2.Preview",[]),angular.module("Pundit2.Preview").directive("preview",function(){return{restrict:"E",scope:{useInKorbo:"@",isLoading:"@",errorLoading:"@"},templateUrl:"src/Preview/DashboardPreview.dir.tmpl.html",controller:"PreviewCtrl"}}),angular.module("Pundit2.Preview").controller("PreviewCtrl",["$scope","Preview","TypesHelper","$window","Config",function(a,b,c,d,e){a.itemDashboardPreview=null,a.$watch(function(){return b.getItemDashboardPreview()},function(b){a.itemDashboardPreview=b,null===b?(a.hasImage=!1,a.itemIsAnImage=!1):"Notebook"===c.getLabel(b.type[0])?(a.hasImage=!1,a.itemIsAnImage=!1):(a.hasImage="undefined"!=typeof b.image,a.itemIsAnImage=a.itemDashboardPreview.isImage()||a.itemDashboardPreview.isImageFragment())}),a.getWelcomeHeaderMessage=function(){return b.getWelcomeHeaderMessage()},a.getWelcomeBodyMessage=function(){return b.getWelcomeBodyMessage()},a.isItemEmpty=function(){return null===a.itemDashboardPreview},a.isNotebook=function(){return null!==a.itemDashboardPreview&&"http://purl.org/pundit/ont/ao#Notebook"===a.itemDashboardPreview.type[0]?!0:!1},a.isStickyItemEmpty=function(){return null===b.getItemDashboardSticky()},a.isStickyItem=function(){return b.isStickyItem()},a.clearSticky=function(){b.clearItemDashboardSticky()},a.getLabelType=function(a){return c.getLabel(a)},a.openUrl=function(a){d.open(a)},a.openNotebookUrl=function(a){var b=e.askBaseURL+"#/myNotebooks/"+a;d.open(b)},a.getItemIcon=function(){return a.isItemEmpty()?void 0:a.itemDashboardPreview.getIcon()},a.getItemClass=function(){return a.isItemEmpty()?void 0:a.itemDashboardPreview.getClass()}}]),angular.module("Pundit2.Preview").constant("PREVIEWDEFAULTS",{welcomeHeaderMessage:"Welcome in Pundit",welcomeBodyMessage:"This is the preview area of Pundit. Just click on an element in a list to select it and see its details here. Enjoy using Pundit.",clientDashboardTemplate:"src/Preview/ClientDashboardPreview.tmpl.html",clientDashboardPanel:"details",clientDashboardTabTitle:"Preview"}).service("Preview",["BaseComponent","PREVIEWDEFAULTS",function(a,b){var c,d=new a("Preview",b);return c={itemDashboardPreview:null,itemDashboardSticky:null,heigthTypesDiv:null,typesHidden:null},d.getWelcomeHeaderMessage=function(){return d.options.welcomeHeaderMessage},d.getWelcomeBodyMessage=function(){return d.options.welcomeBodyMessage},d.showDashboardPreview=function(a){c.itemDashboardPreview=a},d.getItemDashboardPreview=function(){return c.itemDashboardPreview},d.setItemDashboardSticky=function(a){c.itemDashboardSticky=a},d.getItemDashboardSticky=function(){return c.itemDashboardSticky},d.clearItemDashboardSticky=function(){c.itemDashboardSticky=null,c.itemDashboardPreview=null},d.hideDashboardPreview=function(){c.itemDashboardPreview=null===c.itemDashboardSticky?null:c.itemDashboardSticky},d.isStickyItem=function(a){var b;return b="undefined"!=typeof a?a:c.itemDashboardPreview,null!==c.itemDashboardSticky&&null!==b?c.itemDashboardSticky.uri===b.uri:!1},d}]),angular.module("Pundit2.Preview").directive("itemPreview",function(){return{restrict:"E",scope:{uri:"@",sticking:"=sticking"},templateUrl:"src/Preview/ItemPreview.dir.tmpl.html",controller:"ItemPreviewCtrl"}}),angular.module("Pundit2.Preview").controller("ItemPreviewCtrl",["$scope","$timeout","TypesHelper","ItemsExchange","$element","Preview","ImageFragmentAnnotatorHelper",function(a,b,c,d,e,f,g){var h,i,j=angular.element(e).find(".pnd-annotation-preview-item-container");a.typeHidden=!0,a.isSticky=!1,a.hasImage=!1,h="undefined"!=typeof a.sticking?a.sticking:!1,a.getTypeLabel=function(a){return c.getLabel(a)},a.$watch("uri",function(){a.item=d.getItemByUri(a.uri),a.typeHidden=!0,"undefined"!=typeof a.item&&(a.hasImage="undefined"!=typeof a.item.image),"undefined"!=typeof a.item&&a.item.isImageFragment()&&"undefined"!=typeof a.item.polygon&&b(function(){angular.element(e).find(".pnd-preview-item-image span > svg.pnd-polygon-layer").remove(),g.drawPolygonOverImage(a.item.polygon,i),i=angular.element(e).find(".pnd-preview-item-image > img")},50),h&&(a.isSticky=null!==f.getItemDashboardSticky()&&f.getItemDashboardSticky().uri===a.uri?!0:!1)}),a.$watch(function(){return"undefined"!=typeof i?i.width():void 0},function(b){"undefined"!=typeof b&&(angular.element(e).find(".pnd-preview-item-image span > svg.pnd-polygon-layer").remove(),g.drawPolygonOverImage(a.item.polygon,i))}),a.$watch(function(){return j.find("li.pnd-preview-single-type").css("width")},function(){var b;if(a.isSticky&&h)a.typeHiddenPresent=a.prev;else{b=j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").children("li:not(.pnd-is-sticky)");var c=parseInt(j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").css("width"),10),d=j.find(b[0]).outerHeight(!0),e=j.find("div.pnd-preview-item-types"),f=0;j.find(".pnd-preview-item-image").length>0?f=parseInt(j.find(".pnd-preview-item-image").css("padding-top"),10):j.find(".pnd-preview-item-description").length>0&&(f=parseInt(j.find(".pnd-preview-item-description").css("padding-top"),10));var g=d+f;e.css({height:g}),a.heigthTypesDiv=g,l(b,c)}});var k=j.find("div.pnd-preview");a.$watch(function(){return k.width()},function(){var a=j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").children("li"),b=j.find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").width();l(a,b)});var l=function(b,c){a.prev=a.typeHiddenPresent;for(var d,e=0,f=30,g=c-f,h=0;h<b.length;h++){if(d=parseInt(j.find(b[h]).css("width"),10)+e,d>g)return a.typeHiddenPresent=!0,!0;e=d}return a.typeHiddenPresent=!1,!1};a.showAlltypes=function(){var b=j.find("div.pnd-preview-item-types"),c=j.find("div.pnd-preview-item-types").height();c===a.heigthTypesDiv?(a.typeHidden=!1,b.css({height:"auto"})):(a.typeHidden=!0,b.css({height:a.heigthTypesDiv}))}}]),angular.module("Pundit2.Preview").directive("notebookPreview",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/Preview/NotebookPreview.dir.tmpl.html",controller:"NotebookPreviewCtrl"}}),angular.module("Pundit2.Preview").controller("NotebookPreviewCtrl",["$scope","NotebookExchange",function(a,b){a.$watch("id",function(){a.notebook=b.getNotebookById(a.id),a.isCurrent=b.getCurrentNotebooks().id===a.notebook.id?!0:!1})}]),angular.module("Pundit2.ResourcePanel",[]),angular.module("Pundit2.ResourcePanel").filter("filterByLabel",function(){return function(a,b){var c=[];return"undefined"!=typeof b&&""!==b?angular.forEach(a,function(a){var d=a.label,e=b.toLowerCase().replace(/\s+/g," "),f=e.split(" "),g=new RegExp(f.join(".*"));return null!==d.toLowerCase().match(g)?void c.push(a):void 0}):c=a,c}}).filter("filterByTypes",function(){return function(a,b,c){var d=[];return"undefined"!=typeof c&&c.length>0?angular.forEach(a,function(a){if("undefined"!=typeof a[b]&&a[b].length>0){for(var e=0;e<c.length;e++)for(var f=0;f<a[b].length;f++)if(c[e]===a[b][f])return void d.push(a)}else d.push(a)}):d=a,d}}),angular.module("Pundit2.ResourcePanel").directive("calendarDateFormat",["$filter",function(a){return{require:"ngModel",link:function(b,c,d,e){var f="yyyy-MM-dd";e.$formatters.push(function(b){var c=angular.isDate(b);return e.$setValidity("datefield",c),c?a("date")(b,f):0/0})}}}]),angular.module("Pundit2.ResourcePanel").constant("RESOURCEPANELDEFAULTS",{vocabSearchTimer:1e3,initialCalendarDate:"",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("ResourcePanel",["BaseComponent","EventDispatcher","RESOURCEPANELDEFAULTS","ItemsExchange","MyItems","PageItemsContainer","Client","NameSpace","SelectorsManager","$filter","$rootScope","$popover","$q","$timeout","Preview","$window","Config","Item","Utils",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u,v,w=new a("ResourcePanel",c),x={popover:null,defaultPlacement:"bottom",resourcePromise:null,popoverOptions:{scope:k.$new(),trigger:"manual"}},y=function(){null!==x.popover&&(x.popoverOptions.scope.vocabObjRes=[],x.popoverOptions.scope.vocabSubRes=[],x.popoverOptions.scope.label="",x.popover.hide(),x.popover.destroy(),x.popover=null)},z=function(a){n(function(){angular.element(a)[0].focus()})},A=function(a,b,c,d,e,f){var g=0,h=100;if(x.popoverOptions.scope.arrowLeft="-11px","undefined"!=typeof f&&("sub"===f?(g=h+27,x.popoverOptions.scope.arrowLeft="-"+h-27+"px"):"obj"===f&&(x.popoverOptions.scope.arrowLeft=h+"px",g=-h)),"calendar"===d)x.popoverOptions.template="src/ResourcePanel/popoverCalendar.tmpl.html",x.popoverOptions.scope.selectedDate="undefined"==typeof a.date||""===a.date?"undefined"==typeof w.options.initialCalendarDate||""===w.options.initialCalendarDate?(new Date).toString():w.options.initialCalendarDate:a.date,x.popoverOptions.scope.escapeEvent=function(a){27===a.which&&a.stopPropagation()},x.popoverOptions.scope.save=function(){x.resourcePromise.resolve(new Date(this.selectedDate)),o.hideDashboardPreview(),y()},x.popoverOptions.scope.cancel=function(){o.hideDashboardPreview(),y()};else if("literal"===d)x.popoverOptions.template="src/ResourcePanel/popoverLiteralText.tmpl.html",x.popoverOptions.scope.literalText="undefined"==typeof a.literalText?"":a.literalText,x.popoverOptions.scope.escapeEvent=function(a){27===a.which&&a.stopPropagation()
},x.popoverOptions.scope.save=function(){x.resourcePromise.resolve(this.literalText),o.hideDashboardPreview(),y()},x.popoverOptions.scope.cancel=function(){o.hideDashboardPreview(),y()};else if("resourcePanel"===d){if("undefined"!=typeof q.korbo&&q.korbo.active){var i=p[q.korbo.confName].globalObjectName;p[i].onSave(function(a){var b={label:a.label,type:a.type};"undefined"!=typeof a.description&&""!==a.description&&(b.description=a.description),"undefined"!=typeof a.image&&""!==a.image&&(b.image=a.image);var c=new r(a.value,b);x.resourcePromise.resolve(c),o.hideDashboardPreview(),y()})}x.popoverOptions.template="src/ResourcePanel/popoverResourcePanel.tmpl.html",x.popoverOptions.scope.originalContent=angular.copy(a),x.popoverOptions.scope.type=a.type,x.popoverOptions.scope.triple=a.triple,x.popoverOptions.scope.pageItems=a.pageItems,x.popoverOptions.scope.myItems=a.myItems,x.popoverOptions.scope.properties=a.properties,x.popoverOptions.scope.contentTabs=e,""!==a.label&&"undefined"!=typeof a.label?B(a.label):x.popoverOptions.scope.label=a.label,x.popoverOptions.scope.save=function(a){y(),o.hideDashboardPreview(),x.resourcePromise.resolve(a)},x.popoverOptions.scope.cancel=function(){o.clearItemDashboardSticky(),o.hideDashboardPreview(),y()}}x.popoverOptions.placement="undefined"==typeof c||""===c?x.defaultPlacement:c,x.popoverOptions.container="[data-ng-app='Pundit2']";var j=b.getBoundingClientRect().left,k=b.getBoundingClientRect().top,m=angular.element(b).outerHeight(),s=angular.element(b).outerWidth();return angular.element("[data-ng-app='Pundit2']").prepend("<div class='pnd-popover-anchor' style='position: absolute; left: -500px; top: -500px;'><div>"),x.anchor=angular.element(".pnd-popover-anchor"),x.anchor.css({left:j+g+s/2,top:k+m}),x.popover=l(x.anchor,x.popoverOptions),x.popover.posPopMod=g,"calendar"===d&&n(function(){angular.element(x.popover.$element).find(".pnd-input-calendar").triggerHandler("click")},.3),x.popover.clickTarget=b,x.popover},B=function(a){x.popoverOptions.scope.label=a,("obj"===x.popoverOptions.scope.type||"sub"===x.popoverOptions.scope.type)&&(x.popoverOptions.scope.myItems=j("filterByLabel")(x.popoverOptions.scope.originalContent.myItems,a),x.popoverOptions.scope.pageItems=j("filterByLabel")(x.popoverOptions.scope.originalContent.pageItems,a)),"pr"===x.popoverOptions.scope.type&&(x.popoverOptions.scope.properties=j("filterByLabel")(x.popoverOptions.scope.originalContent.properties,a))},C=function(a,b){for(var c in b)if(-1!==a.type.indexOf(b[c]))return!0;return!1},D=function(a,b){if("undefined"==typeof a)return!1;if(null===a)return!1;if("undefined"!=typeof b){if("undefined"==typeof a[b])return!1;if(0===a[b].length||""===a[b][0])return!1}return!0},E=function(a,b){var c=[];if(!D(b,"domain"))return a;for(var d in a)C(a[d],b.domain)&&c.push(a[d]);return c},F=function(a,b){var c=[];if(!D(b,"range"))return a;for(var d in a)C(a[d],b.range)&&c.push(a[d]);return c},G=function(a,b,c,d,e,f,g){var h={},i=[];if(h.type=f,h.triple=g,"sub"===f||"obj"===f){var j={title:"Page items",items:b,module:"Pundit2",isStarted:!0};i.push(j),h.pageItems=b;var k={title:"My items",items:c,module:"Pundit2",isStarted:!0};i.push(k),h.myItems=c,h.properties=null}if("pr"===f){var l={title:"Properties",items:d,isStarted:!0};i.push(l),h.properties=d,h.pageItems=null,h.myItems=null}h.label=e,null===x.popover?(x.popover=A(h,a,"","resourcePanel",i,f),x.popover.$promise.then(function(){x.popover.show(),z("input.pnd-rsp-input")})):null!==x.popover&&x.popover.clickTarget!==a&&(y(),x.popover=A(h,a,"","resourcePanel",i,f),x.popover.$promise.then(function(){x.popover.show(),z("input.pnd-rsp-input")}))},H=function(a,b,c,e){var f=c.predicate;if(""===a||"undefined"==typeof a)for(var g=0;g<b.length;g++)!function(a){for(var c=0;c<x.popoverOptions.scope.contentTabs.length;c++)x.popoverOptions.scope.contentTabs[c].title===b[a].config.label&&(x.popoverOptions.scope.contentTabs[c].items=[],x.popoverOptions.scope.contentTabs[c].isLoading=!1,x.popoverOptions.scope.contentTabs[c].isStarted=!1)}(g);else for(var h=0;h<b.length;h++)!function(c){for(var g=0;g<x.popoverOptions.scope.contentTabs.length;g++)x.popoverOptions.scope.contentTabs[g].title===b[c].config.label&&(x.popoverOptions.scope.contentTabs[g].isLoading=!0,x.popoverOptions.scope.contentTabs[g].isStarted=!0);b[c].getItems(a).then(function(){for(var g=0;g<x.popoverOptions.scope.contentTabs.length;g++)if(x.popoverOptions.scope.contentTabs[g].title===b[c].config.label){var h=x.popoverOptions.scope.contentTabs[g].itemsContainer+a.split(" ").join("$"),i=d.getItemsByContainer(h);null!==f&&("subject"===e?i=E(i,f):"object"===e&&(i=F(i,f))),x.popoverOptions.scope.contentTabs[g].items=i,x.popoverOptions.scope.contentTabs[g].isLoading=!1}})}(h)};return b.addListener("TripleComposer.statementChange",function(){y()}),w.updateVocabSearch=function(a,b,c){var d=i.getActiveSelectors();H(a,d,b,c),B(a)},w.updatePosition=function(){if(null!==x.popover){var a=x.popover.clickTarget,b=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top,d=angular.element(a).outerHeight(),e=angular.element(a).outerWidth(),f=b+x.popover.posPopMod+e/2-200,g=c+d;x.popover.$element.css({left:f,top:g})}},w.hide=function(){y()},w.showPopoverLiteral=function(a,b){var c={};return c.literalText=a,null!==x.popover&&x.popover.clickTarget!==b?(y(),x.popover=A(c,b,"","literal"),x.popover.$promise.then(function(){x.popover.show(),z("textarea.pnd-popover-literal-textarea")})):null===x.popover&&(x.popover=A(c,b,"","literal"),x.popover.$promise.then(function(){x.popover.show(),z("textarea.pnd-popover-literal-textarea")})),x.resourcePromise=m.defer(),x.resourcePromise.promise},w.showPopoverCalendar=function(a,b){var c={};return c.date=a,null===x.popover?(x.popover=A(c,b,"","calendar"),x.popover.$promise.then(function(){x.popover.show()})):null!==x.popover&&x.popover.clickTarget!==b&&(y(),x.popover=A("",b,"","calendar"),x.popover.$promise.then(function(){x.popover.show()})),x.resourcePromise=m.defer(),x.resourcePromise.promise},w.showItemsForSubject=function(a,b,c){"undefined"==typeof b&&(b=x.popover.clickTarget);var g=i.getActiveSelectors();if(x.popoverOptions.scope.selectors=[],angular.forEach(g,function(a){x.popoverOptions.scope.selectors.push(a.config.container)}),null!==x.popover&&x.popover.clickTarget===b)x.popoverOptions.scope.vocabSubStatus="loading",n.cancel(v),B(c),v=n(function(){H(c,g,a,"subject")},w.options.vocabSearchTimer);else{"undefined"!=typeof c&&""!==c&&(x.popoverOptions.scope.vocabSubStatus="loading",n.cancel(v),v=n(function(){H(c,g,a,"subject")},w.options.vocabSearchTimer));var h,j,k=e.options.container,l=f.options.container;if("undefined"!=typeof a){var o=a.predicate;if("undefined"==typeof o||null===o)h=d.getItemsByContainer(k),j=d.getItemsByContainer(l);else{var p=d.getItemByUri(o.uri);if("undefined"==typeof p||"undefined"==typeof p.domain||0===p.domain.length||""===p.domain[0])h=d.getItemsByContainer(k),j=d.getItemsByContainer(l);else{var q=p.domain,r=function(a){for(var b=0;b<q.length;b++)for(var c=0;c<a.type.length;c++)if(q[b]===a.type[c])return!0;return!1};h=d.getItemsFromContainerByFilter(k,r),j=d.getItemsFromContainerByFilter(l,r)}}}G(b,j,h,"",c,"sub",a)}return x.resourcePromise=m.defer(),x.resourcePromise.promise},w.showItemsForObject=function(a,b,c){"undefined"==typeof b&&(b=x.popover.clickTarget);var g=i.getActiveSelectors();if(x.popoverOptions.scope.selectors=[],angular.forEach(g,function(a){x.popoverOptions.scope.selectors.push(a.config.container)}),null!==x.popover&&x.popover.clickTarget===b)n.cancel(v),B(c),v=n(function(){H(c,g,a,"object")},w.options.vocabSearchTimer);else{n.cancel(v),"undefined"!=typeof c&&""!==c&&(n.cancel(v),v=n(function(){H(c,g,a,"object")},w.options.vocabSearchTimer));var j,k,l=e.options.container,o=f.options.container;if("undefined"!=typeof a){var p=a.predicate;if("undefined"==typeof p||null===p)j=d.getItemsByContainer(l),k=d.getItemsByContainer(o),G(b,k,j,"",c,"obj",a);else{var q=d.getItemByUri(p.uri);if("undefined"==typeof q||"undefined"==typeof q.range||0===q.range.length||""===q.range[0])j=d.getItemsByContainer(l),k=d.getItemsByContainer(o),G(b,k,j,"",c,"obj",a);else if(1===q.range.length&&q.range[0]===h.rdfs.literal)w.showPopoverLiteral("",b);else if(1===q.range.length&&q.range[0]===h.dateTime)w.showPopoverCalendar("",b);else{var r=q.range,s=function(a){for(var b=0;b<r.length;b++)for(var c=0;c<a.type.length;c++)if(r[b]===a.type[c])return!0;return!1};j=d.getItemsFromContainerByFilter(l,s),k=d.getItemsFromContainerByFilter(o,s),G(b,k,j,"",c,"obj",a)}}}}return x.resourcePromise=m.defer(),x.resourcePromise.promise},w.showProperties=function(a,b,c){if("undefined"==typeof b&&(b=x.popover.clickTarget),n.cancel(v),x.popoverOptions.scope.vocabStatus="",x.popoverOptions.scope.vocab=[],null!==x.popover&&x.popover.clickTarget===b)B(c);else{y();var e,f=g.options.relationsContainer;if("undefined"!=typeof a){var i=a.subject,k=a.object;e=d.getItemsByContainer(f),D(i,"type")&&(u=i.type,e=j("filterByTypes")(e,"domain",u)),D(k)&&(t=[],D(k,"type")?t=k.type:s.isValidDate(k)?t=[h.dateTime]:"string"==typeof k&&(t=[h.rdfs.literal]),e=j("filterByTypes")(e,"range",t)),"undefined"!=typeof e&&e.length>0?G(b,"","",e,c,"pr",a):G(b,"","",[],c,"pr",a)}}return x.resourcePromise=m.defer(),x.resourcePromise.promise},b.addListener("TripleComposer.reset",function(){y()}),w}]),angular.module("Pundit2.ResourcePanel").controller("ResourcePanelCtrl",["$rootScope","$scope","$timeout","$filter","$window","Client","Config","ItemsExchange","MyItems","MyPundit","PageItemsContainer","Preview","ResourcePanel","SelectorsManager","KorboCommunicationService","EventDispatcher",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=n.getActiveSelectors();if(b.label="",b.moduleName="Pundit2",b.subjectIcon=m.options.inputIconSearch,b.itemSelected=null,b.isUseActive=!1,b.contentTabs.activeTab=0,"pr"!==b.type)for(var t=0;t<s.length;t++)b.contentTabs.push({title:s[t].config.label,template:"src/Lists/itemList.tmpl.html",itemsContainer:s[t].config.container,items:[],module:"Pundit2",isStarted:!1});var u=function(){m.updatePosition()};angular.element(e).resize(u);var v=function(a){return a.replace(/ /g,"")},w=function(){b.isUseActive=!1,b.itemSelected=null};b.getOrderProperty=function(a){return v(a.label)},b.isSelected=function(a){return null!==b.itemSelected&&b.itemSelected.uri===a.uri?!0:!1},b.select=function(a){l.setItemDashboardSticky(a),p.sendEvent("Pundit.changeSelection"),b.isUseActive=!0,b.itemSelected=a},b.showUseAndCopyButton=function(){var a=b.contentTabs[b.contentTabs.activeTab].title;return g.korbo.active&&"Freebase"===a?!0:!1},b.showNewButton=function(){return"undefined"!=typeof g.korbo&&g.korbo.active&&"pr"!==b.type?!0:!1},b.createNew=function(){var a=e[g.korbo.confName].globalObjectName;e[a].callOpenNew()},b.useAndCopy=function(a){var b=e[g.korbo.confName].globalObjectName;e[b].callCopyAndUse(a)},b.showCopyInEditorButton=function(){var a=b.contentTabs[b.contentTabs.activeTab].title;return g.korbo.active&&"Freebase"===a?!0:!1},b.copyInEditor=function(){var a={};a.uri="__m__"+b.itemSelected.uri.substring(b.itemSelected.uri.lastIndexOf("/")+1),a.providerFrom="freebase",o.setEntityToCopy(a);var c=e[g.korbo.confName].globalObjectName;e[c].callOpenNew()},b.updateSearch=function(a){var d="";if("undefined"!=typeof a&&a.length>2){switch(b.type){case"sub":d="subject";break;case"pr":d="predicate";break;case"obj":d="object"}"pr"!==d&&""!==d&&(c.cancel(r),r=c(function(){m.updateVocabSearch(a,b.triple,d)},m.options.vocabSearchTimer))}else c.cancel(r),m.updateVocabSearch("",b.triple,d)},b.escapeEvent=function(a){27===a.which&&a.stopPropagation()},b.$watch(function(){return b.contentTabs.activeTab},function(a,c){if(a!==c){var d=b.label?b.label:"";q=b.contentTabs[b.contentTabs.activeTab].itemsContainer+d.split(" ").join("$"),b.showUseAndCopyButton()}}),a.$watch(function(){return j.isUserLogged()},function(a){b.userLoggedIn=a}),p.addListener("Pundit.changeSelection",function(){w()})}]),angular.module("Pundit2.NotebookComposer",[]),angular.module("Pundit2.NotebookComposer").directive("notebookComposer",function(){return{restrict:"E",scope:{},templateUrl:"src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",controller:"NotebookComposerCtrl"}}),angular.module("Pundit2.NotebookComposer").controller("NotebookComposerCtrl",["$scope","EventDispatcher","NotebookComposer","$timeout","NotebookExchange","NotebookCommunication","$q",function(a,b,c,d,e,f,g){var h=function(a){b.sendEvent("NotebookComposerCtrl.loading",a)};a.notebook={},a.notebook.visibility="public",a.notebook.name="",a.notebook.current=!1,a.editMode=!1,a.notebookComposerHeader="Create your notebook",a.$watch(function(){return c.getNotebookToEdit()},function(b){null!==b?(a.notebookToEdit=b,a.notebook.name=b.label,a.notebook.visibility=b.visibility,a.editMode=!0,e.getCurrentNotebooks().id===b.id?(a.isCurrentNotebook=!0,a.notebook.current=!0):(a.isCurrentNotebook=!1,a.notebook.current=!1),a.notebookComposerHeader="Edit your notebook"):a.clear()}),a.saving=!1,a.textMessage=c.options.savingMsg;var i="Editing",j="Loading",k="Saved",l="Warning!",m="pnd-icon-refresh pnd-icon-spin",n="pnd-icon-check-circle",o="pnd-icon-exclamation-circle",p="pnd-message",q="pnd-message-success",r="pnd-message-warning";a.shortMessagge=j,a.savingIcon=m,a.shortMessageClass=p;var s,t,u=function(b,e,f){a.textMessage=b,f?(a.shortMessagge=l,a.savingIcon=o,a.shortMessageClass=r):(a.shortMessagge=k,a.savingIcon=n,a.shortMessageClass=q),d(function(){a.saving=!1,h(!1),a.notebookComposerHeader="Create your notebook",c.setNotebookToEdit(null)},e)};a.save=function(){h(!0),a.textMessage=c.options.savingMsg,a.shortMessagge=j,a.savingIcon=m,a.shortMessageClass=p,t=!1,s=d(function(){t=!0},c.options.savingMsgTime),a.saving=!0,c.createNotebook(a.notebook).then(function(){t?(u(c.options.notificationSuccessMsg,c.options.notificationMsgTime,!1),a.clear()):s.then(function(){u(c.options.notificationSuccessMsg,c.options.notificationMsgTime,!1),a.clear()})},function(){t?u(c.options.notificationErrorMsg,c.options.notificationMsgTime,!0):s.then(function(){u(c.options.notificationErrorMsg,c.options.notificationMsgTime,!0)})})},a.edit=function(){var b=[];if(h(!0),a.textMessage=c.options.editingMsg,a.shortMessagge=i,a.savingIcon=m,a.shortMessageClass=p,t=!1,s=d(function(){t=!0},c.options.savingMsgTime),a.saving=!0,a.notebookToEdit.label!==a.notebook.name){var e=c.editNotebook(a.notebookToEdit.id,a.notebook.name);b.push(e)}if(a.notebook.current===!0){var j=f.setCurrent(a.notebookToEdit.id);b.push(j)}if(a.notebookToEdit.visibility!==a.notebook.visibility)if("public"===a.notebook.visibility){var k=f.setPublic(a.notebookToEdit.id);b.push(k)}else if("private"===a.notebook.visibility){var l=f.setPrivate(a.notebookToEdit.id);b.push(l)}g.all(b).then(function(){t?(u(c.options.notificationSuccessMsg,c.options.notificationMsgTime,!1),a.clear()):s.then(function(){u(c.options.notificationSuccessMsg,c.options.notificationMsgTime,!1),a.clear()})},function(){t?(u(c.options.notificationErrorMsg,c.options.notificationMsgTime,!0),a.clear()):s.then(function(){u(c.options.notificationErrorMsg,c.options.notificationMsgTime,!0),a.clear()})})},a.clear=function(){a.notebook.name="",a.notebook.visibility="public",a.notebook.current="",a.editMode=!1,a.notebookComposerHeader="Create your notebook",c.setNotebookToEdit(null)}}]),angular.module("Pundit2.NotebookComposer").constant("NOTEBOOKCOMPOSERDEFAULTS",{clientDashboardTemplate:"src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html",clientDashboardPanel:"tools",clientDashboardTabTitle:"Notebook composer",savingMsg:"We are saving your notebook",editingMsg:"We are editing your notebook",savingMsgTime:1250,notificationMsgTime:1500,notificationSuccessMsg:"Your notebook has been saved successfully",notificationErrorMsg:"We were unable to save your notebook"}).service("NotebookComposer",["BaseComponent","NotebookExchange","NOTEBOOKCOMPOSERDEFAULTS","$q","NotebookCommunication",function(a,b,c,d,e){var f=new a("NotebookComposer",c);f.createNotebook=function(a){var b=d.defer(),c=[];return e.createNotebook(a.name).then(function(f){if("private"===a.visibility){var g=e.setPrivate(f);c.push(g)}if(a.current===!0){var h=e.setCurrent(f);c.push(h)}d.all(c).then(function(){b.resolve()})},function(){b.reject("created failed")}),b.promise};var g=null;return f.editNotebook=function(a,b){var c=d.defer();return e.setName(a,b).then(function(){c.resolve()},function(){c.reject("edited failed")}),c.promise},f.getNotebookToEdit=function(){return g},f.setNotebookToEdit=function(a){g=a},f}]),angular.module("Pundit2.Vocabularies",[]),angular.module("Pundit2.Vocabularies").constant("FREEBASESELECTORDEFAULTS",{freebaseSearchURL:"https://www.googleapis.com/freebase/v1/search",freebaseSchemaBaseURL:"http://www.freebase.com/schema",freebaseImagesBaseURL:"https://usercontent.googleapis.com/freebase/v1/image",freebaseTopicURL:"https://www.googleapis.com/freebase/v1/topic",freebaseMQLReadURL:"https://www.googleapis.com/freebase/v1/mqlread",freebaseItemsBaseURL:"http://www.freebase.com",freebaseAPIKey:"AIzaSyCJjAj7Nd2wKsZ8d7XQ9ZvUwN5SF0tZBsE",active:!1,limit:15,instances:[{container:"freebase",label:"Freebase",active:!0}],objectFilters:["/common/topic/description","/common/topic/notable_types","/common/topic/notable_for"],debug:!1}).factory("FreebaseSelector",["BaseComponent","FREEBASESELECTORDEFAULTS","TypesHelper","SelectorsManager","Item","ItemsExchange","$http","$q",function(a,b,c,d,e,f,g,h){var i=new a("FreebaseSelector",b);i.name="FreebaseSelector",i.options.active&&d.addSelector(i);var j=function(a){this.config=a};return j.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,c=h.defer(),d=b.config.container+a.split(" ").join("$");return g({method:"GET",url:i.options.freebaseSearchURL,params:{key:i.options.freebaseAPIKey,query:a,limit:i.options.limit}}).success(function(a){if(i.log("Http success, get items from freebase",a),0===a.result.length)return i.log("Http success, but get empty result"),f.wipeContainer(d),void c.resolve();var g=[],j=[],k=[];for(var l in a.result){var m={label:a.result[l].name,mid:a.result[l].mid,image:i.options.freebaseImagesBaseURL+a.result[l].mid,description:-1,uri:-1};k.push(m);var n=h.defer();g.push(n.promise),j.push(n)}for(h.all(g).then(function(){for(i.log("Completed all items http request (topic and mql)"),f.wipeContainer(d),l=0;l<k.length;l++)f.addItemToContainer(new e(k[l].uri,k[l]),d);c.resolve()}),l=0;l<k.length;l++)b.getItemDetails(k[l],j[l])}).error(function(a){i.err("Cant get items from freebase: ",a),c.resolve()}),c.promise}},j.prototype.getItemDetails=function(a,b){var d=0;a.type=[],g({method:"GET",url:i.options.freebaseMQLReadURL,params:{key:i.options.freebaseAPIKey,query:{id:null,mid:a.mid,type:[{}]}}}).success(function(d){a.uri=i.options.freebaseItemsBaseURL+d.result.mid,i.log("Http success, get MQL from freebase"+a.uri);for(var e=d.result.type.length;e--;){var f=d.result.type[e],g=i.options.freebaseSchemaBaseURL+f.id;-1===a.type.indexOf(g)&&(a.type.push(g),c.add(g,f.name))}-1!==a.description&&(i.log("MQL was last, complete for item "+a.uri),delete a.mid,b.resolve(a))}).error(function(c){i.err("Cant get MQL from freebase: ",c),(-1!==a.description||d>0)&&b.resolve(a),d++}),g({method:"GET",url:i.options.freebaseTopicURL+a.mid,params:{key:i.options.freebaseAPIKey,filter:i.options.objectFilters}}).success(function(d){if(i.log("Http success, get TOPIC from freebase"+a.uri),"undefined"!=typeof d.property){if(a.description="undefined"!=typeof d.property["/common/topic/description"]&&d.property["/common/topic/description"].values.length>0?d.property["/common/topic/description"].values[0].value:a.label,"undefined"!=typeof d.property["/common/topic/notable_types"]&&d.property["/common/topic/notable_types"].values.length>0){var e=d.property["/common/topic/notable_types"].values[0],f=i.options.freebaseSchemaBaseURL+e.id,g=a.type.indexOf(f);g>-1&&a.type.splice(g,1),a.type.unshift(f),c.add(f,e.text)}}else a.description=a.label;-1!==a.uri&&(i.log("TOPIC was last, complete http for item "+a.uri),delete a.mid,b.resolve(a))}).error(function(c){i.err("Cant get TOPIC from freebase: ",c),(-1!==a.uri||d>0)&&b.resolve(a),d++})},i.log("Factory init"),j}]),angular.module("Pundit2.Vocabularies").constant("MURUCASELECTORDEFAULTS",{murucaReconURL:"http://demo2.galassiaariosto.netseven.it/backend.php/reconcile",queryProperties:{},active:!1,limit:5,instances:[{queryType:"http://purl.org/galassiariosto/types/Azione",container:"muruca",label:"Muruca",active:!0}],debug:!1}).factory("MurucaSelector",["BaseComponent","MURUCASELECTORDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("MurucaSelector",b);h.name="MurucaSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,c=g.defer(),e=b.config.container+a.split(" ").join("$"),i={params:{query:{query:a,type:b.config.queryType,properties:h.options.queryProperties,limit:h.options.limit}}};return f.jsonp(h.options.murucaReconURL+"?jsonp=JSON_CALLBACK",i).success(function(a){h.log("Http success, get items from muruca "+b.config.label,a),d.wipeContainer(e),0===a.result.length?(h.log("Empty Response"),c.resolve()):b.getItemsDetails(a.result,c,e)}).error(function(){d.wipeContainer(e),c.resolve()}),c.promise}},i.prototype.getItemsDetails=function(a,b,e){for(var f=0;f<a.length;f++){var g=a[f],i={label:g.name,uri:g.resource_url,type:[]};if(h.log("Loading metadata for item "+i.uri),"description"in g&&(i.description=g.description),"type"in g&&"length"in g.type)for(var j=g.type.length;j--;)"string"==typeof g.type[j]?i.type.push(g.type[j]):h.log("ERROR: Weird type is weird? "+typeof g.type[j]+": "+g.type[j]);var k=new c(i.uri,i);d.addItemToContainer(k,e)}b.resolve(),h.log("Complete items parsing")},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("KORBOBASKETSELECTORDEFAULTS",{korboBasketReconURL:"http://manager.korbo.org/api.php/basket/reconcile/",korboBasketMetadataURL:"http://manager.korbo.org/",korboItemsBaseURL:"http://purl.org/net7/korbo",korboSchemaBaseURL:"http://purl.org/net7/korbo/type/",baskets:[16],active:!1,limit:15,instances:[{container:"korboBasket",label:"KorboBasket",active:!0}],debug:!1}).factory("KorboBasketSelector",["BaseComponent","KORBOBASKETSELECTORDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("KorboBasketSelector",b);h.name="KorboBasketSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={params:{query:{query:a,limit:h.options.limit}},withCredentials:!0};return f.jsonp(h.options.korboBasketReconURL+h.options.baskets[0]+"?jsonp=JSON_CALLBACK",j).success(function(a){if(h.log("Http success, get items "+b.config.label,a),0===a.result.length)return h.log("Http success, but empty response"),d.wipeContainer(i),void e.resolve();for(var f=[],j=[],k=[],l=0;l<a.result.length;l++){var m=a.result[l],n={label:m.name,uri:m.resource_url,type:[]};k.push(n);var o=g.defer();f.push(o.promise),j.push(o)}for(g.all(f).then(function(){for(h.log("Completed all items http request"),d.wipeContainer(i),l=0;l<k.length;l++)d.addItemToContainer(new c(k[l].uri,k[l]),i);e.resolve()}),l=0;l<a.result.length;l++)b.getItemDetails(k[l],j[l])}).error(function(){e.resolve()}),e.promise}},i.prototype.getItemDetails=function(a,b){h.log("Loading metadata for item "+a.uri);var c={params:{url:a.uri},withCredentials:!0};f.jsonp(h.options.korboBasketMetadataURL+h.options.baskets[0]+"?jsonp=JSON_CALLBACK",c).success(function(c){h.log("Http item details success, get item",c);var d=c.result;if("image"in d&&(a.image=d.image),"description"in d&&(a.description=d.description),"rdftype"in d&&"length"in d.rdftype)for(var e=d.rdftype.length;e--;)"string"==typeof d.rdftype[e]?a.type.push(d.rdftype[e]):h.log("ERROR: Weird type is weird? "+typeof d.rdftype[e]+": "+d.rdftype[e]);b.resolve()}).error(function(){b.resolve()})},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("KORBO2DEFAULTS",{active:!1,limit:15,instances:[{container:"korbo2",label:"Korbo2",active:!0,basketID:null,url:"http://dev.korbo2.org/v1",language:"en"}],debug:!1}).factory("Korbo2Selector",["BaseComponent","KORBO2DEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("Korbo2Selector",b);h.name="Korbo2Selector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={q:a,p:"korbo",limit:h.options.limit,offset:0,lang:b.config.language};return null!==b.config.basketID&&(j.basketId=b.config.basketID),f({method:"GET",url:b.config.url+"/search/items",cache:!1,params:j}).success(function(a){if(h.log("Http success, get items "+b.config.label,a.data),0===a.data.length)return h.log("Empty response"),d.wipeContainer(i),void e.resolve();d.wipeContainer(i);for(var f=0;f<a.data.length;f++){var g=a.data[f],j={label:g.label,uri:g.uri,type:g.type};""!==g.depiction&&(j.image=g.depiction),""!==g.abstract&&(j.description=g.abstract),d.addItemToContainer(new c(j.uri,j),i)}e.resolve()}).error(function(){h.log("Http Error"),e.resolve()}),e.promise}},i.prototype.push=function(a){h.options.instances.push(a)},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("EUROPEANADEFAULTS",{active:!1,limit:15,instances:[{container:"europeana",label:"Europeana",active:!0,basketID:null,url:"http://dev.korbo2.org/v1",language:"en"}],debug:!1}).factory("EuropeanaSelector",["BaseComponent","EUROPEANADEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("EuropeanaSelector",b);h.name="EuropeanaSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={q:a,p:"europeana",limit:h.options.limit,offset:0,lang:b.config.language};return null!==b.config.basketID&&(j.basketId=b.config.basketID),f({method:"GET",url:b.config.url+"/search/items",cache:!1,params:j}).success(function(a){if(h.log("Http success, get items "+b.config.label,a.data),0===a.data.length)return h.log("Empty response"),d.wipeContainer(i),void e.resolve();d.wipeContainer(i);for(var f=0;f<a.data.length;f++){var g=a.data[f],j={label:g.label,uri:g.uri,type:g.type};""!==g.depiction&&(j.image=g.depiction),""!==g.abstract&&(j.description=g.abstract),d.addItemToContainer(new c(j.uri,j),i)}e.resolve()}).error(function(){h.log("Http Error"),e.resolve()}),e.promise}},i.prototype.push=function(a){h.options.instances.push(a)},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("GEONAMESDEFAULTS",{active:!1,limit:15,instances:[{container:"geonames",label:"Geonames",active:!0,basketID:null,url:"http://dev.korbo2.org/v1",language:"en"}],debug:!1}).factory("GeonamesSelector",["BaseComponent","GEONAMESDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("GeonamesSelector",b);h.name="GeonamesSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={q:a,p:"geonames",limit:h.options.limit,offset:0,lang:b.config.language};return null!==b.config.basketID&&(j.basketId=b.config.basketID),f({method:"GET",url:b.config.url+"/search/items",cache:!1,params:j}).success(function(a){if(h.log("Http success, get items "+b.config.label,a.data),0===a.data.length)return h.log("Empty response"),d.wipeContainer(i),void e.resolve();d.wipeContainer(i);for(var f=0;f<a.data.length;f++){var g=a.data[f],j={label:g.label,uri:g.uri,type:g.type};""!==g.depiction&&(j.image=g.depiction),""!==g.abstract&&(j.description=g.abstract),d.addItemToContainer(new c(j.uri,j),i)}e.resolve()}).error(function(){h.log("Http Error"),e.resolve()}),e.promise}},i.prototype.push=function(a){h.options.instances.push(a)},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("DBPEDIADEFAULTS",{active:!1,limit:15,instances:[{container:"dbpedia",label:"Dbpedia",active:!0,basketID:null,url:"http://dev.korbo2.org/v1",language:"en"}],debug:!1}).factory("DbpediaSelector",["BaseComponent","DBPEDIADEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("DbpediaSelector",b);h.name="DbpediaSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){if("undefined"!=typeof a){var b=this,e=g.defer(),i=b.config.container+a.split(" ").join("$"),j={q:a,p:"dandeliondbpedia",limit:h.options.limit,offset:0,lang:b.config.language};return null!==b.config.basketID&&(j.basketId=b.config.basketID),f({method:"GET",url:b.config.url+"/search/items",cache:!1,params:j}).success(function(a){if(h.log("Http success, get items "+b.config.label,a.data),0===a.data.length)return h.log("Empty response"),d.wipeContainer(i),void e.resolve();d.wipeContainer(i);for(var f=0;f<a.data.length;f++){var g=a.data[f],j={label:g.label,uri:g.uri,type:g.type};""!==g.depiction&&(j.image=g.depiction),""!==g.abstract&&(j.description=g.abstract),d.addItemToContainer(new c(j.uri,j),i)}e.resolve()}).error(function(){h.log("Http Error"),e.resolve()}),e.promise}},i.prototype.push=function(a){h.options.instances.push(a)},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("SELECTORMANAGERDEFAULTS",{clientDashboardTemplate:"src/Lists/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Vocab",cMenuType:"vocabItems",debug:!1,order:"label",reverse:!1,initialActiveTab:0,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("SelectorsManager",["BaseComponent","SELECTORMANAGERDEFAULTS","ItemsExchange","$injector","$q",function(a,b,c,d,e){var f=new a("SelectorsManager",b),g={},h=[],i={},j=function(a){f.log("Wipe all containers that match "+a);for(var b in h){var d=h[b].config.container+a;c.wipeContainer(d)}};return f.getItems=function(a,b){if("undefined"!=typeof a){var c=e.defer(),d=h.length,f=a.split(" ").join("$");"undefined"==typeof i[f]?i[f]=[b]:i[f].push(b),b.then(function(){var a=b,c=i[f].indexOf(a);c>-1&&(i[f].splice(c,1),0===i[f].length&&(j(f),delete i[f]))});for(var g in h)h[g].getItems(a).then(function(){d--,0>=d&&null!==c&&(c.resolve(),c=null)});return c.promise}},f.init=function(){h=[];for(var a in g){var b=d.get(g[a].name);for(var c in g[a].options.instances){var e=new b(g[a].options.instances[c]);h.push(e)}}f.log("Init, add selectors instances",h)},f.addSelector=function(a){g[a.name]=a,f.log("Add selector ",a.name)},f.getActiveSelectors=function(){return h},f}]),angular.module("korboee-templates",["src/KorboEE/Korboee-callback.tmpl.html","src/KorboEE/Korboee-error-config.tmpl.html","src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html","src/KorboEE/Modal/KorboEE.modal.tmpl.html","src/KorboEE/New/KorboEE.languagesPopover.tmpl.html","src/KorboEE/New/KorboEE.new.tmpl.html","src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html","src/KorboEE/Search/KorboEE.search.tmpl.html","src/KorboEE/Search/KorboEEverticalTabs.tmpl.html","src/KorboEE/autocompleteList.tmpl.html","src/KorboEE/korboee-entity.tmpl.html"]),angular.module("src/KorboEE/Korboee-callback.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-callback.tmpl.html","<!--\nUse only callback mode.\nYou can use API registered on Global Object defined in your configuration\n-->\n\n")}]),angular.module("src/KorboEE/Korboee-error-config.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Korboee-error-config.tmpl.html",'<div class="container error-ee-config">\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-globalobject" \n        ng-show="errorType == \'globalObject\'">\n            Configuration Error. Object {{conf.globalObjectName}} existing. Please check your configuration!\n    </div>\n    <div \n        class="row container alert alert-danger error col-md-4 error-ee-autocomplete" \n        ng-show="errorType == \'autoComplete\'">\n            CONFIGURATION ERROR. <br> \n            You can choise only one mode: useAutocompleteWithNew or useAutocompleteWithSearch. <br> \n            Please check your configuration!\n    </div>\n</div>')
}]),angular.module("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",'<div class="modal kee-wrp pnd-confirm-modal-container pnd-ignore" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-confirm-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-confirm-modal-footer">\n                <button type="button" class="btn btn-default pnd-confirm-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-confirm-modal-confirm" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html",'<ul class="nav nav-tabs" ng-hide="editMode">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}">{{pane.title}}<span class="badge pull-right" ng-show="pane.isStarted">{{pane.totalResults}}</span>\n        </a>\n    </li>\n</ul>\n<div class="tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template || \'$pane\'"></div>\n</div>\n')}]),angular.module("src/KorboEE/Modal/KorboEE.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Modal/KorboEE.modal.tmpl.html",'<div class="kee-wrp kee-modal-container modal pnd-ignore" tabindex="-1" role="dialog" ng-controller="KeeModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content kee-modal-content">\n            <div class="modal-body kee-modal-body">\n                <div ng-model="korboModalTabs.activeTab" data-template="src/KorboEE/Modal/KorboEE.modal.tabs.tmpl.html" bs-tabs="korboModalTabs"> </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n')}]),angular.module("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",'<div class="pnd-korbo-languages-popover popover">\n    <div ng-repeat="lang in disactiveLanguages" class="kee-popover-item">\n        <div ng-click="addLanguage(lang); $hide()" >\n            <span class="pnd-icon pnd-icon-plus"></span> {{lang.name}} ({{lang.title}})\n        </div>\n    </div>\n</div>')}]),angular.module("src/KorboEE/New/KorboEE.new.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/KorboEE.new.tmpl.html",'<div ng-controller="KeeNewCtrl">\n    <!-- Top area -->\n    <div class="kee-top-area">\n        <div class="kee-top-area-menu pull-right">\n            <button type="button" class="btn btn-xs btn-link" ng-click="showDropdown($event)">\n                <span class="pnd-icon pnd-icon-gear"></span>\n            </button>\n        </div>\n        <div class="kee-top-area-message" ng-class="{\'kee-error\' : topArea.status == \'error\'}">\n            {{topArea.message}}\n        </div>\n    </div> \n    <!-- End top area -->\n\n    <!-- New content -->\n    <div class="kee-new-content" ng-hide="isSaving">\n    \n        <!-- Content on the right -->\n        <div class="kee-right-content" ng-hide="loadingStatus">\n\n            <!-- Original url-->\n            <div class="kee-new-original-url">\n	            <div class="form-group">\n	                <label>Original URL</label>\n	                <div class="left-inner-icon">\n                        <span class="pnd-icon pnd-icon-external-link" ng-click="openWindow(originalUrl);$event.stopPropagation();$event.preventDefault();"></span>\n                        <input \n                            type="text" \n                            class="form-control" \n                            ng-model="originalUrl" \n                            ng-disabled="originalUrlCheck">\n	                </div>\n	            </div>\n            </div>\n            <!-- End original url -->\n\n            <!-- Image url -->\n            <div class="kee-new-image-url">\n\n                <!-- Form group -->\n	            <div class="form-group">\n\n	            	<!-- Preview -->\n	                <div class="kee-preview-image">\n                    	<img ng-show="showImg" ng-src="{{previewImage}}"/>\n                    </div>\n	                <!-- End preview -->\n\n	                <span \n                        ng-show="errorImage" \n                        class="kee-message-error-image">\n                            Impossible to load image\n                    </span>\n                    <span \n                        ng-show="loadingImage" \n                        class="kee-message-loading-image">\n                            Loading image...\n                    </span>\n	                <label>\n                        Image URL\n	                    <span \n                            ng-show="!imageUrlHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="imageUrlHasError" \n                            class="kee-error pnd-icon pnd-icon-info-circle" \n                            data-title="{{imageUrlErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n	                <input \n                        ng-hide="showImg" \n                        type="text" \n                        ng-model="imageUrl" \n                        ng-change="checkUrl()" \n                        class="form-control">\n	                <a \n                        ng-show="showImg" \n                        ng-click="removeImage()" \n                        class="kee-message-remove-image">\n                            Remove image\n                    </a>\n	                <label ng-class="{\'kee-error\' : imageUrlHasError}" />\n	            </div>\n                <!-- End form group -->\n            </div>\n            <!-- End image url -->\n\n            <!-- Types -->\n            <div \n                class="kee-new-types" \n                ng-mouseleave="typesMouseLeave()" \n                ng-mouseenter="typesMouseEnter()">\n            \n                <!-- Form group -->\n	            <div class="form-group">\n    	            <button \n                        type="button" \n                        class="btn btn-xs btn-link pull-right" \n                        ng-show="!activeFilter" \n                        ng-click="activeFilter = !activeFilter">\n                            <span class="pnd-icon pnd-icon-filter"></span>\n                    </button>\n	                <label ng-class="{\'kee-error\' : typesHasError}">                    \n	                    Types\n                        <span class="kee-error"> * </span>\n	                    <span \n                            ng-show="!typesHasError" \n                            class="pnd-icon pnd-icon-info-circle" \n                            data-title="{{typesTooltipeMessage}}" \n                            bs-tooltip>\n                        </span>\n	                    <span \n                            ng-show="typesHasError" \n                            class="pnd-icon pnd-icon-info-circle kee-error" \n                            data-title="{{typesErrorMessage}}" \n                            bs-tooltip>\n                        </span>\n	                </label>\n\n                    <div \n                        class="left-inner-icon pull-right" \n                        ng-show="activeFilter">\n                        <span \n                            ng-show="typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-filter" \n                            ng-click="activeFilter = !activeFilter">\n                        </span>\n                        <span \n                            ng-show="!typeFilter.label == \'\'" \n                            class="pnd-icon pnd-icon-times" \n                            ng-click="typeFilter.label=\'\'">\n                        </span>\n                        <input \n                            ng-show="activeFilter" \n                            type="text" \n                            placeholder="filter types..." \n                            ng-model="typeFilter.label"  \n                            class="form-control">\n                    </div>\n	            </div>\n                <!-- End form group -->\n\n                <!-- Types list -->\n                <div class="kee-list-types">\n                    <ul class="list-group">\n                        <li \n                            ng-repeat="item in types | filter:typeFilter" \n                            class="list-group-item">\n                            	<div \n                                    class="pnd-item" \n                                    ng-class="{\'pnd-sticky-item\': item.checked}" \n                                    ng-click="item.checked = !item.checked; updateTypes()">\n                                        <div class="pnd-item-buttons">\n                                            <span \n                                                class="pnd-icon pnd-icon-check ng-scope"\n                                                ng-show="item.checked">\n                                            </span>\n                                        </div>\n\n                                        <div class="pnd-item-text">\n                                            <span class="pnd-item-label">\n                                                {{item.label}}\n                                            </span>\n                                        </div>\n\n                                        <span \n                                            class="pnd-icon pnd-icon-external-link pull-right" \n                                            ng-click="openWindow(item.URI);$event.stopPropagation();$event.preventDefault();">\n                                        </span>\n                                </div>\n                        </li>\n                    </ul>\n                </div>\n                <button \n                    type="button" \n                    class="btn btn-default btn-xs" \n                    ng-click="activeAllTypes()">\n                        Select all types\n                </button>\n                <button \n                    type="button" \n                    class="btn btn-default btn-xs" \n                    ng-click="disableAllTypes()">\n                        Deselect all types\n                </button>\n                <!-- End types list -->  \n            </div>\n            <!-- End Types -->\n        </div> \n        <!-- End content on the right -->\n\n        <div class="kee-new-languages">\n            <div kee-languages="tabs"></div>\n            <button \n                class="btn btn-xs btn-link pull-left" \n                ng-class="{true:\'pnd-korboee-btn-not-active\'}[disactiveLanguages.length < 1]"\n                template="{{disactiveLanguagesPopoverTemplate}}" \n                data-animation="am-flip-x" \n                bs-popover \n                ng-disabled="disactiveLanguages.length < 1">\n                    <span class="pnd-icon pnd-icon-plus"></span>\n            </button>\n        </div>\n    </div> \n    <!-- End new content -->\n\n    <div class="kee-new-saving" ng-show="isSaving">\n        Saving...\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="save()">\n                <span ng-if="!editMode">Save and add</span>\n                <span ng-if="editMode">Save</span>\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-info" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-info" \n            ng-click="clearForm()">\n                Clear\n        </button>\n\n    </div> \n    <!-- End Footer -->\n</div>')}]),angular.module("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in panes" ng-class="{active: $index == active, \'kee-error\' : panes[$index].hasError}" ng-show="pane.isVisible">\n            <a ng-show="!panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n            <a ng-show="panes[$index].hasError" data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="kee-error" bs-tooltip data-title="{{tabs[$index].tooltipMessageErrorTab}}" >{{pane.title}}</span>\n            </a>\n        </li>\n        <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n            <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n        </li>\n    </ul>\n    <!-- tab content-->\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n            <div ng-repeat="pane in tabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n                <!-- entity title -->\n                <div class="kee-title">\n	                <div class="form-group">\n	                <label ng-class="{\'kee-error\' : tabs[$index].hasError}">Title\n	                    <span class="kee-error" ng-class="{\'kee-error\' : tabs[$index].hasError}"> * </span>\n	                    <span ng-show="!tabs[$index].hasError" class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageTitle}}" bs-tooltip></span>\n	                    <span ng-show="tabs[$index].hasError" class="kee-error pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageError}}" bs-tooltip></span>\n	                </label>\n	                <input type="text" ng-model="tabs[$index].label" ng-change = updateTitleField($index) class="form-control">\n	                </div>\n                </div>\n                <!-- end entity title -->\n\n                <!-- entity description -->\n                <div class="form-group">\n	                <div class="kee-description">\n    	                <label>Description <span class="pnd-icon pnd-icon-info-circle" data-title="{{tabs[$index].tooltipMessageDescription}}" bs-tooltip></span></label>\n    	                <textarea class="form-control" rows="3" ng-model="tabs[$index].description" class="form-control"></textarea>\n	                </div>\n                </div>\n                <!-- end entity description -->\n            </div>\n\n        </div>\n    </div>\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/Search/KorboEE.search.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEE.search.tmpl.html",'<div class="kee-wrp" ng-controller="KeeSearchCtrl">\n    <!-- Search -->\n    <div class="kee-search">\n            <label>\n                Search entity to use:\n            </label>\n            <div class="left-inner-icon">\n    	        <span \n                    class="pnd-icon pnd-icon-search" \n                    ng-click="search.term = \'\'">\n                </span>\n    	        <input \n                    class="form-control" \n                    type="text" \n                    ng-model="elemToSearch" \n                    placeholder="Type at least {{conf.labelMinLength}} characters...">\n            </div>\n    </div>\n    <!-- // End search -->\n\n    <div>\n        <preview \n            use-in-korbo="true" \n            is-loading="{{previewIsLoading}}" \n            error-loading="{{previewError}}">\n        </preview>\n    </div>\n\n    <div \n        ng-model="contentTabs.activeTab" \n        bs-tabs="contentTabs" \n        data-template = "src/ResourcePanel/verticalTabs.tmpl.html">\n    </div>\n\n    <!-- Footer -->\n    <div class="kee-footer">\n        <button \n            ng-hide="editMode" \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-click="closeKeeModal()">\n                Close\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showMoreInfo.visibility" \n            ng-class="{\'disabled\': showMoreInfo.disabled}" \n            ng-click="moreInfo()">\n                More Info\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showCopyInEditor.visibility" \n            ng-class="{\'disabled\': showCopyInEditor.disabled}" \n            ng-click="copyInEditor()">\n                Copy in editor\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUse.visibility" \n            ng-class="{\'disabled\': showUse.disabled}" \n            ng-click="use()">\n                Use\n        </button>\n        <button \n            type="button" \n            class="btn btn-xs btn-success" \n            ng-show="!editMode && showUseAndCopy.visibility" \n            ng-class="{\'disabled\': showUseAndCopy.disabled}" \n            ng-click="copyAndUse()">\n                Copy and Use\n        </button>\n\n        <button \n            ng-show="editMode" \n            type="button" class="btn btn-xs btn-success" \n            ng-click="korboModalTabs.activeTab = 1">\n                Back\n        </button>\n        <button \n            ng-show="editMode" \n            type="button" \n            class="btn btn-xs btn-success"\n            ng-disabled="!itemSelected"\n            ng-click="copyInEditor(); elemToSearch = \'\'">\n                Select URL\n        </button>\n    </div>\n    <!-- // End footer -->\n</div>')}]),angular.module("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/Search/KorboEEverticalTabs.tmpl.html",'<div class="tabbable tabs-left"> <!-- tabs left -->\n\n    <ul class="nav nav-tabs pnd-vertical-tabs">\n        <li ng-repeat="pane in contentTabs" ng-class="{active: $index == active}">\n            <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" >\n                <span class="badge pull-right" ng-show="!pane.isLoading && pane.items.length>0 && elemToSearch!==\'\'">{{pane.items.length}}</span>\n                <span class="pnd-icon pnd-icon-refresh pnd-icon-spin pull-right" ng-show="pane.isLoading"></span>\n                {{pane.title}}\n            </a>\n        </li>\n    </ul>\n    <div>\n        <div class="pnd-vertical-tab-content tab-content">\n        	<div ng-repeat="pane in contentTabs" class="tab-pane pnd-vertical-tab-list-content" ng-class="[$index == active ? \'active\' : \'\']">\n		        <div class="kee-server-messages" ng-if="!contentTabs[$index].serverError">\n		        	<!-- messages 1 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch !== \'\'">No results found</div>\n		        	<!-- / end messages 1 -->\n		        	<!-- messages 2 -->\n		        	<div class="kee-server-searching" ng-show="contentTabs[$index].isLoading && elemToSearch !== \'\'"><span class="pnd-icon pnd-icon-refresh pnd-icon-spin "></span></div>\n		        	<!-- / end messages 2 -->\n		        	<!-- messages 3 -->\n		        	<div ng-show="!contentTabs[$index].isLoading && contentTabs[$index].items.length === 0 && elemToSearch === \'\'">Type a label to search...</div>\n		        	<!-- / end messages 3 -->\n		        </div>\n		        <!-- messages 4 -->\n		        <div class="kee-server-messages" ng-if="contentTabs[$index].serverError">\n		            <div ng-show="contentTabs[$index].serverError">Server error</div>\n		        </div>\n		        <!-- / end messages 4 -->\n                <ul class="list-group pnd-inner-scrollable">\n                    <li class="list-group-item" ng-repeat="mi in contentTabs[$index].items | orderBy:getOrderProperty" >\n                        <item uri="{{mi.uri}}" hide-options="true" hide-sticky-button="true" ng-click="select(mi)" is-selected="{{isSelected(mi)}}" ng-mouseover="getItem(mi)"></item>\n                    </li>\n                </ul>\n           </div>\n        </div>\n    </div>\n\n\n</div> <!-- / tabs left -->')}]),angular.module("src/KorboEE/autocompleteList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/autocompleteList.tmpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu kee-autocomplete-list list-group" ng-show="$isVisible() && !serverNotRunning" role="select">\n  <li role="presentation" ng-repeat="match in $matches"  class="list-group-item">\n    <item uri="{{match.value.uri}}" ng-click="$select($index, $event);selectEntity(match)" ng-if="match.label !== \'no found\'"></item>\n    <span class="kee-not-found" role="menuitem" tabindex="-1" disabled ng-bind="noFound" ng-show="match.value.noResult === true"></span>\n  </li>\n    <li ng-show="showNewButton() || showSearchButton()"></li>\n    <li>\n    <!-- footer -->\n    <div class="kee-footer-autocomplete">\n        <span class="kee-elem-to-search" ng-show="showNewButton() || showSearchButton()">"{{elemToSearch}}"</span>\n        <!-- <div class="kee-footer-btn"> -->\n        <button class="kee-btn-new btn btn-info btn-xs" ng-show="showNewButton()" ng-click="openKeeModal();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-plus"></i>\n            Create new\n        </button>\n        <button class="kee-btn-search btn btn-success btn-xs" ng-show="showSearchButton()" ng-click="searchOnLOD();$event.preventDefault();$event.stopPropagation();">\n            <i class="pnd-icon pnd-icon-search"></i>\n            Search in LOD\n        </button>\n        <!-- </div> -->\n    </div>\n    <!-- End footer -->\n    </li>\n</ul>\n')}]),angular.module("src/KorboEE/korboee-entity.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/KorboEE/korboee-entity.tmpl.html",'<div \n      class="container kee-wrp" \n      id="korbo-ee-container" \n      ng-show="renderElement()">\n      \n      <div class="left-inner-icon">\n            <span \n                  class="pnd-icon pnd-icon-refresh pnd-icon-spin" \n                  ng-show="isLoading() && !serverNotRunning">\n            </span>\n            \n            <input \n                  class="kee-input-elem-to-search kee-input-ok form-control"\n                  name="{{conf.tafonyName}}"\n                  id="{{conf.tafonyId}}"\n                  placeholder="Type at least {{conf.labelMinLength}} characters..."\n                  ng-keypress="keyPressHandle($event)"\n                  type="text"\n                  autocomplete="off"\n                  ng-model="elemToSearch"\n                  template="{{autocompleteListTemplate}}"\n                  ng-options="e.label for e in results"\n                  bs-typeahead\n                  ng-disabled="serverNotRunning"\n                  ng-show = "!serverNotRunning"\n                    />\n            <input \n                  ng-disabled="true" \n                  class="kee-input-elem-to-search kee-input-error-server form-control" placeholder="Sorry! The service is not working" \n                  ng-show = "serverNotRunning"/>\n\n      </div> \n      <!-- // End div ee-input-container -->\n\n\n      <!-- input hidden -->\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenUri}}" \n            value="{{location}}" \n            class="ee-uri-hidden" />\n      <input \n            type="hidden" \n            name="{{conf.nameInputHiddenLabel}}" \n            value="{{label}}" \n            class="ee-label-hidden" />\n      <!-- // End input hidden -->\n\n</div> \n<!-- // End div container -->\n')}]),angular.module("KorboEE",["korboee-templates","templates-main","APIModule","mgcrea.ngStrap","Pundit2.Core"]),angular.module("KorboEE").directive("korboEntityEditor",["korboConf","APIService","$window",function(a,b,c){return{restrict:"E",templateUrl:function(d,e){var f=e.confName||"",g=a.setConfiguration(f);if("undefined"!=typeof c[g.globalObjectName])return e.error=!0,e.errorType="globalObject","src/KorboEE/Korboee-error-config.tmpl.html";e.error=!1;var h=b.init(g),i=["OpenSearch","OpenNew","Cancel","ClearForm","Edit","CopyAndUse"],j=["Open","Cancel","Save"];return h.addEvent(j),h.addFeature(i),null!==g.onLoad&&"function"==typeof g.onLoad&&g.useOnlyCallback&&g.onLoad(),g.useOnlyCallback||!g.useTafonyCompatibility&&!g.useOnlyCallback?"src/KorboEE/Korboee-callback.tmpl.html":g.useTafonyCompatibility?"src/KorboEE/korboee-entity.tmpl.html":void 0},scope:{},link:function(b,c,d){var e=d.confName||"";b.conf=a.setConfiguration(e),b.abstract="",b.location="",b.errorGlobalObjName=d.error,b.errorType=d.errorType,a.setIsOpenModal(!1)},controller:"EEDirectiveCtrl"}}]),angular.module("KorboEE").controller("EEDirectiveCtrl",["$scope","APIService","korboConf","$http","KorboCommunicationFactory","$timeout","ItemsExchange","KorboCommunicationService",function(a,b,c,d,e,f,g,h){a.autocompleteListTemplate="src/KorboEE/autocompleteList.tmpl.html";var i;a.readyToRender=!1,a.noFound="no entities found",a.elemToSearch="",a.isSearching=!1,a.serverNotRunning=!1,a.renderElement=function(){return a.readyToRender},a.$watch("conf",function(){a.errorGlobalObjName||(a.init=function(){a.readyToRender=a.conf.updateTime,a.limit=a.conf.limitSearchResult,a.minLabelLength=a.conf.labelMinLength,a.defaultLan=a.conf.languages[0];for(var b in a.conf.languages)if(a.conf.languages[b].state===!0){a.defaultLan=a.conf.languages[b];break}k(),a.$evalAsync(function(){j()})}())});var j=function(){a.inputWidth=angular.element(".kee-input-elem-to-search").outerWidth(),null!==a.conf.onReady&&"function"==typeof a.conf.onReady&&a.conf.onReady()},k=function(){i=b.get(a.conf.globalObjectName),"undefined"!=typeof i&&(i.exposeOpenSearch(function(b){h.openModalOnSearch(a.conf,b,a)}),i.exposeOpenNew(function(b){h.openModalOnNew(a.conf,b,a)}),i.exposeEdit(function(b){h.openModalOnEdit(a.conf,b,a)}),i.exposeCancel(function(){h.closeModal()}),i.exposeCopyAndUse(function(b){var c=new e;if("undefined"!=typeof b&&null!==b){var d={label:b.label,"abstract":b.description,depiction:b.image,type:b.type,resource:b.uri},f=c.save(d,a.defaultLan.value,a.conf.endpoint,a.conf.basketID);f.then(function(b){var c={};c.value=b,c.label=d.label,c.type=d.type,c.image=d.depiction,c.description=d.abstract,c.language=a.defaultLan.value,i.fireOnSave(c)})}}))};a.keyPressHandle=function(b){13===b.keyCode&&a.conf.useTafonyCompatibility&&(b.stopPropagation(),b.preventDefault())},a.autoCompleteSearch=function(b){b.length>=a.conf.labelMinLength&&(a.isSearching=!0,a.results=h.autocompleteSearch(b,a.conf.endpoint,"korbo",a.conf.limitSearchResult,0,a.defaultLan.value,a.conf.basketID),a.results.then(function(b){return"undefined"!=typeof b[0]&&b[0].errorServer?(a.serverNotRunning=!0,void(a.isSearching=!1)):(a.isSearching=!1,a.serverNotRunning=!1,a.results)}))},a.selectEntity=function(b){a.location=b.value.uri,a.label=b.value.label;var c={};c.value=a.location,c.label=b.value.label,c.type=b.value.type,c.image=b.value.depiction,c.description=b.value.abstract,c.language=a.defaultLan.value,i.fireOnSave(c)},a.$watch("elemToSearch",function(){a.autoCompleteSearch(a.elemToSearch)}),a.showSearchButton=function(){return"search"===a.conf.autoCompleteOptions||"all"===a.conf.autoCompleteOptions?!0:!1},a.showNewButton=function(){return"new"===a.conf.autoCompleteOptions||"all"===a.conf.autoCompleteOptions?!0:!1},a.isLoading=function(){return a.isSearching},a.openKeeModal=function(){var b={label:a.elemToSearch};h.openModalOnNew(a.conf,b,a)},a.searchOnLOD=function(){h.openModalOnSearch(a.conf,a.elemToSearch,a)}}]),angular.module("KorboEE").factory("korboConf",["Utils",function(a){var b=angular.copy(KORBODEFAULTCONF),c=function(c){return"undefined"==typeof c||"undefined"==typeof window[c]||""===c?angular.copy(KORBODEFAULTCONF):(b=angular.copy(KORBODEFAULTCONF),a.deepExtend(b,window[c]),b)};return b.setConfiguration=c,b.setIsOpenModal=function(a){b.modalOpen=a},b.getIsOpenModal=function(){return b.modalOpen},b}]),angular.module("APIModule",[]).service("APIService",["$window",function(a){function b(a){return this.conf=a,this.eventCallbacks={},this.featureCallbacks={},this.global={},this}var c=[],d={};return b.prototype.addEvent=function(a){var b=this,c=b.eventCallbacks,d=a;"string"==typeof a&&(d=[a]);for(var e in d){var f=d[e];c[f]=[],b.global["on"+f]=function(a){return function(b){"function"==typeof b&&c[a].push(b)}}(f),b["fireOn"+f]=function(a){return function(){var b=Array.prototype.splice.call(arguments,0);for(var d in c[a])c[a][d].apply(this,b)}}(f)}},b.prototype.addFeature=function(a){var b=this,c=b.featureCallbacks,d=a;"string"==typeof a&&(d=[a]);for(var e in d){var f=d[e];b["expose"+f]=function(a){return function(b){"function"==typeof b&&(c[a]=b)}}(f),b.global["call"+f]=function(a){return function(){if(a in c){var d=Array.prototype.splice.call(arguments,0);return c[a].apply(b,d)}}}(f)}},d.init=function(d){if("globalObjectName"in d){var e=new b(d);return a[d.globalObjectName]=e.global,c[d.globalObjectName]=e,e}},d.get=function(a){return c[a]},d}]);var KORBODEFAULTCONF;KORBODEFAULTCONF={endpoint:"http://dev.korbo2.org/v1",basketID:1,updateTime:1e3,labelMinLength:3,copyToKorboBeforeUse:!1,tafonyId:"default_tafony_id",tafonyName:"default_tafony_name",nameInputHiddenUri:"default_korbo_uri",nameInputHiddenLabel:"default_korbo_label",useTafonyCompatibility:!1,useOnlyCallback:!1,globalObjectName:"EE",onLoad:null,searchTypes:["http://person.uri","http://philosopher.uri","http://place.uri"],limitSearchResult:10,providers:{freebase:!1,dbpedia:!1},buttonLabel:"Default Search",type:[{label:"Schema.org place",state:!0,URI:"http://schema.org/Place"},{label:"FOAF person",state:!1,URI:"http://xmlns.com/foaf/0.1/Person"},{label:"W3 Spatial thing",state:!0,URI:"http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing"}],languages:[{name:"Italian",value:"it",state:!1},{name:"English",value:"en",state:!0},{name:"German",value:"de",state:!1}],visualizeCopyButton:["freebase"],onReady:null,autoCompleteMode:"simple",autoCompleteOptions:"none"},angular.module("KorboEE").service("KorboCommunicationService",["$q","$http","BaseComponent","ItemsExchange","Item","$rootScope","$modal","korboConf","KorboCommunicationFactory","APIService",function(a,b,c,d,e,f,g,h,i,j){var k=new c("KorboCommunication"),l=!1;k.setAutocompleteLoading=function(a){l=a},k.isAutocompleteLoading=function(){return l};var m=f.$new(),n=g({container:"[data-ng-app='Pundit2']",template:"src/KorboEE/Modal/KorboEE.modal.tmpl.html",show:!1,backdrop:"static",scope:m,keyboard:!1}),o=f.$new();o.titleMessage="Are you sure?",o.notifyMessage="Are you sure you want to close the editor? You will lose any unsaved changes",o.cancel=function(){p.hide()
},o.confirm=function(){var a=j.get(this.globalObjectName);p.hide(),h.setIsOpenModal(!1),n.hide(),h.setIsOpenModal(!1),a.fireOnCancel(),r=null,q=null};var p=g({container:"[data-ng-app='Pundit2']",template:"src/KorboEE/Modal/KorboEE.confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:o});k.showConfirmModal=function(a){o.globalObjectName=a,p.$promise.then(p.show)},k.openModalOnNew=function(a,b,c){h.getIsOpenModal()===!1&&(h.setIsOpenModal(!0),m.entityToCreate="undefined"!=typeof b||""!==b?b:null,m.labelToSearch=null,m.idEntityToEdit=null,m.op="new",m.conf=a,m.directiveScope=c,n.$promise.then(n.show))},k.openModalOnSearch=function(a,b,c){h.getIsOpenModal()===!1&&(h.setIsOpenModal(!0),m.labelToSearch="undefined"!=typeof b||""!==b?b:null,m.entityToCreate=null,m.idEntityToEdit=null,m.op="search",m.conf=a,m.directiveScope=c,n.$promise.then(n.show))},k.openModalOnEdit=function(a,b,c){h.getIsOpenModal()===!1&&(h.setIsOpenModal(!0),m.idEntityToEdit="undefined"!=typeof b||""!==b?b:null,m.entityToCreate=null,m.labelToSearch=null,m.op="edit",m.conf=a,m.directiveScope=c,n.$promise.then(n.show))},k.closeModal=function(){h.getIsOpenModal()===!0&&(h.setIsOpenModal(!1),n.hide())},k.autocompleteSearch=function(a,c,f,g,h,i,j){return l=!0,b({method:"GET",url:c+"/search/items",cache:!1,params:{q:a,p:f,limit:g,offset:h,lang:i,basketId:j}}).then(function(a){if("0"===a.data.metadata.totalCount){var b=[{label:"no found",noResult:!0}];return l=!1,b}d.wipeContainer("kee-"+f);for(var c=0;c<a.data.data.length;c++){for(var g={uri:a.data.data[c].uri,label:a.data.data[c].label,description:a.data.data[c].abstract,depiction:a.data.data[c].depiction,type:[]},h=0;h<a.data.data[c].type.length;h++)g.type.push(a.data.data[c].type[h]);var i=new e(g.uri,g);d.addItemToContainer(i,"kee-"+f)}return l=!1,a.data.data},function(){l=!1;var a=[{label:"error",errorServer:!0}];return a})},k.buildLanguagesObject=function(b,c){var d=a.defer(),e=0,f={},g=new i,h="Insert title of the entity in ",j="Insert description of the entity in ";return f.languages=[],g.getItem(b,!1).then(function(a){if(f.imageUrl=a.depiction,f.originalUrl=a.resource,f.types=a.type,f.basketId=a.basket_id,a.available_languages.length>=0)for(var i=0;i<a.available_languages.length;i++)!function(i){var k;b.language=a.available_languages[i],k=g.getItem(b,!1),k.then(function(a){var b=c.map(function(a){return angular.lowercase(a.value)}).indexOf(angular.lowercase(a.reqLanguage));if(-1!==b){var d=angular.uppercase(a.reqLanguage),e=angular.lowercase(c[b].name),g={title:d,name:e,description:a.abstract,label:a.label,mandatory:!0,hasError:!1,tooltipMessageTitle:h+e,tooltipMessageDescription:j+e,tooltipMessageError:"message",tooltipMessageErrorTab:"There are some errors in the "+e+" languages fields"};f.languages.push(g)}}).finally(function(){e++,e===a.available_languages.length&&d.resolve(f)})}(i);else d.resolve(f)},function(a){console.log("server error ",a),f=null,d.reject()}),d.promise};var q=null;k.setSelectedEntity=function(a){q=a},k.getSelectedEntity=function(){return q};var r=null;return k.setEntityToCopy=function(a){r=a},k.getEntityToCopy=function(){return r},k}]),angular.module("KorboEE").factory("KorboCommunicationFactory",["$q","$http","Item","ItemsExchange",function(a,b,c,d){var e=function(){};return e.prototype.search=function(e,f){var g=a.defer();return b({method:"GET",url:e.endpoint+"/search/items",cache:!1,params:{q:e.label,p:e.provider,limit:e.limit,offset:e.offset,lang:e.language,basketId:e.basketID}}).success(function(a){d.wipeContainer(f);for(var b=0;b<a.data.length;b++){var e={uri:a.data[b].id,label:a.data[b].label,description:"",depiction:"",type:[""]},h=new c(e.uri,e);d.addItemToContainer(h,f)}g.resolve()}).error(function(){g.reject()}),g.promise},e.prototype.getItem=function(c,d){var e=a.defer(),f=angular.copy(c.language);return b({headers:{"Accept-Language":c.language},method:"GET",url:c.endpoint+"/baskets/"+c.basketID+"/items/"+c.item.uri,cache:d,params:{p:c.provider}}).success(function(a){a.reqLanguage=f,e.resolve(a)}).error(function(){e.reject()}),e.promise},e.prototype.save=function(c,d,e,f){var g=a.defer();return b({headers:{"Access-Control-Expose-Headers":"Location","Content-Language":d},method:"POST",url:e+"/baskets/"+f+"/items",data:c}).success(function(a,b,c){var d=c("Location");g.resolve(d)}).error(function(){g.reject()}),g.promise},e}]),angular.module("KorboEE").controller("KeeModalCtrl",["$scope","$modal","KorboCommunicationService","APIService","korboConf","KorboCommunicationFactory","$window",function(a,b,c,d,e,f,g){var h=d.get(a.conf.globalObjectName),i=new f;a.editMode=!1,a.defaultLan=a.conf.languages[0];for(var j in a.conf.languages)if(a.conf.languages[j].state===!0){a.defaultLan=a.conf.languages[j];break}a.currentProv={},a.korboModalTabs=[{title:"Search",template:"src/KorboEE/Search/KorboEE.search.tmpl.html",totalResults:0,isStarted:!1},{title:"New",template:"src/KorboEE/New/KorboEE.new.tmpl.html"}],a.showUse={visibility:!1,disabled:!0},a.showUseAndCopy={visibility:!1,disabled:!0},a.showCopyInEditor={visibility:!1,disabled:!0},a.showMoreInfo={visibility:!1,disabled:!0},a.showSaveAndAdd={visibility:!1,disabled:!0},a.$watch("op",function(b){"search"===b?(a.korboModalTabs.activeTab=0,a.korboModalTabs[0].labelToSearch=a.labelToSearch):"new"===b?(a.korboModalTabs.activeTab=1,a.korboModalTabs[1].entityToCreate=a.entityToCreate):"edit"===b&&(a.korboModalTabs.activeTab=1,a.korboModalTabs[1].idEntityToEdit=a.idEntityToEdit,a.editMode=!0)}),a.$watch("korboModalTabs.activeTab",function(){k()}),a.closeKeeModal=function(){c.showConfirmModal(a.conf.globalObjectName)},a.copyAndUse=function(){var b={label:a.itemSelected.label,"abstract":a.itemSelected.description,type:a.itemSelected.type,depiction:a.itemSelected.image,resource:a.itemSelected.resource},d=i.save(b,a.defaultLan.value,a.conf.endpoint,a.conf.basketID);d.then(function(d){a.conf.useTafonyCompatibility&&(a.directiveScope.label=b.label,a.directiveScope.elemToSearch=b.label,a.directiveScope.location=d);var f={};f.value=d,f.label=b.label,f.type=b.type,f.image=b.depiction,f.description=b.abstract,f.language=a.defaultLan.value,h.fireOnSave(f),h.fireOnCancel(),c.closeModal(),e.setIsOpenModal(!1)},function(){console.log("error to copy entity in korbo")})},a.moreInfo=function(){g.open(a.itemSelected.resource)},a.copyInEditor=function(){c.setEntityToCopy(a.itemSelected),a.korboModalTabs.activeTab=1},a.use=function(){a.conf.useTafonyCompatibility&&("korbo"===a.itemSelected.providerFrom?(a.directiveScope.location=a.itemSelected.location,a.directiveScope.elemToSearch=a.itemSelected.label,a.directiveScope.label=a.itemSelected.label):(a.directiveScope.location=a.itemSelected.resource,a.directiveScope.elemToSearch=a.itemSelected.label,a.directiveScope.label=a.itemSelected.label));var b={};b.value=a.directiveScope.location,b.label=a.itemSelected.label,b.type=a.itemSelected.type,b.image=a.itemSelected.image,b.description=a.itemSelected.description,b.language=a.defaultLan.value,h.fireOnSave(b),h.fireOnCancel(),c.closeModal(),e.setIsOpenModal(!1)},a.itemSelected=null,a.$watch(function(){return c.getSelectedEntity()},function(b){null!==b&&(a.itemSelected=b)});var k=function(){null===a.itemSelected&&(a.showUseButton(),a.showUseAndCopyButton(),a.showCopyInEditorButton(),a.showMoreInfoButton(),a.showSaveAndAddButton())};a.showUseButton=function(){0===a.korboModalTabs.activeTab?"korbo"!==a.currentProv.p&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!1,a.showUseAndCopy.visibility=!0):"korbo"===a.currentProv.p&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1):"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse||(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1):a.showUse.visibility=!1},a.showUseAndCopyButton=function(){1===a.korboModalTabs.activeTab&&(a.showUseAndCopy.visibility=!1)},a.showCopyInEditorButton=function(){a.showCopyInEditor.visibility=0===a.korboModalTabs.activeTab},a.showMoreInfoButton=function(){a.showMoreInfo.visibility=0===a.korboModalTabs.activeTab},a.showSaveAndAddButton=function(){a.showSaveAndAdd.visibility=1===a.korboModalTabs.activeTab}}]),angular.module("KorboEE").controller("KeeNewCtrl",["$scope","$rootScope","$dropdown","$modal","KorboCommunicationService","$q","KorboCommunicationFactory","korboConf","$timeout","$http","TypesHelper","ItemsExchange","ContextualMenu","$window","Config","APIService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=!1,t=new g,u=p.get(a.conf.globalObjectName);a.tabs=[],a.disactiveLanguages=[],a.disactiveLanguagesPopoverTemplate="src/KorboEE/New/KorboEE.languagesPopover.tmpl.html",a.imageUrl="",a.saveClicked=!1,a.activeFilter=!1,a.isSaving=!1,a.originalUrlCheck=!0,a.loadingStatus=!1,a.topArea={message:"You are creating a new entity",status:"info"},a.typeFilter={label:""},n[a.conf.globalObjectName].onCancel(function(){m.wipeActionsByType("advancedMenu")});var v=function(){a.types=[]},w=function(b){m.addAction({name:"rml"+b.name,type:"advancedMenu",label:"Remove "+b.name,priority:1,showIf:function(){return!0},action:function(b){return function(){a.tabs.length>1&&a.removeLanguage(b)}}(b)})},x=function(b){1===a.tabs.length?(w(b),m.modifyHeaderActionByName("rml"+a.tabs[0].name,!0)):2===a.tabs.length?(w(b),m.modifyHeaderActionByName("rml"+a.tabs[0].name,!1)):a.tabs.length>2&&w(b)},y=function(){m.addAction({name:"editURL",type:"advancedMenu",label:"Edit original URL",priority:3,showIf:function(){return!0},action:function(){a.originalUrlCheck=!1,m.modifyHeaderActionByName("editURL",!0)}}),m.addAction({name:"searchOriginalURL",type:"advancedMenu",label:"Search original URL",priority:3,showIf:function(){return a.editMode},action:function(){a.korboModalTabs.activeTab=0,s=!1}}),m.addAction({name:"searchAndCopy",type:"advancedMenu",label:"Search and copy from LOD",priority:3,showIf:function(){return a.editMode},action:function(){a.korboModalTabs.activeTab=0,s=!0}}),m.addDivider({priority:3,type:"advancedMenu"})};y();var z=function(){var b=angular.copy(a.conf.type);for(var c in b){var d=a.types.map(function(a){return a.URI}).indexOf(b[c].URI);if(-1===d){var e={};e.URI=b[c].URI,e.label=b[c].label,e.checked=b[c].state||!1,a.types.push(e)}else a.types[d].checked=!0}},A=function(b){for(var c=0;c<b.length;c++){var d=a.types.map(function(a){return a.URI}).indexOf(b[c]);if(-1===d){var e={};e.URI=b[c],e.label=k.getLabel(b[c]),e.checked=!0,a.types.push(e)}else a.types[d].checked=!0}},B=function(){for(var b=0;b<a.conf.languages.length;b++){var c=angular.uppercase(a.conf.languages[b].value),d=angular.lowercase(a.conf.languages[b].name),e=a.tabs.map(function(a){return angular.lowercase(a.title)}).indexOf(angular.lowercase(c));if(-1!==e)return;var f={title:c,name:a.conf.languages[b].name,description:"",label:"",mandatory:!0,hasError:!1,tooltipMessageTitle:G+d,tooltipMessageDescription:H+d,tooltipMessageError:"message",tooltipMessageErrorTab:"There are some errors in the "+d+" languages fields"};"undefined"!=typeof a.entityToCreate&&null!==a.entityToCreate&&(f.label=a.entityToCreate.label),a.conf.languages[b].state?(a.tabs.push(f),x(f)):a.disactiveLanguages.push(f)}};a.prevBasketID;var C=function(b,c){a.topArea={message:"Loading entity...",status:"info"},a.loadingStatus=!0;var d="korbo"===c?null:a.conf.basketID,f={item:{uri:b},provider:c,endpoint:a.conf.endpoint,basketID:d,language:a.defaultLan.value},g=a.conf.languages;e.buildLanguagesObject(f,g).then(function(b){"undefined"!=typeof b.basketId&&null!==b.basketId?(a.prevBasketID=b.basketId,r=b.basketId):r=a.prevBasketID,a.imageUrl=b.imageUrl,a.originalUrl=b.originalUrl,v(),A(b.types),z();for(var c in b.languages)a.tabs.push(b.languages[c]),x(b.languages[c]);B(),a.topArea={message:"You are editing the entity...",status:"info"},a.loadingStatus=!1},function(){a.topArea={message:"Error getting entity info!",status:"error"}})},D=function(){for(var b=!0,c=0;c<a.tabs.length;c++)!function(c){"undefined"==typeof a.tabs[c].label||""===a.tabs[c].label?(a.tabs[c].hasError=!0,b=!1,a.tabs[c].tooltipMessageError=I):a.tabs[c].label.length<a.conf.labelMinLength?(a.tabs[c].hasError=!0,b=!1,a.tabs[c].tooltipMessageError=J):a.tabs[c].hasError=!1}(c);return b};a.defaultLan=a.conf.languages[0];for(var E in a.conf.languages)if(a.conf.languages[E].state===!0){a.defaultLan=a.conf.languages[E];break}"undefined"!=typeof a.idEntityToEdit&&null!==a.idEntityToEdit&&C(a.idEntityToEdit,"korbo"),a.imageUrlErrorMessage="Invalid URL",a.imageUrlTooltipeMessage="Depiction URL",a.imageUrlHasError=!1;var F=new RegExp("(http|ftp|https)://[a-z0-9-_]+(.[a-z0-9-_]+)+([a-z0-9-.,@?^=%&;:/~+#]*[a-z0-9-@?^=%&;/~+#])?","i"),G="Insert title of the entity in ",H="Insert description of the entity in ",I="The Title field is mandatory and must be filled",J=" The Title must be contain at least "+a.conf.labelMinLength+" characters";a.typesHasError=!1,a.typesErrorMessage="You must select at least one type",a.typesTooltipeMessage="Select at least one type",a.editMode||(v(),B(),z()),a.updateTypes=function(){var b=0;for(var c in a.types)a.types[c].checked&&b++;return a.saveClicked&&(a.typesHasError=0===b?!0:!1),b},a.checkUrl=function(){return""===a.imageUrl||F.test(a.imageUrl)?(a.saveClicked&&(a.imageUrlHasError=!1),!0):(a.saveClicked&&(a.imageUrlHasError=!0),!1)},a.updateTitleField=function(b){""===a.tabs[b].label?a.tabs[b].tooltipMessageError=I:""!==a.tabs[b].label&&a.tabs[b].label.length<a.conf.labelMinLength?a.tabs[b].tooltipMessageError=J:""!==a.tabs[b].label&&a.tabs[b].label.length>=a.conf.labelMinLength&&(a.tabs[b].hasError=!1)},a.save=function(){a.saveClicked=!0;var b=D();if(a.updateTypes(),a.checkUrl(),a.imageUrlHasError||a.typesHasError||!b)a.topArea.message="Some errors occurred! Check the fields and try to save again...!",a.topArea.status="error";else{a.isSaving=!0,a.topArea.message="Saving entity...",a.topArea.status="info";for(var c=[],d=0;d<a.types.length;d++)a.types[d].checked&&c.push(a.types[d].URI);var g=angular.lowercase(a.tabs[0].title),j={depiction:a.imageUrl,type:c,resource:a.originalUrl},k={};k.label=a.tabs[0].label,k.type=c,k.image=a.imageUrl,k.description=a.tabs[0].label,k.language=a.defaultLan.value;var l;a.editMode?(j.id=String(a.idEntityToEdit),l=r):l=a.conf.basketID;var n=t.save(j,g,a.conf.endpoint,l);n.then(function(b){var c;c=a.editMode?String(a.idEntityToEdit):b.substring(b.lastIndexOf("/")+1);for(var d=b,g=[],j=0;j<a.tabs.length;j++)!function(b){var d=angular.lowercase(a.tabs[b].title),e={id:c,label:a.tabs[b].label,"abstract":a.tabs[b].description},f=t.save(e,d,a.conf.endpoint,l);g.push(f)}(j);f.all(g).then(function(){a.isSaving=!1,a.conf.useTafonyCompatibility&&(a.directiveScope.location=d,a.directiveScope.elemToSearch=a.tabs[0].label,a.directiveScope.label=a.tabs[0].label),a.topAreaMessage="Entity saved!",a.topArea.message="Entity saved!",a.topArea.status="info",k.value=d,u.fireOnSave(k),i(function(){m.wipeActionsByType("advancedMenu"),e.closeModal(),u.fireOnCancel(),h.setIsOpenModal(!1)},1e3)},function(){a.topArea.message="Entity saving error!",a.topArea.status="error"})},function(){a.topArea.message="Entity saving error!",a.topArea.status="error"})}},a.clearForm=function(){a.saveClicked=!1;for(var b=0;b<a.tabs.length;b++)!function(b){a.tabs[b].label="",a.tabs[b].description="",a.tabs[b].hasError=!1}(b);v(),z(),a.imageUrl="",a.originalUrl="",e.setEntityToCopy(null),a.topArea.message="You are creating a new entity",a.topArea.status="info"},a.previewImage="",a.errorImage=!1,a.loadingImage=!1;var K;a.$watch("imageUrl",function(b){""!==b&&F.test(b)?(i.cancel(K),K=i(function(){a.loadingImage=!0,j({headers:{Accept:"image/webp,*/*;q=0.8"},method:"HEAD",url:b,cache:!1}).success(function(){a.showImg=!0,a.previewImage=b,a.errorImage=!1,a.loadingImage=!1}).error(function(){a.showImg=!1,a.errorImage=!0,a.loadingImage=!1})},1e3)):(a.showImg=!1,a.errorImage=!1,a.loadingImage=!1)}),a.addLanguage=function(b){var c=a.disactiveLanguages.indexOf(b);a.disactiveLanguages.splice(c,1),a.tabs.push(b),w(b),2===a.tabs.length&&m.modifyHeaderActionByName("rml"+a.tabs[0].name,!1)},a.removeLanguage=function(b){var c=a.tabs.indexOf(b);a.tabs.splice(c,1),a.disactiveLanguages.push(b),m.removeActionByName("rml"+b.name),a.tabs.length<2&&m.modifyHeaderActionByName("rml"+a.tabs[0].name,!0)},a.showDropdown=function(a){var b={name:"resourceName"};m.show(a.pageX,a.pageY,b,"advancedMenu"),a.stopPropagation()},a.typesMouseLeave=function(){i.cancel(q),q=i(function(){a.activeFilter=!1,a.typeFilter.label=""},1e3)},a.typesMouseEnter=function(){i.cancel(q)},a.removeImage=function(){a.imageUrl=""},a.activeAllTypes=function(){for(var b in a.types)a.types[b].checked=!0},a.disableAllTypes=function(){for(var b in a.types)a.types[b].checked=!1},a.$watch(function(){return e.getEntityToCopy()},function(b){null!==b&&(!a.editMode||s?(m.wipeActionsByType("advancedMenu"),y(),a.tabs=[],a.disactiveLanguages=[],C(b.uri,b.providerFrom),s=!1):a.originalUrl=b.resource)}),a.openWindow=function(a){"undefined"!=typeof a&&null!==a&&n.open(a)}}]),angular.module("KorboEE").directive("keeLanguages",function(){return{restrict:"EAC",scope:!0,templateUrl:"src/KorboEE/New/Languages/keeLanguages.dir.tmpl.html",controller:"keeLanguagesCtrl"}}),angular.module("KorboEE").controller("keeLanguagesCtrl",["$document","$window","$rootScope","$scope","Dashboard","$element","EventDispatcher",function(a,b,c,d,e,f,g){var h={animation:"am-fade",offsetButton:40};d.tabs.activeTab=0,d.hiddenTabsDropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",h.animation&&f.addClass(h.animation),d.panes=null,d.hiddenTabs=[],d.$watch("tabs",function(a,b){if(a.length<b.length&&d.setActive(0),!angular.equals(a,d.panes)){d.panes=angular.copy(a);for(var c in d.panes)d.panes[c].isVisible=!0}},!0);var i=0,j=!1;d.$watch(function(){return angular.element(f).children("ul.pnd-tab-header").children("li:not(.pull-right)").length},function(a){a>0&&(i=a,j=!0,m())});var k=0,l=angular.element(f).children("ul.pnd-tab-header");d.$watch(function(){return l.width()},function(a){k=parseInt(a,10),m(),d.hiddenTabIsActive=-1===p()?!1:!0});var m=function(){i>0&&k>0&&(j&&(j=!1,n()),o(k))},n=function(){for(var a=angular.element(f).children("ul.pnd-tab-header").children("li:not(.pull-right)"),b=0;b<a.length;b++){var c=parseInt(angular.element(a[b]).css("width"),10);d.panes[b].width=c}},o=function(a){d.hiddenTabs=[];for(var b,c,e,f=a-h.offsetButton,g=0,i=0;i<d.panes.length;i++){if(b=d.panes[i],e=g+b.width,e>f){c=i;break}g=e}for(i=0;i<d.panes.length;i++)if(b=d.panes[i],c>i||"undefined"==typeof c)b.isVisible=!0;else{b.isVisible=!1;var j={text:b.title,click:"setActive("+i+", $event)"};j.isActive=i===d.tabs.activeTab?!0:!1,d.hiddenTabs.push(j)}},p=function(a){var b;if("undefined"==typeof d.hiddenTabs)return-1;if(0===d.hiddenTabs.length)return-1;if("undefined"==typeof d.tabs.activeTab)return-1;if(""===a||"undefined"==typeof a){var c=d.tabs.activeTab;b=d.panes[c]}else b=a;for(var e=0;e<d.hiddenTabs.length;e++)if(d.hiddenTabs[e].text===b.title)return e;return-1};f.addClass("tabs"),d.active=d.activePane=0,g.addListener("Dashboard.showTab",function(a){for(var b=a.args,c=0;c<d.panes.length;c++)if(d.panes[c].title===b)return d.active!==c&&d.setActive(c),void(d.$parent.isCollapsed&&d.$parent.toggleCollapse())}),d.setActive=function(a){if(0!==d.hiddenTabs.length)for(var b=0;b<d.hiddenTabs.length;b++)d.hiddenTabs[b].isActive=!1;if(d.active=a,d.tabs.activeTab=a,d.panes[a].isVisible)d.hiddenTabIsActive=!1;else{d.hiddenTabIsActive=!0;var c=p(d.panes[a]);d.hiddenTabs[c].isActive=!0}};var q=!1;d.$watch(function(){return d.hiddenTabs},function(){q=d.hiddenTabs.length>0}),d.hiddenTabsToShow=function(){return q}}]),angular.module("KorboEE").controller("KeeSearchCtrl",["$scope","$modal","KorboCommunicationService","KorboCommunicationFactory","ItemsExchange","$timeout","Preview",function(a,b,c,d,e,f,g){var h=new d;a.moduleName="KorboEE",a.previewIsLoading=!1,a.elemToSearch="undefined"!=typeof a.pane.labelToSearch&&""!==a.pane.labelToSearch?a.pane.labelToSearch:"",a.defaultLan=a.conf.languages[0];for(var i in a.conf.languages)if(a.conf.languages[i].state===!0){a.defaultLan=a.conf.languages[i];break}a.contentTabs=[],a.editMode||a.contentTabs.push({title:"Korbo",template:"src/Lists/itemList.tmpl.html",items:[],itemsContainer:"kee-korbo",provider:"korbo",module:"KorboEE",isStarted:!1});for(var j in a.conf.providers)a.conf.providers[j]&&a.contentTabs.push({title:j,template:"src/Lists/itemList.tmpl.html",items:[],itemsContainer:"kee-"+j,provider:j,module:"KorboEE",isStarted:!1});a.active=a.contentTabs.activeTab=0;var k;a.$watch("elemToSearch",function(b){b.length>=a.conf.labelMinLength?(f.cancel(k),k=f(function(){l(b)},a.conf.updateTime)):""===b&&(m(),a.itemSelected=null,a.korboModalTabs[0].totalResults=0,g.clearItemDashboardSticky())}),a.$watch("contentTabs.activeTab",function(b){a.currentProv.p=a.contentTabs[b].provider,null===a.itemSelected&&("korbo"!==a.contentTabs[b].provider&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!1,a.showUseAndCopy.visibility=!0):"korbo"===a.contentTabs[b].provider&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1):"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse||(a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1))});var l=function(b){a.korboModalTabs[0].totalResults=0,a.korboModalTabs[0].isStarted=!0;for(var c=0;c<a.contentTabs.length;c++)!function(c){var d={};d.label=b,d.endpoint=a.conf.endpoint,d.basketID=a.conf.basketID,d.offset=0,d.limit=a.conf.limitSearchResult,d.language=a.defaultLan.value,d.provider=a.contentTabs[c].provider,d.index=c,a.contentTabs[c].isLoading=!0,a.contentTabs[c].isStarted=!0,h.search(d,a.contentTabs[c].itemsContainer).then(function(){a.contentTabs[c].isLoading=!1,a.contentTabs[c].serverError=!1,a.contentTabs[c].items=e.getItemsByContainer(a.contentTabs[c].itemsContainer),a.korboModalTabs[0].totalResults+=a.contentTabs[c].items.length},function(){a.contentTabs[c].isLoading=!1,a.contentTabs[c].serverError=!0})}(c)},m=function(){a.korboModalTabs[0].isStarted=!1;for(var b=0;b<a.contentTabs.length;b++)!function(b){a.contentTabs[b].items=[],a.contentTabs[b].isStarted=!1,e.wipeContainer(a.contentTabs[b].itemsContainer)}(b)};a.previewError=!1,a.getItem=function(b){a.previewIsLoading=!0,a.previewError=!1;var c={};c.endpoint=a.conf.endpoint,c.basketID="korbo"===a.contentTabs[a.contentTabs.activeTab].provider?"null":a.conf.basketID,c.language=a.defaultLan.value,c.provider=a.contentTabs[a.contentTabs.activeTab].provider,c.item=b;var d=h.getItem(c,!0);d.then(function(d){if(""===d.label)c.language=d.available_languages[0],h.getItem(c,!0).then(function(c){var d=e.getItemByUri(b.uri);d.description=c.abstract,d.type=angular.copy(c.type),d.image=c.depiction,d.location=c.uri,d.resource=c.resource,g.showDashboardPreview(d),a.previewIsLoading=!1,a.previewError=!1},function(){g.hideDashboardPreview(),a.previewIsLoading=!1,a.previewError=!0});else{var f=e.getItemByUri(b.uri);f.description=d.abstract,f.type=angular.copy(d.type),f.image=d.depiction,f.location=d.uri,f.resource=d.resource,g.showDashboardPreview(f),a.previewIsLoading=!1,a.previewError=!1}},function(){g.hideDashboardPreview(),a.previewIsLoading=!1,a.previewError=!0})},a.itemSelected=null,a.isUseActive=!1,a.select=function(b){g.setItemDashboardSticky(b),a.isUseActive=!0,a.itemSelected=b,a.itemSelected.providerFrom=a.contentTabs[a.contentTabs.activeTab].provider,c.setSelectedEntity(a.itemSelected),a.showMoreInfo.disabled="freebase"===a.itemSelected.providerFrom?!1:!0,"korbo"===a.itemSelected.providerFrom&&(a.showUse.disabled=!1,a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1),"korbo"!==a.itemSelected.providerFrom&&"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse?(a.showUseAndCopy.disabled=!1,a.showUse.visibility=!1,a.showUseAndCopy.visibility=!0):"korbo"===a.itemSelected.providerFrom||"undefined"!=typeof a.conf.copyToKorboBeforeUse&&a.conf.copyToKorboBeforeUse||(a.showUse.disabled=!1,a.showUse.visibility=!0,a.showUseAndCopy.visibility=!1),-1!==a.conf.visualizeCopyButton.indexOf(a.contentTabs[a.contentTabs.activeTab].provider)?(a.showCopyInEditor.visibility=!0,a.showCopyInEditor.disabled=!1):a.showCopyInEditor.disabled=!0},a.isSelected=function(b){return null!==a.itemSelected&&a.itemSelected.uri===b.uri?!0:!1},a.onMouseLeave=function(){g.hideDashboardPreview(),a.previewIsLoading=!1,a.previewError=!1}}]);